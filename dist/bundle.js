var ke=Object.defineProperty;var Pe=(O,e,t)=>e in O?ke(O,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):O[e]=t;var $=(O,e,t)=>Pe(O,typeof e!="symbol"?e+"":e,t);(function(){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`.litegraph-editor{width:100%;height:100%;margin:0;padding:0;background-color:#333;color:#eee;font:14px Tahoma;position:relative}.litegraph-editor h1{font-family:Metro Light,Tahoma;color:#ddd;font-size:28px;padding-left:10px;margin:0;font-weight:400}.litegraph-editor h1 span{font-family:Arial;font-size:14px;font-weight:400;color:#aaa}.litegraph-editor h2{font-family:Metro Light;padding:5px;margin-left:10px}.litegraph-editor *{box-sizing:border-box;-moz-box-sizing:border-box}.litegraph-editor .content{position:relative;width:100%;height:calc(100% - 80px);background-color:#1a1a1a}.litegraph-editor .header,.litegraph-editor .footer{position:relative;height:40px;background-color:#333}.litegraph-editor .tools,.litegraph-editor .tools-left,.litegraph-editor .tools-right{position:absolute;top:2px;right:0;vertical-align:top;margin:2px 5px 0 0}.litegraph-editor .tools-left{right:auto;left:4px}.litegraph-editor .footer{height:40px;position:relative}.litegraph-editor .miniwindow{background-color:#333;border:1px solid #111}.litegraph-editor .miniwindow .corner-button{position:absolute;top:2px;right:2px;font-family:Tahoma;font-size:14px;color:#aaa;cursor:pointer}.litegraph-editor .btn{color:#ccc;font-size:20px;min-width:30px;border:0 solid #666;background-color:#3f3f3f;padding:4px 10px;cursor:pointer;transition:all 1s;-moz-transition:all 1s;-webkit-transition:all .4s}.litegraph-editor button:hover{background-color:#999;color:#fff;transition:all 1s;-moz-transition:all 1s;-webkit-transition:all .4s}.litegraph-editor button:active{background-color:#fff}.litegraph-editor button.fixed{position:absolute;top:5px;right:5px;font-size:1.2em}.litegraph-editor button img{margin:-4px;vertical-align:top;opacity:.8;transition:all 1s}.litegraph-editor button:hover img{opacity:1}.litegraph-editor .header button{height:32px;vertical-align:top}.litegraph-editor .toolbar-widget{display:inline-block}.litegraph-editor .editor-area{width:100%;height:100%}.litegraph-editor .loadmeter{font-family:Tahoma;color:#aaa;font-size:12px;border-radius:2px;width:130px;vertical-align:top}.litegraph-editor .strong{vertical-align:top;padding:3px;width:30px;display:inline-block;line-height:8px}.litegraph-editor .cpuload .bgload,.litegraph-editor .gpuload .bgload{display:inline-block;width:90px;height:15px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAPCAIAAADriU8RAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAALWSURBVHja7NfbkqM2EAbgXwdOMkiZGZNNZnn/5wu7swsYkNLdWGO7dq9zE1Mu1VddgH4aXCUZKAU6jEZpGSmRVWl+tRKrbF1qqUMZpa/nsE2ua65rJbfRXD8uJePetsSvNmKVXRS3+oNvkVHcIqO89zUOKPqDVTYg0x6mK+g636g+KMK8qtDovoNYh9r2LTnNm2G7wzaUZd/QDeK8F6Gs+5rKcY5lKJq+pPrOtq63dP42pyqYU2+oTq6D7nqaFOuMJijfq8MuIPQ8Lfnk8ccZKeKyoO3w8sp1ctfi9YXrywXdCW8BMWFZKT7OndQ3+Brnk9TJJTgmPcqOUECiYY4IBhINc0JQeNNYwT99fB3qVKvhrOiuZO/08KqvbuzwomkGOtVX5RCM51ZaX1VDa68umsEVnt9a4W07NKXnt1Z564eq9Easw2BpJDdevQ6mETuv3gZNlaN+HpTzkDr+/IpTx6bxyzvalk3jX1/QnsQOf5/RcUx0Du8v2RW+ekg0+ApDm11gaCDRQKGGAhKBx3eNWj4QKfAzGbjq+vEVRrH5MRS7VNnaFdnasPlyXWjrrL7Z6EKJVeG0EdNYPlgZ+eZprBys2D66vnPTwEo0Gps6x7Rwnz7im+wyW8NZSDQx/b/kP0Kj09nUfQXz0I7n8WzHsx3Pdjzb8WzHsx3PdvxX7YiR17pbZG8xPXhL4vTouOzZSZwO70uM4vjobUnZEOPwuuDeu3jfeUlO49WX35ti7hJzl+X5771DpuVxiXdO2cAlQUiLMVqk05aMVqW0yh9/YLrwCnVPafyZbp7StCqryfs4x2kjJ+rAuIgVeR3XfdrJoMTjuk1Rcx3zuH96GuM6JUObhR0/x3TJ/jHiMoHOiVzHMuGof3w64vuIeeZtG7247x+Yl6u/fXDkw+Mk1vIoM6YNHJnql2yqr5giOCY5Ykpsat0/tCfihhw72uL/vkiX2+BfAQYA+5e7SPxhYhIAAAAASUVORK5CYII=)}.litegraph-editor .cpuload .fgload,.litegraph-editor .gpuload .fgload{display:inline-block;width:4px;height:15px;max-width:90px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAAPCAIAAADriU8RAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAASUSURBVHja7Jfvb9tEHMYf27Edx3aaxFk72q5pu87buqrtLgwhNGnSBIMZIV7AKwRIIPC/aiaNF5MQmvjhweY6/Z0uTuLEP3d36RD/AK/Ivfjmo8tFee65e6T7SpBElCUMTbBMAUCSCUZVtAxcsipZBp0vk1w01IpVm7FkKIpVpVwkRcWQFUsFZ9moVC0ZECgrhqQxRp6UqiHqlvSWBcMS6W+zBFVDMC32t5Q1A3UL//BCC/SLNEFNR6PJ5tMUeg3NhbesoVXnnMGookUll0hyGCpaNS6fsgKryrmAUYGl8DV0uxKsCp+nLMASkZfIAAmagjQXdjekz+4JSVoGZ5XuhuLsI0mL4FztdnTnDuUsuNC6qw3HLpM0CQZm9+oVZ71MskkwbHTby84q9WgcjNvdRsdZLJJ8GEyWuuaW06C+DIJkpavddvQ8KS6CrNNVdh2V+nIeFBtdiThSnuAsKLe6wnuOQPd/GuDmXXzwCbIpjg9wew8PHiKd4rCHnTt4eJ9x7xi7Nj68x/wKT7G/gUe7zKODPu6u4rFNJSMYgCzh03V6rAhG6DbhLDKPggm6OhyTeRRk6Mp4JOOkwFkJERV2aML2tYr7sUg2KVfIpuY+lMk6ZYV06u59lVyjXCMrbfddnSxTNsnSiru7QBYpN0l707VbpEW5TRrbbmeRsBNcIgZxl5aJTnmFaO+7zVXCLtEaUR64tQ5hp7NJpI9ceZOwC7JFhMeucIOwQ7tJ8Pn3uLXPeHsPX36N7R3GO9v46gvs3GJM7fjGwd51xnsb+O4B9tcYUzt+uAcuk9nx4w5Im3MLbgeEXygqym2BywGR8a2KNSaB2iGwT2GhJtjLNC+MLUOyr87yIlq6bC9KFtuSZNWqdrtiaZRlS6vZTZlfRJoU066rPC+qpTRsnecFNCktW9P4paxZ0hVbmeVFt8Qlu0LzQtmwhHdscZYX08KKfZmXegtrN1he6FhoYn3zMi+NBjY6l3lp1nF9FU0mmSVl6ypaOucabrTRYjJZUuzGZV5oUmwDXBpLiq2Cy2FJuS5Bv7RjPv415nbM7ZjbMbdjbsfcjrkd/70dZZyU4XkZxYyjSRH2aWVtSDTJwtdFNOU8TcMojxLWekTJNBxmnLMojcNxGqWsfYiyUThJooy1A3RtmNBKeRoVgzCjlfIkKi/CnNYZ98MyjpgGWs9CzHgc4bSH8ZDxaIjjI4xGnEc4OsFozHg4xuEZhjHnCXoXrDKmT/gBuDRWwxG4NFBR4QRcGqioMAWXAyrkuABfTnsW+khPM8HU6Mu+8J6X/hHjOMm833P/WDSrlCfei9Q/lUyVujbyXk39fsVUijgbeL2x/1o25TzOzr2ToT+UzUoR50de/7U/Vkwpj4sDL+r7U9UUs7j824vP/LTK+U8vOfFzzRSSGL95+ZFfarSJiPHcQ89HjfMvT3DwArqBaYxnT/HqJXQd0wl+foaXBzBqmEzx9Ff8dchaOMpP/sCLU9bCTVL89BJ+H6aCOIXXgz+AKSPO4J3Dj2FKiHN4I/gpTBHTEl6KQ3ZAkjh75f6fH+m2hDp/pL8RYACY9BgwCiiMiQAAAABJRU5ErkJggg==)}.litegraph-editor textarea.code,.litegraph-editor div.code{height:100%;width:100%;background-color:#000;padding:4px;font:16px monospace;overflow:auto;resize:none;outline:none;color:#ddd}.litegraph-editor .codeflask{background-color:#2a2a2a}.litegraph-editor .codeflask textarea{opacity:0}.lgraphcanvas{user-select:none;-moz-user-select:none;-webkit-user-select:none;outline:none;font-family:Poppins,Noto Sans KR,sans-serif}.litegraph.litecontextmenu{font-family:Poppins,Noto Sans KR,sans-serif;position:fixed;top:100px;left:100px;min-width:100px;color:#aaf;padding:0;box-shadow:0 0 10px #000!important;background-color:#2e2e2e!important;z-index:10}.litegraph.litecontextmenu.dark{background-color:#000!important}.litegraph.litecontextmenu.dark .litemenu-entry.submenu{background-color:#000!important}.litegraph .litemenubar ul{font-family:Poppins,Noto Sans KR,sans-serif;margin:0;padding:0}.litegraph .litegraph .litemenubar-panel{position:absolute;top:5px;left:5px;min-width:100px;background-color:#444;box-shadow:0 0 3px #000;padding:4px;border-bottom:2px solid #aaf;z-index:10}.litegraph .litemenu-entry.separator{display:block;width:100%;height:0px;margin:3px 0 2px;background-color:transparent;padding:0!important;cursor:default!important}.litegraph.litesearchbox{font-family:Poppins,Noto Sans KR,sans-serif;position:absolute;background-color:#00000080;padding-top:4px;z-index:2000}.litegraph.litesearchbox input,.litegraph.litesearchbox select{margin-top:3px;min-width:60px;min-height:1.5em;background-color:#000;border:0;color:#fff;padding-left:10px;margin-right:5px}.litegraph.lite-search-item{font-family:Poppins,Noto Sans KR,sans-serif;background-color:#00000080;color:#fff;padding-top:2px}.litegraph.lite-search-item:hover,.litegraph.lite-search-item.selected{cursor:pointer;background-color:#fff;color:#000}.litegraph.dialog{z-index:100;position:absolute;top:50%;left:50%;margin-top:-150px;margin-left:-200px;background-color:#2a2a2a;min-width:400px;min-height:200px;box-shadow:0 0 4px #111;border-radius:6px;color:#fff}.litegraph.dialog.settings{left:10px;top:10px;height:calc(100% - 20px);margin:auto;max-width:50%}.litegraph.dialog .close{float:right;margin:4px 10px 4px 4px;cursor:pointer;font-size:1.4em}.litegraph.dialog .close:hover{color:#fff}.litegraph.dialog .dialog-header{border-bottom:1px solid #161616}.litegraph.dialog .dialog-footer{height:50px;padding:10px;border-top:1px solid #1a1a1a}.litegraph.dialog .dialog-header .dialog-title{font:20px Arial;margin:4px;padding:4px 10px;display:inline-block}.litegraph.dialog .dialog-content,.litegraph.dialog .dialog-alt-content{height:calc(100% - 90px);width:100%;min-height:100px;display:inline-block;overflow:auto}.litegraph.dialog .dialog-content h4{margin:10px;color:#fff}.litegraph.dialog .dialog-content .connections .connections_side{width:calc(50% - 5px);min-height:100px;background-color:#000;display:flex}.litegraph.dialog .separator{display:block;width:calc(100% - 4px);height:1px;margin:10px 2px;padding:0;border-top:none!important;border-bottom:1px solid #5d5d5d!important}.litegraph.dialog .property{margin-bottom:2px;padding:4px}.litegraph.dialog .property:hover{background:#545454}.litegraph.dialog .property_name{display:inline-block;text-align:left;vertical-align:top;width:160px;padding-left:4px;overflow:hidden;margin-right:6px}.litegraph.dialog .property:hover .property_name{color:#fff}.litegraph.dialog .property_value{display:inline-block;text-align:right;color:#aaa;background-color:#1a1a1a;max-width:calc(100% - 162px);min-width:200px;max-height:300px;min-height:20px;padding:4px 12px 4px 4px;overflow:hidden;cursor:pointer;border-radius:3px}.litegraph.dialog .property_value:hover{color:#fff}.litegraph.dialog .btn{border:0;border-radius:4px;padding:4px 20px;margin-left:0;background-color:#060606;color:#8e8e8e}.litegraph.dialog .btn:hover{background-color:#111;color:#fff}.litegraph.dialog .btn.delete{color:#fff;background-color:#f46a6a;border-color:#f46a6a}.litegraph.dialog .btn.delete:hover{color:#fff;background-color:#cf5a5a;border-color:#c35555}.litegraph.dialog .btn.delete:focus{color:#fff;background-color:#cf5a5a;border-color:#c35555;-webkit-box-shadow:0 0 0 .15rem rgba(246,128,128,.5);box-shadow:0 0 0 .15rem #f6808080}.graphdialog{position:absolute;top:10px;left:10px;min-height:2em;background-color:#333;font-size:1.2em;box-shadow:0 0 10px #000!important;z-index:10}.graphdialog.rounded{border-radius:12px;padding-right:2px}.graphdialog .name{display:inline-block;min-width:60px;min-height:1.5em;padding-left:10px}.graphdialog input,.graphdialog textarea,.graphdialog select{margin:3px;min-width:60px;min-height:1.5em;background-color:#000;border:0;color:#fff;padding-left:10px;outline:none}.graphdialog button{margin-top:3px;vertical-align:top;background-color:#999;border:0}.graphdialog .help-item:hover,.graphdialog .help-item.selected{cursor:pointer;background-color:#fff;color:#000}.lgraphcanvas{user-select:none;-moz-user-select:none;-webkit-user-select:none;outline:none;font-family:NotoSans,Poppins,Arial,sans-serif;width:100%;height:100%}.lgraphcanvas *{box-sizing:border-box}.litegraph.litecontextmenu{font-family:NotoSans,Poppins,Arial,sans-serif;position:fixed;top:100px;left:100px;min-width:100px;color:#aaf;padding:0;box-shadow:0 0 10px #000!important;background-color:#2e2e2e!important;z-index:10}.litegraph.litecontextmenu.dark{background-color:#292929!important}.litegraph.litecontextmenu .litemenu-title img{margin-top:2px;margin-left:2px;margin-right:4px}.litegraph.litecontextmenu .litemenu-entry{margin:2px;padding:2px}.litegraph.litecontextmenu .litemenu-entry.submenu{background-color:#2e2e2e!important}.litegraph.litecontextmenu.dark .litemenu-entry.submenu{background-color:#292929!important}.litegraph .litemenubar ul{font-family:NotoSans,Poppins,Arial,sans-serif;margin:0;padding:0}.litegraph .litemenubar li{font-size:14px;color:#999;display:inline-block;min-width:50px;padding-left:10px;padding-right:10px;user-select:none;-moz-user-select:none;-webkit-user-select:none;cursor:pointer}.litegraph .litemenubar li:hover{background-color:#777;color:#eee}.litegraph .litegraph .litemenubar-panel{position:absolute;top:5px;left:5px;min-width:100px;background-color:#444;padding:4px;border-bottom:2px solid #aaf;z-index:10}.litegraph .litemenu-entry,.litemenu-title{font-size:12px;color:#aaa;margin:2px;padding:0 0 0 2px;-moz-user-select:none;-webkit-user-select:none;user-select:none;cursor:pointer}.litegraph .litemenu-entry .icon{display:inline-block;width:12px;height:12px;margin:2px;vertical-align:top}.litegraph .litemenu-entry.checked .icon{background-color:#aaf}.litegraph .litemenu-entry .more{float:right;padding-right:5px}.litegraph .litemenu-entry.disabled{opacity:.5;cursor:default}.litegraph .litemenu-entry.separator{display:block;border-top:none!important;border-bottom:1px solid rgb(128 128 128)!important;width:100%;height:0px;margin:3px 0 2px;background-color:transparent;padding:0!important;cursor:default!important}.litegraph .litemenu-entry.has_submenu{border-right:2px solid cyan}.litegraph .litemenu-title{color:#dde;background-color:#111;margin:0;padding:2px;cursor:default}.litegraph .litemenu-entry:hover:not(.disabled):not(.separator){background-color:#444!important;color:#eee;transition:all .2s}.litegraph .litemenu-entry .property_name{display:inline-block;text-align:left;min-width:80px;min-height:1.2em}.litegraph .litemenu-entry .property_value{display:inline-block;background-color:#00000080;text-align:right;min-width:80px;min-height:1.2em;vertical-align:middle;padding-right:10px}.litegraph.litesearchbox{font-family:NotoSans,Poppins,Arial,sans-serif;position:absolute;background-color:#00000080;padding-top:4px}.litegraph.litesearchbox input,.litegraph.litesearchbox select{margin-top:3px;min-width:60px;min-height:1.5em;background-color:#000;border:0;color:#d1d1d1;padding-left:10px;margin-right:5px}.litegraph.litesearchbox .name{display:inline-block;min-width:60px;min-height:1.5em;padding-left:10px}.litegraph.litesearchbox .helper{overflow:auto;max-height:200px;margin-top:2px}.litegraph.lite-search-item{font-family:NotoSans,Poppins,Arial,sans-serif;background-color:#00000080;color:#d1d1d1;padding-top:2px}.litegraph.lite-search-item.not_in_filter{color:#b99;font-style:italic}.litegraph.lite-search-item.generic_type{color:#999;font-style:italic}.litegraph.lite-search-item:hover,.litegraph.lite-search-item.selected{cursor:pointer;background-color:#d1d1d1;color:#000}.litegraph.dialog{position:absolute;top:50%;left:50%;margin-top:-150px;margin-left:-200px;background-color:#474747;min-width:400px;min-height:200px;border-radius:6px}.litegraph.dialog.settings{left:0;top:0;height:100%;margin:auto;max-width:50%}.litegraph.dialog.centered{top:50px;left:50%;position:absolute;transform:translate(-50%);min-width:600px;min-height:300px;height:calc(100% - 100px);margin:auto}.litegraph.dialog .close{cursor:pointer;font-size:1.4em;text-shadow:none;position:absolute;right:8px;top:50%;transform:translateY(-50%)}.litegraph.dialog .dialog-header{color:#d1d1d1;border-bottom:1px solid #5d5d5d;font-weight:600;position:relative}.litegraph.dialog .dialog-header{height:40px}.litegraph.dialog .dialog-footer{display:flex;justify-content:end;padding:10px;border-top:1px solid rgba(71,71,71,1)}.litegraph.dialog .dialog-header .dialog-title{font-size:18px;margin:4px;padding:4px 10px;display:inline-block;font-weight:700}.litegraph.dialog .dialog-content,.litegraph.dialog .dialog-alt-content{height:calc(100% - 90px);width:100%;min-height:100px;display:inline-block;color:#d1d1d1;overflow:auto}.litegraph.dialog .dialog-content .panel-section{padding:10px}.litegraph.dialog .dialog-content .connections{flex-direction:row}.litegraph.dialog .dialog-content .connections .connections_side{width:calc(50% - 5px);min-height:100px;background-color:#474747;display:flex}.litegraph.dialog .node_type{font-size:1.2em;display:block;margin:10px}.litegraph.dialog .node_desc{opacity:.5;display:block;margin:10px}.litegraph.dialog .separator{display:block;width:calc(100% - 4px);height:1px;border-top:none!important;border-bottom:1px solid #5d5d5d!important;margin:10px 2px;padding:0}.litegraph.dialog .property{margin-bottom:2px;padding:4px;display:flex;align-items:center}.litegraph.dialog .property_name{color:#d1d1d1;display:inline-block;text-align:left;vertical-align:top;width:160px;padding-left:4px;overflow:hidden;margin-right:6px}.litegraph.dialog .property:hover .property_name{color:#d1d1d1}.litegraph.dialog .property_value,.property_value_input{display:inline-block;text-align:right;color:#aaa;background-color:#292929;max-width:200px;min-width:200px;max-height:300px;min-height:20px;padding:2px 12px 2px 2px;overflow:hidden;cursor:pointer;border-radius:3px;font-size:1rem;border:none}.litegraph.dialog .property_value.disabled,.property_value_input.disabled{background-color:#5c5c5c}.property_value_input:focus-visible{outline:none}.litegraph.dialog .property_value:hover{color:#d1d1d1}.litegraph.dialog .property.boolean .property_value{padding-right:30px;color:#a88}.litegraph.dialog .property.boolean.bool-on .property_name,.litegraph.dialog .property.boolean.bool-on .property_value{color:#8a8}.litegraph.dialog .btn{border:0;border-radius:4px;padding:4px 20px;margin-left:0;background-color:transparent;color:#8e8e8e;cursor:pointer}.litegraph.dialog .btn:hover{background-color:#414141;color:#d1d1d1}.litegraph.dialog .btn.delete{background-color:transparent;color:#d1d1d1;border:1px solid #7f8a93}.litegraph.dialog .btn.delete:hover{background-color:#414141;color:#d1d1d1}.litegraph .subgraph_property{padding:4px}.litegraph .subgraph_property:hover{background-color:#333}.litegraph .subgraph_property.extra{margin-top:8px}.litegraph .subgraph_property span.name{font-size:1.3em;padding-left:4px}.litegraph .subgraph_property span.type{opacity:.5;margin-right:20px;padding-left:4px}.litegraph .subgraph_property span.label{display:inline-block;width:60px;padding:0 10px}.litegraph .subgraph_property input{width:140px;color:#999;background-color:#1a1a1a;border-radius:4px;border:0;margin-right:10px;padding:4px 4px 4px 10px}.litegraph .subgraph_property button{background-color:#1c1c1c;color:#aaa;border:0;border-radius:2px;padding:4px 10px;cursor:pointer}.litegraph .subgraph_property.extra{color:#ccc}.litegraph .subgraph_property.extra input{background-color:#111}.litegraph .bullet_icon{margin-left:10px;border-radius:10px;width:12px;height:12px;background-color:#666;display:inline-block;margin-top:2px;margin-right:4px;transition:background-color .1s ease 0s;-moz-transition:background-color .1s ease 0s}.litegraph .bullet_icon:hover{background-color:#698;cursor:pointer}.graphcontextmenu{padding:4px;min-width:100px}.graphcontextmenu-title{color:#dde;background-color:#222;margin:0;padding:2px;cursor:default}.graphmenu-entry{box-sizing:border-box;margin:2px;padding-left:20px;user-select:none;-moz-user-select:none;-webkit-user-select:none;transition:all linear .3s}.graphmenu-entry.event,.litemenu-entry.event{border-left:8px solid orange;padding-left:12px}.graphmenu-entry.disabled{opacity:.3}.graphmenu-entry.submenu{border-right:2px solid #eee}.graphmenu-entry:hover{background-color:#555}.graphmenu-entry.separator{background-color:#111;border-bottom:1px solid #666;height:1px;width:calc(100% - 20px);-moz-width:calc(100% - 20px);-webkit-width:calc(100% - 20px)}.graphmenu-entry .property_name{display:inline-block;text-align:left;min-width:80px;min-height:1.2em}.graphmenu-entry .property_value,.litemenu-entry .property_value{display:inline-block;background-color:#00000080;text-align:right;min-width:80px;min-height:1.2em;vertical-align:middle;padding-right:10px}.graphdialog{position:absolute;top:10px;left:10px;min-height:2em;background-color:#474747;font-size:1.2em;z-index:10;display:flex;align-items:center;border-radius:2px}.graphdialog.rounded{border-radius:12px;padding-right:2px;display:flex;flex-direction:column}.graphdialog.rounded input{width:90%}.graphdialog .name{display:inline-block;min-width:60px;min-height:1.5em;padding-left:10px;color:#d1d1d1}.graphdialog input,.graphdialog textarea,.graphdialog select{margin:3px;min-width:60px;min-height:1.5em;background-color:#1a1a1a;border:0;color:#d1d1d1;padding-left:10px;outline:none;border:2px}.graphdialog textarea{min-height:150px}.graphdialog button{vertical-align:top;background-color:#999;border:0;border-radius:2px;margin:0 10px}.graphdialog button.rounded,.graphdialog input.rounded{border-radius:0 12px 12px 0}.graphdialog .helper{overflow:auto;max-height:200px}.graphdialog .help-item{padding-left:10px}.graphdialog .help-item:hover,.graphdialog .help-item.selected{cursor:pointer;background-color:#d1d1d1;color:#000}.litegraph.dialog{min-height:0}.litegraph.dialog .dialog-content{display:block}.litegraph.dialog .dialog-content .subgraph_property{padding:5px}.litegraph.dialog .dialog-footer{margin:0}.litegraph.dialog .dialog-footer .subgraph_property{margin-top:0;display:flex;align-items:center;padding:5px}.litegraph.dialog .dialog-footer .subgraph_property .name{flex:1}.litegraph .graphdialog{display:flex;align-items:center;border-radius:20px;padding:4px 10px;position:fixed}.litegraph .graphdialog .name{padding:0;min-height:0;font-size:16px;vertical-align:middle}.litegraph .graphdialog .value{font-size:16px;min-height:0;margin:0 10px;padding:2px 5px}.litegraph .graphdialog input[type=checkbox]{width:16px;height:16px}.litegraph .graphdialog button{padding:4px 18px;border-radius:20px;cursor:pointer}#grpSizeDialog,#nodeSizeDialog{border-radius:6px}#grpSizeDialog .main-tit,#nodeSizeDialog .main-tit{font-size:18px;font-weight:700;color:#d1d1d1}#grpSizeDialog .sub-prop,#nodeSizeDialog .sub-prop{color:#d1d1d1}.btn-save-image{color:#d1d1d1!important;border:1px solid #7f8a93!important}
/*$vite$:1*/`,document.head.appendChild(__vite_style__);var EPSILON=1e-6,ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array,RANDOM=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function create$5(){var e=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function fromMat4(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function clone$5(e){var t=new ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function copy$5(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function fromValues$5(e,t,r,n,a,s,o,l,c){var u=new ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=a,u[5]=s,u[6]=o,u[7]=l,u[8]=c,u}function set$5(e,t,r,n,a,s,o,l,c,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=o,e[6]=l,e[7]=c,e[8]=u,e}function identity$2(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function transpose$1(e,t){if(e===t){var r=t[1],n=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function invert$2(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=h*o-l*u,f=-h*s+l*c,p=u*s-o*c,g=r*d+n*f+a*p;return g?(g=1/g,e[0]=d*g,e[1]=(-h*n+a*u)*g,e[2]=(l*n-a*o)*g,e[3]=f*g,e[4]=(h*r-a*c)*g,e[5]=(-l*r+a*s)*g,e[6]=p*g,e[7]=(-u*r+n*c)*g,e[8]=(o*r-n*s)*g,e):null}function adjoint$1(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8];return e[0]=o*h-l*u,e[1]=a*u-n*h,e[2]=n*l-a*o,e[3]=l*c-s*h,e[4]=r*h-a*c,e[5]=a*s-r*l,e[6]=s*u-o*c,e[7]=n*c-r*u,e[8]=r*o-n*s,e}function determinant$1(e){var t=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*(u*s-o*c)+r*(-u*a+o*l)+n*(c*a-s*l)}function multiply$5(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=r[0],p=r[1],g=r[2],b=r[3],m=r[4],E=r[5],L=r[6],T=r[7],_=r[8];return e[0]=f*n+p*o+g*u,e[1]=f*a+p*l+g*h,e[2]=f*s+p*c+g*d,e[3]=b*n+m*o+E*u,e[4]=b*a+m*l+E*h,e[5]=b*s+m*c+E*d,e[6]=L*n+T*o+_*u,e[7]=L*a+T*l+_*h,e[8]=L*s+T*c+_*d,e}function translate$1(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=r[0],p=r[1];return e[0]=n,e[1]=a,e[2]=s,e[3]=o,e[4]=l,e[5]=c,e[6]=f*n+p*o+u,e[7]=f*a+p*l+h,e[8]=f*s+p*c+d,e}function rotate$2(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=Math.sin(r),p=Math.cos(r);return e[0]=p*n+f*o,e[1]=p*a+f*l,e[2]=p*s+f*c,e[3]=p*o-f*n,e[4]=p*l-f*a,e[5]=p*c-f*s,e[6]=u,e[7]=h,e[8]=d,e}function scale$5(e,t,r){var n=r[0],a=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function fromTranslation$1(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function fromRotation$1(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function fromScaling$1(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function fromMat2d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function fromQuat$1(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,l=n+n,c=a+a,u=r*o,h=n*o,d=n*l,f=a*o,p=a*l,g=a*c,b=s*o,m=s*l,E=s*c;return e[0]=1-d-g,e[3]=h-E,e[6]=f+m,e[1]=h+E,e[4]=1-u-g,e[7]=p-b,e[2]=f-m,e[5]=p+b,e[8]=1-u-d,e}function normalFromMat4(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],b=t[13],m=t[14],E=t[15],L=r*l-n*o,T=r*c-a*o,_=r*u-s*o,A=n*c-a*l,M=n*u-s*l,S=a*u-s*c,N=h*b-d*g,I=h*m-f*g,P=h*E-p*g,R=d*m-f*b,C=d*E-p*b,k=f*E-p*m,D=L*k-T*C+_*R+A*P-M*I+S*N;return D?(D=1/D,e[0]=(l*k-c*C+u*R)*D,e[1]=(c*P-o*k-u*I)*D,e[2]=(o*C-l*P+u*N)*D,e[3]=(a*C-n*k-s*R)*D,e[4]=(r*k-a*P+s*I)*D,e[5]=(n*P-r*C-s*N)*D,e[6]=(b*S-m*M+E*A)*D,e[7]=(m*_-g*S-E*T)*D,e[8]=(g*M-b*_+E*L)*D,e):null}function projection(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function str$5(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function frob$1(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function add$5(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function subtract$4(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function multiplyScalar$1(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function multiplyScalarAndAdd$1(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function exactEquals$5(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function equals$6(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],f=t[1],p=t[2],g=t[3],b=t[4],m=t[5],E=t[6],L=t[7],T=t[8];return Math.abs(r-d)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-f)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-p)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-g)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-b)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(l-m)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-E)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-L)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(h-T)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(T))}var mul$5=multiply$5,sub$4=subtract$4;const mat3$1=Object.freeze(Object.defineProperty({__proto__:null,add:add$5,adjoint:adjoint$1,clone:clone$5,copy:copy$5,create:create$5,determinant:determinant$1,equals:equals$6,exactEquals:exactEquals$5,frob:frob$1,fromMat2d,fromMat4,fromQuat:fromQuat$1,fromRotation:fromRotation$1,fromScaling:fromScaling$1,fromTranslation:fromTranslation$1,fromValues:fromValues$5,identity:identity$2,invert:invert$2,mul:mul$5,multiply:multiply$5,multiplyScalar:multiplyScalar$1,multiplyScalarAndAdd:multiplyScalarAndAdd$1,normalFromMat4,projection,rotate:rotate$2,scale:scale$5,set:set$5,str:str$5,sub:sub$4,subtract:subtract$4,translate:translate$1,transpose:transpose$1},Symbol.toStringTag,{value:"Module"}));function create$4(){var e=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone$4(e){var t=new ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function copy$4(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fromValues$4(e,t,r,n,a,s,o,l,c,u,h,d,f,p,g,b){var m=new ARRAY_TYPE(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=a,m[5]=s,m[6]=o,m[7]=l,m[8]=c,m[9]=u,m[10]=h,m[11]=d,m[12]=f,m[13]=p,m[14]=g,m[15]=b,m}function set$4(e,t,r,n,a,s,o,l,c,u,h,d,f,p,g,b,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=o,e[6]=l,e[7]=c,e[8]=u,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=b,e[15]=m,e}function identity$1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],s=t[6],o=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=a,e[13]=o,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function invert$1(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],b=t[13],m=t[14],E=t[15],L=r*l-n*o,T=r*c-a*o,_=r*u-s*o,A=n*c-a*l,M=n*u-s*l,S=a*u-s*c,N=h*b-d*g,I=h*m-f*g,P=h*E-p*g,R=d*m-f*b,C=d*E-p*b,k=f*E-p*m,D=L*k-T*C+_*R+A*P-M*I+S*N;return D?(D=1/D,e[0]=(l*k-c*C+u*R)*D,e[1]=(a*C-n*k-s*R)*D,e[2]=(b*S-m*M+E*A)*D,e[3]=(f*M-d*S-p*A)*D,e[4]=(c*P-o*k-u*I)*D,e[5]=(r*k-a*P+s*I)*D,e[6]=(m*_-g*S-E*T)*D,e[7]=(h*S-f*_+p*T)*D,e[8]=(o*C-l*P+u*N)*D,e[9]=(n*P-r*C-s*N)*D,e[10]=(g*M-b*_+E*L)*D,e[11]=(d*_-h*M-p*L)*D,e[12]=(l*I-o*R-c*N)*D,e[13]=(r*R-n*I+a*N)*D,e[14]=(b*T-g*A-m*L)*D,e[15]=(h*A-d*T+f*L)*D,e):null}function adjoint(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],b=t[13],m=t[14],E=t[15];return e[0]=l*(f*E-p*m)-d*(c*E-u*m)+b*(c*p-u*f),e[1]=-(n*(f*E-p*m)-d*(a*E-s*m)+b*(a*p-s*f)),e[2]=n*(c*E-u*m)-l*(a*E-s*m)+b*(a*u-s*c),e[3]=-(n*(c*p-u*f)-l*(a*p-s*f)+d*(a*u-s*c)),e[4]=-(o*(f*E-p*m)-h*(c*E-u*m)+g*(c*p-u*f)),e[5]=r*(f*E-p*m)-h*(a*E-s*m)+g*(a*p-s*f),e[6]=-(r*(c*E-u*m)-o*(a*E-s*m)+g*(a*u-s*c)),e[7]=r*(c*p-u*f)-o*(a*p-s*f)+h*(a*u-s*c),e[8]=o*(d*E-p*b)-h*(l*E-u*b)+g*(l*p-u*d),e[9]=-(r*(d*E-p*b)-h*(n*E-s*b)+g*(n*p-s*d)),e[10]=r*(l*E-u*b)-o*(n*E-s*b)+g*(n*u-s*l),e[11]=-(r*(l*p-u*d)-o*(n*p-s*d)+h*(n*u-s*l)),e[12]=-(o*(d*m-f*b)-h*(l*m-c*b)+g*(l*f-c*d)),e[13]=r*(d*m-f*b)-h*(n*m-a*b)+g*(n*f-a*d),e[14]=-(r*(l*m-c*b)-o*(n*m-a*b)+g*(n*c-a*l)),e[15]=r*(l*f-c*d)-o*(n*f-a*d)+h*(n*c-a*l),e}function determinant(e){var t=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],b=e[14],m=e[15],E=t*o-r*s,L=t*l-n*s,T=t*c-a*s,_=r*l-n*o,A=r*c-a*o,M=n*c-a*l,S=u*g-h*p,N=u*b-d*p,I=u*m-f*p,P=h*b-d*g,R=h*m-f*g,C=d*m-f*b;return E*C-L*R+T*P+_*I-A*N+M*S}function multiply$4(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=t[9],p=t[10],g=t[11],b=t[12],m=t[13],E=t[14],L=t[15],T=r[0],_=r[1],A=r[2],M=r[3];return e[0]=T*n+_*l+A*d+M*b,e[1]=T*a+_*c+A*f+M*m,e[2]=T*s+_*u+A*p+M*E,e[3]=T*o+_*h+A*g+M*L,T=r[4],_=r[5],A=r[6],M=r[7],e[4]=T*n+_*l+A*d+M*b,e[5]=T*a+_*c+A*f+M*m,e[6]=T*s+_*u+A*p+M*E,e[7]=T*o+_*h+A*g+M*L,T=r[8],_=r[9],A=r[10],M=r[11],e[8]=T*n+_*l+A*d+M*b,e[9]=T*a+_*c+A*f+M*m,e[10]=T*s+_*u+A*p+M*E,e[11]=T*o+_*h+A*g+M*L,T=r[12],_=r[13],A=r[14],M=r[15],e[12]=T*n+_*l+A*d+M*b,e[13]=T*a+_*c+A*f+M*m,e[14]=T*s+_*u+A*p+M*E,e[15]=T*o+_*h+A*g+M*L,e}function translate(e,t,r){var n=r[0],a=r[1],s=r[2],o,l,c,u,h,d,f,p,g,b,m,E;return t===e?(e[12]=t[0]*n+t[4]*a+t[8]*s+t[12],e[13]=t[1]*n+t[5]*a+t[9]*s+t[13],e[14]=t[2]*n+t[6]*a+t[10]*s+t[14],e[15]=t[3]*n+t[7]*a+t[11]*s+t[15]):(o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],b=t[9],m=t[10],E=t[11],e[0]=o,e[1]=l,e[2]=c,e[3]=u,e[4]=h,e[5]=d,e[6]=f,e[7]=p,e[8]=g,e[9]=b,e[10]=m,e[11]=E,e[12]=o*n+h*a+g*s+t[12],e[13]=l*n+d*a+b*s+t[13],e[14]=c*n+f*a+m*s+t[14],e[15]=u*n+p*a+E*s+t[15]),e}function scale$4(e,t,r){var n=r[0],a=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rotate$1(e,t,r,n){var a=n[0],s=n[1],o=n[2],l=Math.hypot(a,s,o),c,u,h,d,f,p,g,b,m,E,L,T,_,A,M,S,N,I,P,R,C,k,D,U;return l<EPSILON?null:(l=1/l,a*=l,s*=l,o*=l,c=Math.sin(r),u=Math.cos(r),h=1-u,d=t[0],f=t[1],p=t[2],g=t[3],b=t[4],m=t[5],E=t[6],L=t[7],T=t[8],_=t[9],A=t[10],M=t[11],S=a*a*h+u,N=s*a*h+o*c,I=o*a*h-s*c,P=a*s*h-o*c,R=s*s*h+u,C=o*s*h+a*c,k=a*o*h+s*c,D=s*o*h-a*c,U=o*o*h+u,e[0]=d*S+b*N+T*I,e[1]=f*S+m*N+_*I,e[2]=p*S+E*N+A*I,e[3]=g*S+L*N+M*I,e[4]=d*P+b*R+T*C,e[5]=f*P+m*R+_*C,e[6]=p*P+E*R+A*C,e[7]=g*P+L*R+M*C,e[8]=d*k+b*D+T*U,e[9]=f*k+m*D+_*U,e[10]=p*k+E*D+A*U,e[11]=g*k+L*D+M*U,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX$2(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*a+u*n,e[5]=o*a+h*n,e[6]=l*a+d*n,e[7]=c*a+f*n,e[8]=u*a-s*n,e[9]=h*a-o*n,e[10]=d*a-l*n,e[11]=f*a-c*n,e}function rotateY$2(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[0],o=t[1],l=t[2],c=t[3],u=t[8],h=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*a-u*n,e[1]=o*a-h*n,e[2]=l*a-d*n,e[3]=c*a-f*n,e[8]=s*n+u*a,e[9]=o*n+h*a,e[10]=l*n+d*a,e[11]=c*n+f*a,e}function rotateZ$2(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[0],o=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*a+u*n,e[1]=o*a+h*n,e[2]=l*a+d*n,e[3]=c*a+f*n,e[4]=u*a-s*n,e[5]=h*a-o*n,e[6]=d*a-l*n,e[7]=f*a-c*n,e}function fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,t,r){var n=r[0],a=r[1],s=r[2],o=Math.hypot(n,a,s),l,c,u;return o<EPSILON?null:(o=1/o,n*=o,a*=o,s*=o,l=Math.sin(t),c=Math.cos(t),u=1-c,e[0]=n*n*u+c,e[1]=a*n*u+s*l,e[2]=s*n*u-a*l,e[3]=0,e[4]=n*a*u-s*l,e[5]=a*a*u+c,e[6]=s*a*u+n*l,e[7]=0,e[8]=n*s*u+a*l,e[9]=a*s*u-n*l,e[10]=s*s*u+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,c=a+a,u=s+s,h=n*l,d=n*c,f=n*u,p=a*c,g=a*u,b=s*u,m=o*l,E=o*c,L=o*u;return e[0]=1-(p+b),e[1]=d+L,e[2]=f-E,e[3]=0,e[4]=d-L,e[5]=1-(h+b),e[6]=g+m,e[7]=0,e[8]=f+E,e[9]=g-m,e[10]=1-(h+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromQuat2(e,t){var r=new ARRAY_TYPE(3),n=-t[0],a=-t[1],s=-t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=n*n+a*a+s*s+o*o;return d>0?(r[0]=(l*o+h*n+c*s-u*a)*2/d,r[1]=(c*o+h*a+u*n-l*s)*2/d,r[2]=(u*o+h*s+l*a-c*n)*2/d):(r[0]=(l*o+h*n+c*s-u*a)*2,r[1]=(c*o+h*a+u*n-l*s)*2,r[2]=(u*o+h*s+l*a-c*n)*2),fromRotationTranslation(e,t,r),e}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var r=t[0],n=t[1],a=t[2],s=t[4],o=t[5],l=t[6],c=t[8],u=t[9],h=t[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,o,l),e[2]=Math.hypot(c,u,h),e}function getRotation(e,t){var r=new ARRAY_TYPE(3);getScaling(r,t);var n=1/r[0],a=1/r[1],s=1/r[2],o=t[0]*n,l=t[1]*a,c=t[2]*s,u=t[4]*n,h=t[5]*a,d=t[6]*s,f=t[8]*n,p=t[9]*a,g=t[10]*s,b=o+h+g,m=0;return b>0?(m=Math.sqrt(b+1)*2,e[3]=.25*m,e[0]=(d-p)/m,e[1]=(f-c)/m,e[2]=(l-u)/m):o>h&&o>g?(m=Math.sqrt(1+o-h-g)*2,e[3]=(d-p)/m,e[0]=.25*m,e[1]=(l+u)/m,e[2]=(f+c)/m):h>g?(m=Math.sqrt(1+h-o-g)*2,e[3]=(f-c)/m,e[0]=(l+u)/m,e[1]=.25*m,e[2]=(d+p)/m):(m=Math.sqrt(1+g-o-h)*2,e[3]=(l-u)/m,e[0]=(f+c)/m,e[1]=(d+p)/m,e[2]=.25*m),e}function fromRotationTranslationScale(e,t,r,n){var a=t[0],s=t[1],o=t[2],l=t[3],c=a+a,u=s+s,h=o+o,d=a*c,f=a*u,p=a*h,g=s*u,b=s*h,m=o*h,E=l*c,L=l*u,T=l*h,_=n[0],A=n[1],M=n[2];return e[0]=(1-(g+m))*_,e[1]=(f+T)*_,e[2]=(p-L)*_,e[3]=0,e[4]=(f-T)*A,e[5]=(1-(d+m))*A,e[6]=(b+E)*A,e[7]=0,e[8]=(p+L)*M,e[9]=(b-E)*M,e[10]=(1-(d+g))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,t,r,n,a){var s=t[0],o=t[1],l=t[2],c=t[3],u=s+s,h=o+o,d=l+l,f=s*u,p=s*h,g=s*d,b=o*h,m=o*d,E=l*d,L=c*u,T=c*h,_=c*d,A=n[0],M=n[1],S=n[2],N=a[0],I=a[1],P=a[2],R=(1-(b+E))*A,C=(p+_)*A,k=(g-T)*A,D=(p-_)*M,U=(1-(f+E))*M,z=(m+L)*M,X=(g+T)*S,W=(m-L)*S,Y=(1-(f+b))*S;return e[0]=R,e[1]=C,e[2]=k,e[3]=0,e[4]=D,e[5]=U,e[6]=z,e[7]=0,e[8]=X,e[9]=W,e[10]=Y,e[11]=0,e[12]=r[0]+N-(R*N+D*I+X*P),e[13]=r[1]+I-(C*N+U*I+W*P),e[14]=r[2]+P-(k*N+z*I+Y*P),e[15]=1,e}function fromQuat(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,l=n+n,c=a+a,u=r*o,h=n*o,d=n*l,f=a*o,p=a*l,g=a*c,b=s*o,m=s*l,E=s*c;return e[0]=1-d-g,e[1]=h+E,e[2]=f-m,e[3]=0,e[4]=h-E,e[5]=1-u-g,e[6]=p+b,e[7]=0,e[8]=f+m,e[9]=p-b,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,r,n,a,s,o){var l=1/(r-t),c=1/(a-n),u=1/(s-o);return e[0]=s*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*l,e[9]=(a+n)*c,e[10]=(o+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*u,e[15]=0,e}function perspectiveNO(e,t,r,n,a){var s=1/Math.tan(t/2),o;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(o=1/(n-a),e[10]=(a+n)*o,e[14]=2*a*n*o):(e[10]=-1,e[14]=-2*n),e}var perspective=perspectiveNO;function perspectiveZO(e,t,r,n,a){var s=1/Math.tan(t/2),o;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(o=1/(n-a),e[10]=a*o,e[14]=a*n*o):(e[10]=-1,e[14]=-n),e}function perspectiveFromFieldOfView(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+l),u=2/(a+s);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-((o-l)*c*.5),e[9]=(a-s)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function orthoNO(e,t,r,n,a,s,o){var l=1/(t-r),c=1/(n-a),u=1/(s-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*l,e[13]=(a+n)*c,e[14]=(o+s)*u,e[15]=1,e}var ortho=orthoNO;function orthoZO(e,t,r,n,a,s,o){var l=1/(t-r),c=1/(n-a),u=1/(s-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*l,e[13]=(a+n)*c,e[14]=s*u,e[15]=1,e}function lookAt(e,t,r,n){var a,s,o,l,c,u,h,d,f,p,g=t[0],b=t[1],m=t[2],E=n[0],L=n[1],T=n[2],_=r[0],A=r[1],M=r[2];return Math.abs(g-_)<EPSILON&&Math.abs(b-A)<EPSILON&&Math.abs(m-M)<EPSILON?identity$1(e):(h=g-_,d=b-A,f=m-M,p=1/Math.hypot(h,d,f),h*=p,d*=p,f*=p,a=L*f-T*d,s=T*h-E*f,o=E*d-L*h,p=Math.hypot(a,s,o),p?(p=1/p,a*=p,s*=p,o*=p):(a=0,s=0,o=0),l=d*o-f*s,c=f*a-h*o,u=h*s-d*a,p=Math.hypot(l,c,u),p?(p=1/p,l*=p,c*=p,u*=p):(l=0,c=0,u=0),e[0]=a,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=o,e[9]=u,e[10]=f,e[11]=0,e[12]=-(a*g+s*b+o*m),e[13]=-(l*g+c*b+u*m),e[14]=-(h*g+d*b+f*m),e[15]=1,e)}function targetTo(e,t,r,n){var a=t[0],s=t[1],o=t[2],l=n[0],c=n[1],u=n[2],h=a-r[0],d=s-r[1],f=o-r[2],p=h*h+d*d+f*f;p>0&&(p=1/Math.sqrt(p),h*=p,d*=p,f*=p);var g=c*f-u*d,b=u*h-l*f,m=l*d-c*h;return p=g*g+b*b+m*m,p>0&&(p=1/Math.sqrt(p),g*=p,b*=p,m*=p),e[0]=g,e[1]=b,e[2]=m,e[3]=0,e[4]=d*m-f*b,e[5]=f*g-h*m,e[6]=h*b-d*g,e[7]=0,e[8]=h,e[9]=d,e[10]=f,e[11]=0,e[12]=a,e[13]=s,e[14]=o,e[15]=1,e}function str$4(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function add$4(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function subtract$3(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function multiplyScalar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function multiplyScalarAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function exactEquals$4(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function equals$5(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],b=e[13],m=e[14],E=e[15],L=t[0],T=t[1],_=t[2],A=t[3],M=t[4],S=t[5],N=t[6],I=t[7],P=t[8],R=t[9],C=t[10],k=t[11],D=t[12],U=t[13],z=t[14],X=t[15];return Math.abs(r-L)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(L))&&Math.abs(n-T)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-_)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-A)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-M)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(l-S)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-N)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(u-I)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-P)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-R)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(f-C)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-k)<=EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(g-D)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(b-U)<=EPSILON*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(m-z)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(E-X)<=EPSILON*Math.max(1,Math.abs(E),Math.abs(X))}var mul$4=multiply$4,sub$3=subtract$3;const mat4$1=Object.freeze(Object.defineProperty({__proto__:null,add:add$4,adjoint,clone:clone$4,copy:copy$4,create:create$4,determinant,equals:equals$5,exactEquals:exactEquals$4,frob,fromQuat,fromQuat2,fromRotation,fromRotationTranslation,fromRotationTranslationScale,fromRotationTranslationScaleOrigin,fromScaling,fromTranslation,fromValues:fromValues$4,fromXRotation,fromYRotation,fromZRotation,frustum,getRotation,getScaling,getTranslation,identity:identity$1,invert:invert$1,lookAt,mul:mul$4,multiply:multiply$4,multiplyScalar,multiplyScalarAndAdd,ortho,orthoNO,orthoZO,perspective,perspectiveFromFieldOfView,perspectiveNO,perspectiveZO,rotate:rotate$1,rotateX:rotateX$2,rotateY:rotateY$2,rotateZ:rotateZ$2,scale:scale$4,set:set$4,str:str$4,sub:sub$3,subtract:subtract$3,targetTo,translate,transpose},Symbol.toStringTag,{value:"Module"}));function create$3(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function clone$3(e){var t=new ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function length$3(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function fromValues$3(e,t,r){var n=new ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function copy$3(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function set$3(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function add$3(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function subtract$2(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function multiply$3(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function divide$2(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function ceil$2(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function floor$2(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function min$2(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function max$2(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function round$2(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function scale$3(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function scaleAndAdd$2(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function distance$2(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return Math.hypot(r,n,a)}function squaredDistance$2(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return r*r+n*n+a*a}function squaredLength$3(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function negate$2(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function inverse$2(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function normalize$3(e,t){var r=t[0],n=t[1],a=t[2],s=r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function dot$3(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross$2(e,t,r){var n=t[0],a=t[1],s=t[2],o=r[0],l=r[1],c=r[2];return e[0]=a*c-s*l,e[1]=s*o-n*c,e[2]=n*l-a*o,e}function lerp$3(e,t,r,n){var a=t[0],s=t[1],o=t[2];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=o+n*(r[2]-o),e}function hermite(e,t,r,n,a,s){var o=s*s,l=o*(2*s-3)+1,c=o*(s-2)+s,u=o*(s-1),h=o*(3-2*s);return e[0]=t[0]*l+r[0]*c+n[0]*u+a[0]*h,e[1]=t[1]*l+r[1]*c+n[1]*u+a[1]*h,e[2]=t[2]*l+r[2]*c+n[2]*u+a[2]*h,e}function bezier(e,t,r,n,a,s){var o=1-s,l=o*o,c=s*s,u=l*o,h=3*s*l,d=3*c*o,f=c*s;return e[0]=t[0]*u+r[0]*h+n[0]*d+a[0]*f,e[1]=t[1]*u+r[1]*h+n[1]*d+a[1]*f,e[2]=t[2]*u+r[2]*h+n[2]*d+a[2]*f,e}function random$3(e,t){t=t||1;var r=RANDOM()*2*Math.PI,n=RANDOM()*2-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e}function transformMat4$2(e,t,r){var n=t[0],a=t[1],s=t[2],o=r[3]*n+r[7]*a+r[11]*s+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*a+r[8]*s+r[12])/o,e[1]=(r[1]*n+r[5]*a+r[9]*s+r[13])/o,e[2]=(r[2]*n+r[6]*a+r[10]*s+r[14])/o,e}function transformMat3$1(e,t,r){var n=t[0],a=t[1],s=t[2];return e[0]=n*r[0]+a*r[3]+s*r[6],e[1]=n*r[1]+a*r[4]+s*r[7],e[2]=n*r[2]+a*r[5]+s*r[8],e}function transformQuat$1(e,t,r){var n=r[0],a=r[1],s=r[2],o=r[3],l=t[0],c=t[1],u=t[2],h=a*u-s*c,d=s*l-n*u,f=n*c-a*l,p=a*f-s*d,g=s*h-n*f,b=n*d-a*h,m=o*2;return h*=m,d*=m,f*=m,p*=2,g*=2,b*=2,e[0]=l+h+p,e[1]=c+d+g,e[2]=u+f+b,e}function rotateX$1(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[0],s[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),s[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function rotateY$1(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),s[1]=a[1],s[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function rotateZ$1(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),s[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),s[2]=a[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function angle$1(e,t){var r=e[0],n=e[1],a=e[2],s=t[0],o=t[1],l=t[2],c=Math.sqrt(r*r+n*n+a*a),u=Math.sqrt(s*s+o*o+l*l),h=c*u,d=h&&dot$3(e,t)/h;return Math.acos(Math.min(Math.max(d,-1),1))}function zero$2(e){return e[0]=0,e[1]=0,e[2]=0,e}function str$3(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function exactEquals$3(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function equals$4(e,t){var r=e[0],n=e[1],a=e[2],s=t[0],o=t[1],l=t[2];return Math.abs(r-s)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-l)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}var sub$2=subtract$2,mul$3=multiply$3,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$3=length$3,sqrLen$3=squaredLength$3,forEach$2=function(){var e=create$3();return function(t,r,n,a,s,o){var l,c;for(r||(r=3),n||(n=0),a?c=Math.min(a*r+n,t.length):c=t.length,l=n;l<c;l+=r)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2];return t}}();const vec3$1=Object.freeze(Object.defineProperty({__proto__:null,add:add$3,angle:angle$1,bezier,ceil:ceil$2,clone:clone$3,copy:copy$3,create:create$3,cross:cross$2,dist:dist$2,distance:distance$2,div:div$2,divide:divide$2,dot:dot$3,equals:equals$4,exactEquals:exactEquals$3,floor:floor$2,forEach:forEach$2,fromValues:fromValues$3,hermite,inverse:inverse$2,len:len$3,length:length$3,lerp:lerp$3,max:max$2,min:min$2,mul:mul$3,multiply:multiply$3,negate:negate$2,normalize:normalize$3,random:random$3,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,round:round$2,scale:scale$3,scaleAndAdd:scaleAndAdd$2,set:set$3,sqrDist:sqrDist$2,sqrLen:sqrLen$3,squaredDistance:squaredDistance$2,squaredLength:squaredLength$3,str:str$3,sub:sub$2,subtract:subtract$2,transformMat3:transformMat3$1,transformMat4:transformMat4$2,transformQuat:transformQuat$1,zero:zero$2},Symbol.toStringTag,{value:"Module"}));function create$2(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function clone$2(e){var t=new ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function fromValues$2(e,t,r,n){var a=new ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function copy$2(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function set$2(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function add$2(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function subtract$1(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function multiply$2(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function divide$1(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ceil$1(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function floor$1(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function min$1(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function max$1(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function round$1(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function scale$2(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function scaleAndAdd$1(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function distance$1(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,n,a,s)}function squaredDistance$1(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],s=t[3]-e[3];return r*r+n*n+a*a+s*s}function length$2(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(t,r,n,a)}function squaredLength$2(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function negate$1(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function inverse$1(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function normalize$2(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=r*r+n*n+a*a+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=a*o,e[3]=s*o,e}function dot$2(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function cross$1(e,t,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],h=t[0],d=t[1],f=t[2],p=t[3];return e[0]=d*u-f*c+p*l,e[1]=-(h*u)+f*o-p*s,e[2]=h*c-d*o+p*a,e[3]=-(h*l)+d*s-f*a,e}function lerp$2(e,t,r,n){var a=t[0],s=t[1],o=t[2],l=t[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=o+n*(r[2]-o),e[3]=l+n*(r[3]-l),e}function random$2(e,t){t=t||1;var r,n,a,s,o,l;do r=RANDOM()*2-1,n=RANDOM()*2-1,o=r*r+n*n;while(o>=1);do a=RANDOM()*2-1,s=RANDOM()*2-1,l=a*a+s*s;while(l>=1);var c=Math.sqrt((1-o)/l);return e[0]=t*r,e[1]=t*n,e[2]=t*a*c,e[3]=t*s*c,e}function transformMat4$1(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*o,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*o,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*o,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*o,e}function transformQuat(e,t,r){var n=t[0],a=t[1],s=t[2],o=r[0],l=r[1],c=r[2],u=r[3],h=u*n+l*s-c*a,d=u*a+c*n-o*s,f=u*s+o*a-l*n,p=-o*n-l*a-c*s;return e[0]=h*u+p*-o+d*-c-f*-l,e[1]=d*u+p*-l+f*-o-h*-c,e[2]=f*u+p*-c+h*-l-d*-o,e[3]=t[3],e}function zero$1(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function str$2(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function exactEquals$2(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function equals$3(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(r-o)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-u)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(u))}var sub$1=subtract$1,mul$2=multiply$2,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$2=length$2,sqrLen$2=squaredLength$2,forEach$1=function(){var e=create$2();return function(t,r,n,a,s,o){var l,c;for(r||(r=4),n||(n=0),a?c=Math.min(a*r+n,t.length):c=t.length,l=n;l<c;l+=r)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}}();const vec4$1=Object.freeze(Object.defineProperty({__proto__:null,add:add$2,ceil:ceil$1,clone:clone$2,copy:copy$2,create:create$2,cross:cross$1,dist:dist$1,distance:distance$1,div:div$1,divide:divide$1,dot:dot$2,equals:equals$3,exactEquals:exactEquals$2,floor:floor$1,forEach:forEach$1,fromValues:fromValues$2,inverse:inverse$1,len:len$2,length:length$2,lerp:lerp$2,max:max$1,min:min$1,mul:mul$2,multiply:multiply$2,negate:negate$1,normalize:normalize$2,random:random$2,round:round$1,scale:scale$2,scaleAndAdd:scaleAndAdd$1,set:set$2,sqrDist:sqrDist$1,sqrLen:sqrLen$2,squaredDistance:squaredDistance$1,squaredLength:squaredLength$2,str:str$2,sub:sub$1,subtract:subtract$1,transformMat4:transformMat4$1,transformQuat,zero:zero$1},Symbol.toStringTag,{value:"Module"}));function create$1(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function identity(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function setAxisAngle(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function getAxisAngle(e,t){var r=Math.acos(t[3])*2,n=Math.sin(r/2);return n>EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function getAngle(e,t){var r=dot$1(e,t);return Math.acos(2*r*r-1)}function multiply$1(e,t,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=r[0],c=r[1],u=r[2],h=r[3];return e[0]=n*h+o*l+a*u-s*c,e[1]=a*h+o*c+s*l-n*u,e[2]=s*h+o*u+n*c-a*l,e[3]=o*h-n*l-a*c-s*u,e}function rotateX(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],o=t[3],l=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*l,e[1]=a*c+s*l,e[2]=s*c-a*l,e[3]=o*c-n*l,e}function rotateY(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],o=t[3],l=Math.sin(r),c=Math.cos(r);return e[0]=n*c-s*l,e[1]=a*c+o*l,e[2]=s*c+n*l,e[3]=o*c-a*l,e}function rotateZ(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],o=t[3],l=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*l,e[1]=a*c-n*l,e[2]=s*c+o*l,e[3]=o*c-s*l,e}function calculateW(e,t){var r=t[0],n=t[1],a=t[2];return e[0]=r,e[1]=n,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),e}function exp(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sqrt(r*r+n*n+a*a),l=Math.exp(s),c=o>0?l*Math.sin(o)/o:0;return e[0]=r*c,e[1]=n*c,e[2]=a*c,e[3]=l*Math.cos(o),e}function ln(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sqrt(r*r+n*n+a*a),l=o>0?Math.atan2(o,s)/o:0;return e[0]=r*l,e[1]=n*l,e[2]=a*l,e[3]=.5*Math.log(r*r+n*n+a*a+s*s),e}function pow(e,t,r){return ln(e,t),scale$1(e,e,r),exp(e,e),e}function slerp(e,t,r,n){var a=t[0],s=t[1],o=t[2],l=t[3],c=r[0],u=r[1],h=r[2],d=r[3],f,p,g,b,m;return p=a*c+s*u+o*h+l*d,p<0&&(p=-p,c=-c,u=-u,h=-h,d=-d),1-p>EPSILON?(f=Math.acos(p),g=Math.sin(f),b=Math.sin((1-n)*f)/g,m=Math.sin(n*f)/g):(b=1-n,m=n),e[0]=b*a+m*c,e[1]=b*s+m*u,e[2]=b*o+m*h,e[3]=b*l+m*d,e}function random$1(e){var t=RANDOM(),r=RANDOM(),n=RANDOM(),a=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e}function invert(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],o=r*r+n*n+a*a+s*s,l=o?1/o:0;return e[0]=-r*l,e[1]=-n*l,e[2]=-a*l,e[3]=s*l,e}function conjugate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function fromMat3(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var s=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[a*3+a]-t[s*3+s]-t[o*3+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[s*3+o]-t[o*3+s])*n,e[s]=(t[s*3+a]+t[a*3+s])*n,e[o]=(t[o*3+a]+t[a*3+o])*n}return e}function fromEuler(e,t,r,n){var a=.5*Math.PI/180;t*=a,r*=a,n*=a;var s=Math.sin(t),o=Math.cos(t),l=Math.sin(r),c=Math.cos(r),u=Math.sin(n),h=Math.cos(n);return e[0]=s*c*h-o*l*u,e[1]=o*l*h+s*c*u,e[2]=o*c*u-s*l*h,e[3]=o*c*h+s*l*u,e}function str$1(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var clone$1=clone$2,fromValues$1=fromValues$2,copy$1=copy$2,set$1=set$2,add$1=add$2,mul$1=multiply$1,scale$1=scale$2,dot$1=dot$2,lerp$1=lerp$2,length$1=length$2,len$1=length$1,squaredLength$1=squaredLength$2,sqrLen$1=squaredLength$1,normalize$1=normalize$2,exactEquals$1=exactEquals$2,equals$2=equals$3,rotationTo=function(){var e=create$3(),t=fromValues$3(1,0,0),r=fromValues$3(0,1,0);return function(n,a,s){var o=dot$3(a,s);return o<-.999999?(cross$2(e,t,a),len$3(e)<1e-6&&cross$2(e,r,a),normalize$3(e,e),setAxisAngle(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(cross$2(e,a,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,normalize$1(n,n))}}(),sqlerp=function(){var e=create$1(),t=create$1();return function(r,n,a,s,o,l){return slerp(e,n,o,l),slerp(t,a,s,l),slerp(r,e,t,2*l*(1-l)),r}}(),setAxes=function(){var e=create$5();return function(t,r,n,a){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],normalize$1(t,fromMat3(t,e))}}();const quat$1=Object.freeze(Object.defineProperty({__proto__:null,add:add$1,calculateW,clone:clone$1,conjugate,copy:copy$1,create:create$1,dot:dot$1,equals:equals$2,exactEquals:exactEquals$1,exp,fromEuler,fromMat3,fromValues:fromValues$1,getAngle,getAxisAngle,identity,invert,len:len$1,length:length$1,lerp:lerp$1,ln,mul:mul$1,multiply:multiply$1,normalize:normalize$1,pow,random:random$1,rotateX,rotateY,rotateZ,rotationTo,scale:scale$1,set:set$1,setAxes,setAxisAngle,slerp,sqlerp,sqrLen:sqrLen$1,squaredLength:squaredLength$1,str:str$1},Symbol.toStringTag,{value:"Module"}));function create(){var e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function clone(e){var t=new ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t}function fromValues(e,t){var r=new ARRAY_TYPE(2);return r[0]=e,r[1]=t,r}function copy(e,t){return e[0]=t[0],e[1]=t[1],e}function set(e,t,r){return e[0]=t,e[1]=r,e}function add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function scaleAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function distance(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function squaredDistance(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function length(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function squaredLength(e){var t=e[0],r=e[1];return t*t+r*r}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e}function inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function normalize(e,t){var r=t[0],n=t[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]}function cross(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function lerp(e,t,r,n){var a=t[0],s=t[1];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e}function random(e,t){t=t||1;var r=RANDOM()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function transformMat2(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e}function transformMat2d(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a+r[4],e[1]=r[1]*n+r[3]*a+r[5],e}function transformMat3(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[3]*a+r[6],e[1]=r[1]*n+r[4]*a+r[7],e}function transformMat4(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],e}function rotate(e,t,r,n){var a=t[0]-r[0],s=t[1]-r[1],o=Math.sin(n),l=Math.cos(n);return e[0]=a*l-s*o+r[0],e[1]=a*o+s*l+r[1],e}function angle(e,t){var r=e[0],n=e[1],a=t[0],s=t[1],o=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+s*s),l=o&&(r*a+n*s)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function zero(e){return e[0]=0,e[1]=0,e}function str(e){return"vec2("+e[0]+", "+e[1]+")"}function exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]}function equals$1(e,t){var r=e[0],n=e[1],a=t[0],s=t[1];return Math.abs(r-a)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(s))}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var e=create();return function(t,r,n,a,s,o){var l,c;for(r||(r=2),n||(n=0),a?c=Math.min(a*r+n,t.length):c=t.length,l=n;l<c;l+=r)e[0]=t[l],e[1]=t[l+1],s(e,e,o),t[l]=e[0],t[l+1]=e[1];return t}}();const vec2$1=Object.freeze(Object.defineProperty({__proto__:null,add,angle,ceil,clone,copy,create,cross,dist,distance,div,divide,dot,equals:equals$1,exactEquals,floor,forEach,fromValues,inverse,len,length,lerp,max,min,mul,multiply,negate,normalize,random,rotate,round,scale,scaleAndAdd,set,sqrDist,sqrLen,squaredDistance,squaredLength,str,sub,subtract,transformMat2,transformMat2d,transformMat3,transformMat4,zero},Symbol.toStringTag,{value:"Module"}));function earcut(e,t,r=2){const n=t&&t.length,a=n?t[0]*r:e.length;let s=linkedList(e,0,a,r,!0);const o=[];if(!s||s.next===s.prev)return o;let l,c,u;if(n&&(s=eliminateHoles(e,t,s,r)),e.length>80*r){l=1/0,c=1/0;let h=-1/0,d=-1/0;for(let f=r;f<a;f+=r){const p=e[f],g=e[f+1];p<l&&(l=p),g<c&&(c=g),p>h&&(h=p),g>d&&(d=g)}u=Math.max(h-l,d-c),u=u!==0?32767/u:0}return earcutLinked(s,o,r,l,c,u,0),o}function linkedList(e,t,r,n,a){let s;if(a===signedArea(e,t,r,n)>0)for(let o=t;o<r;o+=n)s=insertNode(o/n|0,e[o],e[o+1],s);else for(let o=r-n;o>=t;o-=n)s=insertNode(o/n|0,e[o],e[o+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(e,t){if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(equals(r,r.next)||area(r.prev,r,r.next)===0)){if(removeNode(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function earcutLinked(e,t,r,n,a,s,o){if(!e)return;!o&&s&&indexCurve(e,n,a,s);let l=e;for(;e.prev!==e.next;){const c=e.prev,u=e.next;if(s?isEarHashed(e,n,a,s):isEar(e)){t.push(c.i,e.i,u.i),removeNode(e),e=u.next,l=u.next;continue}if(e=u,e===l){o?o===1?(e=cureLocalIntersections(filterPoints(e),t),earcutLinked(e,t,r,n,a,s,2)):o===2&&splitEarcut(e,t,r,n,a,s):earcutLinked(filterPoints(e),t,r,n,a,s,1);break}}}function isEar(e){const t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;const a=t.x,s=r.x,o=n.x,l=t.y,c=r.y,u=n.y,h=Math.min(a,s,o),d=Math.min(l,c,u),f=Math.max(a,s,o),p=Math.max(l,c,u);let g=n.next;for(;g!==t;){if(g.x>=h&&g.x<=f&&g.y>=d&&g.y<=p&&pointInTriangleExceptFirst(a,l,s,c,o,u,g.x,g.y)&&area(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function isEarHashed(e,t,r,n){const a=e.prev,s=e,o=e.next;if(area(a,s,o)>=0)return!1;const l=a.x,c=s.x,u=o.x,h=a.y,d=s.y,f=o.y,p=Math.min(l,c,u),g=Math.min(h,d,f),b=Math.max(l,c,u),m=Math.max(h,d,f),E=zOrder(p,g,t,r,n),L=zOrder(b,m,t,r,n);let T=e.prevZ,_=e.nextZ;for(;T&&T.z>=E&&_&&_.z<=L;){if(T.x>=p&&T.x<=b&&T.y>=g&&T.y<=m&&T!==a&&T!==o&&pointInTriangleExceptFirst(l,h,c,d,u,f,T.x,T.y)&&area(T.prev,T,T.next)>=0||(T=T.prevZ,_.x>=p&&_.x<=b&&_.y>=g&&_.y<=m&&_!==a&&_!==o&&pointInTriangleExceptFirst(l,h,c,d,u,f,_.x,_.y)&&area(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;T&&T.z>=E;){if(T.x>=p&&T.x<=b&&T.y>=g&&T.y<=m&&T!==a&&T!==o&&pointInTriangleExceptFirst(l,h,c,d,u,f,T.x,T.y)&&area(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;_&&_.z<=L;){if(_.x>=p&&_.x<=b&&_.y>=g&&_.y<=m&&_!==a&&_!==o&&pointInTriangleExceptFirst(l,h,c,d,u,f,_.x,_.y)&&area(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function cureLocalIntersections(e,t){let r=e;do{const n=r.prev,a=r.next.next;!equals(n,a)&&intersects(n,r,r.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(t.push(n.i,r.i,a.i),removeNode(r),removeNode(r.next),r=e=a),r=r.next}while(r!==e);return filterPoints(r)}function splitEarcut(e,t,r,n,a,s){let o=e;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&isValidDiagonal(o,l)){let c=splitPolygon(o,l);o=filterPoints(o,o.next),c=filterPoints(c,c.next),earcutLinked(o,t,r,n,a,s,0),earcutLinked(c,t,r,n,a,s,0);return}l=l.next}o=o.next}while(o!==e)}function eliminateHoles(e,t,r,n){const a=[];for(let s=0,o=t.length;s<o;s++){const l=t[s]*n,c=s<o-1?t[s+1]*n:e.length,u=linkedList(e,l,c,n,!1);u===u.next&&(u.steiner=!0),a.push(getLeftmost(u))}a.sort(compareXYSlope);for(let s=0;s<a.length;s++)r=eliminateHole(a[s],r);return r}function compareXYSlope(e,t){let r=e.x-t.x;if(r===0&&(r=e.y-t.y,r===0)){const n=(e.next.y-e.y)/(e.next.x-e.x),a=(t.next.y-t.y)/(t.next.x-t.x);r=n-a}return r}function eliminateHole(e,t){const r=findHoleBridge(e,t);if(!r)return t;const n=splitPolygon(r,e);return filterPoints(n,n.next),filterPoints(r,r.next)}function findHoleBridge(e,t){let r=t;const n=e.x,a=e.y;let s=-1/0,o;if(equals(e,r))return r;do{if(equals(e,r.next))return r.next;if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){const d=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=n&&d>s&&(s=d,o=r.x<r.next.x?r:r.next,d===n))return o}r=r.next}while(r!==t);if(!o)return null;const l=o,c=o.x,u=o.y;let h=1/0;r=o;do{if(n>=r.x&&r.x>=c&&n!==r.x&&pointInTriangle(a<u?n:s,a,c,u,a<u?s:n,a,r.x,r.y)){const d=Math.abs(a-r.y)/(n-r.x);locallyInside(r,e)&&(d<h||d===h&&(r.x>o.x||r.x===o.x&&sectorContainsSector(o,r)))&&(o=r,h=d)}r=r.next}while(r!==l);return o}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,r,n){let a=e;do a.z===0&&(a.z=zOrder(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,sortLinked(a)}function sortLinked(e){let t,r=1;do{let n=e,a;e=null;let s=null;for(t=0;n;){t++;let o=n,l=0;for(let u=0;u<r&&(l++,o=o.nextZ,!!o);u++);let c=r;for(;l>0||c>0&&o;)l!==0&&(c===0||!o||n.z<=o.z)?(a=n,n=n.nextZ,l--):(a=o,o=o.nextZ,c--),s?s.nextZ=a:e=a,a.prevZ=s,s=a;n=o}s.nextZ=null,r*=2}while(t>1);return e}function zOrder(e,t,r,n,a){return e=(e-r)*a|0,t=(t-n)*a|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function getLeftmost(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function pointInTriangle(e,t,r,n,a,s,o,l){return(a-o)*(t-l)>=(e-o)*(s-l)&&(e-o)*(n-l)>=(r-o)*(t-l)&&(r-o)*(s-l)>=(a-o)*(n-l)}function pointInTriangleExceptFirst(e,t,r,n,a,s,o,l){return!(e===o&&t===l)&&pointInTriangle(e,t,r,n,a,s,o,l)}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){const a=sign(area(e,t,r)),s=sign(area(e,t,n)),o=sign(area(r,n,e)),l=sign(area(r,n,t));return!!(a!==s&&o!==l||a===0&&onSegment(e,r,t)||s===0&&onSegment(e,n,t)||o===0&&onSegment(r,e,n)||l===0&&onSegment(r,t,n))}function onSegment(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){let r=e,n=!1;const a=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&a<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function splitPolygon(e,t){const r=createNode(e.i,e.x,e.y),n=createNode(t.i,t.x,t.y),a=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function insertNode(e,t,r,n){const a=createNode(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function createNode(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function signedArea(e,t,r,n){let a=0;for(let s=t,o=r-n;s<r;s+=n)a+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return a}const vec2=Object.assign({},vec2$1),vec3=Object.assign({},vec3$1),vec4=Object.assign({},vec4$1),quat=Object.assign({},quat$1),mat3=Object.assign({},mat3$1),mat4=Object.assign({},mat4$1),global=typeof window<"u"?window:typeof self<"u"?self:global,GL$1=global.GL=global.LiteGL={};global.requestAnimationFrame=global.requestAnimationFrame||global.mozRequestAnimationFrame||global.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},GL$1.blockable_keys={Up:!0,Down:!0,Left:!0,Right:!0},GL$1.reverse=null,GL$1.LEFT_MOUSE_BUTTON=0,GL$1.MIDDLE_MOUSE_BUTTON=1,GL$1.RIGHT_MOUSE_BUTTON=2,GL$1.LEFT_MOUSE_BUTTON_MASK=1,GL$1.RIGHT_MOUSE_BUTTON_MASK=2,GL$1.MIDDLE_MOUSE_BUTTON_MASK=4,GL$1.last_context_id=0,GL$1.COLOR_BUFFER_BIT=16384,GL$1.DEPTH_BUFFER_BIT=256,GL$1.STENCIL_BUFFER_BIT=1024,GL$1.TEXTURE_2D=3553,GL$1.TEXTURE_CUBE_MAP=34067,GL$1.TEXTURE_3D=32879,GL$1.TEXTURE_MAG_FILTER=10240,GL$1.TEXTURE_MIN_FILTER=10241,GL$1.TEXTURE_WRAP_S=10242,GL$1.TEXTURE_WRAP_T=10243,GL$1.BYTE=5120,GL$1.UNSIGNED_BYTE=5121,GL$1.SHORT=5122,GL$1.UNSIGNED_SHORT=5123,GL$1.INT=5124,GL$1.UNSIGNED_INT=5125,GL$1.FLOAT=5126,GL$1.HALF_FLOAT_OES=36193,GL$1.HALF_FLOAT=5131,GL$1.DEPTH_COMPONENT16=33189,GL$1.DEPTH_COMPONENT24=33190,GL$1.DEPTH_COMPONENT32F=36012,GL$1.FLOAT_VEC2=35664,GL$1.FLOAT_VEC3=35665,GL$1.FLOAT_VEC4=35666,GL$1.INT_VEC2=35667,GL$1.INT_VEC3=35668,GL$1.INT_VEC4=35669,GL$1.BOOL=35670,GL$1.BOOL_VEC2=35671,GL$1.BOOL_VEC3=35672,GL$1.BOOL_VEC4=35673,GL$1.FLOAT_MAT2=35674,GL$1.FLOAT_MAT3=35675,GL$1.FLOAT_MAT4=35676,GL$1.TYPE_LENGTH={},GL$1.TYPE_LENGTH[GL$1.FLOAT]=GL$1.TYPE_LENGTH[GL$1.INT]=GL$1.TYPE_LENGTH[GL$1.BYTE]=GL$1.TYPE_LENGTH[GL$1.BOOL]=1,GL$1.TYPE_LENGTH[GL$1.FLOAT_VEC2]=GL$1.TYPE_LENGTH[GL$1.INT_VEC2]=GL$1.TYPE_LENGTH[GL$1.BOOL_VEC2]=2,GL$1.TYPE_LENGTH[GL$1.FLOAT_VEC3]=GL$1.TYPE_LENGTH[GL$1.INT_VEC3]=GL$1.TYPE_LENGTH[GL$1.BOOL_VEC3]=3,GL$1.TYPE_LENGTH[GL$1.FLOAT_VEC4]=GL$1.TYPE_LENGTH[GL$1.INT_VEC4]=GL$1.TYPE_LENGTH[GL$1.BOOL_VEC4]=4,GL$1.TYPE_LENGTH[GL$1.FLOAT_MAT3]=9,GL$1.TYPE_LENGTH[GL$1.FLOAT_MAT4]=16,GL$1.SAMPLER_2D=35678,GL$1.SAMPLER_3D=35679,GL$1.SAMPLER_CUBE=35680,GL$1.INT_SAMPLER_2D=36298,GL$1.INT_SAMPLER_3D=36299,GL$1.INT_SAMPLER_CUBE=36300,GL$1.UNSIGNED_INT_SAMPLER_2D=36306,GL$1.UNSIGNED_INT_SAMPLER_3D=36307,GL$1.UNSIGNED_INT_SAMPLER_CUBE=36308,GL$1.DEPTH_COMPONENT=6402,GL$1.ALPHA=6406,GL$1.RGB=6407,GL$1.RGBA=6408,GL$1.LUMINANCE=6409,GL$1.LUMINANCE_ALPHA=6410,GL$1.DEPTH_STENCIL=34041,GL$1.UNSIGNED_INT_24_8=GL$1.UNSIGNED_INT_24_8_WEBGL=34042,GL$1.R8=33321,GL$1.R16F=33325,GL$1.R32F=33326,GL$1.R8UI=33330,GL$1.RG8=33323,GL$1.RG16F=33327,GL$1.RG32F=33328,GL$1.RGB8=32849,GL$1.SRGB8=35905,GL$1.RGB565=36194,GL$1.R11F_G11F_B10F=35898,GL$1.RGB9_E5=35901,GL$1.RGB16F=34843,GL$1.RGB32F=34837,GL$1.RGB8UI=36221,GL$1.RGBA8=32856,GL$1.RGB5_A1=32855,GL$1.RGBA16F=34842,GL$1.RGBA32F=34836,GL$1.RGBA8UI=36220,GL$1.RGBA16I=36232,GL$1.RGBA16UI=36214,GL$1.RGBA32I=36226,GL$1.RGBA32UI=36208,GL$1.DEPTH24_STENCIL8=35056,GL$1.NEAREST=9728,GL$1.LINEAR=9729,GL$1.NEAREST_MIPMAP_NEAREST=9984,GL$1.LINEAR_MIPMAP_NEAREST=9985,GL$1.NEAREST_MIPMAP_LINEAR=9986,GL$1.LINEAR_MIPMAP_LINEAR=9987,GL$1.REPEAT=10497,GL$1.CLAMP_TO_EDGE=33071,GL$1.MIRRORED_REPEAT=33648,GL$1.ZERO=0,GL$1.ONE=1,GL$1.SRC_COLOR=768,GL$1.ONE_MINUS_SRC_COLOR=769,GL$1.SRC_ALPHA=770,GL$1.ONE_MINUS_SRC_ALPHA=771,GL$1.DST_ALPHA=772,GL$1.ONE_MINUS_DST_ALPHA=773,GL$1.DST_COLOR=774,GL$1.ONE_MINUS_DST_COLOR=775,GL$1.SRC_ALPHA_SATURATE=776,GL$1.CONSTANT_COLOR=32769,GL$1.ONE_MINUS_CONSTANT_COLOR=32770,GL$1.CONSTANT_ALPHA=32771,GL$1.ONE_MINUS_CONSTANT_ALPHA=32772,GL$1.VERTEX_SHADER=35633,GL$1.FRAGMENT_SHADER=35632,GL$1.FRONT=1028,GL$1.BACK=1029,GL$1.FRONT_AND_BACK=1032,GL$1.NEVER=512,GL$1.LESS=513,GL$1.EQUAL=514,GL$1.LEQUAL=515,GL$1.GREATER=516,GL$1.NOTEQUAL=517,GL$1.GEQUAL=518,GL$1.ALWAYS=519,GL$1.KEEP=7680,GL$1.REPLACE=7681,GL$1.INCR=7682,GL$1.DECR=7683,GL$1.INCR_WRAP=34055,GL$1.DECR_WRAP=34056,GL$1.INVERT=5386,GL$1.STREAM_DRAW=35040,GL$1.STATIC_DRAW=35044,GL$1.DYNAMIC_DRAW=35048,GL$1.ARRAY_BUFFER=34962,GL$1.ELEMENT_ARRAY_BUFFER=34963,GL$1.POINTS=0,GL$1.LINES=1,GL$1.LINE_LOOP=2,GL$1.LINE_STRIP=3,GL$1.TRIANGLES=4,GL$1.TRIANGLE_STRIP=5,GL$1.TRIANGLE_FAN=6,GL$1.CW=2304,GL$1.CCW=2305,GL$1.CULL_FACE=2884,GL$1.DEPTH_TEST=2929,GL$1.BLEND=3042,GL$1.temp_vec3=vec3.create(),GL$1.temp2_vec3=vec3.create(),GL$1.temp_vec4=vec4.create(),GL$1.temp_quat=quat.create(),GL$1.temp_mat3=mat3.create(),GL$1.temp_mat4=mat4.create(),global.DEG2RAD=.0174532925,global.RAD2DEG=57.295779578552306,global.EPSILON=1e-6,global.isPowerOfTwo=GL$1.isPowerOfTwo=function(t){return Math.log(t)/Math.log(2)%1==0},global.nearestPowerOfTwo=GL$1.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))},global.nextPowerOfTwo=GL$1.nextPowerOfTwo=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))};var typed_arrays=[Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array];function typedToArray(){return Array.prototype.slice.call(this)}typed_arrays.forEach(function(e){e.prototype.toJSON||Object.defineProperty(e.prototype,"toJSON",{value:typedToArray,enumerable:!1,configurable:!0,writable:!0})}),typeof performance<"u"?global.getTime=performance.now.bind(performance):global.getTime=Date.now.bind(Date),GL$1.getTime=global.getTime,global.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},global.isArray=function(t){return t&&t.constructor===Array},global.isNumber=function(t){return t!=null&&t.constructor===Number},global.getClassName=function(t){if(t){if(t.name)return t.name;if(t.toString){var r=t.toString().match(/function\s*(\w+)/);if(r&&r.length==2)return r[1]}}},global.cloneObject=GL$1.cloneObject=function(e,t){if(e.constructor!==Object)throw"cloneObject only can clone pure javascript objects, not classes";t=t||{};for(var r in e){var n=e[r];if(n===null){t[r]=null;continue}switch(n.constructor){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:t[r]=new n.constructor(n);break;case Boolean:case Number:case String:t[r]=n;break;case Array:t[r]=n.concat();break;case Object:t[r]=GL$1.cloneObject(n);break}}return t},global.regexMap=function(t,r,n){for(var a;(a=t.exec(r))!=null;)n(a)},global.createCanvas=GL$1.createCanvas=function(t,r){var n=document.createElement("canvas");return n.width=t,n.height=r,n},global.cloneCanvas=GL$1.cloneCanvas=function(t){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d");return n.drawImage(t,0,0),r},typeof Image<"u"&&(Image.prototype.getPixels=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");return t.drawImage(this,0,0),t.getImageData(0,0,this.width,this.height).data}),Object.prototype.hasOwnProperty.call(String.prototype,"replaceAll")||Object.defineProperty(String.prototype,"replaceAll",{value:function(e){var t=this;for(var r in e)t=t.split(r).join(e[r]);return t},enumerable:!1}),Object.prototype.hasOwnProperty.call(String.prototype,"hashCode")||Object.defineProperty(String.prototype,"hashCode",{value:function(){var e=0,t,r,n;if(this.length==0)return e;for(t=0,n=this.length;t<n;++t)r=this.charCodeAt(t),e=(e<<5)-e+r,e|=0;return e},enumerable:!1}),Object.prototype.hasOwnProperty.call(Array.prototype,"clone")||Object.defineProperty(Array.prototype,"clone",{value:Array.prototype.concat,enumerable:!1}),Object.prototype.hasOwnProperty.call(Float32Array.prototype,"clone")||Object.defineProperty(Float32Array.prototype,"clone",{value:function(){return new Float32Array(this)},enumerable:!1}),global.wipeObject=function(t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&delete t[r]},global.extendClass=GL$1.extendClass=function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=r[n]);if(r.prototype)for(var a=Object.getOwnPropertyNames(r.prototype),n=0;n<a.length;++n){var s=a[n];Object.prototype.hasOwnProperty.call(t,s)||(r.prototype.__lookupGetter__(s)?t.prototype.__defineGetter__(s,r.prototype.__lookupGetter__(s)):t.prototype[s]=r.prototype[s],r.prototype.__lookupSetter__(s)&&t.prototype.__defineSetter__(s,r.prototype.__lookupSetter__(s)))}Object.prototype.hasOwnProperty.call(t,"superclass")||Object.defineProperty(t,"superclass",{get:function(){return r},enumerable:!1})},global.HttpRequest=GL$1.request=function(t,r,n,a,s){var o=!0;if(s=s||{},s.async!==void 0&&(o=s.async),r){var l=null,c=[];for(var u in r)c.push(u+"="+r[u]);l=c.join("&"),t=t+"?"+l}var h=new XMLHttpRequest;if(h.open("GET",t,o),h.responseType=s.responseType||"text",h.onload=function(d){if(this.response,this.getResponseHeader("Content-Type"),this.status!=200){LEvent.trigger(h,"fail",this.status),a&&a(this.status);return}LEvent.trigger(h,"done",this.response),n&&n(this.response)},h.onerror=function(d){LEvent.trigger(h,"fail",d)},s){for(var u in s)h[u]=s[u];s.binary&&(h.responseType="arraybuffer")}return h.send(),h},global.XMLHttpRequest&&(Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"done")||Object.defineProperty(XMLHttpRequest.prototype,"done",{enumerable:!1,value:function(e){return LEvent.bind(this,"done",function(t,r){e(r)}),this}}),Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"fail")||Object.defineProperty(XMLHttpRequest.prototype,"fail",{enumerable:!1,value:function(e){return LEvent.bind(this,"fail",function(t,r){e(r)}),this}})),global.getFileExtension=function(t){var r=t.indexOf("?");r!=-1&&(t=t.substr(0,r));var n=t.lastIndexOf(".");return n==-1?"":t.substr(n+1).toLowerCase()},global.loadFileAtlas=GL$1.loadFileAtlas=function(t,r,n){var a=null;return global.HttpRequest(t,null,function(s){var o=GL$1.processFileAtlas(s);r&&r(o),a&&a(o)},alert,n),{done:function(s){a=s}}},global.processFileAtlas=GL$1.processFileAtlas=function(e,t){for(var r=e.split(`
`),n={},a=[],s="",o=0,l=r.length;o<l;o++){var c=t?r[o]:r[o].trim();if(c.length){if(c[0]!="\\"){a.push(c);continue}a.length&&(n[s]=a.join(`
`)),a.length=0,s=c.substr(1)}}return a.length&&(n[s]=a.join(`
`)),n},global.typedArrayToArray=function(e){var t=[];t.length=e.length;for(var r=0;r<e.length;r++)t[r]=e[r];return t},global.RGBToHex=function(e,t,r){return e=Math.min(255,e*255)|0,t=Math.min(255,t*255)|0,r=Math.min(255,r*255)|0,"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1)},global.HUEToRGB=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e},global.HSLToRGB=function(e,t,r,n){var a,s,o;if(n=n||vec3.create(),t==0)a=s=o=r;else{var l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;a=global.HUEToRGB(c,l,e+1/3),s=global.HUEToRGB(c,l,e),o=global.HUEToRGB(c,l,e-1/3)}return n[0]=a,n[1]=s,n[2]=o,n},global.hexColorToRGBA=function(){var e={white:[1,1,1],black:[0,0,0],gray:[.501960813999176,.501960813999176,.501960813999176],red:[1,0,0],orange:[1,.6470588445663452,0],pink:[1,.7529411911964417,.7960784435272217],green:[0,.501960813999176,0],lime:[0,1,0],blue:[0,0,1],violet:[.9333333373069763,.5098039507865906,.9333333373069763],magenta:[1,0,1],cyan:[0,1,1],yellow:[1,1,0],brown:[.6470588445663452,.16470588743686676,.16470588743686676],silver:[.7529411911964417,.7529411911964417,.7529411911964417],gold:[1,.843137264251709,0],transparent:[0,0,0,0]};return function(t,r,n){if(n=n===void 0?1:n,r=r||new Float32Array(4),r[3]=n,typeof t!="string")return r;var a=e[t];if(a!==void 0)return r.set(a),r.length==3?r[3]=n:r[3]*=n,r;var o=t.indexOf("rgba(");if(o!=-1){var s=t.substr(5,t.length-2);return s=s.split(","),r[0]=parseInt(s[0])/255,r[1]=parseInt(s[1])/255,r[2]=parseInt(s[2])/255,r[3]=parseFloat(s[3])*n,r}var o=t.indexOf("hsla(");if(o!=-1){var s=t.substr(5,t.length-2);return s=s.split(","),global.HSLToRGB(parseInt(s[0])/360,parseInt(s[1])/100,parseInt(s[2])/100,r),r[3]=parseFloat(s[3])*n,r}r[3]=n;var o=t.indexOf("rgb(");if(o!=-1){var s=t.substr(4,t.length-2);return s=s.split(","),r[0]=parseInt(s[0])/255,r[1]=parseInt(s[1])/255,r[2]=parseInt(s[2])/255,r}var o=t.indexOf("hsl(");if(o!=-1){var s=t.substr(4,t.length-2);return s=s.split(","),global.HSLToRGB(parseInt(s[0])/360,parseInt(s[1])/100,parseInt(s[2])/100,r),r}var l=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(l,function(u,h,d,f){return h+h+d+d+f+f});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return c&&(r[0]=parseInt(c[1],16)/255,r[1]=parseInt(c[2],16)/255,r[2]=parseInt(c[3],16)/255),r}}(),global.toHalfFloat=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);return function(n){e[0]=n;var a=t[0],s=a>>16&32768,o=(a&2147483647)+4096;return o>=1199570944?(a&2147483647)>=1199570944?o<2139095040?s|31744:s|31744|(a&8388607)>>13:s|31743:o>=947912704?s|o-939524096>>13:o<855638016?s:(o=(a&2147483647)>>23,s|(a&8388607|8388608)+(8388608>>>o-102)>>126-o)}}();var DDS=function(){var e=542327876,t=131072,r=512,n=4;function a(R){return R.charCodeAt(0)+(R.charCodeAt(1)<<8)+(R.charCodeAt(2)<<16)+(R.charCodeAt(3)<<24)}function s(R){return String.fromCharCode(R&255,R>>8&255,R>>16&255,R>>24&255)}var o=a("DXT1"),l=a("DXT3"),c=a("DXT5"),u=31,h=0,d=1,f=2,p=3,g=4,b=7,m=20,E=21,L=27;function T(R,C,k,D){for(var U=new Uint16Array(4),z=new Uint16Array(k*D),X=0,W=0,Y=0,H=0,J=0,oe=0,he=0,ce=0,ie=0,de=k/4,fe=D/4,ge=0;ge<fe;ge++)for(var Te=0;Te<de;Te++)Y=C+4*(ge*de+Te),U[0]=R[Y],U[1]=R[Y+1],H=U[0]&31,J=U[0]&2016,oe=U[0]&63488,he=U[1]&31,ce=U[1]&2016,ie=U[1]&63488,U[2]=5*H+3*he>>3|5*J+3*ce>>3&2016|5*oe+3*ie>>3&63488,U[3]=5*he+3*H>>3|5*ce+3*J>>3&2016|5*ie+3*oe>>3&63488,X=R[Y+2],W=ge*4*k+Te*4,z[W]=U[X&3],z[W+1]=U[X>>2&3],z[W+2]=U[X>>4&3],z[W+3]=U[X>>6&3],W+=k,z[W]=U[X>>8&3],z[W+1]=U[X>>10&3],z[W+2]=U[X>>12&3],z[W+3]=U[X>>14],X=R[Y+3],W+=k,z[W]=U[X&3],z[W+1]=U[X>>2&3],z[W+2]=U[X>>4&3],z[W+3]=U[X>>6&3],W+=k,z[W]=U[X>>8&3],z[W+1]=U[X>>10&3],z[W+2]=U[X>>12&3],z[W+3]=U[X>>14];return z}function _(R){for(var C=0,k=R.length,D=0;C<k;C+=4)D=R[C],R[C]=R[C+2],R[C+2]=D}function A(R,C,k,D){var U=new Int32Array(k,0,u),z,X,W,Y,H,J,oe,he,ce,ie,de,fe,ge;if(U[h]!=e)return console.error("Invalid magic number in DDS header"),0;if(!U[m]&n)return console.error("Unsupported format, must contain a FourCC code"),0;switch(z=U[E],z){case o:X=8,W=C?C.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case l:X=16,W=C?C.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case c:X=16,W=C?C.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:X=4,z=null,W=R.RGBA}if(de=1,U[f]&t&&D!==!1&&(de=Math.max(1,U[b])),Y=U[g],H=U[p],oe=U[d]+4,he=!!(U[L+1]&r),he)for(ge=0;ge<6;++ge){Y=U[g],H=U[p];for(var fe=0;fe<de;++fe)z?(J=Math.max(4,Y)/4*Math.max(4,H)/4*X,ie=new Uint8Array(k,oe,J),R.compressedTexImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+ge,fe,W,Y,H,0,ie)):(R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),J=Y*H*X,ie=new Uint8Array(k,oe,J),_(ie),R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+ge,fe,W,Y,H,0,R.RGBA,R.UNSIGNED_BYTE,ie)),oe+=J,Y*=.5,H*=.5}else if(C){R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0);for(var fe=0;fe<de;++fe)z?(J=Math.max(4,Y)/4*Math.max(4,H)/4*X,ie=new Uint8Array(k,oe,J),R.compressedTexImage2D(R.TEXTURE_2D,fe,W,Y,H,0,ie)):(J=Y*H*X,ie=new Uint8Array(k,oe,J),_(ie),R.texImage2D(R.TEXTURE_2D,fe,W,Y,H,0,W,R.UNSIGNED_BYTE,ie)),oe+=J,Y*=.5,H*=.5}else if(z==o)J=Math.max(4,Y)/4*Math.max(4,H)/4*X,ie=new Uint16Array(k),ce=T(ie,oe/2,Y,H),R.texImage2D(R.TEXTURE_2D,0,R.RGB,Y,H,0,R.RGB,R.UNSIGNED_SHORT_5_6_5,ce),D&&R.generateMipmap(R.TEXTURE_2D);else return console.error("No manual decoder for",s(z),"and no native support"),0;return de}function M(R,C,k){var D=new Int32Array(R,0,u),U,z,X,W,Y,H,J,oe,he,ce,ie,de;if(D[h]!=e)return console.error("Invalid magic number in DDS header"),0;if(!D[m]&n)return console.error("Unsupported format, must contain a FourCC code"),0;switch(U=D[E],U){case o:z=8,X="COMPRESSED_RGB_S3TC_DXT1_EXT";break;case l:z=16,X="COMPRESSED_RGBA_S3TC_DXT3_EXT";break;case c:z=16,X="COMPRESSED_RGBA_S3TC_DXT5_EXT";break;default:z=4,X="RGBA"}ce=1,D[f]&t&&k!==!1&&(ce=Math.max(1,D[b])),W=D[g],Y=D[p],J=D[d]+4,oe=!!(D[L+1]&r);var fe=[];if(oe)for(var de=0;de<6;++de){W=D[g],Y=D[p];for(var ie=0;ie<ce;++ie)U?(H=Math.max(4,W)/4*Math.max(4,Y)/4*z,he=new Uint8Array(R,J,H),fe.push({tex:"TEXTURE_CUBE_MAP",face:de,mipmap:ie,internalFormat:X,width:W,height:Y,offset:0,dataOffset:J,dataLength:H})):(H=W*Y*z,he=new Uint8Array(R,J,H),_(he),fe.push({tex:"TEXTURE_CUBE_MAP",face:de,mipmap:ie,internalFormat:X,width:W,height:Y,offset:0,type:"UNSIGNED_BYTE",dataOffset:J,dataLength:H})),J+=H,W*=.5,Y*=.5}else for(var ie=0;ie<ce;++ie)H=Math.max(4,W)/4*Math.max(4,Y)/4*z,he=new Uint8Array(R,J,H),fe.push({tex:"TEXTURE_2D",mipmap:ie,internalFormat:X,width:W,height:Y,offset:0,type:"UNSIGNED_BYTE",dataOffset:J,dataLength:H}),J+=H,W*=.5,Y*=.5;return fe}function S(R,C,k,D,U,z){var X=new XMLHttpRequest;return X.open("GET",k,!0),X.responseType="arraybuffer",X.onload=function(){if(this.status==200){var W=new Int32Array(this.response,0,u),Y=!!(W[L+1]&r),H=Y?R.TEXTURE_CUBE_MAP:R.TEXTURE_2D;R.bindTexture(H,D);var J=A(R,C,this.response,U);R.texParameteri(H,R.TEXTURE_MAG_FILTER,R.LINEAR),R.texParameteri(H,R.TEXTURE_MIN_FILTER,J>1?R.LINEAR_MIPMAP_LINEAR:R.LINEAR),R.bindTexture(H,null),D.texture_type=H,D.width=W[g],D.height=W[p]}z&&z(D)},X.send(null),D}function N(R,C,k,D,U){var z=new Int32Array(k,0,u),X=!!(z[L+1]&r),W=X?R.TEXTURE_CUBE_MAP:R.TEXTURE_2D;D.handler,R.bindTexture(W,D.handler);var Y=A(R,C,k,U);return R.texParameteri(W,R.TEXTURE_MAG_FILTER,R.LINEAR),R.texParameteri(W,R.TEXTURE_MIN_FILTER,Y>1?R.LINEAR_MIPMAP_LINEAR:R.LINEAR),X&&(R.texParameteri(W,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(W,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE)),R.bindTexture(W,null),D.handler&&(D.texture_type=W,D.width=z[g],D.height=z[p]),D}function I(R){var C=new Int32Array(R,0,u),k=!!(C[L+1]&r),D=k?"TEXTURE_CUBE_MAP":"TEXTURE_2D",U=M(R),z={type:D,buffers:U,data:R,width:C[g],height:C[p]};return z}function P(R,z,k,D){var U=R.createTexture(),z=R.getExtension("WEBGL_compressed_texture_s3tc");return S(R,z,k,U,!0,D),U}return{dxtToRgb565:T,uploadDDSLevels:A,loadDDSTextureEx:S,loadDDSTexture:P,loadDDSTextureFromMemoryEx:N,getDDSTextureFromMemoryEx:I}}();if(typeof global<"u"&&(global.DDS=DDS),typeof glMatrix>"u"&&typeof exports<"u"&&typeof process<"u"&&exports.vec3)for(var i in exports)global[i]=exports[i];Math.clamp=function(e,t,r){return t>e?t:r<e?r:e},Math.lerp=function(e,t,r){return e*(1-r)+t*r},Math.lerp01=function(e,t,r){return Math.clamp(e*(1-r)+t*r,0,1)},Math.iLerp=function(e,t,r){return(r-e)/(t-e)},Math.remap=function(e,t,r,n,a){return Math.lerp(n,a,Math.iLerp(t,r,e))},vec3.create,vec3.create,vec3.ZERO=vec3.fromValues(0,0,0),vec3.FRONT=vec3.fromValues(0,0,-1),vec3.UP=vec3.fromValues(0,1,0),vec3.RIGHT=vec3.fromValues(1,0,0),vec2.rotate=function(e,t,r){var n=t[0],a=t[1],s=Math.cos(r),o=Math.sin(r);return e[0]=n*s-a*o,e[1]=n*o+a*s,e},vec3.zero=function(e){return e[0]=e[1]=0,e},vec2.perpdot=function(e,t){return e[1]*t[0]+-e[0]*t[1]},vec2.computeSignedAngle=function(e,t){return Math.atan2(vec2.perpdot(e,t),vec2.dot(e,t))},vec2.random=function(e,t){return t=t||1,e[0]=Math.random()*t,e[1]=Math.random()*t,e},vec3.zero=function(e){return e[0]=e[1]=e[2]=0,e},vec3.minValue=function(e){return e[0]<e[1]&&e[0]<e[2]?e[0]:e[1]<e[2]?e[1]:e[2]},vec3.maxValue=function(e){return e[0]>e[1]&&e[0]>e[2]?e[0]:e[1]>e[2]?e[1]:e[2]},vec3.minValue=function(e){return e[0]<e[1]&&e[0]<e[2]?e[0]:e[1]<e[2]?e[1]:e[2]},vec3.addValue=function(e,t,r){e[0]=t[0]+r,e[1]=t[1]+r,e[2]=t[2]+r},vec3.subValue=function(e,t,r){e[0]=t[0]-r,e[1]=t[1]-r,e[2]=t[2]-r},vec3.toArray=function(e){return[e[0],e[1],e[2]]},vec3.rotateX=function(e,t,r){var n=t[1],a=t[2],s=Math.cos(r),o=Math.sin(r);return e[0]=t[0],e[1]=n*s-a*o,e[2]=n*o+a*s,e},vec3.rotateY=function(e,t,r){var n=t[0],a=t[2],s=Math.cos(r),o=Math.sin(r);return e[0]=n*s-a*o,e[1]=t[1],e[2]=n*o+a*s,e},vec3.rotateZ=function(e,t,r){var n=t[0],a=t[1],s=Math.cos(r),o=Math.sin(r);return e[0]=n*s-a*o,e[1]=n*o+a*s,e[2]=t[2],e},vec3.angle=function(e,t){return Math.acos(vec3.dot(e,t))},vec3.signedAngle=function(e,t,r){var n=vec3.angle(e,t),a=e[1]*t[2]-e[2]*t[1],s=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0],l=Math.sign(r[0]*a+r[1]*s+r[2]*o);return n*l},vec3.random=function(e,t){return t=t||1,e[0]=Math.random()*t,e[1]=Math.random()*t,e[2]=Math.random()*t,e},vec3.cartesianToPolar=function(e,t){e=e||vec3.create();var r=t[0],n=t[1],a=t[2];return e[0]=Math.sqrt(r*r+n*n+a*a),e[1]=Math.asin(n/e[0]),e[2]=Math.atan2(r,a),e},vec3.polarToCartesian=function(e,t){var r=t[0],n=t[1],a=t[2];return e[0]=r*Math.cos(n)*Math.sin(a),e[1]=r*Math.sin(n),e[2]=r*Math.cos(n)*Math.cos(a),e},vec3.reflect=function(e,t,r){var n=t[0],a=t[1],s=t[2];return vec3.scale(e,r,-2*vec3.dot(t,r)),e[0]+=n,e[1]+=a,e[2]+=s,e},vec4.random=function(e,t){return t=t||1,e[0]=Math.random()*t,e[1]=Math.random()*t,e[2]=Math.random()*t,e[3]=Math.random()*t,e},vec4.toArray=function(e){return[e[0],e[1],e[2],e[3]]},mat3.IDENTITY=mat3.create(),mat4.IDENTITY=mat4.create(),mat4.toArray=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},mat4.setUpAndOrthonormalize=function(e,t,r){t!=e&&mat4.copy(e,t);var n=e.subarray(0,3);vec3.normalize(e.subarray(4,7),r);var a=e.subarray(8,11);vec3.cross(n,r,a),vec3.normalize(n,n),vec3.cross(a,n,r),vec3.normalize(a,a)},mat4.multiplyVec3=function(e,t,r){var n=r[0],a=r[1],s=r[2];return e[0]=t[0]*n+t[4]*a+t[8]*s+t[12],e[1]=t[1]*n+t[5]*a+t[9]*s+t[13],e[2]=t[2]*n+t[6]*a+t[10]*s+t[14],e},mat4.projectVec3=function(e,t,r){var n=r[0],a=r[1],s=r[2],o=t[0]*n+t[4]*a+t[8]*s+t[12],l=t[1]*n+t[5]*a+t[9]*s+t[13],c=t[2]*n+t[6]*a+t[10]*s+t[14],u=t[3]*n+t[7]*a+t[11]*s+t[15];return e[0]=(o/u+1)/2,e[1]=(l/u+1)/2,e[2]=(c/u+1)/2,e},vec3.project=function(e,t,r,n){n=n||gl.viewport_data;var a=r,s=t[0],o=t[1],l=t[2],c=a[0]*s+a[4]*o+a[8]*l+a[12],u=a[1]*s+a[5]*o+a[9]*l+a[13],h=a[2]*s+a[6]*o+a[10]*l+a[14],d=a[3]*s+a[7]*o+a[11]*l+a[15],f=(c/d+1)/2,p=1-(u/d+1)/2,g=(h/d+1)/2;return e[0]=f*n[2]+n[0],e[1]=p*n[3]+n[1],e[2]=g,e};var unprojectMat=mat4.create(),unprojectVec=vec4.create();vec3.unproject=function(e,t,r,n){var a=unprojectMat,s=unprojectVec;return s[0]=(t[0]-n[0])*2/n[2]-1,s[1]=(t[1]-n[1])*2/n[3]-1,s[2]=2*t[2]-1,s[3]=1,!mat4.invert(a,r)||(vec4.transformMat4(s,s,a),s[3]===0)?null:(e[0]=s[0]/s[3],e[1]=s[1]/s[3],e[2]=s[2]/s[3],e)},mat4.rotateVec3=function(e,t,r){var n=r[0],a=r[1],s=r[2];return e[0]=t[0]*n+t[4]*a+t[8]*s,e[1]=t[1]*n+t[5]*a+t[9]*s,e[2]=t[2]*n+t[6]*a+t[10]*s,e},mat4.fromTranslationFrontTop=function(e,t,r,n){return vec3.cross(e.subarray(0,3),r,n),e.set(n,4),e.set(r,8),e.set(t,12),e},mat4.translationMatrix=function(e){var t=mat4.create();return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},mat4.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},mat4.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},mat4.toRotationMat4=function(e,t){return mat4.copy(e,t),e[12]=e[13]=e[14]=0,e},mat4.swapRows=function(e,t,r,n,a){if(e!=t)return mat4.copy(e,t),e[4*r]=t[4*n],e[4*r+1]=t[4*n+1],e[4*r+2]=t[4*n+2],e[4*r+3]=t[4*n+3],e[4*n]=t[4*r],e[4*n+1]=t[4*r+1],e[4*n+2]=t[4*r+2],e[4*n+3]=t[4*r+3],e;var s=new Float32Array(a.subarray(r*4,r*5));return a.set(a.subarray(n*4,n*5),r*4),a.set(s,n*4),e},mat4.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},quat.fromAxisAngle=function(e,t){var r=quat.create();t=t*.5;var n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r},quat.lookRotation=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create();return function(n,a,s){vec3.normalize(e,a),vec3.cross(t,s,e),vec3.normalize(t,t),vec3.cross(r,e,t);var o=t[0],l=t[1],c=t[2],u=r[0],h=r[1],d=r[2],f=e[0],p=e[1],g=e[2],b=o+h+g;if(b>0){var m=Math.sqrt(b+1);return n[3]=m*.5,m=.5/m,n[0]=(d-p)*m,n[1]=(f-c)*m,n[2]=(l-u)*m,n}if(o>=h&&o>=g){var E=Math.sqrt(1+o-h-g),L=.5/E;return n[0]=.5*E,n[1]=(l+u)*L,n[2]=(c+f)*L,n[3]=(d-p)*L,n}if(h>g){var T=Math.sqrt(1+h-o-g),_=.5/T;return n[0]=(u+l)*_,n[1]=.5*T,n[2]=(p+d)*_,n[3]=(f-c)*_,n}var A=Math.sqrt(1+g-o-h),M=.5/A;return n[0]=(f+c)*M,n[1]=(p+d)*M,n[2]=.5*A,n[3]=(l-u)*M,n}}(),quat.toEuler=function(e,t){var r=Math.atan2(2*t[1]*t[3]-2*t[0]*t[2],1-2*t[1]*t[1]-2*t[2]*t[2]),n=Math.asin(2*t[0]*t[1]+2*t[2]*t[3]),a=Math.atan2(2*t[0]*t[3]-2*t[1]*t[2],1-2*t[0]*t[0]-2*t[2]*t[2]);return e||(e=vec3.create()),vec3.set(e,r,n,a),e},quat.fromEuler=function(e,t){var r=t[0],n=t[1],a=t[2],s=Math.cos(r),o=Math.cos(n),l=Math.cos(a),c=Math.sin(r),u=Math.sin(n),h=Math.sin(a),d=Math.sqrt(1+s*o+s*l-c*u*h+o*l)*.5;d==0&&(d=1e-6);var f=(o*h+s*h+c*u*l)/(4*d),p=(c*o+c*l+s*u*h)/(4*d),g=(-c*h+s*u*l+u)/(4*d);return quat.set(e,f,p,g,d),quat.normalize(e,e),e},quat.fromMat4=function(e,t){var r=t[0]+t[5]+t[10];if(r>0){var n=Math.sqrt(r+1);e[3]=n*.5;var a=.5/n;e[0]=(t[9]-t[6])*a,e[1]=(t[8]-t[2])*a,e[2]=(t[4]-t[1])*a}else{var s=0;t[5]>t[0]&&(s=1),t[10]>t[s*4+s]&&(s=2);var o=(s+1)%3,l=(o+1)%3,n=Math.sqrt(t[s*4+s]-t[o*4+o]-t[l*4+l]+1);e[s]=.5*n;var a=.5/n;e[3]=(t[l*4+o]-t[o*4+l])*a,e[o]=(t[o*4+s]+t[s*4+o])*a,e[l]=(t[l*4+s]+t[s*4+l])*a}quat.normalize(e,e)},vec3.getMat3Column=function(e,t,r){return e[0]=t[r*3],e[1]=t[r*3+1],e[2]=t[r*3+2],e},mat3.setColumn=function(e,t,r){return e[r*3]=t[0],e[r*3+1]=t[1],e[r*3+2]=t[2],e},quat.fromMat3AndQuat=function(){var e=mat3.create(),t=quat.create(),r=vec3.create(),n=vec3.create(),a=vec3.create(),s=vec3.create(),o=vec3.create(),l=vec3.create(),c=vec3.create(),u=vec3.create(),h=vec3.create(),d=vec3.create();return mat3.create(),function(f,p,g){g=g||25;for(var b=0;b<g;++b){var m=mat3.fromQuat(e,f);vec3.getMat3Column(r,m,0),vec3.getMat3Column(n,m,1),vec3.getMat3Column(a,m,2),vec3.getMat3Column(s,p,0),vec3.getMat3Column(o,p,1),vec3.getMat3Column(l,p,2),vec3.cross(c,r,s),vec3.cross(u,n,o),vec3.cross(h,a,l),vec3.add(d,c,u),vec3.add(d,d,h);var E=1/Math.abs(vec3.dot(r,s)+vec3.dot(n,o)+vec3.dot(a,l))+1e-9;vec3.scale(d,d,E);var L=vec3.length(d);if(L<1e-9)break;vec3.scale(d,d,1/L),quat.setAxisAngle(t,d,L),quat.mul(f,t,f),quat.normalize(f,f)}return f}}(),quat.rotateToFrom=function(){var e=vec3.create();return function(t,r,n){t=t||quat.create();var a=vec3.cross(e,r,n),s=vec3.dot(r,n);return s<-1+.01?(t[0]=0,t[1]=1,t[2]=0,t[3]=0,t):(t[0]=a[0]*.5,t[1]=a[1]*.5,t[2]=a[2]*.5,t[3]=(1+s)*.5,quat.normalize(t,t),t)}}(),quat.lookAt=function(){var e=vec3.create();return function(t,r,n){var a=vec3.dot(vec3.FRONT,r);if(Math.abs(a- -1)<1e-6)return t.set(vec3.UP),t[3]=Math.PI,t;if(Math.abs(a-1)<1e-6)return quat.identity(t);var s=Math.acos(a);return vec3.cross(e,vec3.FRONT,r),vec3.normalize(e,e),quat.setAxisAngle(t,e,s),t}}(),GL$1.Indexer=function(){this.unique=[],this.indices=[],this.map={}},GL$1.Indexer.prototype={add:function(e){var t=JSON.stringify(e);return t in this.map||(this.map[t]=this.unique.length,this.unique.push(e)),this.map[t]}},GL$1.Buffer=function(t,r,n,a,s){GL$1.debug&&console.log("GL.Buffer created"),s!==null&&(s=s||global.gl),this.gl=s,this.buffer=null,this.target=t,this.attribute=null,this.normalize=!1,this.data=r,this.spacing=n||3,this.data&&this.gl&&this.upload(a)},GL$1.Buffer.prototype.bind=function(e,t){t=t||this.gl,t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,this.spacing,this.buffer.gl_type,this.normalize||!1,0,0)},GL$1.Buffer.prototype.unbind=function(e,t){t=t||this.gl,t.disableVertexAttribArray(e)},GL$1.Buffer.prototype.forEach=function(e){for(var t=this.data,r=0,n=this.spacing,a=t.length;r<a;r+=n)e(t.subarray(r,r+n),r);return this},GL$1.Buffer.prototype.applyTransform=function(e){for(var t=this.data,r=0,n=this.spacing,a=t.length;r<a;r+=n){var s=t.subarray(r,r+n);vec3.transformMat4(s,s,e)}return this},GL$1.Buffer.prototype.upload=function(e){var t=this.spacing||3,r=this.gl;if(r){if(!this.data)throw"No data supplied";var n=this.data;if(!n.buffer)throw"Buffers must be typed arrays";if(this.buffer=this.buffer||r.createBuffer(),!!this.buffer){switch(this.buffer.length=n.length,this.buffer.spacing=t,n.constructor){case Int8Array:this.buffer.gl_type=r.BYTE;break;case Uint8ClampedArray:case Uint8Array:this.buffer.gl_type=r.UNSIGNED_BYTE;break;case Int16Array:this.buffer.gl_type=r.SHORT;break;case Uint16Array:this.buffer.gl_type=r.UNSIGNED_SHORT;break;case Int32Array:this.buffer.gl_type=r.INT;break;case Uint32Array:this.buffer.gl_type=r.UNSIGNED_INT;break;case Float32Array:this.buffer.gl_type=r.FLOAT;break;default:throw"unsupported buffer type"}this.target==r.ARRAY_BUFFER&&(this.buffer.gl_type==r.INT||this.buffer.gl_type==r.UNSIGNED_INT)&&(console.warn("WebGL does not support UINT32 or INT32 as vertex buffer types, converting to FLOAT"),this.buffer.gl_type=r.FLOAT,n=new Float32Array(n)),r.bindBuffer(this.target,this.buffer),r.bufferData(this.target,n,e||this.stream_type||r.STATIC_DRAW)}}},GL$1.Buffer.prototype.compile=GL$1.Buffer.prototype.upload,GL$1.Buffer.prototype.setData=function(e,t){if(!e.buffer)throw"Data must be typed array";if(t=t||0,this.data){if(this.data.length<e.length)throw"buffer is not big enough, you cannot set data to a smaller buffer"}else{this.data=e,this.upload();return}if(this.data!=e){if(this.data.length==e.length){this.data.set(e),this.upload();return}var r=new Uint8Array(e.buffer,e.buffer.byteOffset,e.buffer.byteLength),n=new Uint8Array(this.data.buffer);n.set(r,t),this.uploadRange(t,r.length)}},GL$1.Buffer.prototype.uploadRange=function(e,t){if(!this.data)throw"No data stored in this buffer";var r=this.data;if(!r.buffer)throw"Buffers must be typed arrays";var n=new Uint8Array(this.data.buffer,e,t),a=this.gl;a.bindBuffer(this.target,this.buffer),a.bufferSubData(this.target,e,n)},GL$1.Buffer.prototype.clone=function(e){var t=new GL$1.Buffer;if(e)for(var r in this)t[r]=this[r];else this.target&&(t.target=this.target),this.gl&&(t.gl=this.gl),this.spacing&&(t.spacing=this.spacing),this.data&&(t.data=new global[this.data.constructor](this.data),t.upload());return t},GL$1.Buffer.prototype.toJSON=function(){return this.data?{data_type:global.getClassName(this.data),data:this.data.toJSON(),target:this.target,attribute:this.attribute,spacing:this.spacing}:(console.error("cannot serialize a mesh without data"),null)},GL$1.Buffer.prototype.fromJSON=function(e){var t=global[e.data_type]||Float32Array;this.data=new t(e.data),this.target=e.target,this.spacing=e.spacing||3,this.attribute=e.attribute,this.upload(GL$1.STATIC_DRAW)},GL$1.Buffer.prototype.delete=function(){var e=this.gl;e.deleteBuffer(this.buffer),this.buffer=null},global.Mesh=GL$1.Mesh=function(t,r,n,a){if(GL$1.debug&&console.log("GL.Mesh created"),a!==null&&(a=a||global.gl,this.gl=a),this.gl&&(this._context_id=this.gl.context_id),this.vertexBuffers={},this.indexBuffers={},this.info={groups:[]},this._bounding=global.BBox.create(),(t||r)&&this.addBuffers(t,r,n?n.stream_type:null),n)for(var s in n)this[s]=n[s]},Mesh.common_buffers={vertices:{spacing:3,attribute:"a_vertex"},vertices2D:{spacing:2,attribute:"a_vertex2D"},normals:{spacing:3,attribute:"a_normal",normalize:!0},coords:{spacing:2,attribute:"a_coord"},coords1:{spacing:2,attribute:"a_coord1"},coords2:{spacing:2,attribute:"a_coord2"},colors:{spacing:4,attribute:"a_color",normalize:!0},tangents:{spacing:3,attribute:"a_tangent"},bone_indices:{spacing:4,attribute:"a_bone_indices",type:Uint8Array},weights:{spacing:4,attribute:"a_weights",normalize:!0},extra:{spacing:1,attribute:"a_extra"},extra2:{spacing:2,attribute:"a_extra2"},extra3:{spacing:3,attribute:"a_extra3"},extra4:{spacing:4,attribute:"a_extra4"}},Mesh.default_datatype=Float32Array,Object.defineProperty(Mesh.prototype,"bounding",{set:function(e){if(e){if(e.length<13)throw"Bounding must use the BBox bounding format of 13 floats: center, halfsize, min, max, radius";this._bounding.set(e)}},get:function(){return this._bounding}}),Mesh.prototype.addBuffer=function(e,t){if(t.target==gl.ARRAY_BUFFER?this.vertexBuffers[e]=t:this.indexBuffers[e]=t,!t.attribute){var r=GL$1.Mesh.common_buffers[e];r&&(t.attribute=r.attribute)}},Mesh.prototype.addBuffers=function(e,t,r){var n=0;this.vertexBuffers.vertices&&(n=this.vertexBuffers.vertices.data.length/3);for(var a in e){var s=e[a];if(s){if(s.constructor==GL$1.Buffer||s.data)s=s.data;else if(typeof s[0]!="number"){for(var o=[],l=0,c=1e4;l<s.length;l+=c)o=Array.prototype.concat.apply(o,s.slice(l,l+c));s=o}var u=GL$1.Mesh.common_buffers[a];if(s.constructor===Array){var h=GL$1.Mesh.default_datatype;u&&u.type&&(h=u.type),s=new h(s)}a=="vertices"&&(n=s.length/3);var d=s.length/n;u&&u.spacing&&(d=u.spacing);var f="a_"+a;u&&u.attribute&&(f=u.attribute),this.vertexBuffers[a]?this.updateVertexBuffer(a,f,d,s,r):this.createVertexBuffer(a,f,d,s,r)}}if(t)for(var a in t){var s=t[a];if(s){if((s.constructor==GL$1.Buffer||s.data)&&(s=s.data),typeof s[0]!="number"){o=[];for(var a=0,c=1e4;a<s.length;a+=c)o=Array.prototype.concat.apply(o,s.slice(a,a+c));s=o}if(s.constructor===Array){var h=Uint16Array;n>256*256&&(h=Uint32Array),s=new h(s)}this.createIndexBuffer(a,s)}}},Mesh.prototype.createVertexBuffer=function(e,t,r,n,a){var s=GL$1.Mesh.common_buffers[e];if(!t&&s&&(t=s.attribute),!t)throw"Buffer added to mesh without attribute name";if(!r&&s&&(s&&s.spacing?r=s.spacing:r=3),!n){var o=this.getNumVertices();if(!o)throw"Cannot create an empty buffer in a mesh without vertices (vertices are needed to know the size)";n=new GL$1.Mesh.default_datatype(o*r)}if(!n.buffer)throw"Buffer data MUST be typed array";var l=this.vertexBuffers[e]=new GL$1.Buffer(GL$1.ARRAY_BUFFER,n,r,a,this.gl);return l.name=e,l.attribute=t,(n.constructor==Uint8Array||n.constructor==Int8Array||n.constructor==Uint16Array||n.constructor==Int16Array||n.constructor==Uint32Array||n.constructor==Int32Array)&&s&&s.normalize&&(l.normalize=!0),l},Mesh.prototype.updateVertexBuffer=function(e,t,r,n,a){var s=this.vertexBuffers[e];if(!s){console.log("buffer not found: ",e);return}n.length&&(s.attribute=t,s.spacing=r,s.data=n,s.upload(a))},Mesh.prototype.removeVertexBuffer=function(e,t){var r=this.vertexBuffers[e];r&&(t&&r.delete(),delete this.vertexBuffers[e])},Mesh.prototype.getVertexBuffer=function(e){return this.vertexBuffers[e]},Mesh.prototype.createIndexBuffer=function(e,t,r){if(t.constructor===Array){var n=Uint16Array,a=this.vertexBuffers.vertices;if(a){var s=a.data.length/3;s>256*256&&(n=Uint32Array),t=new n(t)}}var o=this.indexBuffers[e]=new GL$1.Buffer(GL$1.ELEMENT_ARRAY_BUFFER,t,0,r,this.gl);return o},Mesh.prototype.getBuffer=function(e){return this.vertexBuffers[e]},Mesh.prototype.getIndexBuffer=function(e){return this.indexBuffers[e]},Mesh.prototype.removeIndexBuffer=function(e,t){var r=this.indexBuffers[e];r&&(t&&r.delete(),delete this.indexBuffers[e])},Mesh.prototype.upload=function(e){for(var t in this.vertexBuffers){var r=this.vertexBuffers[t];r.upload(e)}for(var n in this.indexBuffers){var r=this.indexBuffers[n];r.upload()}},Mesh.prototype.compile=Mesh.prototype.upload,Mesh.prototype.deleteBuffers=function(){for(var e in this.vertexBuffers){var t=this.vertexBuffers[e];t.delete()}this.vertexBuffers={};for(var e in this.indexBuffers){var t=this.indexBuffers[e];t.delete()}this.indexBuffers={}},Mesh.prototype.delete=Mesh.prototype.deleteBuffers,Mesh.prototype.bindBuffers=function(e){for(var t in this.vertexBuffers){var r=this.vertexBuffers[t],n=r.attribute||t,a=e.attributes[n];a==null||!r.buffer||(gl.bindBuffer(gl.ARRAY_BUFFER,r.buffer),gl.enableVertexAttribArray(a),gl.vertexAttribPointer(a,r.buffer.spacing,r.buffer.gl_type,r.normalize||!1,0,0))}},Mesh.prototype.unbindBuffers=function(e){for(var t in this.vertexBuffers){var r=this.vertexBuffers[t],n=r.attribute||t,a=e.attributes[n];a==null||!r.buffer||gl.disableVertexAttribArray(e.attributes[n])}},Mesh.prototype.clone=function(t){var t=t||global.gl,r={},n={};for(var a in this.vertexBuffers){var s=this.vertexBuffers[a];r[a]=new s.data.constructor(s.data)}for(var a in this.indexBuffers){var s=this.indexBuffers[a];n[a]=new s.data.constructor(s.data)}return new GL$1.Mesh(r,n,void 0,t)},Mesh.prototype.cloneShared=function(t){var t=t||global.gl;return new GL$1.Mesh(this.vertexBuffers,this.indexBuffers,void 0,t)},Mesh.prototype.toObject=function(){var e={},t={};for(var r in this.vertexBuffers){var n=this.vertexBuffers[r];e[r]={spacing:n.spacing,data:new n.data.constructor(n.data)}}for(var r in this.indexBuffers){var n=this.indexBuffers[r];t[r]={data:new n.data.constructor(n.data)}}return{vertexBuffers:e,indexBuffers:t,info:this.info?global.cloneObject(this.info):null,bounding:this._bounding.toJSON()}},Mesh.prototype.toJSON=function(){var e={vertexBuffers:{},indexBuffers:{},info:this.info?global.cloneObject(this.info):null,bounding:this._bounding.toJSON()};for(var t in this.vertexBuffers)e.vertexBuffers[t]=this.vertexBuffers[t].toJSON();for(var t in this.indexBuffers)e.indexBuffers[t]=this.indexBuffers[t].toJSON();return e},Mesh.prototype.fromJSON=function(e){this.vertexBuffers={},this.indexBuffers={};for(var t in e.vertexBuffers)if(e.vertexBuffers[t]){var r=new GL$1.Buffer;r.fromJSON(e.vertexBuffers[t]),!r.attribute&&GL$1.Mesh.common_buffers[t]&&(r.attribute=GL$1.Mesh.common_buffers[t].attribute),this.vertexBuffers[t]=r}for(var t in e.indexBuffers)if(e.indexBuffers[t]){var r=new GL$1.Buffer;r.fromJSON(e.indexBuffers[t]),this.indexBuffers[t]=r}e.info&&(this.info=global.cloneObject(e.info)),e.bounding&&(this.bounding=e.bounding)},Mesh.prototype.generateMetadata=function(){var e={},t=this.vertexBuffers.vertices.data,r=this.indexBuffers.triangles.data;e.vertices=t.length/3,r?e.faces=r.length/3:e.faces=t.length/9,e.indexed=!!this.metadata.faces,this.metadata=e},Mesh.prototype.computeWireframe=function(){var e=this.indexBuffers.triangles,t=this.vertexBuffers.vertices.data,r=t.length/3;if(e){for(var o=e.data,l=new GL$1.Indexer,s=0;s<o.length;s+=3)for(var c=o.subarray(s,s+3),u=0;u<c.length;u++){var h=c[u],d=c[(u+1)%c.length];l.add([Math.min(h,d),Math.max(h,d)])}for(var f=l.unique,a=r>256*256?new Uint32Array(f.length*2):new Uint16Array(f.length*2),s=0,p=f.length;s<p;++s)a.set(f[s],s*2)}else for(var n=r/3,a=r>256*256?new Uint32Array(n*6):new Uint16Array(n*6),s=0;s<r;s+=3)a[s*2]=s,a[s*2+1]=s+1,a[s*2+2]=s+1,a[s*2+3]=s+2,a[s*2+4]=s+2,a[s*2+5]=s;return this.createIndexBuffer("wireframe",a),this},Mesh.prototype.flipNormals=function(e){var t=this.vertexBuffers.normals;if(t){for(var a=t.data,s=a.length,r=0;r<s;++r)a[r]*=-1;t.upload(e),this.indexBuffers.triangles||this.computeIndices();for(var n=this.indexBuffers.triangles,a=n.data,s=a.length,r=0;r<s;r+=3){var o=a[r];a[r]=a[r+1],a[r+1]=o}n.upload(e)}},Mesh.prototype.computeIndices=function(){var e=[],t=[],r=[],n=[],a=this.vertexBuffers.vertices,s=this.vertexBuffers.normals,o=this.vertexBuffers.coords,l=a.data,c=null;s&&(c=s.data);var u=null;o&&(u=o.data);for(var h={},d=l.length/3,f=0;f<d;++f){var p=l.subarray(f*3,(f+1)*3),g=p[0]*1e3|0,b=0,m=h[g];if(m)for(var E=m.length;b<E;b++){var L=e[m[b]];if(vec3.sqrDist(p,L)<.01){n.push(b);break}}if(!(m&&b!=E)){var T=b;e.push(p),h[g]?h[g].push(T):h[g]=[T],c&&t.push(c.subarray(f*3,(f+1)*3)),u&&r.push(u.subarray(f*2,(f+1)*2)),n.push(T)}}this.vertexBuffers={},this.createVertexBuffer("vertices",GL$1.Mesh.common_buffers.vertices.attribute,3,linearizeArray(e)),c&&this.createVertexBuffer("normals",GL$1.Mesh.common_buffers.normals.attribute,3,linearizeArray(t)),u&&this.createVertexBuffer("coords",GL$1.Mesh.common_buffers.coords.attribute,2,linearizeArray(r)),this.createIndexBuffer("triangles",n)},Mesh.prototype.explodeIndices=function(e){e=e||"triangles";var t=this.getIndexBuffer(e);if(t){var r=t.data,n={};for(var a in this.vertexBuffers){var s=GL$1.Mesh.common_buffers[a];n[a]=new(s.type||Float32Array)(s.spacing*r.length)}for(var a=0,o=r.length;a<o;++a){var l=r[a];for(var c in this.vertexBuffers){var u=this.vertexBuffers[c],s=GL$1.Mesh.common_buffers[c],h=u.spacing||s.spacing,d=n[c];d.set(u.data.subarray(l*h,l*h+h),a*h)}}for(var a in n){var f=this.vertexBuffers[a];this.createVertexBuffer(a,f.attribute,f.spacing,n[a])}delete this.indexBuffers[e]}},Mesh.prototype.computeNormals=function(e){var t=this.vertexBuffers.vertices;if(!t)return console.error("Cannot compute normals of a mesh without vertices");var r=this.vertexBuffers.vertices.data;r.length/3;var n=new Float32Array(r.length),a=null;this.indexBuffers.triangles&&(a=this.indexBuffers.triangles.data);for(var s=GL$1.temp_vec3,o=GL$1.temp2_vec3,l,c,u,h,d,f,p,g,b,m=a?a.length:r.length,E=0;E<m;E+=3)a?(l=a[E],c=a[E+1],u=a[E+2],h=r.subarray(l*3,l*3+3),d=r.subarray(c*3,c*3+3),f=r.subarray(u*3,u*3+3),p=n.subarray(l*3,l*3+3),g=n.subarray(c*3,c*3+3),b=n.subarray(u*3,u*3+3)):(h=r.subarray(E*3,E*3+3),d=r.subarray(E*3+3,E*3+6),f=r.subarray(E*3+6,E*3+9),p=n.subarray(E*3,E*3+3),g=n.subarray(E*3+3,E*3+6),b=n.subarray(E*3+6,E*3+9)),vec3.sub(s,d,h),vec3.sub(o,f,h),vec3.cross(s,s,o),vec3.normalize(s,s),vec3.add(p,p,s),vec3.add(g,g,s),vec3.add(b,b,s);if(a)for(var E=0,m=n.length;E<m;E+=3){var L=n.subarray(E,E+3);vec3.normalize(L,L)}var T=this.vertexBuffers.normals;if(T)T.data=n,T.upload(e);else return this.createVertexBuffer("normals",GL$1.Mesh.common_buffers.normals.attribute,3,n);return T},Mesh.prototype.computeTangents=function(){var e=this.vertexBuffers.vertices;if(!e)return console.error("Cannot compute tangents of a mesh without vertices");var t=this.vertexBuffers.normals;if(!t)return console.error("Cannot compute tangents of a mesh without normals");var r=this.vertexBuffers.coords;if(!r)return console.error("Cannot compute tangents of a mesh without uvs");var n=this.indexBuffers.triangles;if(!n)return console.error("Cannot compute tangents of a mesh without indices");var a=e.data,s=t.data,o=r.data,l=n.data;if(!(!a||!s||!o)){var c=a.length/3,u=new Float32Array(c*4),h=new Float32Array(c*3*2),d=h.subarray(c*3),f,p,g=vec3.create(),b=vec3.create(),m=vec3.create(),E=vec3.create();for(f=0,p=l.length;f<p;f+=3){var L=l[f],T=l[f+1],_=l[f+2],A=a.subarray(L*3,L*3+3),M=a.subarray(T*3,T*3+3),S=a.subarray(_*3,_*3+3),N=o.subarray(L*2,L*2+2),I=o.subarray(T*2,T*2+2),P=o.subarray(_*2,_*2+2),R=M[0]-A[0],C=S[0]-A[0],k=M[1]-A[1],D=S[1]-A[1],U=M[2]-A[2],z=S[2]-A[2],X=I[0]-N[0],W=P[0]-N[0],Y=I[1]-N[1],H=P[1]-N[1],J,oe=X*H-W*Y;Math.abs(oe)<1e-9?J=0:J=1/oe,vec3.copy(g,[(H*R-Y*C)*J,(H*k-Y*D)*J,(H*U-Y*z)*J]),vec3.copy(b,[(X*C-W*R)*J,(X*D-W*k)*J,(X*z-W*U)*J]),vec3.add(h.subarray(L*3,L*3+3),h.subarray(L*3,L*3+3),g),vec3.add(h.subarray(T*3,T*3+3),h.subarray(T*3,T*3+3),g),vec3.add(h.subarray(_*3,_*3+3),h.subarray(_*3,_*3+3),g),vec3.add(d.subarray(L*3,L*3+3),d.subarray(L*3,L*3+3),b),vec3.add(d.subarray(T*3,T*3+3),d.subarray(T*3,T*3+3),b),vec3.add(d.subarray(_*3,_*3+3),d.subarray(_*3,_*3+3),b)}for(f=0,p=a.length;f<p;f+=3){var he=s.subarray(f,f+3),ce=h.subarray(f,f+3);vec3.subtract(m,ce,vec3.scale(m,he,vec3.dot(he,ce))),vec3.normalize(m,m);var ie=vec3.dot(vec3.cross(E,he,ce),d.subarray(f,f+3))<0?-1:1;u.set([m[0],m[1],m[2],ie],f/3*4)}this.createVertexBuffer("tangents",Mesh.common_buffers.tangents.attribute,4,u)}},Mesh.prototype.computeTextureCoordinates=function(e){var t=this.vertexBuffers.vertices;if(!t)return console.error("Cannot compute uvs of a mesh without vertices");this.explodeIndices("triangles");var r=t.data,n=r.length/3,a=this.vertexBuffers.coords,s=new Float32Array(n*2),o=this.indexBuffers.triangles,l=null;o&&(l=o.data);var c=vec3.create(),u=vec3.create(),h=vec3.create(),d=this.getBoundingBox(),f=global.BBox.getCenter(d),p=vec3.create();p.set(global.BBox.getHalfsize(d)),vec3.scale(p,p,2);for(var g=l?l.length:r.length/3,b=0;b<g;b+=3){if(l)var m=l[b],E=l[b+1],L=l[b+2],T=r.subarray(m*3,m*3+3),_=r.subarray(E*3,E*3+3),A=r.subarray(L*3,L*3+3),M=s.subarray(m*2,m*2+2),S=s.subarray(E*2,E*2+2),N=s.subarray(L*2,L*2+2);else var T=r.subarray(b*3,b*3+3),_=r.subarray((b+1)*3,(b+1)*3+3),A=r.subarray((b+2)*3,(b+2)*3+3),M=s.subarray(b*2,b*2+2),S=s.subarray((b+1)*2,(b+1)*2+2),N=s.subarray((b+2)*2,(b+2)*2+2);vec3.sub(u,T,_),vec3.sub(h,T,A),vec3.cross(c,u,h),c[0]=Math.abs(c[0]),c[1]=Math.abs(c[1]),c[2]=Math.abs(c[2]),c[0]>c[1]&&c[0]>c[2]?(M[0]=(T[2]-f[2])/p[2],M[1]=(T[1]-f[1])/p[1],S[0]=(_[2]-f[2])/p[2],S[1]=(_[1]-f[1])/p[1],N[0]=(A[2]-f[2])/p[2],N[1]=(A[1]-f[1])/p[1]):c[1]>c[2]?(M[0]=(T[0]-f[0])/p[0],M[1]=(T[2]-f[2])/p[2],S[0]=(_[0]-f[0])/p[0],S[1]=(_[2]-f[2])/p[2],N[0]=(A[0]-f[0])/p[0],N[1]=(A[2]-f[2])/p[2]):(M[0]=(T[0]-f[0])/p[0],M[1]=(T[1]-f[1])/p[1],S[0]=(_[0]-f[0])/p[0],S[1]=(_[1]-f[1])/p[1],N[0]=(A[0]-f[0])/p[0],N[1]=(A[1]-f[1])/p[1])}a?(a.data=s,a.upload(e)):this.createVertexBuffer("coords",Mesh.common_buffers.coords.attribute,2,s)},Mesh.prototype.getNumVertices=function(){var e=this.vertexBuffers.vertices;return e?e.data.length/e.spacing:0},Mesh.prototype.getNumTriangles=function(){var e=this.getIndexBuffer("triangles");return e?e.data.length/3:this.getNumVertices()/3},Mesh.computeBoundingBox=function(e,t,r){if(e){var n=0;if(r){for(var a=0;a<r.length;++a)if(r[a]){n=a;break}if(n==r.length){console.warn("mask contains only zeros, no vertices marked");return}}for(var s=vec3.clone(e.subarray(n*3,n*3+3)),o=vec3.clone(e.subarray(n*3,n*3+3)),l,a=n*3;a<e.length;a+=3)r&&!r[a/3]||(l=e.subarray(a,a+3),vec3.min(s,l,s),vec3.max(o,l,o));(isNaN(s[0])||isNaN(s[1])||isNaN(s[2])||isNaN(o[0])||isNaN(o[1])||isNaN(o[2]))&&(s[0]=s[1]=s[2]=0,o[0]=o[1]=o[2]=0,console.warn("Warning: GL.Mesh has NaN values in vertices"));var c=vec3.add(vec3.create(),s,o);vec3.scale(c,c,.5);var u=vec3.subtract(vec3.create(),o,c);return global.BBox.setCenterHalfsize(t||global.BBox.create(),c,u)}},Mesh.prototype.getBoundingBox=function(){return this._bounding?this._bounding:(this.updateBoundingBox(),this._bounding)},Mesh.prototype.updateBoundingBox=function(){var e=this.vertexBuffers.vertices;e&&(GL$1.Mesh.computeBoundingBox(e.data,this._bounding),this.info&&this.info.groups&&this.info.groups.length&&this.computeGroupsBoundingBoxes())},Mesh.prototype.computeGroupsBoundingBoxes=function(){var e=null,t=this.getIndexBuffer("triangles");t&&(e=t.data);var r=this.getVertexBuffer("vertices");if(!r)return!1;var n=r.data;if(!n.length)return!1;var a=this.info.groups;if(a){for(var s=0;s<a.length;++s){var o=a[s];o.bounding=o.bounding||global.BBox.create();var l=null;if(e){for(var c=new Uint8Array(n.length/3),u=o.start,h=0,d=o.length;h<d;h+=3)c[e[u+h]]=1,c[e[u+h+1]]=1,c[e[u+h+2]]=1;GL$1.Mesh.computeBoundingBox(n,o.bounding,c)}else l=n.subarray(o.start*3,(o.start+o.length)*3),GL$1.Mesh.computeBoundingBox(l,o.bounding)}return!0}},Mesh.prototype.setBoundingBox=function(e,t){global.BBox.setCenterHalfsize(this._bounding,e,t)},Mesh.prototype.freeData=function(){for(var e in this.vertexBuffers)this.vertexBuffers[e].data=null,delete this[this.vertexBuffers[e].name];for(var t in this.indexBuffers)this.indexBuffers[t].data=null,delete this[this.indexBuffers[t].name]},Mesh.prototype.configure=function(e,t){var r={},n={};t=t||{};for(var a in e)if(e[a]){if(a=="vertexBuffers"||a=="vertex_buffers"){for(s in e[a])r[s]=e[a][s];continue}if(a=="indexBuffers"||a=="index_buffers"){for(s in e[a])n[s]=e[a][s];continue}a=="indices"||a=="lines"||a=="wireframe"||a=="triangles"?n[a]=e[a]:GL$1.Mesh.common_buffers[a]?r[a]=e[a]:t[a]=e[a]}this.addBuffers(r,n,t.stream_type);for(var s in t)this[s]=t[s];t.bounding||this.updateBoundingBox()},Mesh.prototype.totalMemory=function(){var e=0;for(var t in this.vertexBuffers)e+=this.vertexBuffers[t].data.buffer.byteLength;for(var t in this.indexBuffers)e+=this.indexBuffers[t].data.buffer.byteLength;return e},Mesh.prototype.slice=function(e,t){var r={},n=this.indexBuffers.triangles;if(!n)return console.warn("splice in not indexed not supported yet"),null;var a=n.data,s=[],o=new Int32Array(a.length);o.fill(-1);var l=e+t;l>=a.length&&(l=a.length);for(var c=0,u=e;u<l;++u){var h=a[u];if(o[h]!=-1){s.push(o[h]);continue}var d=c++;o[h]=d,s.push(d);for(var f in this.vertexBuffers){var p=this.vertexBuffers[f],g=p.data,b=p.spacing;r[f]||(r[f]=[]);for(var m=r[f],E=0;E<b;++E)m.push(g[E+h*b])}}var L=new GL$1.Mesh(r,{triangles:s},null,gl);return L.updateBoundingBox(),L},Mesh.prototype.simplify=function(){var e=this.getBoundingBox(),t=global.BBox.getMin(e),r=global.BBox.getHalfsize(e),n=vec3.scale(vec3.create(),r,2),a=new GL$1.Mesh,s=vec3.create();for(var o in this.vertexBuffers){var l=this.vertexBuffers[o],c=l.data,u=new Float32Array(c.length);if(o=="vertices")for(var h=0,d=c.length;h<d;h+=3){var f=c.subarray(h,h+3);vec3.sub(s,f,t),vec3.div(s,s,n),s[0]=Math.round(s[0]*256)/256,s[1]=Math.round(s[1]*256)/256,s[2]=Math.round(s[2]*256)/256,vec3.mul(s,s,n),vec3.add(s,s,t),u.set(s,h)}a.addBuffer()}},Mesh.load=function(e,t,r,n){t=t||{},t.no_gl&&(n=null);var a=r||new GL$1.Mesh(null,null,null,n);return a.configure(e,t),a},Mesh.mergeMeshes=function(e,t){t=t||{};for(var r={},n={},a={},s=[],o=0,l=0,c=[],u=[],h={},d=0,f=null,p=0;p<e.length;++p){var g=e[p],b=g.mesh,m=o;s.push(m);var E=b.vertexBuffers.vertices.data.length/3;o+=E;for(var L in b.vertexBuffers)r[L]?r[L]+=b.vertexBuffers[L].data.length:r[L]=b.vertexBuffers[L].data.length;for(var L in b.indexBuffers)n[L]?n[L]+=b.indexBuffers[L].data.length:n[L]=b.indexBuffers[L].data.length;var T={name:"mesh_"+p,start:m,length:E,material:""};if(b.bones){for(var _={},L=0;L<b.bones.length;++L){var A=b.bones[L];h[A[0]]||(h[A[0]]=u.length,u.push(A)),_[L]=h[A[0]]}for(var M=b.vertexBuffers.bone_indices.data,L=0;L<M.length;L+=1)M[L]=_[M[L]]}else if(u.length)throw"cannot merge meshes, one contains bones, the other doesnt";if(c.push(T),b.morphs){var S=Object.values(b.morphs).length;if(d==0)d=S;else if(d!==S)throw"cannot merge meshes with and without morph targets"}}for(var L in r){var N=t[L];if(N===null){delete r[L];continue}if(!N){var I=b.vertexBuffers[L];I&&(I.data&&(I=I.data),I.constructor!==Array&&(N=I.constructor)),N||(N=Float32Array)}r[L]=new N(r[L]),a[L]=0,L==="vertices"&&(l=r[L].length/3)}if(d){f=[];for(var p=0;p<d;++p){var P=e[0].mesh,R={name:P.morphs[p].name,weight:P.morphs[p].weight,buffers:{vertices:new Float32Array(l*3),normals:new Float32Array(l*3)}};f.push(R)}}for(var L in n){var N=o<65536?Uint16Array:Uint32Array;n[L]=new N(n[L]),a[L]=0}for(var p=0;p<e.length;++p){var g=e[p],b=g.mesh,m=a.vertices,E=0;for(var L in b.vertexBuffers)if(r[L]){if(L=="vertices"&&(E=b.vertexBuffers[L].data.length/3),r[L].set(b.vertexBuffers[L].data,a[L]),g[L+"_matrix"]){var C=g[L+"_matrix"];C.length==16?U(r[L],a[L],b.vertexBuffers[L].data.length,C):C.length==9&&z(r[L],a[L],b.vertexBuffers[L].data.length,C)}a[L]+=b.vertexBuffers[L].data.length}for(var L in b.indexBuffers)n[L].set(b.indexBuffers[L].data,a[L]),X(n[L],a[L],b.indexBuffers[L].data.length,s[p]),a[L]+=b.indexBuffers[L].data.length;if(d)for(var L=0;L<b.morphs.length;++L){var k=b.morphs[L];for(var D in k.buffers){var R=k.buffers[D];f[L].buffers[D].set(R,m)}}}function U(Y,H,J,oe){for(var he=H+J,ce=H;ce<he;ce+=3){var ie=Y.subarray(ce,ce+3);vec3.transformMat4(ie,ie,oe)}}function z(Y,H,J,oe){for(var he=H+J,ce=H;ce<he;ce+=2){var ie=Y.subarray(ce,ce+2);vec2.transformMat3(ie,ie,oe)}}function X(Y,H,J,oe){if(oe)for(var he=H+J,ce=H;ce<he;++ce)Y[ce]+=oe}var W={info:{groups:c}};if(u.length&&(W.bones=u),!t.only_data){var b=new GL$1.Mesh(r,n,W);return b.updateBoundingBox(),f&&(b.morphs=f),b}return{vertexBuffers:r,indexBuffers:n,info:{groups:c},morphs:f}},Mesh.parsers={},Mesh.encoders={},Mesh.binary_file_formats={},Mesh.compressors={},Mesh.decompressors={},Mesh.fromURL=function(e,t,r,n){n=n||{},r=r||global.gl;var a=e.lastIndexOf("."),s=e.substr(a+1).toLowerCase();n.extension&&(s=n.extension);var o=GL$1.Mesh.parsers[s.toLowerCase()];if(!o)return console.error("No parser available in litegl to parse mesh of type",s),null;var l=new GL$1.Mesh(void 0,void 0,void 0,r);return l.ready=!1,n.binary=Mesh.binary_file_formats[s],global.HttpRequest(e,null,function(c){l.parse(c,s,n),delete l.ready,t&&t.call(l,l,e,n)},function(c){t&&t(null)},n),l},Mesh.prototype.parse=function(e,t,r){r=r||{},r.mesh=this,t=t.toLowerCase();var n=GL$1.Mesh.parsers[t];if(n)return n.call(null,e,r);throw"GL.Mesh.parse: no parser found for format "+t},Mesh.prototype.encode=function(e,t){e=e.toLowerCase();var r=GL$1.Mesh.encoders[e];if(r)return r.call(null,this,t);throw"GL.Mesh.encode: no encoder found for format "+e},Mesh.getScreenQuad=function(e){e=e||global.gl;var t=e.meshes[":screen_quad"];if(t)return t;var r=new Float32Array([0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,1,1,0]),n=new Float32Array([0,0,1,1,0,1,0,0,1,0,1,1]);return t=new GL$1.Mesh({vertices:r,coords:n},void 0,void 0,e),e.meshes[":screen_quad"]=t};function linearizeArray(e,t){if(e.constructor===t)return e;if(e.constructor!==Array)return t=t||Float32Array,new t(e);t=t||Float32Array;for(var r=e[0].length,n=e.length*r,a=new t(n),s=0;s<e.length;++s)for(var o=0;o<r;++o)a[s*r+o]=e[s][o];return a}GL$1.linearizeArray=linearizeArray,GL$1.Mesh.EXTENSION="wbin",GL$1.Mesh.enable_wbin_compression=!0;function DynamicMesh(e,t,r,n,a){e=e||1024,GL$1.debug&&console.log("GL.Mesh created"),a!==null&&(a=a||global.gl,this.gl=a),this.normals=t,this.coords=r,this._context_id=a.context_id,this.vertexBuffers={},this.indexBuffers={},this.info={groups:[]},this._bounding=global.BBox.create(),this.resize(e)}DynamicMesh.DEFAULT_NORMAL=vec3.fromValues(0,1,0),DynamicMesh.DEFAULT_COORD=vec2.fromValues(.5,.5),DynamicMesh.DEFAULT_COLOR=vec4.fromValues(1,1,1,1),DynamicMesh.prototype.resize=function(e){var t={};this._vertex_data=new Float32Array(e*3),t.vertices=this._vertex_data,this.normals&&(t.normals=this._normal_data=new Float32Array(e*3)),this.coords&&(t.coords=this._coord_data=new Float32Array(e*2)),this.colors&&(t.colors=this._color_data=new Float32Array(e*4)),this.addBuffers(t),this.current_pos=0,this.max_size=e,this._must_update=!0},DynamicMesh.prototype.clear=function(){this.current_pos=0},DynamicMesh.prototype.addPoint=function(e,t,r,n){if(a>=this.max_size)return console.warn("DynamicMesh: not enough space, reserve more"),!1;var a=this.current_pos++;return this._vertex_data.set(e,a*3),this._normal_data&&this._normal_data.set(t||DynamicMesh.DEFAULT_NORMAL,a*3),this._coord_data&&this._coord_data.set(r||DynamicMesh.DEFAULT_COORD,a*2),this._color_data&&this._color_data.set(n||DynamicMesh.DEFAULT_COLOR,a*4),this._must_update=!0,!0},DynamicMesh.prototype.update=function(e){return!this._must_update&&!e?this.current_pos:(this._must_update=!1,this.getBuffer("vertices").upload(gl.STREAM_DRAW),this._normal_data&&this.getBuffer("normal").upload(gl.STREAM_DRAW),this._coord_data&&this.getBuffer("coord").upload(gl.STREAM_DRAW),this._color_data&&this.getBuffer("color").upload(gl.STREAM_DRAW),this.current_pos)},global.extendClass(DynamicMesh,Mesh),Mesh.plane=function(e,t){e=e||{},e.triangles=[];var r=e.detailX||e.detail||1,n=e.detailY||e.detail||1,a=e.width||e.size||1,s=e.height||e.size||1,o=e.xz;a*=.5,s*=.5;var l=[],c=[],u=[],h=[],d=vec3.fromValues(0,0,1);o&&d.set([0,1,0]);for(var f=0;f<=n;f++)for(var p=f/n,g=0;g<=r;g++){var b=g/r;if(o?c.push((2*b-1)*a,0,-(2*p-1)*s):c.push((2*b-1)*a,(2*p-1)*s,0),u.push(b,p),h.push(d[0],d[1],d[2]),g<r&&f<n){var m=g+f*(r+1);o?(l.push(m+1,m+r+1,m),l.push(m+1,m+r+2,m+r+1)):(l.push(m,m+1,m+r+1),l.push(m+r+1,m+1,m+r+2))}}var E=global.BBox.fromCenterHalfsize([0,0,0],o?[a,0,s]:[a,s,0]),L={vertices:c,normals:h,coords:u,triangles:l};return GL$1.Mesh.load(L,{bounding:E},t)},Mesh.plane2D=function(e,t){var r=new Float32Array([-1,1,1,-1,1,1,-1,1,-1,-1,1,-1]),n=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0]);if(e&&e.size)for(var a=e.size*.5,s=0;s<r.length;++s)r[s]*=a;return new GL$1.Mesh({vertices2D:r,coords:n},null,t)},Mesh.point=function(e){return new GL$1.Mesh({vertices:[0,0,0]})},Mesh.cube=function(e,t){e=e||{};var r=(e.size||1)*.5,n={};n.vertices=new Float32Array([-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1]);for(var a=0,s=n.vertices.length;a<s;++a)n.vertices[a]*=r;return n.normals=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),n.coords=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]),e.wireframe&&(n.wireframe=new Uint16Array([0,2,2,5,5,4,4,0,6,7,7,10,10,11,11,6,0,6,2,7,5,10,4,11])),e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[r,r,r]),GL$1.Mesh.load(n,e,t)},Mesh.box=function(e,t){e=e||{};var r=e.sizex||1,n=e.sizey||1,a=e.sizez||1;r*=.5,n*=.5,a*=.5;var s={};s.vertices=new Float32Array([-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1]);for(var o=0,l=s.vertices.length;o<l;o+=3)s.vertices[o]*=r,s.vertices[o+1]*=n,s.vertices[o+2]*=a;return s.normals=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),s.coords=new Float32Array([0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]),e.wireframe&&(s.wireframe=new Uint16Array([0,2,2,5,5,4,4,0,6,7,7,10,10,11,11,6,0,6,2,7,5,10,4,11])),e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[r,n,a]),GL$1.Mesh.load(s,e,t)},Mesh.circle=function(e,t){e=e||{};var r=e.size||e.radius||1,n=Math.ceil(e.slices||24),a=e.xz||!1,s=e.empty||!1;n<3&&(n=3);var o=2*Math.PI/n,l=vec3.create(),c=vec3.create(),u=vec3.fromValues(0,0,1),h=vec2.fromValues(.5,.5),d=vec2.create();a&&u.set([0,1,0]);var f=a?2:1,p=new Float32Array(3*(n+1)),g=new Float32Array(3*(n+1)),b=new Float32Array(2*(n+1)),m=null;p.set(l,0),g.set(u,0),b.set(h,0);for(var E=0,L=0,T=0;T<n;++T)E=Math.sin(o*T),L=Math.cos(o*T),c[0]=E*r,c[f]=L*r,d[0]=E*.5+.5,d[1]=L*.5+.5,p.set(c,T*3+3),g.set(u,T*3+3),b.set(d,T*2+2);if(s)p=p.subarray(3),g=p.subarray(3),b=p.subarray(2),m=null;else{var m=new Uint16Array(3*n),_=2,A=1;a&&(_=1,A=2);for(var T=0;T<n-1;++T)m[T*3]=0,m[T*3+1]=T+_,m[T*3+2]=T+A;m[T*3]=0,a?(m[T*3+1]=T+1,m[T*3+2]=1):(m[T*3+1]=1,m[T*3+2]=T+1)}e.bounding=global.BBox.fromCenterHalfsize([0,0,0],a?[r,0,r]:[r,r,0]);var M={vertices:p,normals:g,coords:b,triangles:m};if(e.wireframe){for(var S=new Uint16Array(n*2),T=0;T<n;T++)S[T*2]=T,S[T*2+1]=T+1;S[0]=n,M.wireframe=S}return GL$1.Mesh.load(M,e,t)},Mesh.ring=function(e,t){e=e||{};var r=e.size||e.radius||1,n=e.thickness||r*.1,a=Math.ceil(e.slices||24),s=e.xz||!1,o=e.empty||!1;a<3&&(a=3);var l=2*Math.PI/a;vec3.create();var c=vec3.create(),u=vec3.create(),h=vec3.fromValues(0,0,1);vec2.fromValues(.5,.5);var d=vec2.create();s&&h.set([0,1,0]);for(var f=s?2:1,p=new Float32Array(3*(a*2+2)),g=new Float32Array(3*(a*2+2)),b=new Float32Array(2*(a*2+2)),m=null,E=0,L=0,T=0;T<=a;++T)E=Math.sin(l*T),L=Math.cos(l*T),c[0]=E*(r-n),c[f]=L*(r-n),d[0]=T/a,d[1]=0,p.set(c,T*6),g.set(h,T*6),b.set(d,T*4),u[0]=E*(r+n),u[f]=L*(r+n),d[1]=1,p.set(u,T*6+3),g.set(h,T*6+3),b.set(d,T*4+2);if(o)p=p.subarray(3),g=p.subarray(3),b=p.subarray(2),m=null;else{var m=new Uint16Array(6*a),_=2,A=1;s&&(_=1,A=2);for(var T=0;T<a;++T)m[T*6]=T*2,m[T*6+1]=T*2+_,m[T*6+2]=T*2+A,m[T*6+3]=T*2+A,m[T*6+4]=T*2+_,m[T*6+5]=T*2+3}e.bounding=global.BBox.fromCenterHalfsize([0,0,0],s?[r+n,0,r+n]:[r+n,r+n,0]);var M={vertices:p,normals:g,coords:b,triangles:m};if(e.wireframe){for(var S=new Uint16Array(a*4),T=0;T<a;T++)S[T*4]=T*2,S[T*4+1]=T*2+2,S[T*4+2]=T*2+1,S[T*4+3]=T*2+3;M.wireframe=S}return GL$1.Mesh.load(M,e,t)},Mesh.cylinder=function(e,t){e=e||{};for(var r=e.radius||e.size||1,n=e.height||e.size||2,a=e.subdivisions||64,s=new Float32Array(a*6*3*2),o=new Float32Array(a*6*3*2),l=new Float32Array(a*6*2*2),c=2*Math.PI/a,u=null,h=0;h<a;++h){var d=h*c;u=[Math.sin(d),0,Math.cos(d)],s.set([u[0]*r,n*.5,u[2]*r],h*6*3),o.set(u,h*6*3),l.set([h/a,1],h*6*2),u=[Math.sin(d),0,Math.cos(d)],s.set([u[0]*r,n*-.5,u[2]*r],h*6*3+3),o.set(u,h*6*3+3),l.set([h/a,0],h*6*2+2),u=[Math.sin(d+c),0,Math.cos(d+c)],s.set([u[0]*r,n*-.5,u[2]*r],h*6*3+6),o.set(u,h*6*3+6),l.set([(h+1)/a,0],h*6*2+4),u=[Math.sin(d+c),0,Math.cos(d+c)],s.set([u[0]*r,n*.5,u[2]*r],h*6*3+9),o.set(u,h*6*3+9),l.set([(h+1)/a,1],h*6*2+6),u=[Math.sin(d),0,Math.cos(d)],s.set([u[0]*r,n*.5,u[2]*r],h*6*3+12),o.set(u,h*6*3+12),l.set([h/a,1],h*6*2+8),u=[Math.sin(d+c),0,Math.cos(d+c)],s.set([u[0]*r,n*-.5,u[2]*r],h*6*3+15),o.set(u,h*6*3+15),l.set([(h+1)/a,0],h*6*2+10)}var f=h*6*3,p=h*6*2,g=f;if(e.caps===!1)s=s.subarray(0,f),o=o.subarray(0,f),l=l.subarray(0,p);else for(var b=vec3.fromValues(0,n*.5,0),m=vec3.fromValues(0,n*-.5,0),E=vec3.fromValues(0,1,0),L=vec3.fromValues(0,-1,0),h=0;h<a;++h){var d=h*c,T=vec3.fromValues(Math.sin(d),0,Math.cos(d)),_=vec3.fromValues(Math.sin(d+c),0,Math.cos(d+c));s.set([T[0]*r,n*.5,T[2]*r],f+h*6*3),o.set(E,f+h*6*3),l.set([-T[0]*.5+.5,T[2]*.5+.5],p+h*6*2),s.set([_[0]*r,n*.5,_[2]*r],f+h*6*3+3),o.set(E,f+h*6*3+3),l.set([-_[0]*.5+.5,_[2]*.5+.5],p+h*6*2+2),s.set(b,f+h*6*3+6),o.set(E,f+h*6*3+6),l.set([.5,.5],p+h*6*2+4),s.set([_[0]*r,n*-.5,_[2]*r],f+h*6*3+9),o.set(L,f+h*6*3+9),l.set([_[0]*.5+.5,_[2]*.5+.5],p+h*6*2+6),s.set([T[0]*r,n*-.5,T[2]*r],f+h*6*3+12),o.set(L,f+h*6*3+12),l.set([T[0]*.5+.5,T[2]*.5+.5],p+h*6*2+8),s.set(m,f+h*6*3+15),o.set(L,f+h*6*3+15),l.set([.5,.5],p+h*6*2+10)}var A={vertices:s,normals:o,coords:l};return e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[r,n*.5,r]),e.info={groups:[]},e.caps!==!1&&(e.info.groups.push({name:"side",start:0,length:g/3}),e.info.groups.push({name:"caps",start:g/3,length:(s.length-g)/3})),Mesh.load(A,e,t)},Mesh.cone=function(e,t){e=e||{};for(var r=e.radius||e.size||1,n=e.height||e.size||2,a=e.subdivisions||64,s=new Float32Array(a*3*3*2),o=new Float32Array(a*3*3*2),l=new Float32Array(a*2*3*2),c=2*Math.PI/a,u=null,h=r/n,d=0;d<a;++d){var f=d*c;u=[Math.sin(f+c*.5),h,Math.cos(f+c*.5)],vec3.normalize(u,u),s.set([0,n,0],d*6*3),o.set(u,d*6*3),l.set([d/a,1],d*6*2),u=[Math.sin(f),h,Math.cos(f)],s.set([u[0]*r,0,u[2]*r],d*6*3+3),vec3.normalize(u,u),o.set(u,d*6*3+3),l.set([d/a,0],d*6*2+2),u=[Math.sin(f+c),h,Math.cos(f+c)],s.set([u[0]*r,0,u[2]*r],d*6*3+6),vec3.normalize(u,u),o.set(u,d*6*3+6),l.set([(d+1)/a,0],d*6*2+4)}for(var p=0,g=0,b=vec3.fromValues(0,0,0),m=vec3.fromValues(0,-1,0),d=0;d<a;++d){var f=d*c,E=vec3.fromValues(Math.sin(f),0,Math.cos(f)),L=vec3.fromValues(Math.sin(f+c),0,Math.cos(f+c));s.set([L[0]*r,0,L[2]*r],p+d*6*3+9),o.set(m,p+d*6*3+9),l.set([L[0]*.5+.5,L[2]*.5+.5],g+d*6*2+6),s.set([E[0]*r,0,E[2]*r],p+d*6*3+12),o.set(m,p+d*6*3+12),l.set([E[0]*.5+.5,E[2]*.5+.5],g+d*6*2+8),s.set(b,p+d*6*3+15),o.set(m,p+d*6*3+15),l.set([.5,.5],g+d*6*2+10)}var T={vertices:s,normals:o,coords:l};return e.bounding=global.BBox.fromCenterHalfsize([0,n*.5,0],[r,n*.5,r]),Mesh.load(T,e,t)},Mesh.torus=function(e,t){e=e||{};var r=e.outerradius||e.radius||1,n=Math.ceil(e.outerslices||e.slices||24),a=e.innerradius||r*.1,s=Math.ceil(e.innerslices||n),o=e.angle||Math.PI*2,l=Math.PI*2/s,c=o/n,u=1;vec3.create();var h=vec3.create(),d=vec3.fromValues(0,0,1);vec2.fromValues(.5,.5);for(var f=vec2.create(),p=o==Math.PI*2,g=new Float32Array(3*s),b=new Float32Array(3*s),_=0,A=0,m=0;m<s;++m)_=Math.sin(l*m),A=Math.cos(l*m),h[0]=_*a,h[u]=A*a,f[0]=_*.5+.5,f[1]=A*.5+.5,g.set(h,m*3),vec3.normalize(d,h),b.set(d,m*3);var E=new Float32Array(3*n*s),L=new Float32Array(3*n*s),T=new Float32Array(2*n*s),I=null,_=0,A=0,M=mat4.create(),S=vec3.fromValues(-r,0,0),N=vec3.fromValues(0,1,0);vec3.create();for(var I=[],P=s,m=0;m<n;++m){mat4.identity(M),mat4.rotate(M,M,m*c,N),mat4.translate(M,M,S);var R=m*s,P=s;m>=n-1&&(P=(n-1)*-s,p||(P=0));for(var C=0;C<s;++C){var k=g.subarray(C*3,C*3+3),D=b.subarray(C*3,C*3+3);mat4.multiplyVec3(h,M,k),mat4.rotateVec3(d,M,D),E.set(h,C*3+m*3*s),L.set(d,C*3+m*3*s),T.set([m/n,C/s],C*2+m*2*s);var U=R+C,z=R+(C+1)%s;I.push(z,U,U+P,z,U+P,z+P)}}var X=a+r;e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[X,X,a]);var W={vertices:E,normals:L,coords:T,triangles:I};return GL$1.Mesh.load(W,e,t)},Mesh.sphere=function(e,t){e=e||{};for(var r=e.radius||e.size||1,n=e.lat||e.subdivisions||16,a=e.long||e.subdivisions||16,s=new Float32Array((n+1)*(a+1)*3),o=new Float32Array((n+1)*(a+1)*3),l=new Float32Array((n+1)*(a+1)*2),c=new Uint16Array(n*a*6),u=e.hemi?Math.PI*.5:Math.PI,h=0,d=0,f=0;f<=n;f++)for(var p=f*u/n,g=Math.sin(p),b=Math.cos(p),m=0;m<=a;m++){var E=m*2*Math.PI/a,L=Math.sin(E),T=Math.cos(E),_=T*g,A=b,M=L*g,S=1-m/a,N=1-f/n;s.set([r*_,r*A,r*M],h),o.set([_,A,M],h),l.set([S,N],d),h+=3,d+=2}h=0;for(var f=0;f<n;f++)for(var m=0;m<a;m++){var I=f*(a+1)+m,P=I+a+1;c.set([P,I,I+1],h),c.set([P+1,P,I+1],h+3),h+=6}var R={vertices:s,normals:o,coords:l,triangles:c};if(e.wireframe){for(var C=new Uint16Array(a*n*4),k=0,h=0;h<n;h++){for(var D=0;D<a;D++)C[k]=h*(a+1)+D,C[k+1]=h*(a+1)+D+1,k+=2;C[k-a*2]=h*(a+1)+D}for(var h=0;h<a;h++)for(var D=0;D<n;D++)C[k]=D*(a+1)+h,C[k+1]=(D+1)*(a+1)+h,k+=2;R.wireframe=C}return e.hemi?e.bounding=global.BBox.fromCenterHalfsize([0,r*.5,0],[r,r*.5,r],r):e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[r,r,r],r),GL$1.Mesh.load(R,e,t)},Mesh.grid=function(e,t){e=e||{};var r=e.lines||11;r<0&&(r=1);for(var n=e.size||10,a=new Float32Array(r*2*2*3),s=n*.5,o=0,l=-s,c=n/(r-1),u=0;u<r;u++)a[o]=l,a[o+2]=-s,a[o+3]=l,a[o+5]=s,a[o+6]=s,a[o+8]=l,a[o+9]=-s,a[o+11]=l,l+=c,o+=12;return new GL$1.Mesh({vertices:a},e,t)},Mesh.icosahedron=function(e,t){e=e||{};var r=e.radius||e.size||1,n=e.subdivisions===void 0?0:e.subdivisions;n>6&&(n=6);for(var a=(1+Math.sqrt(5))/2,s=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1],o=[],l=[],c=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],u=s.length,h=0;h<u;h+=3){var d=Math.sqrt(s[h]*s[h]+s[h+1]*s[h+1]+s[h+2]*s[h+2]),f=s[h]/d,p=s[h+1]/d,g=s[h+2]/d;o.push(f,p,g),l.push(Math.atan2(f,g),Math.acos(p)),s[h]*=r/d,s[h+1]*=r/d,s[h+2]*=r/d}var b={};function m(M,S){var N=c[M]<c[S]?c[M]+":"+c[S]:c[S]+":"+c[M],I=b[N];if(I)return I;var P=s.length/3;s.push((s[c[M]*3]+s[c[S]*3])*.5,(s[c[M]*3+1]+s[c[S]*3+1])*.5,(s[c[M]*3+2]+s[c[S]*3+2])*.5);var R=Math.sqrt(s[P*3]*s[P*3]+s[P*3+1]*s[P*3+1]+s[P*3+2]*s[P*3+2]),C=s[P*3]/R,k=s[P*3+1]/R,D=s[P*3+2]/R;return o.push(C,k,D),l.push(Math.atan2(C,D)/Math.PI*.5,Math.acos(k)/Math.PI),s[P*3]*=r/R,s[P*3+1]*=r/R,s[P*3+2]*=r/R,b[N]=P,P}for(var E=0;E<n;++E){for(var L=[],u=c.length,h=0;h<u;h+=3){var T=m(h,h+1),_=m(h+1,h+2),A=m(h+2,h);L.push(c[h],T,A),L.push(c[h+1],_,T),L.push(c[h+2],A,_),L.push(T,_,A)}c=L}return e.bounding=global.BBox.fromCenterHalfsize([0,0,0],[r,r,r],r),new GL$1.Mesh.load({vertices:s,coords:l,normals:o,triangles:c},e,t)},Mesh.shape=function(e,t,r){if(t=t||{},typeof earcut>"u")throw"To use GL.Mesh.shape you must download and include earcut.js (do not link it directly!): https://raw.githubusercontent.com/mapbox/earcut/master/src/earcut.js";if(!e||!e.length||e.length%2==1)throw"GL.Mesh.shape line missing, must be an array of 2D vertices";var n=t.extrude||0;e[0].constructor===Array&&(e=earcut.flatten(e));var a=earcut(e).reverse();console.log(a);for(var s=[],o=[],l=[],c=[e[0],e[1]],u=[e[0],e[1]],h=0;h<e.length;h+=2)c[0]=Math.min(c[0],e[h]),c[1]=Math.max(c[1],e[h]),u[0]=Math.min(u[0],e[h+1]),u[1]=Math.max(u[1],e[h+1]);var d=c[1]-c[0],f=u[1]-u[0],p=[],g=null;if(n){g=[];for(var b=vec3.create(),m=e.length,h=0;h<e.length;h+=2){var E=e[h],L=e[h+1],T=e[(h+2)%m],_=e[(h+3)%m],A=s.length/3;s.push(E,n*.5,L),s.push(E,n*-.5,L),s.push(T,n*.5,_),s.push(T,n*-.5,_),vec3.normalize(b,vec3.cross(b,[0,1,0],[T-E,0,_-L])),o.push(b[0],b[1],b[2],b[0],b[1],b[2],b[0],b[1],b[2],b[0],b[1],b[2]);var M=(E-c[0])/d,S=(L-u[0])/f,N=(T-c[0])/d,I=(_-u[0])/f;l.push(M,S,M,S,N,I,N,I),g.push(A,A+2,A+1,A+2,A+3,A+1)}p.push({name:"side",start:0,length:g.length});for(var P=s.length/3,R=g.length,h=0;h<e.length;h+=2){var E=e[h],L=e[h+1],M=(E-c[0])/d,S=(L-u[0])/f;s.push(E,n*.5,L),s.push(E,n*-.5,L),o.push(0,1,0,0,-1,0),l.push(M,S,M,S)}for(var h=0;h<a.length;h+=3)g.push(P+a[h]*2,P+a[h+1]*2,P+a[h+2]*2),g.push(P+a[h]*2+1,P+a[h+2]*2+1,P+a[h+1]*2+1);p.push({name:"caps",start:R,length:g.length}),t.bounding=global.BBox.fromCenterHalfsize([(c[0]+c[1])*.5,0,(u[0]+u[1])*.5],[d*.5,n*.5,f*.5],vec2.len([d*.5,n*.5,f*.5]))}else{for(var h=0;h<e.length;h+=2)s.push(e[h],0,e[h+1]),o.push(0,1,0),l.push((e[h]-c[0])/d,(e[h+1]-u[0])/f);g=a,p.push({name:"side",start:0,length:g.length}),t.bounding=global.BBox.fromCenterHalfsize([(c[0]+c[1])*.5,0,(u[0]+u[1])*.5],[d*.5,0,f*.5],vec2.len([d*.5,0,f*.5]))}if(t.xy){for(var h=0;h<s.length;h+=3)C(s,h),C(o,h);n?t.bounding=global.BBox.fromCenterHalfsize([(c[0]+c[1])*.5,(u[0]+u[1])*.5,0],[d*.5,f*.5,n*.5],vec2.len([d*.5,f*.5,n*.5])):t.bounding=global.BBox.fromCenterHalfsize([(c[0]+c[1])*.5,(u[0]+u[1])*.5,0],[d*.5,f*.5,0],vec2.len([d*.5,f*.5,0]))}return t.info={groups:p},new GL$1.Mesh.load({vertices:s,coords:l,normals:o,triangles:g},t,r);function C(k,D){var U=k[D+1];k[D+1]=k[D+2],k[D+2]=-U}},global.Texture=GL$1.Texture=function e(t,r,n,a){if(n=n||{},a=a||global.gl,this.gl=a,this._context_id=a.context_id,t=parseInt(t),r=parseInt(r),GL$1.debug&&console.log("GL.Texture created: ",t,r),this.handler=a.createTexture(),this.width=t,this.height=r,n.depth&&(this.depth=n.depth),this.texture_type=n.texture_type||a.TEXTURE_2D,this.format=n.format||e.DEFAULT_FORMAT,this.internalFormat=n.internalFormat,this.type=n.type||e.DEFAULT_TYPE,this.magFilter=n.magFilter||n.filter||e.DEFAULT_MAG_FILTER,this.minFilter=n.minFilter||n.filter||e.DEFAULT_MIN_FILTER,this.wrapS=n.wrap||n.wrapS||e.DEFAULT_WRAP_S,this.wrapT=n.wrap||n.wrapT||e.DEFAULT_WRAP_T,this.data=null,e.MAX_TEXTURE_IMAGE_UNITS||(e.MAX_TEXTURE_IMAGE_UNITS=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)),this.has_mipmaps=!1,this.format==a.DEPTH_COMPONENT&&a.webgl_version==1&&!a.extensions.WEBGL_depth_texture)throw"Depth Texture not supported";if(this.type==a.FLOAT&&!a.extensions.OES_texture_float&&a.webgl_version==1)throw"Float Texture not supported";if(this.type==a.HALF_FLOAT_OES){if(!a.extensions.OES_texture_half_float&&a.webgl_version==1)throw"Half Float Texture extension not supported.";a.webgl_version>1&&(console.warn("using HALF_FLOAT_OES in WebGL2 is deprecated, suing HALF_FLOAT instead"),this.type=this.format==a.RGB?a.RGB16F:a.RGBA16F)}if((!isPowerOfTwo(this.width)||!isPowerOfTwo(this.height))&&(this.minFilter!=a.NEAREST&&this.minFilter!=a.LINEAR||this.wrapS!=a.CLAMP_TO_EDGE||this.wrapT!=a.CLAMP_TO_EDGE))if(n.ignore_pot)this.minFilter=this.magFilter=a.LINEAR,this.wrapS=this.wrapT=a.CLAMP_TO_EDGE;else throw"Cannot use texture-wrap or mipmaps in Non-Power-of-Two textures";if(!t||!r)return;this.internalFormat||this.computeInternalFormat(),a.activeTexture(a.TEXTURE0+e.MAX_TEXTURE_IMAGE_UNITS-1),a.bindTexture(this.texture_type,this.handler),a.texParameteri(this.texture_type,a.TEXTURE_MAG_FILTER,this.magFilter),a.texParameteri(this.texture_type,a.TEXTURE_MIN_FILTER,this.minFilter),a.texParameteri(this.texture_type,a.TEXTURE_WRAP_S,this.wrapS),a.texParameteri(this.texture_type,a.TEXTURE_WRAP_T,this.wrapT),n.anisotropic&&a.extensions.EXT_texture_filter_anisotropic&&a.texParameterf(GL$1.TEXTURE_2D,a.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.anisotropic);var s=this.type,o=n.pixel_data;if(o&&!o.buffer){if(this.texture_type==GL$1.TEXTURE_CUBE_MAP)if(o[0].constructor===Number)o=c(o),o=[o,o,o,o,o,o];else for(var l=0;l<o.length;++l)o[l]=c(o[l]);else o=c(o);this.data=o}function c(d){return d.constructor!==Array?d:s==GL$1.FLOAT?new Float32Array(d):s==GL$1.HALF_FLOAT_OES?new Uint16Array(d):new Uint8Array(d)}if(e.setUploadOptions(n),this.texture_type==GL$1.TEXTURE_2D)a.texImage2D(GL$1.TEXTURE_2D,0,this.internalFormat,t,r,0,this.format,this.type,o||null),GL$1.isPowerOfTwo(t)&&GL$1.isPowerOfTwo(r)&&n.minFilter&&n.minFilter!=a.NEAREST&&n.minFilter!=a.LINEAR&&(a.generateMipmap(this.texture_type),this.has_mipmaps=!0);else if(this.texture_type==GL$1.TEXTURE_CUBE_MAP)for(var u=t*t*(this.format==GL$1.RGBA?4:3),l=0;l<6;++l){var h=o;h&&(h.constructor===Array?h=h[l]:h.subarray(u*l,u*(l+1))),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this.internalFormat,this.width,this.height,0,this.format,this.type,h||null)}else if(this.texture_type==GL$1.TEXTURE_3D){if(this.gl.webgl_version==1)throw"TEXTURE_3D not supported in WebGL 1. Enable WebGL 2 in the context by passing webgl2:true to the context";if(!n.depth)throw"3d texture depth must be set in the options.depth";a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage3D(GL$1.TEXTURE_3D,0,this.internalFormat,t,r,n.depth,0,this.format,this.type,o||null)}a.bindTexture(this.texture_type,null),a.activeTexture(a.TEXTURE0)},GL$1.Texture.DEFAULT_TYPE=GL$1.UNSIGNED_BYTE,GL$1.Texture.DEFAULT_FORMAT=GL$1.RGBA,GL$1.Texture.DEFAULT_MAG_FILTER=GL$1.LINEAR,GL$1.Texture.DEFAULT_MIN_FILTER=GL$1.LINEAR,GL$1.Texture.DEFAULT_WRAP_S=GL$1.CLAMP_TO_EDGE,GL$1.Texture.DEFAULT_WRAP_T=GL$1.CLAMP_TO_EDGE,GL$1.Texture.EXTENSION="png",GL$1.Texture.framebuffer=null,GL$1.Texture.renderbuffer=null,GL$1.Texture.loading_color=new Uint8Array([0,0,0,0]),GL$1.Texture.use_renderbuffer_pool=!0,GL$1.Texture.CROSS_ORIGIN_CREDENTIALS="Anonymous",GL$1.Texture.prototype.computeInternalFormat=function(){if(this.internalFormat=this.format,gl.webgl_version==1?this.type==GL$1.HALF_FLOAT&&(console.warn("webgl 1 does not use HALF_FLOAT, converting to HALF_FLOAT_OES"),this.type=GL$1.HALF_FLOAT_OES):this.type==GL$1.HALF_FLOAT_OES&&(console.warn("webgl 2 does not use HALF_FLOAT_OES, converting to HALF_FLOAT"),this.type=GL$1.HALF_FLOAT),this.format==GL$1.DEPTH_COMPONENT||this.format===GL$1.DEPTH_STENCIL){if(this.minFilter=GL$1.NEAREST,gl.webgl_version==2)if(this.type===GL$1.UNSIGNED_INT_24_8&&this.format===GL$1.DEPTH_STENCIL)this.internalFormat=GL$1.DEPTH24_STENCIL8;else if(this.type===GL$1.FLOAT&&this.format===GL$1.DEPTH_STENCIL)this.internalFormat=gl.FLOAT_32_UNSIGNED_INT_24_8_REV;else if(this.type==GL$1.UNSIGNED_SHORT)this.internalFormat=GL$1.DEPTH_COMPONENT16;else if(this.type==GL$1.UNSIGNED_INT)this.internalFormat=GL$1.DEPTH_COMPONENT24;else if(this.type==GL$1.FLOAT)this.internalFormat=GL$1.DEPTH_COMPONENT32F;else throw"unsupported type for a depth texture";else if(gl.webgl_version==1){if(this.type==GL$1.FLOAT)throw"WebGL 1.0 does not support float depth textures";this.internalFormat=GL$1.DEPTH_COMPONENT}}else if(this.format==gl.RGBA)gl.webgl_version==2&&(this.type==GL$1.FLOAT?this.internalFormat=GL$1.RGBA32F:this.type==GL$1.HALF_FLOAT&&(this.internalFormat=GL$1.RGBA16F));else if(this.format==gl.RGB&&gl.webgl_version==2){if(this.type==GL$1.FLOAT)this.internalFormat=GL$1.RGB32F;else if(this.type==GL$1.HALF_FLOAT)throw"GL.RGB HALF_FLOAT is not supported, use RGBA instead"}},GL$1.Texture.prototype.delete=function(){gl.deleteTexture(this.handler),this.handler=null},GL$1.Texture.prototype.getProperties=function(){return{width:this.width,height:this.height,type:this.type,format:this.format,texture_type:this.texture_type,magFilter:this.magFilter,minFilter:this.minFilter,wrapS:this.wrapS,wrapT:this.wrapT}},GL$1.Texture.prototype.hasSameProperties=function(e){return e?e.width==this.width&&e.height==this.height&&e.type==this.type&&e.format==this.format&&e.texture_type==this.texture_type:!1},GL$1.Texture.prototype.hasSameSize=function(e){return e?e.width==this.width&&e.height==this.height:!1},GL$1.Texture.prototype.toJSON=function(){return""},GL$1.Texture.isDepthSupported=function(){return gl.extensions.WEBGL_depth_texture!=null},GL$1.Texture.prototype.bind=function(e){e==null&&(e=0);var t=this.gl;return t.activeTexture(t.TEXTURE0+e),t.bindTexture(this.texture_type,this.handler),e},GL$1.Texture.prototype.unbind=function(e){e===void 0&&(e=0);var t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(this.texture_type,null)},GL$1.Texture.prototype.setParameter=function(e,t){switch(this.bind(0),this.gl.texParameteri(this.texture_type,e,t),e){case this.gl.TEXTURE_MAG_FILTER:this.magFilter=t;break;case this.gl.TEXTURE_MIN_FILTER:this.minFilter=t;break;case this.gl.TEXTURE_WRAP_S:this.wrapS=t;break;case this.gl.TEXTURE_WRAP_T:this.wrapT=t;break}},GL$1.Texture.setUploadOptions=function(e,t){t=t||global.gl,GL$1.Texture.disable_deprecated||(e?(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!e.premultiply_alpha),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!e.no_flip)):(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0))),t.pixelStorei(t.UNPACK_ALIGNMENT,1)},GL$1.Texture.flipYData=function(e,t,r,n){for(var a=new e.constructor(t*n),s=0,o=t*(r-1)*n,l=Math.floor(r*.5),c=0;c<l;++c){var u=e.subarray(s,s+t*n),h=e.subarray(o,o+t*n);if(a.set(u),u.set(h),h.set(a),s+=t*n,o-=t*n,s>o)break}},GL$1.Texture.prototype.uploadImage=function(e,t){this.bind();var r=this.gl;if(!e)throw"uploadImage parameter must be Image";GL$1.Texture.setUploadOptions(t,r);try{if(t&&t.subimage)r.webgl_version==1?r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.format,this.type,e):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.videoWidth||e.width,e.videoHeight||e.height,this.format,this.type,e);else{var n=e.videoWidth||e.width,a=e.videoHeight||e.height;(n!=this.width||a!=this.height)&&this.width!=1&&this.height!=1&&console.warn("image uploaded has a different size than texture, resizing it."),r.texImage2D(r.TEXTURE_2D,0,this.format,this.format,this.type,e),this.width=n,this.height=a}this.data=e}catch(s){throw console.error(s),location.protocol=="file:"?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}this.minFilter&&this.minFilter!=r.NEAREST&&this.minFilter!=r.LINEAR&&(r.generateMipmap(this.texture_type),this.has_mipmaps=!0),r.bindTexture(this.texture_type,null)},GL$1.Texture.prototype.uploadData=function(e,t,r){if(t=t||{},!e)throw"no data passed";var n=this.gl;this.bind(),GL$1.Texture.setUploadOptions(t,n);var a=t.mipmap_level||0,s=this.width,o=this.height;s=s>>a,o=o>>a;var l=this.internalFormat||this.format;if(this.type==GL$1.HALF_FLOAT_OES&&e.constructor===Float32Array&&console.warn("cannot uploadData to a HALF_FLOAT texture from a Float32Array, must be Uint16Array. To upload it we recomment to create a FLOAT texture, upload data there and copy to your HALF_FLOAT."),this.texture_type==GL$1.TEXTURE_2D)n.webgl_version==1?e.buffer&&e.buffer.constructor==ArrayBuffer?n.texImage2D(this.texture_type,a,l,s,o,0,this.format,this.type,e):n.texImage2D(this.texture_type,a,l,this.format,this.type,e):n.webgl_version==2&&(e.buffer&&e.buffer.constructor==ArrayBuffer?n.texImage2D(this.texture_type,a,l,s,o,0,this.format,this.type,e):n.texImage2D(this.texture_type,a,l,s,o,0,this.format,this.type,e));else if(this.texture_type==GL$1.TEXTURE_3D)n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.texImage3D(this.texture_type,a,l,s,o,this.depth>>a,0,this.format,this.type,e);else if(this.texture_type==GL$1.TEXTURE_CUBE_MAP)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+(t.cubemap_face||0),a,l,s,o,0,this.format,this.type,e);else throw"cannot uploadData for this texture type";this.data=e,!r&&this.minFilter&&this.minFilter!=n.NEAREST&&this.minFilter!=n.LINEAR&&(n.generateMipmap(this.texture_type),this.has_mipmaps=!0),n.bindTexture(this.texture_type,null)},GL$1.Texture.cubemap_camera_parameters=[{type:"posX",dir:vec3.fromValues(1,0,0),up:vec3.fromValues(0,1,0),right:vec3.fromValues(0,0,-1)},{type:"negX",dir:vec3.fromValues(-1,0,0),up:vec3.fromValues(0,1,0),right:vec3.fromValues(0,0,1)},{type:"posY",dir:vec3.fromValues(0,1,0),up:vec3.fromValues(0,0,-1),right:vec3.fromValues(1,0,0)},{type:"negY",dir:vec3.fromValues(0,-1,0),up:vec3.fromValues(0,0,1),right:vec3.fromValues(1,0,0)},{type:"posZ",dir:vec3.fromValues(0,0,1),up:vec3.fromValues(0,1,0),right:vec3.fromValues(1,0,0)},{type:"negZ",dir:vec3.fromValues(0,0,-1),up:vec3.fromValues(0,1,0),right:vec3.fromValues(-1,0,0)}],GL$1.Texture.prototype.drawTo=function(e,t){var r=this.gl,n=r.getViewport(),a=GL$1.getTime(),s=r.getParameter(r.FRAMEBUFFER_BINDING),o=r._framebuffer=r._framebuffer||r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var l=null;if(GL$1.Texture.use_renderbuffer_pool){r._renderbuffers_pool||(r._renderbuffers_pool={});var c=this.width+":"+this.height;r._renderbuffers_pool[c]?(l=r._renderbuffers_pool[c],l.time=a,r.bindRenderbuffer(r.RENDERBUFFER,l)):(r._renderbuffers_pool[c]=l=r.createRenderbuffer(),l.time=a,l.width=this.width,l.height=this.height,r.bindRenderbuffer(r.RENDERBUFFER,l),setTimeout(u.bind(l),1e3*60))}else l=r._renderbuffer=r._renderbuffer||r.createRenderbuffer(),l.width=this.width,l.height=this.height,r.bindRenderbuffer(r.RENDERBUFFER,l);this.format===r.DEPTH_COMPONENT?r.renderbufferStorage(r.RENDERBUFFER,r.RGBA4,this.width,this.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this.width,this.height);function u(){GL$1.getTime()-this.time>=1e3*60?(r.deleteRenderbuffer(r._renderbuffers_pool[c]),delete r._renderbuffers_pool[c]):setTimeout(u.bind(this),1e3*60)}if(r.viewport(0,0,this.width,this.height),r._current_texture_drawto=this,r._current_fbo_color=o,r._current_fbo_depth=l,this.texture_type==r.TEXTURE_2D)this.format!==r.DEPTH_COMPONENT?(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.handler,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,l)):(r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,l),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,this.handler,0)),e(this,t);else if(this.texture_type==r.TEXTURE_CUBE_MAP){this.format!==r.DEPTH_COMPONENT?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,l):r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,l);for(var h=0;h<6;h++)this.format!==r.DEPTH_COMPONENT?r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+h,this.handler,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X+h,this.handler,0),e(this,h,t)}return this.data=null,r._current_texture_drawto=null,r._current_fbo_color=null,r._current_fbo_depth=null,r.bindFramebuffer(r.FRAMEBUFFER,s),r.bindRenderbuffer(r.RENDERBUFFER,null),r.viewport(n[0],n[1],n[2],n[3]),this},GL$1.Texture.prototype.copyTo=function(e,t,r){var n=this.gl;if(!e)throw"target_texture required";var a=n.getParameter(n.FRAMEBUFFER_BINDING),s=n.getViewport();t||(t=this.texture_type==n.TEXTURE_2D?GL$1.Shader.getScreenShader():GL$1.Shader.getCubemapCopyShader()),n.disable(n.BLEND),n.disable(n.DEPTH_TEST),t&&r&&t.uniforms(r);var o=n.__copy_fbo;if(o||(o=n.__copy_fbo=n.createFramebuffer()),n.bindFramebuffer(n.FRAMEBUFFER,o),n.viewport(0,0,e.width,e.height),this.texture_type==n.TEXTURE_2D)if(this.format!==n.DEPTH_COMPONENT&&this.format!==n.DEPTH_STENCIL)n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.handler,0),this.toViewport(t);else{var l=n._color_renderbuffer=n._color_renderbuffer||n.createRenderbuffer(),c=l.width=e.width,u=l.height=e.height;n.bindRenderbuffer(n.RENDERBUFFER,l),n.renderbufferStorage(n.RENDERBUFFER,n.RGBA4,c,u),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,l);var h=e.format==n.DEPTH_STENCIL?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_2D,e.handler,0);var d=n.checkFramebufferStatus(n.FRAMEBUFFER);if(d!==n.FRAMEBUFFER_COMPLETE)throw"FBO not complete: "+d;n.enable(n.DEPTH_TEST),n.depthFunc(n.ALWAYS),n.colorMask(!1,!1,!1,!1),t=GL$1.Shader.getCopyDepthShader(),this.toViewport(t),n.colorMask(!0,!0,!0,!0),n.disable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,null),n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_2D,null,0)}else if(this.texture_type==n.TEXTURE_CUBE_MAP){t.uniforms({u_texture:0});for(var f=GL$1.temp_mat3,p=0;p<6;p++){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+p,e.handler,0);var g=GL$1.Texture.cubemap_camera_parameters[p];mat3.identity(f),f.set(g.right,0),f.set(g.up,3),f.set(g.dir,6),this.toViewport(t,{u_rotation:f})}}return n.setViewport(s),n.bindFramebuffer(n.FRAMEBUFFER,a),e.minFilter&&e.minFilter!=n.NEAREST&&e.minFilter!=n.LINEAR&&(e.bind(),n.generateMipmap(e.texture_type),e.has_mipmaps=!0),e.data=null,n.bindTexture(e.texture_type,null),this},GL$1.Texture.prototype.blit=function(){var e=new Float32Array(4);return function(t,r,n){var a=this.gl;if(this.texture_type!=a.TEXTURE_2D||this.format===a.DEPTH_COMPONENT||this.format===a.DEPTH_STENCIL)throw"blit only support TEXTURE_2D of RGB or RGBA. use copyTo instead";var s=a.getParameter(a.FRAMEBUFFER_BINDING);e.set(a.viewport_data),r=r||GL$1.Shader.getScreenShader(),r&&n&&r.uniforms(n);var o=a.__copy_fbo;return o||(o=a.__copy_fbo=a.createFramebuffer()),a.bindFramebuffer(a.FRAMEBUFFER,o),a.viewport(0,0,t.width,t.height),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t.handler,0),this.bind(0),r.draw(GL$1.Mesh.getScreenQuad(),a.TRIANGLES),a.setViewport(e),a.bindFramebuffer(a.FRAMEBUFFER,s),t.data=null,a.bindTexture(t.texture_type,null),this}}(),GL$1.Texture.prototype.toViewport=function(e,t){e=e||Shader.getScreenShader();var r=Mesh.getScreenQuad();this.bind(0),t&&e.uniforms(t),e.draw(r,gl.TRIANGLES)},GL$1.Texture.prototype.fill=function(e,t){if(e.constructor===GL$1.Shader){var r=e;this.drawTo(function(){r.toViewport()})}else{var n=e,a=gl.getParameter(gl.COLOR_CLEAR_VALUE);gl.clearColor(n[0],n[1],n[2],n[3]),this.drawTo(function(){gl.clear(gl.COLOR_BUFFER_BIT)}),gl.clearColor(a[0],a[1],a[2],a[3])}!t&&this.minFilter&&this.minFilter!=gl.NEAREST&&this.minFilter!=gl.LINEAR&&(this.bind(),gl.generateMipmap(this.texture_type),this.has_mipmaps=!0)},GL$1.Texture.prototype.renderQuad=function(){var e=mat3.create(),t=vec2.create(),r=vec2.create(),n=vec4.fromValues(1,1,1,1);return function(a,s,o,l,c,u){t[0]=a,t[1]=s,r[0]=o,r[1]=l,c=c||Shader.getQuadShader(this.gl);var h=Mesh.getScreenQuad(this.gl);this.bind(0),c.uniforms({u_texture:0,u_position:t,u_color:n,u_size:r,u_viewport:gl.viewport_data.subarray(2,4),u_transform:e}),u&&c.uniforms(u),c.draw(h,gl.TRIANGLES)}}(),GL$1.Texture.prototype.applyBlur=function(e,t,r,n,a){var s=this.gl;e===void 0&&(e=1),t===void 0&&(t=1),s.disable(s.DEPTH_TEST),s.disable(s.BLEND),n=n||this;var o=!a;if(a===n)throw"cannot use applyBlur in a texture using as temporary itself";if(n&&this.texture_type!==n.texture_type)throw"cannot use applyBlur with textures of different texture_type";var l=s.getParameter(s.FRAMEBUFFER_BINDING),c=s.getViewport(),u=s.__copy_fbo;if(u||(u=s.__copy_fbo=s.createFramebuffer()),s.bindFramebuffer(s.FRAMEBUFFER,u),s.viewport(0,0,this.width,this.height),this.texture_type===s.TEXTURE_2D){var h=GL$1.Shader.getBlurShader();a||(a=GL$1.Texture.getTemporary(this.width,this.height,this)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,a.handler,0),this.toViewport(h,{u_texture:0,u_intensity:r,u_offset:[0,t/this.height]}),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n.handler,0),s.viewport(0,0,n.width,n.height),a.toViewport(h,{u_intensity:r,u_offset:[e/a.width,0]}),o&&GL$1.Texture.releaseTemporary(a)}else if(this.texture_type===s.TEXTURE_CUBE_MAP){var h=GL$1.Shader.getCubemapBlurShader();h.uniforms({u_texture:0,u_intensity:r,u_offset:[e/this.width,t/this.height]}),this.bind(0);var d=Mesh.getScreenQuad();d.bindBuffers(h),h.bind();var f=null;!a&&n==this?f=a=GL$1.Texture.getTemporary(n.width,n.height,n):f=n;for(var p=GL$1.temp_mat3,g=0;g<6;++g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+g,f.handler,0);var b=GL$1.Texture.cubemap_camera_parameters[g];mat3.identity(p),p.set(b.right,0),p.set(b.up,3),p.set(b.dir,6),h._setUniform("u_rotation",p),s.drawArrays(s.TRIANGLES,0,6)}d.unbindBuffers(h),a&&a.copyTo(n),a&&o&&GL$1.Texture.releaseTemporary(a)}s.setViewport(c),s.bindFramebuffer(s.FRAMEBUFFER,l),n.data=null,n.minFilter&&n.minFilter!=s.NEAREST&&n.minFilter!=s.LINEAR&&(n.bind(),s.generateMipmap(n.texture_type),n.has_mipmaps=!0),s.bindTexture(n.texture_type,null)},GL$1.Texture.fromURL=function(e,t,r,n){n=n||global.gl,t=t||{},t=Object.create(t);var a=t.texture||new GL$1.Texture(1,1,t,n);e.length<64&&(a.url=e),a.bind();var s=t.temp_color||GL$1.Texture.loading_color;n.pixelStorei(n.UNPACK_ALIGNMENT,4);var o=t.type==n.FLOAT?new Float32Array(s):new Uint8Array(s);n.texImage2D(n.TEXTURE_2D,0,a.format,a.width,a.height,0,a.format,a.type,o),n.bindTexture(a.texture_type,null),a.ready=!1;var l=null;if(t.extension&&(l=t.extension),!l&&e.length<512){var c=e,u=e.indexOf("?");u!=-1&&(c=e.substr(0,u)),u=c.lastIndexOf("."),u!=-1&&(l=c.substr(u+1).toLowerCase())}if(l=="dds"){var l=n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBGL_compressed_texture_s3tc"),h=new GL$1.Texture(0,0,t,n);DDS.loadDDSTextureEx(n,l,e,h.handler,!0,function(p){a.texture_type=p.texture_type,a.handler=p,delete a.ready,r&&r(a,e)})}else if(l=="tga")global.HttpRequest(e,null,function(f){var p=GL$1.Texture.parseTGA(f);p&&(t.texture=a,p.flipY&&(t.no_flip=!0),p.format=="RGB"&&(a.format=n.RGB),a=GL$1.Texture.fromMemory(p.width,p.height,p.pixels,t),delete a.ready,r&&r(a,e))},null,{binary:!0});else{var d=new Image;d.src=e,d.crossOrigin=GL$1.Texture.CROSS_ORIGIN_CREDENTIALS,d.onload=function(){t.texture=a,GL$1.Texture.fromImage(this,t),delete a.ready,r&&r(a,e)},d.onerror=function(){r&&r(null)}}return a},GL$1.Texture.parseTGA=function(e){if(!e||e.constructor!==ArrayBuffer)throw"TGA: data must be ArrayBuffer";e=new Uint8Array(e);for(var t=new Uint8Array([0,0,2,0,0,0,0,0,0,0,0,0]),r=e.subarray(0,12),n=0;n<r.length;n++)if(t[n]!=r[n])return console.error("TGA header is not valid"),null;var a=e.subarray(12,18),s={};s.width=a[1]*256+a[0],s.height=a[3]*256+a[2],s.bpp=a[4],s.bytesPerPixel=s.bpp/8,s.imageSize=s.width*s.height*s.bytesPerPixel,s.pixels=e.subarray(18,18+s.imageSize),s.pixels=new Uint8Array(s.pixels),s.flipY=(a[5]&32)==0;for(var n=0;n<s.imageSize;n+=s.bytesPerPixel){var o=s.pixels[n];s.pixels[n]=s.pixels[n+2],s.pixels[n+2]=o}return s.format=s.bpp==32?"RGBA":"RGB",s},GL$1.Texture.fromImage=function(e,t){t=t||{};var r=t.texture||new GL$1.Texture(e.width,e.height,t);return r.uploadImage(e,t),r.bind(),gl.texParameteri(r.texture_type,gl.TEXTURE_MAG_FILTER,r.magFilter||GL$1.Texture.DEFAULT_MAG_FILTER),gl.texParameteri(r.texture_type,gl.TEXTURE_MIN_FILTER,r.minFilter||GL$1.Texture.DEFAULT_MIN_FILTER),gl.texParameteri(r.texture_type,gl.TEXTURE_WRAP_S,r.wrapS||GL$1.Texture.DEFAULT_WRAP_S),gl.texParameteri(r.texture_type,gl.TEXTURE_WRAP_T,r.wrapT||GL$1.Texture.DEFAULT_WRAP_T),GL$1.isPowerOfTwo(r.width)&&GL$1.isPowerOfTwo(r.height)||gl.webgl_version>1?t.minFilter&&t.minFilter!=gl.NEAREST&&t.minFilter!=gl.LINEAR&&(r.bind(),gl.generateMipmap(r.texture_type),r.has_mipmaps=!0):(gl.texParameteri(r.texture_type,gl.TEXTURE_MIN_FILTER,GL$1.LINEAR),gl.texParameteri(r.texture_type,gl.TEXTURE_WRAP_S,GL$1.CLAMP_TO_EDGE),gl.texParameteri(r.texture_type,gl.TEXTURE_WRAP_T,GL$1.CLAMP_TO_EDGE),r.has_mipmaps=!1),gl.bindTexture(r.texture_type,null),r.data=e,t.keep_image&&(r.img=e),r},GL$1.Texture.fromVideo=function(e,t){t=t||{};var r=t.texture||new GL$1.Texture(e.videoWidth,e.videoHeight,t);return r.bind(),r.uploadImage(e,t),t.minFilter&&t.minFilter!=gl.NEAREST&&t.minFilter!=gl.LINEAR&&(r.bind(),gl.generateMipmap(r.texture_type),r.has_mipmaps=!0,r.data=e),gl.bindTexture(r.texture_type,null),r},GL$1.Texture.fromTexture=function(e,t){t=t||{};var r=new GL$1.Texture(e.width,e.height,t);return e.copyTo(r),r},GL$1.Texture.prototype.clone=function(e){var t=this.getProperties();if(e)for(var r in e)t[r]=e[r];return GL$1.Texture.fromTexture(this,t)},GL$1.Texture.fromMemory=function(e,t,r,n){n=n||{};var a=n.texture||new GL$1.Texture(e,t,n);return GL$1.Texture.setUploadOptions(n),a.bind(),r.constructor===Array&&(n.type==gl.FLOAT?r=new Float32Array(r):n.type==GL$1.HALF_FLOAT||n.type==GL$1.HALF_FLOAT_OES?r=new Uint16Array(r):r=new Uint8Array(r)),gl.texImage2D(gl.TEXTURE_2D,0,a.format,e,t,0,a.format,a.type,r),a.width=e,a.height=t,a.data=r,n.minFilter&&n.minFilter!=gl.NEAREST&&n.minFilter!=gl.LINEAR&&(gl.generateMipmap(gl.TEXTURE_2D),a.has_mipmaps=!0),gl.bindTexture(a.texture_type,null),a},GL$1.Texture.fromDDSInMemory=function(e,t){t=t||{};var r=t.texture||new GL$1.Texture(0,0,t);GL$1.Texture.setUploadOptions(t),r.bind();var n=gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBGL_compressed_texture_s3tc");return DDS.loadDDSTextureFromMemoryEx(gl,n,e,r,!0),gl.bindTexture(r.texture_type,null),r},GL$1.Texture.fromShader=function(e,t,r,n){n=n||{};var a=new GL$1.Texture(e,t,n);return a.drawTo(function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE);var s=Mesh.getScreenQuad();r.draw(s)}),a},GL$1.Texture.cubemapFromImages=function(e,t){if(t=t||{},e.length!=6)throw"missing images to create cubemap";var r=e[0].width,n=e[0].height;t.texture_type=gl.TEXTURE_CUBE_MAP;var a=null;t.texture?(a=t.texture,a.width=r,a.height=n):a=new GL$1.Texture(r,n,t),GL$1.Texture.setUploadOptions(t),a.bind();try{for(var s=0;s<6;s++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a.format,a.format,a.type,e[s]);a.data=e}catch{throw location.protocol=="file:"?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return t.minFilter&&t.minFilter!=gl.NEAREST&&t.minFilter!=gl.LINEAR&&(gl.generateMipmap(gl.TEXTURE_CUBE_MAP),a.has_mipmaps=!0),a.unbind(),a},GL$1.Texture.cubemapFromImage=function(e,t){if(t=t||{},e.width!=e.height/6&&e.height%6!=0&&!t.faces&&!t.is_polar)return console.error("Cubemap image not valid, only 1x6 (vertical) or 6x3 (cross) formats. Check size:",e.width,e.height),null;var r=e.width,n=e.height;if(t.is_polar){var d=t.size||GL$1.nearestPowerOfTwo(e.height),a=GL$1.Texture.fromImage(e,{ignore_pot:!0,wrap:gl.REPEAT,filter:gl.LINEAR}),s=new GL$1.Texture(d,d,{texture_type:gl.TEXTURE_CUBE_MAP,format:gl.RGBA});if(t.texture){var o=t.texture;for(var l in s)o[l]=s[l];s=o}var c=mat3.create(),u={u_texture:0,u_rotation:c};gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND);var h=GL$1.Shader.getPolarToCubemapShader();return s.drawTo(function(E,L){var T=GL$1.Texture.cubemap_camera_parameters[L];mat3.identity(c),c.set(T.right,0),c.set(T.up,3),c.set(T.dir,6),a.toViewport(h,u)}),t.keep_image&&(s.img=e),s}else t.is_cross!==void 0?(t.faces=GL$1.Texture.generateCubemapCrossFacesInfo(e.width,t.is_cross),r=n=e.width/4):t.faces?(r=t.width||t.faces[0].width,n=t.height||t.faces[0].height):n/=6;if(r!=n)return console.log("Texture not valid, width and height for every face must be square"),null;var d=r;t.no_flip=!0;for(var f=[],l=0;l<6;l++){var p=createCanvas(d,d),g=p.getContext("2d");t.faces?g.drawImage(e,t.faces[l].x,t.faces[l].y,t.faces[l].width||d,t.faces[l].height||d,0,0,d,d):g.drawImage(e,0,n*l,r,n,0,0,d,d),f.push(p)}var b=GL$1.Texture.cubemapFromImages(f,t);return t.keep_image&&(b.img=e),b},GL$1.Texture.generateCubemapCrossFacesInfo=function(e,t){t===void 0&&(t=1);var r=e/4;return[{x:2*r,y:r,width:r,height:r},{x:0,y:r,width:r,height:r},{x:t*r,y:0,width:r,height:r},{x:t*r,y:2*r,width:r,height:r},{x:r,y:r,width:r,height:r},{x:3*r,y:r,width:r,height:r}]},GL$1.Texture.cubemapFromURL=function(e,t,r){t=t||{},t=Object.create(t),t.texture_type=gl.TEXTURE_CUBE_MAP;var n=t.texture||new GL$1.Texture(1,1,t);n.bind(),GL$1.Texture.setUploadOptions(t);for(var a=t.temp_color||[0,0,0,255],s=t.type==gl.FLOAT?new Float32Array(a):new Uint8Array(a),o=0;o<6;o++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n.format,1,1,0,n.format,n.type,s);gl.bindTexture(n.texture_type,null),n.ready=!1;var l=new Image;return l.src=e,l.onload=function(){t.texture=n,n=GL$1.Texture.cubemapFromImage(this,t),n&&delete n.ready,r&&r(n)},n},GL$1.Texture.prototype.getPixels=function(e,t){t=t||0;var r=this.gl,n=r.getViewport(),a=r.getParameter(r.FRAMEBUFFER_BINDING);if(this.format==r.DEPTH_COMPONENT)throw"cannot use getPixels in depth textures";r.disable(r.DEPTH_TEST);var s=r.__copy_fbo;s||(s=r.__copy_fbo=r.createFramebuffer()),r.bindFramebuffer(r.FRAMEBUFFER,s);var o=null,l=this.width>>t,c=this.height>>t;r.viewport(0,0,l,c),this.texture_type==r.TEXTURE_2D?r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.handler,t):this.texture_type==r.TEXTURE_CUBE_MAP&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+(e||0),this.handler,t);var u=this.format==r.RGB?3:4;u=4;var h=this.type;return h==r.UNSIGNED_BYTE?o=new Uint8Array(l*c*u):h==GL$1.HALF_FLOAT||h==GL$1.HALF_FLOAT_OES?o=new Uint16Array(l*c*u):o=new Float32Array(l*c*u),r.readPixels(0,0,l,c,u==3?r.RGB:r.RGBA,h,o),r.bindFramebuffer(r.FRAMEBUFFER,a),r.viewport(n[0],n[1],n[2],n[3]),o},GL$1.Texture.prototype.setPixels=function(e,t,r,n){var a={no_flip:t};n&&(a.cubemap_face=n),this.uploadData(e,a,r)},GL$1.Texture.prototype.getCubemapPixels=function(){if(this.texture_type!==gl.TEXTURE_CUBE_MAP)throw"this texture is not a cubemap";return[this.getPixels(0),this.getPixels(1),this.getPixels(2),this.getPixels(3),this.getPixels(4),this.getPixels(5)]},GL$1.Texture.prototype.setCubemapPixels=function(e,t){if(this.texture_type!==gl.TEXTURE_CUBE_MAP)throw"this texture is not a cubemap, it should be created with { texture_type: gl.TEXTURE_CUBE_MAP }";for(var r=0;r<6;++r)this.setPixels(e[r],t,r!=5,r)},GL$1.Texture.prototype.toCanvas=function(e,t,r){r=r||8192;var n=this.gl,a=Math.min(this.width,r),s=Math.min(this.height,r);this.texture_type==n.TEXTURE_CUBE_MAP&&(a=a*4,s=s*3),e=e||createCanvas(a,s),e.width!=a&&(e.width=a),e.height!=s&&(e.height=s);var o=null;if(this.texture_type==n.TEXTURE_2D){if(this.width!=a||this.height!=s||this.type!=n.UNSIGNED_BYTE){var l=new GL$1.Texture(a,s,{format:n.RGBA,filter:n.NEAREST});this.copyTo(l),o=l.getPixels()}else o=this.getPixels();var c=e.getContext("2d"),u=c.getImageData(0,0,a,s);if(u.data.set(o),c.putImageData(u,0,0),t){var l=createCanvas(a,s),h=l.getContext("2d");h.translate(0,l.height),h.scale(1,-1),h.drawImage(e,0,0,l.width,l.height),c.clearRect(0,0,c.canvas.width,c.canvas.height),c.drawImage(l,0,0)}}else if(this.texture_type==n.TEXTURE_CUBE_MAP){var d=createCanvas(this.width,this.height),h=d.getContext("2d"),f=GL$1.Texture.generateCubemapCrossFacesInfo(e.width,1),c=e.getContext("2d");c.fillStyle="black",c.fillRect(0,0,e.width,e.height);var p=this;this.type!=n.UNSIGNED_BYTE&&(p=new GL$1.Texture(this.width,this.height,{format:n.RGBA,texture_type:n.TEXTURE_CUBE_MAP,filter:n.NEAREST,type:n.UNSIGNED_BYTE}),this.copyTo(p));for(var g=0;g<6;g++){var u=h.getImageData(0,0,d.width,d.height);o=p.getPixels(g),u.data.set(o),h.putImageData(u,0,0),c.drawImage(d,f[g].x,f[g].y,d.width,d.height)}}return e},GL$1.Texture.binary_extension="png",GL$1.Texture.prototype.toBinary=function(e,t){for(var r=this.toCanvas(null,e),n=r.toDataURL(t),a=n.indexOf(","),s=n.substr(a+1),o=atob(s),l=o.length,c=new Uint8Array(l),u=0;u<l;++u)c[u]=o.charCodeAt(u);return c},GL$1.Texture.prototype.toBlob=function(e,t){var r=this.toBinary(e),n=new Blob([r],{type:t||"image/png"});return n},GL$1.Texture.prototype.toBlobAsync=function(e,t,r){var n=this.toCanvas(null,e);if(n.toBlob){n.toBlob(r,t);return}var a=this.toBlob(e,t);r&&r(a)},GL$1.Texture.prototype.toBase64=function(e){var t=this.width,r=this.height,n=this.getPixels(),a=createCanvas(t,r),s=a.getContext("2d"),o=s.getImageData(0,0,t,r);if(o.data.set(n),s.putImageData(o,0,0),e){var l=createCanvas(t,r),c=l.getContext("2d");c.translate(0,r),c.scale(1,-1),c.drawImage(a,0,0),a=l}var u=a.toDataURL("image/png");return u},GL$1.Texture.prototype.generateMetadata=function(){var e={};e.width=this.width,e.height=this.height,this.metadata=e},GL$1.Texture.compareFormats=function(e,t){return!e||!t?!1:e==t?!0:!(e.width!=t.width||e.height!=t.height||e.type!=t.type||e.format!=t.format||e.texture_type!=t.texture_type)},GL$1.Texture.blend=function(e,t,r,n){if(!e||!t)return!1;if(e==t)return n?e.copyTo(n):e.toViewport(),!0;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE);var a=GL$1.Shader.getBlendShader(),s=GL$1.Mesh.getScreenQuad();return t.bind(1),a.uniforms({u_texture:0,u_texture2:1,u_factor:r}),n?(n.drawTo(function(){if(e==n||t==n)throw"Blend output cannot be the same as the input";e.bind(0),a.draw(s,gl.TRIANGLES)}),!0):(e.bind(0),a.draw(s,gl.TRIANGLES),!0)},GL$1.Texture.cubemapToTexture2D=function(e,t,r,n,a){if(!e||e.texture_type!=gl.TEXTURE_CUBE_MAP)throw"No cubemap in convert";t=t||e.width;var s=n?e.type:gl.UNSIGNED_BYTE;a=a||0,r||(r=new GL$1.Texture(t*2,t,{minFilter:gl.NEAREST,type:s}));var o=gl.shaders.cubemap_to_texture2D;return o||(o=gl.shaders.cubemap_to_texture2D=new GL$1.Shader(GL$1.Shader.SCREEN_VERTEX_SHADER,`		precision mediump float;
		#define PI 3.14159265358979323846264
		uniform samplerCube texture;		varying vec2 v_coord;		uniform float u_yaw;
		void main() {			float alpha = ((1.0 - v_coord.x) * 2.0) * PI + u_yaw;			float beta = (v_coord.y * 2.0 - 1.0) * PI * 0.5;			vec3 N = vec3( -cos(alpha) * cos(beta), sin(beta), sin(alpha) * cos(beta) );			gl_FragColor = textureCube(texture,N);		}`)),o.setUniform("u_yaw",a),r.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),e.toViewport(o)}),r},GL$1.Texture.getWhiteTexture=function(e){e=e||global.gl;var t=e.textures[":white"];if(t)return t;var r=new Uint8Array([255,255,255,255]);return e.textures[":white"]=new GL$1.Texture(1,1,{pixel_data:r})},GL$1.Texture.getBlackTexture=function(e){e=e||global.gl;var t=e.textures[":black"];if(t)return t;var r=new Uint8Array([0,0,0,255]);return e.textures[":black"]=new GL$1.Texture(1,1,{pixel_data:r})},GL$1.Texture.getTemporary=function(e,t,r,n){n=n||global.gl,n._texture_pool||(n._texture_pool=[]);var a=GL$1.TEXTURE_2D,s=GL$1.Texture.DEFAULT_TYPE,o=GL$1.Texture.DEFAULT_FORMAT;r&&(r.texture_type&&(a=r.texture_type),r.type&&(s=r.type),r.format&&(o=r.format));for(var l=a+":"+s+":"+e+"x"+t+":"+o,c=n._texture_pool,u=0;u<c.length;++u){var h=c[u];if(h._key==l)return c.splice(u,1),h._pool=0,h}var h=new GL$1.Texture(e,t,{type:s,texture_type:a,format:o,filter:n.LINEAR});return h._key=l,h._pool=0,h},GL$1.Texture.releaseTemporary=function(e,t){t=t||global.gl,t._texture_pool||(t._texture_pool=[]),e._pool>0&&console.warn("this texture is already in the textures pool");var r=t._texture_pool;if(r||(r=t._texture_pool=[]),e._pool=global.getTime(),r.push(e),r.length>20){r.sort(function(a,s){return s._pool-a._pool});var e=r.pop();e._pool=0,e.delete()}},GL$1.Texture.nextPOT=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))};function FBO(e,t,r,n){if(n=n||global.gl,this.gl=n,this._context_id=n.context_id,e&&e.constructor!==Array)throw"FBO textures must be an Array";this.handler=null,this.width=-1,this.height=-1,this.color_textures=[],this.depth_texture=null,this.stencil=!!r,this._stencil_enabled=!1,this._num_binded_textures=0,this.order=null,(e&&e.length||t)&&this.setTextures(e,t),this._old_fbo_handler=null,this._old_viewport=new Float32Array(4)}GL$1.FBO=FBO,FBO.prototype.setTextures=function(e,t,r){if(t&&t.constructor===GL$1.Texture){if(t.format!==GL$1.DEPTH_COMPONENT&&t.format!==GL$1.DEPTH_STENCIL&&t.format!==GL$1.DEPTH_COMPONENT16&&t.format!==GL$1.DEPTH_COMPONENT24&&t.format!==GL$1.DEPTH_COMPONENT32F)throw"FBO Depth texture must be of format: gl.DEPTH_COMPONENT, gl.DEPTH_STENCIL or gl.DEPTH_COMPONENT16/24/32F (only in webgl2)";if(t.type!=GL$1.UNSIGNED_SHORT&&t.type!=GL$1.UNSIGNED_INT&&t.type!=GL$1.UNSIGNED_INT_24_8_WEBGL&&t.type!=GL$1.FLOAT)throw"FBO Depth texture must be of type: gl.UNSIGNED_SHORT, gl.UNSIGNED_INT, gl.UNSIGNED_INT_24_8_WEBGL"}var n=this.depth_texture==t;if(n&&e){if(e.constructor!==Array)throw"FBO: color_textures parameter must be an array containing all the textures to be binded in the color";if(e.length==this.color_textures.length){for(var a=0;a<e.length;++a)if(e[a]!=this.color_textures[a]){n=!1;break}}else n=!1}if(this._stencil_enabled!==this.stencil&&(n=!1),!n){if(this.color_textures.length=e?e.length:0,e)for(var a=0;a<e.length;++a)this.color_textures[a]=e[a];this.depth_texture=t,this.update(r)}},FBO.prototype.update=function(e){this._old_fbo_handler=gl.getParameter(gl.FRAMEBUFFER_BINDING),this.handler||(this.handler=gl.createFramebuffer());var t=-1,r=-1,n=null,a=null,s=this.color_textures,o=this.depth_texture;if(s&&s.length)for(var l=0;l<s.length;l++){var c=s[l];if(c.constructor!==GL$1.Texture)throw"FBO can only bind instances of GL.Texture";if(t==-1)t=c.width;else if(t!=c.width)throw"Cannot bind textures with different dimensions";if(r==-1)r=c.height;else if(r!=c.height)throw"Cannot bind textures with different dimensions";if(n==null)n=c.type,a=c.format;else if(n!=c.type)throw"Cannot bind textures to a FBO with different pixel formats";if(c.texture_type!=gl.TEXTURE_2D)throw"Cannot bind a Cubemap to a FBO"}else t=o.width,r=o.height;this.width=t,this.height=r,gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler);var u=gl.extensions.WEBGL_draw_buffers;if(gl.webgl_version==1&&!u&&s&&s.length>1)throw"Rendering to several textures not supported by your browser";var h=gl.webgl_version==1?gl.FRAMEBUFFER:gl.DRAW_FRAMEBUFFER;if(gl.framebufferRenderbuffer(h,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,null),gl.framebufferRenderbuffer(h,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,null),o&&o.constructor===GL$1.Texture){if(gl.webgl_version==1&&!gl.extensions.WEBGL_depth_texture)throw"Rendering to depth texture not supported by your browser";this.stencil&&o.format!==gl.DEPTH_STENCIL&&console.warn("Stencil cannot be enabled if there is a depth texture with a DEPTH_STENCIL format"),o.format==gl.DEPTH_STENCIL?gl.framebufferTexture2D(h,gl.DEPTH_STENCIL_ATTACHMENT,gl.TEXTURE_2D,o.handler,0):gl.framebufferTexture2D(h,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,o.handler,0)}else{var d=null;o&&o.constructor===WebGLRenderbuffer&&o.width==t&&o.height==r?d=this._depth_renderbuffer=o:(d=this._depth_renderbuffer=this._depth_renderbuffer||gl.createRenderbuffer(),d.width=t,d.height=r),gl.bindRenderbuffer(gl.RENDERBUFFER,d),this.stencil?(gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,t,r),gl.framebufferRenderbuffer(h,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,d)):(gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,t,r),gl.framebufferRenderbuffer(h,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,d))}if(s&&s.length){this.order=[];for(var l=0;l<s.length;l++){var c=s[l];gl.framebufferTexture2D(h,gl.COLOR_ATTACHMENT0+l,gl.TEXTURE_2D,c.handler,0),this.order.push(gl.COLOR_ATTACHMENT0+l)}}else{var f=this._color_renderbuffer=this._color_renderbuffer||gl.createRenderbuffer();f.width=t,f.height=r,gl.bindRenderbuffer(gl.RENDERBUFFER,f),gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGBA4,t,r),gl.framebufferRenderbuffer(h,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,f)}for(var p=s?s.length:0,l=p;l<this._num_binded_textures;++l)gl.framebufferTexture2D(h,gl.COLOR_ATTACHMENT0+l,gl.TEXTURE_2D,null,0);this._num_binded_textures=p,this._stencil_enabled=this.stencil,s&&s.length>1&&(u?u.drawBuffersWEBGL(this.order):gl.drawBuffers(this.order));var g=gl.checkFramebufferStatus(h);if(g!==gl.FRAMEBUFFER_COMPLETE)throw a==GL$1.RGB&&(n==GL$1.FLOAT||n==GL$1.HALF_FLOAT_OES)&&console.error("Tip: Firefox does not support RGB channel float/half_float textures, you must use RGBA"),"FBO not complete: "+g;gl.bindTexture(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),e||gl.bindFramebuffer(h,this._old_fbo_handler)},FBO.prototype.bind=function(e){if(this.multi_sample){this._old_fbo_handler=gl.getParameter(gl.FRAMEBUFFER_BINDING),this._old_viewport.set(gl.viewport_data),gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this.colorRenderbuffer),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.depthRenderbuffer),gl.viewport(0,0,this.width,this.height),FBO.current=this;return}if(!this.color_textures.length&&!this.depth_texture)throw"FBO: no textures attached to FBO";this._old_viewport.set(gl.viewport_data),e?this._old_fbo_handler=gl.getParameter(gl.FRAMEBUFFER_BINDING):this._old_fbo_handler=null,this._old_fbo_handler!=this.handler&&gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler);for(var t=0;t<this.color_textures.length;++t)this.color_textures[t]._in_current_fbo=!0;this.depth_texture&&(this.depth_texture._in_current_fbo=!0),gl.viewport(0,0,this.width,this.height),FBO.current=this},FBO.prototype.unbind=function(){gl.bindFramebuffer(gl.FRAMEBUFFER,this._old_fbo_handler),this._old_fbo_handler=null,gl.setViewport(this._old_viewport);for(var e=0;e<this.color_textures.length;++e)this.color_textures[e]._in_current_fbo=!1;this.depth_texture&&(this.depth_texture._in_current_fbo=!1),FBO.current=null},FBO.prototype.switchTo=function(e){e._old_fbo_handler=this._old_fbo_handler,e._old_viewport.set(this._old_viewport),gl.bindFramebuffer(gl.FRAMEBUFFER,e.handler),this._old_fbo_handler=null,gl.viewport(0,0,this.width,this.height);for(var t=0;t<this.color_textures.length;++t)this.color_textures[t]._in_current_fbo=!1;this.depth_texture&&(this.depth_texture._in_current_fbo=!1);for(var t=0;t<e.color_textures.length;++t)e.color_textures[t]._in_current_fbo=!0;e.depth_texture&&(e.depth_texture._in_current_fbo=!0),FBO.current=e},FBO.prototype.delete=function(){gl.deleteFramebuffer(this.handler),this.handler=null},FBO.supported={},FBO.testSupport=function(e,t){var r=e+":"+t;if(FBO.supported[r]!=null)return FBO.supported[r];var n=new GL$1.Texture(1,1,{format:t,type:e});try{var a=new GL$1.FBO([n])}catch{return console.warn("This browser WEBGL implementation doesn't support this FBO format: "+GL$1.reverse[e]+" "+GL$1.reverse[t]),FBO.supported[r]=!1}return FBO.supported[r]=!0,!0},FBO.prototype.toSingle=function(e){if(e=e||0,!(this.color_textures.length<2)){var t=gl.extensions.WEBGL_draw_buffers;t?t.drawBuffersWEBGL([this.order[e]]):gl.drawBuffers([this.order[e]])}},FBO.prototype.toMulti=function(){if(!(this.color_textures.length<2)){var e=gl.extensions.WEBGL_draw_buffers;e?e.drawBuffersWEBGL(this.order):gl.drawBuffers(this.order)}},FBO.prototype.clearSecondary=function(e){if(!(!this.order||this.order.length<2)){for(var t=gl.extensions.WEBGL_draw_buffers,r=[gl.NONE],n=1;n<this.order.length;++n)r.push(this.order[n]);t?t.drawBuffersWEBGL(r):gl.drawBuffers(r),gl.clearColor(e[0],e[1],e[2],e[3]),gl.clear(gl.COLOR_BUFFER_BIT),t?t.drawBuffersWEBGL(this.order):gl.drawBuffers(this.order)}},FBO.prototype.makeMultiSample=function(e,t,r,n){if(this.gl.webgl_version==1)throw"cannot use makeMultiSample in webgl 1.0";this.width=e,this.height=t,r=r||4,n=n||{};var a=n.format||gl.RGBA8,s=gl.DEPTH_COMPONENT16;this._old_fbo_handler=gl.getParameter(gl.FRAMEBUFFER_BINDING),this.handler=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler),this.colorRenderbuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.colorRenderbuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,r,a,this.width,this.height),this.depthRenderbuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.depthRenderbuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,r,s,this.width,this.height),gl.bindFramebuffer(gl.FRAMEBUFFER,this.handler),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this.colorRenderbuffer),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.depthRenderbuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,this._old_fbo_handler),this._old_fbo_handler=null,this.multi_sample=!0},FBO.prototype.blitMultisample=function(e){if(!e||e.constructor!==GL$1.FBO)throw"parameter must be GL.FBO";gl.bindFramebuffer(gl.READ_FRAMEBUFFER,this.handler),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,e.handler),gl.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,gl.COLOR_BUFFER_BIT,gl.LINEAR),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,this._old_fbo_handler),this._old_fbo_handler=null,gl.setViewport(this._old_viewport)},global.Shader=GL$1.Shader=function e(t,r,n){if(GL$1.debug&&console.log("GL.Shader created"),!t||!r)throw"GL.Shader source code parameter missing";this._context_id=global.gl.context_id;var a=this.gl=global.gl,s=e.expandMacros(n),o=t.constructor===String?e.injectCode(s,t,a):t,l=r.constructor===String?e.injectCode(s,r,a):r;this.program=a.createProgram();var c=t.constructor===String?GL$1.Shader.compileSource(a.VERTEX_SHADER,o):t,u=r.constructor===String?GL$1.Shader.compileSource(a.FRAGMENT_SHADER,l):r;a.attachShader(this.program,c,a),a.attachShader(this.program,u,a),a.linkProgram(this.program),this.vs_shader=c,this.fs_shader=u,this.attributes={},this.uniformInfo={},this.samplers={},e.use_async?this._first_use=!0:this.checkLink()},Shader.use_async=!0,Shader.expandMacros=function(e){var t="";if(e)for(var r in e)t+="#define "+r+" "+(e[r]?e[r]:"")+`
`;return t},Shader.injectCode=function(e,t,r){var n=t.indexOf(`
`),a=r?"#define WEBGL"+r.webgl_version+`
`:"",s=t.substr(0,n).trim();return s.indexOf("#version")==-1?a+e+t:s+`
`+a+e+t.substr(n)},Shader.compileSource=function(e,t,r,n){return r=r||global.gl,n=n||r.createShader(e),r.shaderSource(n,t),r.compileShader(n),n},Shader.parseError=function(e,t,r){if(!e)return null;var n=e.split(" "),a=n[5].split(":");return{type:n[0],line_number:parseInt(a[1]),line_pos:parseInt(a[0]),line_code:(n[0]=="Fragment"?r:t).split(`
`)[parseInt(a[1])],err:e}},Shader.prototype.delete=function(){this.program&&this.gl.deleteProgram(this.program),this.vs_shader&&this.gl.deleteShader(this.vs_shader),this.fs_shader&&this.gl.deleteShader(this.fs_shader),this.gl=null,this.attributes={},this.uniformInfo={},this.samplers={}},Shader.prototype.updateShader=function(e,t,r){var n=this.gl||global.gl,a=Shader.expandMacros(r);this.program?(n.detachShader(this.program,this.vs_shader),n.detachShader(this.program,this.fs_shader)):this.program=n.createProgram();var a=Shader.expandMacros(r),s=e.constructor===String?Shader.injectCode(a,e,n):e,o=t.constructor===String?Shader.injectCode(a,t,n):t,l=e.constructor===String?GL$1.Shader.compileSource(n.VERTEX_SHADER,s):e,c=t.constructor===String?GL$1.Shader.compileSource(n.FRAGMENT_SHADER,o):t;n.attachShader(this.program,l,n),n.attachShader(this.program,c,n),n.linkProgram(this.program),this.vs_shader=l,this.fs_shader=c,this.attributes={},this.uniformInfo={},this.samplers={},Shader.use_async?this._first_use=!0:this.checkLink()},Shader.prototype.extractShaderInfo=function(){for(var e=this.gl,t=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),r=0;r<t;++r){var n=e.getActiveUniform(this.program,r);if(!n)break;var a=n.name,s=a.indexOf("[");if(s!=-1){var o=a.indexOf("].");o==-1&&(a=a.substr(0,s))}(n.type==GL$1.SAMPLER_2D||n.type==GL$1.SAMPLER_CUBE||n.type==GL$1.SAMPLER_3D||n.type==GL$1.INT_SAMPLER_2D||n.type==GL$1.INT_SAMPLER_CUBE||n.type==GL$1.INT_SAMPLER_3D||n.type==GL$1.UNSIGNED_INT_SAMPLER_2D||n.type==GL$1.UNSIGNED_INT_SAMPLER_CUBE||n.type==GL$1.UNSIGNED_INT_SAMPLER_3D)&&(this.samplers[a]=n.type);var l=Shader.getUniformFunc(n),c=!1;(n.type==e.FLOAT_MAT2||n.type==e.FLOAT_MAT3||n.type==e.FLOAT_MAT4)&&(c=!0);var u=GL$1.TYPE_LENGTH[n.type]||1;this.uniformInfo[a]={type:n.type,func:l,size:n.size,type_length:u,is_matrix:c,loc:e.getUniformLocation(this.program,a),data:new Float32Array(u*n.size)}}for(var r=0,t=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES);r<t;++r){var n=e.getActiveAttrib(this.program,r);if(!n)break;var l=Shader.getUniformFunc(n),u=GL$1.TYPE_LENGTH[n.type]||1;this.uniformInfo[n.name]={type:n.type,func:l,type_length:u,size:n.size,loc:null},n.name!=="gl_VertexID"&&(this.attributes[n.name]=e.getAttribLocation(this.program,n.name))}},Shader.prototype.hasUniform=function(e){return this.uniformInfo[e]},Shader.prototype.hasAttribute=function(e){return this.attributes[e]},Shader.getUniformFunc=function(e){var t=null;switch(e.type){case GL$1.FLOAT:e.size==1?t=gl.uniform1f:t=gl.uniform1fv;break;case GL$1.FLOAT_MAT2:t=gl.uniformMatrix2fv;break;case GL$1.FLOAT_MAT3:t=gl.uniformMatrix3fv;break;case GL$1.FLOAT_MAT4:t=gl.uniformMatrix4fv;break;case GL$1.FLOAT_VEC2:t=gl.uniform2fv;break;case GL$1.FLOAT_VEC3:t=gl.uniform3fv;break;case GL$1.FLOAT_VEC4:t=gl.uniform4fv;break;case GL$1.UNSIGNED_INT:case GL$1.INT:e.size==1?t=gl.uniform1i:t=gl.uniform1iv;break;case GL$1.INT_VEC2:t=gl.uniform2iv;break;case GL$1.INT_VEC3:t=gl.uniform3iv;break;case GL$1.INT_VEC4:t=gl.uniform4iv;break;case GL$1.SAMPLER_2D:case GL$1.SAMPLER_3D:case GL$1.SAMPLER_CUBE:case GL$1.INT_SAMPLER_2D:case GL$1.INT_SAMPLER_3D:case GL$1.INT_SAMPLER_CUBE:case GL$1.UNSIGNED_INT_SAMPLER_2D:case GL$1.UNSIGNED_INT_SAMPLER_3D:case GL$1.UNSIGNED_INT_SAMPLER_CUBE:t=gl.uniform1i;break;default:t=gl.uniform1f;break}return t},Shader.fromURL=function(e,t,r){var n=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute mat4 u_mvp;
			void main() { 
				gl_Position = u_mvp * vec4(a_vertex,1.0); 
			}
		`,a=`
			precision highp float;
			void main() {
				gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
			}
			`,s=new GL$1.Shader(n,a);s.ready=!1;var o=null,l=null;global.HttpRequest(e,null,function(u){o=u,l&&c()}),global.HttpRequest(t,null,function(u){l=u,o&&c()});function c(){var u=new GL$1.Shader(o,l);for(var h in u)s[h]=u[h];s.ready=!0}return s},Shader.prototype.checkLink=function(){if(this._first_use=!1,!gl.getShaderParameter(this.vs_shader,gl.COMPILE_STATUS))throw"Vertex shader compile error: "+gl.getShaderInfoLog(this.vs_shader);if(!gl.getShaderParameter(this.fs_shader,gl.COMPILE_STATUS))throw"Fragment shader compile error: "+gl.getShaderInfoLog(this.fs_shader);if(!gl.getProgramParameter(this.program,gl.LINK_STATUS))throw"link error: "+gl.getProgramInfoLog(this.program);this.extractShaderInfo()},Shader.prototype.bind=function(){var e=this.gl;Shader.use_async&&this._first_use&&(this.checkLink(),this._first_use=!1),e.useProgram(this.program),e._current_shader=this},Shader.prototype.getLocation=function(e){var t=this.uniformInfo[e];return t?this.uniformInfo[e].loc:null},Shader._temp_uniform=new Float32Array(16),Shader.prototype.uniforms=function(e){var t=this.gl;this._first_use&&this.checkLink(),t.useProgram(this.program),t._current_shader=this;for(var r in e){var n=this.uniformInfo[r];n&&this._setUniform(r,e[r])}return this},Shader.prototype.uniformsArray=function(e){var t=this.gl;this._first_use&&this.checkLink(),t.useProgram(this.program),t._current_shader=this;for(var r=0,n=e.length;r<n;++r){var a=e[r];for(var s in a)this._setUniform(s,a[s])}return this},Shader.prototype.setUniform=function(){return function(e,t){this.gl._current_shader!=this&&this.bind();var r=this.uniformInfo[e];r&&r.loc!==null&&t!=null&&(t.constructor===Array&&(r.data.set(t),t=r.data),r.is_matrix?r.func.call(this.gl,r.loc,!1,t):r.func.call(this.gl,r.loc,t))}}(),Shader.prototype._setUniform=function(){return function(e,t){this._first_use&&this.checkLink();var r=this.uniformInfo[e];r&&r.loc!==null&&t!=null&&(t.constructor===Array&&(r.data.set(t),t=r.data),r.is_matrix?r.func.call(this.gl,r.loc,!1,t):r.func.call(this.gl,r.loc,t))}}(),Shader.prototype.draw=function(e,t,r){r=r===void 0?t==gl.LINES?"lines":"triangles":r,this.drawBuffers(e.vertexBuffers,r?e.indexBuffers[r]:null,arguments.length<2?gl.TRIANGLES:t)},Shader.prototype.drawRange=function(e,t,r,n,a){a=a===void 0?t==gl.LINES?"lines":"triangles":a,this.drawBuffers(e.vertexBuffers,a?e.indexBuffers[a]:null,t,r,n)};var temp_attribs_array=new Uint8Array(16),temp_attribs_array_zero=new Uint8Array(16);Shader.prototype.drawBuffers=function(e,t,r,n,a){if(a!=0){var s=this.gl;this._first_use&&this.checkLink(),s.useProgram(this.program);var o=0,l=temp_attribs_array;l.set(temp_attribs_array_zero);for(var c in e){var u=e[c],h=u.attribute||c,d=this.attributes[h];d==null||!u.buffer||(l[d]=1,s.bindBuffer(s.ARRAY_BUFFER,u.buffer),s.enableVertexAttribArray(d),s.vertexAttribPointer(d,u.buffer.spacing,u.buffer.gl_type,u.normalize,0,0),o=u.buffer.length/u.buffer.spacing)}var f=0;n>0&&(f=n),t&&(o=t.buffer.length-f),a>0&&a<o&&(o=a);var p=t&&t.data?t.data.constructor.BYTES_PER_ELEMENT:1;f*=p;for(var h in this.attributes){var d=this.attributes[h];l[d]||s.disableVertexAttribArray(this.attributes[h])}return o&&(!t||t.buffer)&&(t?(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t.buffer),s.drawElements(r,o,t.buffer.gl_type,f),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)):s.drawArrays(r,f,o),s.draw_calls++),this}},Shader._instancing_arrays=[],Shader.prototype.drawInstanced=function(e,t,r,n,a,s,o){if(s!==0){var l=this.gl;if(l.webgl_version==1&&!l.extensions.ANGLE_instanced_arrays)throw"instancing not supported";this._first_use&&this.checkLink(),l.useProgram(this.program);var c=0,u=temp_attribs_array;u.set(temp_attribs_array_zero);var h=e.vertexBuffers;for(var d in h){var f=h[d],p=f.attribute||d,g=this.attributes[p];g==null||!f.buffer||(u[g]=1,l.bindBuffer(l.ARRAY_BUFFER,f.buffer),l.enableVertexAttribArray(g),l.vertexAttribPointer(g,f.buffer.spacing,f.buffer.gl_type,f.normalize,0,0),c=f.buffer.length/f.buffer.spacing)}var b=null;r&&(r.constructor===String?b=e.getIndexBuffer(r):r.constructor===GL$1.Buffer&&(b=r));var m=0;a>0&&(m=a),b&&(c=b.buffer.length-m),s>0&&s<c&&(c=s);var E=b&&b.data?b.data.constructor.BYTES_PER_ELEMENT:1;m*=E;for(var p in this.attributes){var g=this.attributes[p];u[g]||l.disableVertexAttribArray(this.attributes[p])}var L=l.extensions.ANGLE_instanced_arrays,T=0,_=0;for(var A in n){var M=n[A];T=M.length;var S=this.attributes[A];if(S==null)return;var N=0,I=0;M.constructor===Array?(N=M[0].constructor===Number?1:M[0].length,I=N*M.length):(N=this.uniformInfo[A].type_length,I=M.length,T=I/N);var P=Shader._instancing_arrays[_];if((!P||P.data.length<I)&&(P=Shader._instancing_arrays[_]={data:new Float32Array(I),buffer:l.createBuffer()}),P.uniform=A,P.element_size=N,M.constructor===Array)for(var R=0;R<M.length;++R)P.data.set(M[R],R*N);else P.data.set(M);if(l.bindBuffer(l.ARRAY_BUFFER,P.buffer),l.bufferData(l.ARRAY_BUFFER,P.data,l.STREAM_DRAW),N==16)for(var C=0;C<4;++C)l.enableVertexAttribArray(S+C),l.vertexAttribPointer(S+C,4,l.FLOAT,!1,16*4,C*4*4),L?L.vertexAttribDivisorANGLE(S+C,1):l.vertexAttribDivisor(S+C,1);else l.enableVertexAttribArray(S),l.vertexAttribPointer(S,N,l.FLOAT,!1,N*4,0),L?L.vertexAttribDivisorANGLE(S,1):l.vertexAttribDivisor(S,1);_+=1}o&&(T=o),L?b?(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,b.buffer),L.drawElementsInstancedANGLE(t,c,b.buffer.gl_type,m,T),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)):L.drawArraysInstancedANGLE(t,m,c,T):b?(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,b.buffer),l.drawElementsInstanced(t,c,b.buffer.gl_type,m,T),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)):l.drawArraysInstanced(t,m,c,T);for(var k=0;k<_;++k){var D=Shader._instancing_arrays[k],S=this.attributes[D.uniform],N=D.element_size;if(N==16)for(var C=0;C<4;++C)l.disableVertexAttribArray(S+C),L?L.vertexAttribDivisorANGLE(S+C,0):l.vertexAttribDivisor(S+C,0);else l.enableVertexAttribArray(S),L?L.vertexAttribDivisorANGLE(S,0):l.vertexAttribDivisor(S,0)}return this}},Shader.expandImports=function(e,t){t=t||Shader.files;var r={};if(!t)throw"Shader.files not initialized, assign files there";var n=function(a){var s=a.split('"'),o=s[1];if(r[o])return"//already imported: "+o+`
`;var l=t[o];return r[o]=!0,l?l+`
`:"//import code not found: "+o+`
`};return e.replace(/#import\s+"([a-zA-Z0-9_.]+)"\s*\n/g,n)},Shader.dumpErrorToConsole=function(e,t,r){console.error(e),e.msg;var n=null;e.indexOf("Fragment")!=-1?n=r:n=t;var a=n.split(`
`);for(var s in a)a[s]=s+"| "+a[s];console.groupCollapsed("Shader code"),console.log(a.join(`
`)),console.groupEnd()},Shader.convertTo100=function(e,t){},Shader.convertTo300=function(e,t){},Shader.validateValue=function(e,t){if(e==null)return!1;switch(t.type){case GL$1.INT:case GL$1.FLOAT:case GL$1.SAMPLER_2D:case GL$1.SAMPLER_3D:case GL$1.SAMPLER_CUBE:case GL$1.INT_SAMPLER_2D:case GL$1.INT_SAMPLER_3D:case GL$1.INT_SAMPLER_CUBE:case GL$1.UNSIGNED_INT_SAMPLER_2D:case GL$1.UNSIGNED_INT_SAMPLER_3D:case GL$1.UNSIGNED_INT_SAMPLER_CUBE:return global.isNumber(e);case GL$1.INT_VEC2:case GL$1.FLOAT_VEC2:return e.length===2;case GL$1.INT_VEC3:case GL$1.FLOAT_VEC3:return e.length===3;case GL$1.INT_VEC4:case GL$1.FLOAT_VEC4:case GL$1.FLOAT_MAT2:return e.length===4;case GL$1.FLOAT_MAT3:return e.length===8;case GL$1.FLOAT_MAT4:return e.length===16}return!0},Shader.DEFAULT_VERTEX_SHADER=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute vec3 a_normal;
			attribute vec2 a_coord;
			varying vec3 v_position;
			varying vec3 v_normal;
			varying vec2 v_coord;
			uniform mat4 u_model;
			uniform mat4 u_mvp;
			void main() {
				v_position = (u_model * vec4(a_vertex,1.0)).xyz;
				v_normal = (u_model * vec4(a_normal,0.0)).xyz;
				v_coord = a_coord;
				gl_Position = u_mvp * vec4(a_vertex,1.0);
			}
			`,Shader.SCREEN_VERTEX_SHADER=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute vec2 a_coord;
			varying vec2 v_coord;
			void main() { 
				v_coord = a_coord; 
				gl_Position = vec4(a_coord * 2.0 - 1.0, 0.0, 1.0); 
			}
			`,Shader.SCREEN_300_VERTEX_SHADER=`#version 300 es
			precision highp float;
			in vec3 a_vertex;
			in vec2 a_coord;
			out vec2 v_coord;
			void main() { 
				v_coord = a_coord; 
				gl_Position = vec4(a_coord * 2.0 - 1.0, 0.0, 1.0); 
			}
			`,Shader.SCREEN_FRAGMENT_SHADER=`
			precision highp float;
			uniform sampler2D u_texture;
			varying vec2 v_coord;
			void main() {
				gl_FragColor = texture2D(u_texture, v_coord);
			}
			`,Shader.SCREEN_FRAGMENT_FX=`
			precision highp float;
			uniform sampler2D u_texture;
			varying vec2 v_coord;
			#ifdef FX_UNIFORMS
				FX_UNIFORMS
			#endif
			void main() {
				vec2 uv = v_coord;
				vec4 color = texture2D(u_texture, uv);
				#ifdef FX_CODE
					FX_CODE ;
				#endif
				gl_FragColor = color;
			}
			`,Shader.SCREEN_COLORED_FRAGMENT_SHADER=`
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec4 u_color;
			varying vec2 v_coord;
			void main() {
				gl_FragColor = u_color * texture2D(u_texture, v_coord);
			}
			`,Shader.BLEND_FRAGMENT_SHADER=`
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_texture2;
			uniform float u_factor;
			varying vec2 v_coord;
			void main() {
				gl_FragColor = mix( texture2D(u_texture, v_coord), texture2D(u_texture2, v_coord), u_factor);
			}
			`,Shader.QUAD_VERTEX_SHADER=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute vec2 a_coord;
			varying vec2 v_coord;
			uniform vec2 u_position;
			uniform vec2 u_size;
			uniform vec2 u_viewport;
			uniform mat3 u_transform;
			void main() { 
				vec3 pos = vec3(u_position + vec2(a_coord.x,1.0 - a_coord.y)  * u_size, 1.0);
				v_coord = a_coord; 
				pos = u_transform * pos;
				pos.z = 0.0;
				//normalize
				pos.x = (2.0 * pos.x / u_viewport.x) - 1.0;
				pos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);
				gl_Position = vec4(pos, 1.0); 
			}
			`,Shader.QUAD_FRAGMENT_SHADER=`
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec4 u_color;
			varying vec2 v_coord;
			void main() {
				gl_FragColor = u_color * texture2D(u_texture, v_coord);
			}
			`,Shader.QUAD2_FRAGMENT_SHADER=`
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec4 u_color;
			uniform vec4 u_texture_area;
			varying vec2 v_coord;
			void main() {
			    vec2 uv = vec2( mix(u_texture_area.x, u_texture_area.z, v_coord.x), 1.0 - mix(u_texture_area.w, u_texture_area.y, v_coord.y) );
				gl_FragColor = u_color * texture2D(u_texture, uv);
			}
			`,Shader.PRIMITIVE2D_VERTEX_SHADER=`
			precision highp float;
			attribute vec3 a_vertex;
			uniform vec2 u_viewport;
			uniform mat3 u_transform;
			void main() { 
				vec3 pos = a_vertex;
				pos = u_transform * pos;
				pos.z = 0.0;
				//normalize
				pos.x = (2.0 * pos.x / u_viewport.x) - 1.0;
				pos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);
				gl_Position = vec4(pos, 1.0); 
			}
			`,Shader.FLAT_VERTEX_SHADER=`
			precision highp float;
			attribute vec3 a_vertex;
			uniform mat4 u_mvp;
			void main() { 
				gl_Position = u_mvp * vec4(a_vertex,1.0); 
			}
			`,Shader.FLAT_FRAGMENT_SHADER=`
			precision highp float;
			uniform vec4 u_color;
			void main() {
				gl_FragColor = u_color;
			}
			`,Shader.SCREEN_FLAT_FRAGMENT_SHADER=Shader.FLAT_FRAGMENT_SHADER,Shader.createFX=function(e,t,r){e=GL$1.Shader.removeComments(e,!0),t=GL$1.Shader.removeComments(t,!0);var n={FX_CODE:e,FX_UNIFORMS:t||""};return r?(r.updateShader(GL$1.Shader.SCREEN_VERTEX_SHADER,GL$1.Shader.SCREEN_FRAGMENT_FX,n),r):new GL$1.Shader(GL$1.Shader.SCREEN_VERTEX_SHADER,GL$1.Shader.SCREEN_FRAGMENT_FX,n)},Shader.replaceCodeUsingContext=function(e,t){return e.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(r){return r=r.replace(/[{}]/g,""),t[r]||""})},Shader.removeComments=function(n,t){if(!n)return"";for(var r=/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*)/g,n=n.replace(r,""),a=n.split(`
`),s=[],o=0;o<a.length;++o){var l=a[o],c=l.indexOf("//");c!=-1&&(l=a[o].substr(0,c)),l=l.trim(),l.length&&s.push(l)}return s.join(t?"":`
`)},Shader.prototype.toViewport=function(e){var t=GL$1.Mesh.getScreenQuad();e&&this.uniforms(e),this.draw(t)},Shader.getScreenShader=function(e){e=e||global.gl;var t=e.shaders[":screen"];return t||(t=e.shaders[":screen"]=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.SCREEN_FRAGMENT_SHADER),t.uniforms({u_texture:0}))},Shader.getFlatScreenShader=function(e){e=e||global.gl;var t=e.shaders[":flat_screen"];return t||(t=e.shaders[":flat_screen"]=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.FLAT_FRAGMENT_SHADER),t.uniforms({u_color:[1,1,1,1]}))},Shader.getColoredScreenShader=function(e){e=e||global.gl;var t=e.shaders[":colored_screen"];return t||(t=e.shaders[":colored_screen"]=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.SCREEN_COLORED_FRAGMENT_SHADER),t.uniforms({u_texture:0,u_color:vec4.fromValues(1,1,1,1)}))},Shader.getQuadShader=function(e){e=e||global.gl;var t=e.shaders[":quad"];return t||(e.shaders[":quad"]=new GL$1.Shader(Shader.QUAD_VERTEX_SHADER,Shader.QUAD_FRAGMENT_SHADER))},Shader.getPartialQuadShader=function(e){e=e||global.gl;var t=e.shaders[":quad2"];return t||(e.shaders[":quad2"]=new GL$1.Shader(Shader.QUAD_VERTEX_SHADER,Shader.QUAD2_FRAGMENT_SHADER))},Shader.getBlendShader=function(e){e=e||global.gl;var t=e.shaders[":blend"];return t||(e.shaders[":blend"]=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,Shader.BLEND_FRAGMENT_SHADER))},Shader.getBlurShader=function(e){e=e||global.gl;var t=e.shaders[":blur"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_offset;
			uniform float u_intensity;
			void main() {
			   vec4 sum = vec4(0.0);
			   sum += texture2D(u_texture, v_coord + u_offset * -4.0) * 0.05/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * -3.0) * 0.09/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * -2.0) * 0.12/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * -1.0) * 0.15/0.98;
			   sum += texture2D(u_texture, v_coord) * 0.16/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * 4.0) * 0.05/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * 3.0) * 0.09/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * 2.0) * 0.12/0.98;
			   sum += texture2D(u_texture, v_coord + u_offset * 1.0) * 0.15/0.98;
			   gl_FragColor = u_intensity * sum;
			}
			`);return e.shaders[":blur"]=t},Shader.getCopyDepthShader=function(e){e=e||global.gl;var t=e.shaders[":copy_depth"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			#extension GL_EXT_frag_depth : enable
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			void main() {
			   gl_FragDepthEXT = texture2D( u_texture, v_coord ).x;
			   gl_FragColor = vec4(1.0);
			}
			`);return e.shaders[":copy_depth"]=t},Shader.getCubemapShowShader=function(e){e=e||global.gl;var t=e.shaders[":show_cubemap"];if(t)return t;var t=new GL$1.Shader(Shader.DEFAULT_VERTEX_SHADER,`
			precision highp float;
			varying vec3 v_normal;
			uniform samplerCube u_texture;
			void main() {
			   gl_FragColor = textureCube( u_texture, v_normal );
			}
			`);return t.uniforms({u_texture:0}),e.shaders[":show_cubemap"]=t},Shader.getPolarToCubemapShader=function(e){e=e||global.gl;var t=e.shaders[":polar_to_cubemap"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform mat3 u_rotation;
			void main() {
				vec2 uv = vec2( v_coord.x, 1.0 - v_coord.y );
				vec3 dir = normalize( vec3( uv - vec2(0.5), 0.5 ));
				dir = u_rotation * dir;
				float u = atan(dir.x,dir.z) / 6.28318531;
				float v = (asin(dir.y) / 1.57079633) * 0.5 + 0.5;
				u = mod(u,1.0);
				v = mod(v,1.0);
			   gl_FragColor = texture2D( u_texture, vec2(u,v) );
			}
			`);return e.shaders[":polar_to_cubemap"]=t},Shader.getCubemapCopyShader=function(e){e=e||global.gl;var t=e.shaders[":copy_cubemap"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			precision highp float;
			varying vec2 v_coord;
			uniform samplerCube u_texture;
			uniform mat3 u_rotation;
			void main() {
				vec2 uv = vec2( v_coord.x, 1.0 - v_coord.y );
				vec3 dir = vec3( uv - vec2(0.5), 0.5 );
				dir = u_rotation * dir;
			   gl_FragColor = textureCube( u_texture, dir );
			}
			`);return e.shaders[":copy_cubemap"]=t},Shader.getCubemapBlurShader=function(e){e=e||global.gl;var t=e.shaders[":blur_cubemap"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			#ifndef NUM_SAMPLES
				#define NUM_SAMPLES 4
			#endif
			
			precision highp float;
			varying vec2 v_coord;
			uniform samplerCube u_texture;
			uniform mat3 u_rotation;
			uniform vec2 u_offset;
			uniform float u_intensity;
			void main() {
				vec4 sum = vec4(0.0);
				vec2 uv = vec2( v_coord.x, 1.0 - v_coord.y ) - vec2(0.5);
				vec3 dir = vec3(0.0);
				vec4 color = vec4(0.0);
				for( int x = -2; x <= 2; x++ )
				{
					for( int y = -2; y <= 2; y++ )
					{
						dir.xy = uv + vec2( u_offset.x * float(x), u_offset.y * float(y)) * 0.5;
						dir.z = 0.5;
						dir = u_rotation * dir;
						color = textureCube( u_texture, dir );
						color.xyz = color.xyz * color.xyz;/*linearize*/
						sum += color;
					}
				}
				sum /= 25.0;
			   gl_FragColor = vec4( sqrt( sum.xyz ), sum.w ) ;
			}
			`);return e.shaders[":blur_cubemap"]=t},Shader.FXAA_FUNC=`
	uniform vec2 u_viewportSize;
	uniform vec2 u_iViewportSize;
	#define FXAA_REDUCE_MIN   (1.0/ 128.0)
	#define FXAA_REDUCE_MUL   (1.0 / 8.0)
	#define FXAA_SPAN_MAX     8.0
	
	/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
	/* fragCoord MUST BE IN PIXELS */
	vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
	{
		vec4 color = vec4(0.0);
		/*vec2 u_iViewportSize = vec2(1.0 / u_viewportSize.x, 1.0 / u_viewportSize.y);*/
		vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * u_iViewportSize).xyz;
		vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * u_iViewportSize).xyz;
		vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * u_iViewportSize).xyz;
		vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * u_iViewportSize).xyz;
		vec3 rgbM  = texture2D(tex, fragCoord  * u_iViewportSize).xyz;
		vec3 luma = vec3(0.299, 0.587, 0.114);
		float lumaNW = dot(rgbNW, luma);
		float lumaNE = dot(rgbNE, luma);
		float lumaSW = dot(rgbSW, luma);
		float lumaSE = dot(rgbSE, luma);
		float lumaM  = dot(rgbM,  luma);
		float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
		float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
		
		vec2 dir;
		dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
		dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
		
		float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
		
		float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
		dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * u_iViewportSize;
		
		vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * u_iViewportSize + dir * (1.0 / 3.0 - 0.5)).xyz + 
			texture2D(tex, fragCoord * u_iViewportSize + dir * (2.0 / 3.0 - 0.5)).xyz);
		vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * u_iViewportSize + dir * -0.5).xyz + 
			texture2D(tex, fragCoord * u_iViewportSize + dir * 0.5).xyz);
		
		//return vec4(rgbA,1.0);
		float lumaB = dot(rgbB, luma);
		if ((lumaB < lumaMin) || (lumaB > lumaMax))
			color = vec4(rgbA, 1.0);
		else
			color = vec4(rgbB, 1.0);
		return color;
	}
`,Shader.getFXAAShader=function(e){e=e||global.gl;var t=e.shaders[":fxaa"];if(t)return t;var t=new GL$1.Shader(Shader.SCREEN_VERTEX_SHADER,`
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			`+Shader.FXAA_FUNC+`
			
			void main() {
			   gl_FragColor = applyFXAA( u_texture, v_coord * u_viewportSize) ;
			}
			`),r=vec2.fromValues(e.viewport_data[2],e.viewport_data[3]),n=vec2.fromValues(1/e.viewport_data[2],1/e.viewport_data[3]);return t.setup=function(){r[0]=e.viewport_data[2],r[1]=e.viewport_data[3],n[0]=1/e.viewport_data[2],n[1]=1/e.viewport_data[3],this.uniforms({u_viewportSize:r,u_iViewportSize:n})},e.shaders[":fxaa"]=t},Shader.getFlatShader=function(e){e=e||global.gl;var t=e.shaders[":flat"];if(t)return t;var t=new GL$1.Shader(Shader.FLAT_VERTEX_SHADER,Shader.FLAT_FRAGMENT_SHADER);return t.uniforms({u_color:[1,1,1,1]}),e.shaders[":flat"]=t},GL$1.create=function(e){e=e||{};var t=null;if(e.canvas)if(typeof e.canvas=="string"){if(t=document.getElementById(e.canvas),!t)throw"Canvas element not found: "+e.canvas}else t=e.canvas;else{var r=null;if(e.container&&(r=e.container.constructor===String?document.querySelector(e.container):e.container),r&&!e.width){var n=r.getBoundingClientRect();e.width=n.width,e.height=n.height}t=createCanvas(e.width||800,e.height||600),r&&r.appendChild(t)}"alpha"in e||(e.alpha=!1);var a=null,s=null;if(e.version==2?s=["webgl2","experimental-webgl2"]:e.version==1||e.version===void 0?s=["webgl","experimental-webgl"]:e.version===0&&(s=["webgl2","experimental-webgl2","webgl","experimental-webgl"]),!s)throw"Incorrect WebGL version, must be 1 or 2";for(var o={alpha:e.alpha===void 0?!0:e.alpha,depth:e.depth===void 0?!0:e.depth,stencil:e.stencil===void 0?!0:e.stencil,antialias:e.antialias===void 0?!0:e.antialias,premultipliedAlpha:e.premultipliedAlpha===void 0?!0:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer===void 0?!0:e.preserveDrawingBuffer},l=0;l<s.length;++l){try{a=t.getContext(s[l],o)}catch{}if(a)break}if(!a)throw t.getContext("webgl")?"WebGL supported but not with those parameters":"WebGL not supported";a.webgl_version=a.constructor.name==="WebGL2RenderingContext"?2:1,global.gl=a,t.is_webgl=!0,t.gl=a,a.context_id=this.last_context_id++,a.extensions={};for(var c=a.getSupportedExtensions(),l=0;l<c.length;++l)a.extensions[c[l]]=a.getExtension(c[l]);if(a.webgl_version==1?a.HIGH_PRECISION_FORMAT=a.extensions.OES_texture_half_float?GL$1.HALF_FLOAT_OES:a.extensions.OES_texture_float?GL$1.FLOAT:GL$1.UNSIGNED_BYTE:a.HIGH_PRECISION_FORMAT=GL$1.HALF_FLOAT_OES,a.max_texture_units=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),a._viewport_func?console.warn("Creating LiteGL context over the same canvas twice"):(a._viewport_func=a.viewport,a.viewport_data=new Float32Array([0,0,a.canvas.width,a.canvas.height]),a.viewport=function(_,A,M,S){var N=this.viewport_data;N[0]=_|0,N[1]=A|0,N[2]=M|0,N[3]=S|0,this._viewport_func(_,A,M,S)},a.getViewport=function(_){return _?(_[0]=a.viewport_data[0],_[1]=a.viewport_data[1],_[2]=a.viewport_data[2],_[3]=a.viewport_data[3],_):new Float32Array(a.viewport_data)},a.setViewport=function(_,A){a.viewport_data.set(_),A&&(a.viewport_data[1]=this.drawingBufferHeight-_[1]-_[3]),this._viewport_func(_[0],a.viewport_data[1],_[2],_[3])}),!GL$1.reverse){GL$1.reverse={};for(var l in a)a[l]&&a[l].constructor===Number&&(GL$1.reverse[a[l]]=l)}if(window.glMatrix==null)throw"glMatrix not found, LiteGL requires glMatrix to be included";var u=0;a.shaders={},a.textures={},a.meshes={},a.draw_calls=0,a.makeCurrent=function(){global.gl=this},a.execute=function(_){var A=global.gl;global.gl=this,_(),global.gl=A},a.animate=function(_){if(_===!1){global.cancelAnimationFrame(this._requestFrame_id),this._requestFrame_id=null;return}var A=global.requestAnimationFrame,M=global.getTime(),S=this,N=0;function I(){if(!a.destroyed){S._requestFrame_id=A(I);var P=global.getTime(),R=(P-M)*.001;if(S.mouse&&(S.mouse.last_buttons=N),N=S.mouse.buttons,S.onupdate&&S.onupdate(R),LEvent.trigger(S,"update",R),S.ondraw){var C=global.gl;global.gl=S,S.ondraw(),LEvent.trigger(S,"draw"),global.gl=C}M=P}}this._requestFrame_id=A(I)},a.destroy=function(){m&&(document.removeEventListener("keydown",m),document.removeEventListener("keyup",m)),f&&(this.canvas.removeEventListener("mousedown",f),this.canvas.removeEventListener("mousemove",f),this.canvas.removeEventListener("mouseup",f),this.canvas.addEventListener("drag",f),this.canvas.addEventListener("dragstart",f),this.canvas.addEventListener("wheel",f));for(var _ in this.shaders)this.shaders[_].delete(),this.shaders[_]=null;this.shaders={};for(var _ in this.meshes)this.meshes[_].deleteBuffers(),this.meshes[_]=null;this.meshes={};for(var _ in this.textures)this.textures[_].delete(),this.textures[_]=null;this.textures={},this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.destroyed=!0,global.gl==this&&(global.gl=null)};var h=a.mouse={buttons:0,last_buttons:0,left_button:!1,middle_button:!1,right_button:!1,position:new Float32Array(2),x:0,y:0,deltax:0,deltay:0,clientx:0,clienty:0,isInsideRect:function(_,A,M,S,N){var I=this.y;return N&&(I=a.canvas.height-I),this.x>_&&this.x<_+M&&I>A&&I<A+S},isButtonPressed:function(_){if(_==GL$1.LEFT_MOUSE_BUTTON)return this.buttons&GL$1.LEFT_MOUSE_BUTTON_MASK;if(_==GL$1.MIDDLE_MOUSE_BUTTON)return this.buttons&GL$1.MIDDLE_MOUSE_BUTTON_MASK;if(_==GL$1.RIGHT_MOUSE_BUTTON)return this.buttons&GL$1.RIGHT_MOUSE_BUTTON_MASK},wasButtonPressed:function(_){var A=0;return _==GL$1.LEFT_MOUSE_BUTTON?A=GL$1.LEFT_MOUSE_BUTTON_MASK:_==GL$1.MIDDLE_MOUSE_BUTTON?A=GL$1.MIDDLE_MOUSE_BUTTON_MASK:_==GL$1.RIGHT_MOUSE_BUTTON&&(A=GL$1.RIGHT_MOUSE_BUTTON_MASK),this.buttons&A&&!(this.last_buttons&A)}};a.captureMouse=function(_,A){t.addEventListener("mousedown",d),t.addEventListener("mousemove",d),t.addEventListener("drag",d),t.addEventListener("dragstart",d),_&&(t.addEventListener("mousewheel",d,!1),t.addEventListener("wheel",d,!1)),t.addEventListener("contextmenu",function(M){return M.preventDefault(),!1}),A&&this.captureTouch(!0)};function d(_){if(!a.ignore_events){var A=a.mouse.buttons;GL$1.augmentEvent(_,t),_.eventType=_.eventType||_.type;var M=global.getTime();if(h.dragging=_.dragging,h.position[0]=_.canvasx,h.position[1]=_.canvasy,h.x=_.canvasx,h.y=_.canvasy,h.mousex=_.mousex,h.mousey=_.mousey,h.canvasx=_.canvasx,h.canvasy=_.canvasy,h.clientx=_.mousex,h.clienty=_.mousey,h.buttons=_.buttons,h.left_button=!!(h.buttons&GL$1.LEFT_MOUSE_BUTTON_MASK),h.middle_button=!!(h.buttons&GL$1.MIDDLE_MOUSE_BUTTON_MASK),h.right_button=!!(h.buttons&GL$1.RIGHT_MOUSE_BUTTON_MASK),_.eventType=="mousedown"){if(A==0){t.removeEventListener("mousemove",d);var S=t.ownerDocument;S.addEventListener("mousemove",d),S.addEventListener("mouseup",d)}u=M,a.onmousedown&&a.onmousedown(_),LEvent.trigger(a,"mousedown")}else if(_.eventType=="mousemove")a.onmousemove&&a.onmousemove(_),LEvent.trigger(a,"mousemove",_);else if(_.eventType=="mouseup"){if(a.mouse.buttons==0){t.addEventListener("mousemove",d);var S=t.ownerDocument;S.removeEventListener("mousemove",d),S.removeEventListener("mouseup",d)}_.click_time=M-u,a.onmouseup&&a.onmouseup(_),LEvent.trigger(a,"mouseup",_)}else _.eventType=="mousewheel"||_.eventType=="wheel"||_.eventType=="DOMMouseScroll"?(_.eventType="mousewheel",_.type=="wheel"?_.wheel=-_.deltaY:_.wheel=_.wheelDeltaY!=null?_.wheelDeltaY:_.detail*-60,_.delta=_.wheelDelta!==void 0?_.wheelDelta/40:_.deltaY?-_.deltaY/3:0,a.onmousewheel&&a.onmousewheel(_),LEvent.trigger(a,"mousewheel",_)):_.eventType=="dragstart"&&(a.ondragstart&&a.ondragstart(_),LEvent.trigger(a,"dragstart",_));if(a.onmouse&&a.onmouse(_),!_.skip_preventDefault)return _.eventType!="mousemove"&&_.stopPropagation(),_.preventDefault(),!1}}var f=d,p=!1;a.captureTouch=function(_){p=_,t.addEventListener("touchstart",g,!0),t.addEventListener("touchmove",g,!0),t.addEventListener("touchend",g,!0),t.addEventListener("touchcancel",g,!0),t.addEventListener("gesturestart",b),t.addEventListener("gesturechange",b),t.addEventListener("gestureend",b)};function g(_){var A=_.changedTouches,M=A[0],S="";if(!(a.ontouch&&a.ontouch(_)===!0)&&LEvent.trigger(a,_.type,_)!==!0&&p&&!(_.touches.length&&_.changedTouches[0].identifier!==_.touches[0].identifier)&&!(A>1)){switch(_.type){case"touchstart":S="mousedown";break;case"touchmove":S="mousemove";break;case"touchend":S="mouseup";break;default:return}var N=document.createEvent("MouseEvent");N.initMouseEvent(S,!0,!0,window,1,M.screenX,M.screenY,M.clientX,M.clientY,!1,!1,!1,!1,0,null),N.originalEvent=N,N.is_touch=!0,M.target.dispatchEvent(N),_.preventDefault()}}function b(_){_.eventType=_.type,!(a.ongesture&&a.ongesture(_)===!1)&&LEvent.trigger(a,_.type,_)!==!1&&_.preventDefault()}a.keys={};var m=null;a.captureKeys=function(_,A){if(m)return;a.keys={},A&&a.canvas,document.addEventListener("keydown",M),document.addEventListener("keyup",M);function M(S){E(S,_)}m=M};function E(_,A){_.eventType=_.type;var M=_.target.nodeName.toLowerCase();if(!(M==="input"||M==="textarea"||M==="select"||_.target.contentEditable==="true")){_.character=String.fromCharCode(_.keyCode).toLowerCase();var S=!1,N=GL$1.mapKeyCode(_.keyCode);N||(N=_.character);var I=_.altKey||_.ctrlKey||_.metaKey;I||(N&&(a.keys[N]=_.type=="keydown"),S=a.keys[_.keyCode],a.keys[_.keyCode]=_.type=="keydown"),(S!=a.keys[_.keyCode]||I)&&(_.type=="keydown"&&a.onkeydown?a.onkeydown(_):_.type=="keyup"&&a.onkeyup&&a.onkeyup(_),LEvent.trigger(a,_.type,_)),a.onkey&&a.onkey(_),A&&(_.isChar||GL$1.blockable_keys[_.keyIdentifier||_.key])&&_.preventDefault()}}a.gamepads=null,a.captureGamepads=function(){var _=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;_&&(this.gamepads=_.call(navigator))},a.getGamepads=function(_){var A=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(A){var M=A.call(navigator);this.gamepads||(this.gamepads=[]);for(var S=0;S<4;S++){var N=M[S];if(N&&!_&&L(N),N&&!N.prev_buttons){N.prev_buttons=new Uint8Array(32);var I=new CustomEvent("gamepadconnected");I.eventType=I.type,I.gamepad=N,this.ongamepadconnected&&this.ongamepadconnected(I),LEvent.trigger(a,"gamepadconnected",I)}if(N)for(var P=0;P<N.buttons.length;++P){var R=N.buttons[P];if(R.was_pressed=!1,R.pressed&&!N.prev_buttons[P]){R.was_pressed=!0;var I=new CustomEvent("gamepadButtonDown");I.eventType=I.type,I.button=R,I.which=P,I.gamepad=N,a.onbuttondown&&a.onbuttondown(I),LEvent.trigger(a,"buttondown",I)}else if(!R.pressed&&N.prev_buttons[P]){var I=new CustomEvent("gamepadButtonUp");I.eventType=I.type,I.button=R,I.which=P,I.gamepad=N,a.onbuttondown&&a.onbuttondown(I),LEvent.trigger(a,"buttonup",I)}N.prev_buttons[P]=R.pressed?1:0}}return this.gamepads=M,M}};function L(_){var A=_.xbox||{axes:[],buttons:{},hat:""};A.axes.lx=_.axes[0],A.axes.ly=_.axes[1],A.axes.rx=_.axes[2],A.axes.ry=_.axes[3],A.axes.triggers=_.axes[4];for(var M=0;M<_.buttons.length;M++)switch(M){case 0:A.buttons.a=_.buttons[M].pressed;break;case 1:A.buttons.b=_.buttons[M].pressed;break;case 2:A.buttons.x=_.buttons[M].pressed;break;case 3:A.buttons.y=_.buttons[M].pressed;break;case 4:A.buttons.lb=_.buttons[M].pressed;break;case 5:A.buttons.rb=_.buttons[M].pressed;break;case 6:A.buttons.lt=_.buttons[M].pressed;break;case 7:A.buttons.rt=_.buttons[M].pressed;break;case 8:A.buttons.back=_.buttons[M].pressed;break;case 9:A.buttons.start=_.buttons[M].pressed;break;case 10:A.buttons.ls=_.buttons[M].pressed;break;case 11:A.buttons.rs=_.buttons[M].pressed;break;case 12:_.buttons[M].pressed&&(A.hat+="up");break;case 13:_.buttons[M].pressed&&(A.hat+="down");break;case 14:_.buttons[M].pressed&&(A.hat+="left");break;case 15:_.buttons[M].pressed&&(A.hat+="right");break;case 16:A.buttons.home=_.buttons[M].pressed;break}_.xbox=A}a.fullscreen=function(){var _=this.canvas;_.requestFullScreen?_.requestFullScreen():_.webkitRequestFullScreen?_.webkitRequestFullScreen():_.mozRequestFullScreen?_.mozRequestFullScreen():console.error("Fullscreen not supported")},a.snapshot=function(_,A,M,S,N){var I=createCanvas(M,S),k=I.getContext("2d"),P=k.getImageData(0,0,I.width,I.height),R=new Uint8Array(M*S*4);if(a.readPixels(_,A,I.width,I.height,a.RGBA,a.UNSIGNED_BYTE,R),P.data.set(R),k.putImageData(P,0,0),N)return I;var C=createCanvas(M,S),k=C.getContext("2d");return k.translate(0,S),k.scale(1,-1),k.drawImage(I,0,0),C};var T={};return a.loadTexture=function(_,A,M){if(this.textures[_])return this.textures[_];if(T[_])return null;var S=new Image;return S.url=_,S.onload=function(){var N=GL$1.Texture.fromImage(this,A);N.img=this,a.textures[this.url]=N,delete T[this.url],M&&M(N)},S.src=_,T[_]=!0,null},a.drawTexture=function(){var _=mat3.create(),A=vec2.create(),M=vec2.create(),S=vec4.create(),N=vec4.fromValues(1,1,1,1),I=vec2.create(),P={u_texture:0,u_position:A,u_color:N,u_size:M,u_texture_area:S,u_viewport:I,u_transform:_};return function(R,C,k,D,U,z,X,W,Y,H,J){A[0]=C,A[1]=k,D===void 0&&(D=R.width),U===void 0&&(U=R.height),M[0]=D,M[1]=U,z===void 0&&(z=0),X===void 0&&(X=0),W===void 0&&(W=R.width),Y===void 0&&(Y=R.height),S[0]=z/R.width,S[1]=X/R.height,S[2]=(z+W)/R.width,S[3]=(X+Y)/R.height,I[0]=this.viewport_data[2],I[1]=this.viewport_data[3],H=H||Shader.getPartialQuadShader(this);var oe=Mesh.getScreenQuad(this);R.bind(0),H.uniforms(P),J&&H.uniforms(J),H.draw(oe,a.TRIANGLES)}}(),a.canvas.addEventListener("webglcontextlost",function(_){_.preventDefault(),a.context_lost=!0,a.onlosecontext&&a.onlosecontext(_)},!1),a.reset=function(){a.viewport(0,0,this.canvas.width,this.canvas.height),a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.frontFace(a.CCW),a._current_texture_drawto=null,a._current_fbo_color=null,a._current_fbo_depth=null},a.dump=function(){console.log("userAgent: ",navigator.userAgent),console.log("Supported extensions:");var _=a.getSupportedExtensions();console.log(_.join(","));var A=["VENDOR","VERSION","MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_SIZE","MAX_TEXTURE_IMAGE_UNITS"];console.log("WebGL info:");for(var M in A)console.log(" * "+A[M]+": "+a.getParameter(a[A[M]]));console.log("*************************************************")},a.reset(),a},GL$1.mapKeyCode=function(e){var t={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",27:"ESCAPE",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};return t[e]||(e>=65&&e<=90?String.fromCharCode(e):null)},GL$1.dragging=!1,GL$1.last_pos=[0,0],GL$1.augmentEvent=function(e,t){var r=null;t=t||e.target||gl.canvas,r=t.getBoundingClientRect(),e.mousex=e.clientX-r.left,e.mousey=e.clientY-r.top,e.canvasx=e.mousex,e.canvasy=r.height-e.mousey,e.deltax=0,e.deltay=0,e.is_touch&&(gl.mouse.buttons=e.which),document.pointerLockElement===t&&(e.canvasx=e.mousex=r.width*.5,e.canvasy=e.mousey=r.height*.5),e.type=="mousedown"?this.dragging=!0:e.type=="mousemove"||e.type=="mouseup"&&e.buttons==0&&(this.dragging=!1),e.movementX!==void 0&&!e.is_touch&&!GL$1.isMobile()?(e.deltax=e.movementX,e.deltay=e.movementY):(e.deltax=e.mousex-this.last_pos[0],e.deltay=e.mousey-this.last_pos[1]),this.last_pos[0]=e.mousex,this.last_pos[1]=e.mousey,e.dragging=this.dragging,e.leftButton=!!(gl.mouse.buttons&GL$1.LEFT_MOUSE_BUTTON_MASK),e.middleButton=!!(gl.mouse.buttons&GL$1.MIDDLE_MOUSE_BUTTON_MASK),e.rightButton=!!(gl.mouse.buttons&GL$1.RIGHT_MOUSE_BUTTON_MASK),e.buttons_mask=0,e.leftButton&&(e.buttons_mask=1),e.middleButton&&(e.buttons_mask|=2),e.rightButton&&(e.buttons_mask|=4),e.isButtonPressed=function(n){return this.buttons_mask&1<<n}},GL$1.isMobile=function(){return this.mobile!==void 0?this.mobile:global.navigator?navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/SamsungBrowser/i)||navigator.userAgent.match(/Mobile VR/i)||navigator.userAgent.match(/Android/i)?this.mobile=!0:this.mobile=!1:this.mobile=!1};var LEvent=global.LEvent=GL$1.LEvent={bind:function(e,t,r,n){if(!e)throw"cannot bind event to null";if(!r)throw"cannot bind to null callback";if(e.constructor===String)throw"cannot bind event to a string";this.target_instance=n,this.callback=r,this.instance=e;var a=e.__levents;a||(Object.defineProperty(e,"__levents",{value:{},enumerable:!1}),a=e.__levents),Object.prototype.hasOwnProperty.call(a,t)?a[t].push([r,n]):a[t]=[[r,n]],e.onLEventBinded&&e.onLEventBinded(t,r,n)},unbind:function(e,t,r,n){if(!e)throw"cannot unbind event to null";if(!r)throw"cannot unbind from null callback";if(e.constructor===String)throw"cannot bind event to a string";var a=e.__levents;if(a&&Object.prototype.hasOwnProperty.call(a,t)){for(var s=0,o=a[t].length;s<o;++s){var l=a[t][s];if(l[0]===r&&l[1]===n){a[t].splice(s,1);break}}a[t].length==0&&delete a[t],e.onLEventUnbinded&&e.onLEventUnbinded(t,r,n)}},unbindAll:function(e,t,r){if(!e)throw"cannot unbind events in null";var n=e.__levents;if(n){if(e.onLEventUnbindAll&&e.onLEventUnbindAll(t,r),!t){delete e.__levents;return}for(var a in n)for(var s=n[a],o=s.length-1;o>=0;--o)s[o][1]!=t||r&&r!==s[o][0]||s.splice(o,1)}},unbindAllEvent:function(e,t){if(!e)throw"cannot unbind events in null";var r=e.__levents;r&&(delete r[t],e.onLEventUnbindAll&&e.onLEventUnbindAll(t,this.target_instance,this.callback))},isBind:function(e,t,r,n){if(!e)throw"LEvent cannot have null as instance";var a=e.__levents;if(a){if(!Object.prototype.hasOwnProperty.call(a,t))return!1;for(var s=0,o=a[t].length;s<o;++s){var l=a[t][s];if(l[0]===r&&l[1]===n)return!0}return!1}},hasBind:function(e,t){if(!e)throw"LEvent cannot have null as instance";var r=e.__levents;return!(!r||!Object.prototype.hasOwnProperty.call(r,t)||!r[t].length)},hasBindTo:function(e,t){if(!e)throw"LEvent cannot have null as instance";var r=e.__levents;if(!r)return!1;for(var n in r)for(var a=r[n],s=0;s<a.length;++s)if(a[s][1]===t)return!0;return!1},trigger:function(e,t,r,n,a){if(!e)throw"cannot trigger event from null";if(e.constructor===String)throw"cannot bind event to a string";var s=e.__levents;if(!s||!Object.prototype.hasOwnProperty.call(s,t))return!1;var o=s[t];if(n)for(var l=o.length-1;l>=0;--l){var c=o[l];if(a){if(c&&c[0].apply(c[1],r)===!0)return!0}else if(c&&c[0].call(c[1],t,r)===!0)return!0}else for(var l=0,u=o.length;l<u;++l){var c=o[l];if(a){if(c&&c[0].apply(c[1],r)===!0)return!0}else if(c&&c[0].call(c[1],t,r)===!0)return!0}return!1},triggerArray:function(e,t,r,n,a){for(var s=!1,o=0,l=e.length;o<l;++o){var c=e[o];if(!c)throw"cannot trigger event from null";if(c.constructor===String)throw"cannot bind event to a string";var u=c.__levents;if(!(!u||!Object.prototype.hasOwnProperty.call(u,t)))if(n)for(var h=u[t].length-1;h>=0;--h){var d=u[t][h];if(a){if(d[0].apply(d[1],r)===!0){s=!0;break}}else if(d[0].call(d[1],t,r)===!0){s=!0;break}}else for(var h=0,f=u[t].length;h<f;++h){var d=u[t][h];if(a){if(d[0].apply(d[1],r)===!0){s=!0;break}}else if(d[0].call(d[1],t,r)===!0){s=!0;break}}}return s},extendObject:function(e){e.bind=function(t,r,n){return LEvent.bind(this,t,r,n)},e.trigger=function(t,r){return LEvent.trigger(this,t,r)},e.unbind=function(t,r,n){return LEvent.unbind(this,t,r,this.instance)},e.unbindAll=function(t,r){return LEvent.unbindAll(this,t,r)}},extendClass:function(e){this.extendObject(e.prototype)}};global.CLIP_INSIDE=GL$1.CLIP_INSIDE=0,global.CLIP_OUTSIDE=GL$1.CLIP_OUTSIDE=1,global.CLIP_OVERLAP=GL$1.CLIP_OVERLAP=2,global.geo={last_t:-1,createPlane:function(e,t){return new Float32Array([t[0],t[1],t[2],-vec3.dot(e,t)])},planeFromTriangle:function(){var e=vec3.create(),t=vec3.create(),r=vec3.create();return function(n,a,s,o){return vec3.sub(e,s,a),vec3.sub(t,o,a),vec3.cross(r,e,t),vec3.normalize(r,r),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=-vec3.dot(a,r),n}}(),computeTriangleNormal:function(){var e=vec3.create(),t=vec3.create(),r=vec3.create();return function(n,a,s,o){return vec3.sub(e,s,a),vec3.sub(t,o,a),vec3.cross(r,e,t),vec3.normalize(r,r),n[0]=r[0],n[1]=r[1],n[2]=r[2],n}}(),distancePointToPlane:function(e,t){return(vec3.dot(e,t)+t[3])/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},distance2PointToPlane:function(e,t){return(vec3.dot(e,t)+t[3])/(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},projectPointOnLine:function(){var e=vec3.create(),t=vec3.create();return function(r,n,a,s){s=s||vec3.create(),vec3.sub(e,r,n),vec3.sub(t,a,n);var o=vec3.dot(e,t)/vec3.dot(t,t);return s[0]=n[0]+o*t[0],s[1]=n[1]+o*t[1],s[2]=n[2]+o*t[2],s}}(),project2DPointOnLine:function(e,t,r,n){n=n||vec2.create();var a=vec2.fromValues(e[0]-t[0],e[1]-t[1]),s=vec2.fromValues(r[0]-t[0],r[1]-t[1]),o=vec2.dot(a,s)/vec2.dot(s,s);return n[0]=t[0]+o*s[0],n[1]=t[1]+o*s[1],n},closestPointToSegment:function(){var e=vec3.create(),t=vec3.create();return function(r,n,a,s){s=s||vec3.create(),vec3.sub(e,r,n),vec3.sub(t,a,n);var o=vec3.dot(e,t)/vec3.dot(t,t);return o=Math.min(1,Math.max(0,o)),s[0]=n[0]+o*t[0],s[1]=n[1]+o*t[1],s[2]=n[2]+o*t[2],s}}(),projectPointOnPlane:function(){var e=vec3.create();return function(t,r,n,a){a=a||vec3.create(),vec3.sub(e,t,r);var s=vec3.dot(e,n);return vec3.scale(e,n,s),vec3.sub(a,t,e)}}(),isPointInsideTriangle:function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create(),a=vec3.create(),s=vec3.create();return function(o,l,c,u){return vec3.sub(e,l,o),vec3.sub(t,c,o),vec3.sub(r,u,o),vec3.cross(n,t,r),vec3.cross(a,r,e),vec3.cross(s,e,t),!(vec3.dot(n,a)<0||vec3.dot(n,s)<0)}}(),reflectPointInPlane:function(e,t,r){var n=-1*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2]),a=-(n+r[0]*e[0]+r[1]*e[1]+r[2]*e[2])/(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return vec3.fromValues(e[0]+a*r[0]*2,e[1]+a*r[1]*2,e[2]+a*r[2]*2)},testRayPlane:function(e,t,r,n,a){var s=vec3.dot(r,n),o=s-vec3.dot(n,e),l=vec3.dot(n,t);if(Math.abs(l)<global.EPSILON)return!1;var c=this.last_t=o/l;return c<0?!1:(a&&vec3.add(a,e,vec3.scale(a,t,c)),!0)},testSegmentPlane:function(){var e=vec3.create();return function(t,r,n,a,s){var o=vec3.dot(n,a),l=o-vec3.dot(a,t),c=vec3.sub(e,r,t),u=vec3.dot(a,c);if(Math.abs(u)<global.EPSILON)return!1;var h=this.last_t=l/u;return h<0||h>1?!1:(s&&vec3.add(s,t,vec3.scale(s,c,h)),!0)}}(),testRaySphere:function(){var e=vec3.create();return function(t,r,n,a,s,o){var l=vec3.subtract(e,t,n),c=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],u=2*l[0]*r[0]+2*l[1]*r[1]+2*l[2]*r[2],h=l[0]*l[0]+l[1]*l[1]+l[2]*l[2]-a*a,d=u*u-4*c*h;if(d<0)return!1;if(s){var f=Math.sqrt(d),p=1/(2*c),g=(-u+f)*p,b=(-u-f)*p,m=g<b?g:b;if(o!==void 0&&m>o)return!1;this.last_t=m,vec3.add(s,t,vec3.scale(s,r,m))}return!0}}(),hitTestTriangle:function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create(),a=vec3.create();return function(s,o,l,c,u,h){vec3.subtract(e,c,l),vec3.subtract(t,u,l),vec3.cross(r,e,t),vec3.normalize(r,r);var d=vec3.dot(r,vec3.subtract(n,l,s))/vec3.dot(r,o);if(d>0){vec3.add(a,s,vec3.scale(n,o,d));var f=vec3.subtract(n,n,l),p=vec3.dot(t,t),g=vec3.dot(t,e),b=vec3.dot(t,f),m=vec3.dot(e,e),E=vec3.dot(e,f),L=p*m-g*g,T=(m*b-g*E)/L,_=(p*E-g*b)/L;if(T>=0&&_>=0&&T+_<=1)return this.last_t=d,h&&vec3.add(h,s,vec3.scale(n,o,d)),!0}return!1}}(),testRayCylinder:function(e,t,r,n,a,s){var o=vec3.clone(e),l=vec3.add(vec3.create(),e,vec3.scale(vec3.create(),t,1e5)),c=0,u=vec3.subtract(vec3.create(),n,r),h=vec3.subtract(vec3.create(),o,r),d=vec3.subtract(vec3.create(),l,o),f=vec3.dot(h,u),p=vec3.dot(d,u),g=vec3.dot(u,u);if(f<0&&f+p<0||f>g&&f+p>g)return!1;var b=vec3.dot(d,d),m=vec3.dot(h,d),E=g*b-p*p,L=vec3.dot(h,h)-a*a,T=g*L-f*f;if(Math.abs(E)<global.EPSILON)return T>0?!1:(f<0?c=-m/b:f>g?c=(p-m)/b:c=0,s&&vec3.add(s,o,vec3.scale(s,d,c)),!0);var _=g*m-p*f,A=_*_-E*T;return A<0||(c=(-_-Math.sqrt(A))/E,c<0||c>1)?!1:f+c*p<0?p<=0?!1:(c=-f/p,s&&vec3.add(s,o,vec3.scale(s,d,c)),L+2*c*(m+c*b)<=0):f+c*p>g?p>=0?!1:(c=(g-f)/p,s&&vec3.add(s,o,vec3.scale(s,d,c)),L+g-2*f+c*(2*(m-p)+c*b)<=0):(this.last_t=c,s&&vec3.add(s,o,vec3.scale(s,d,c)),!0)},testRayBox:function(){var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3);return function(n,a,s,o,l,c){c=c||Number.MAX_VALUE;var u=!0,h=0,d;for(e.fill(0),r.fill(0),t.fill(0),h=0;h<3;++h)n[h]<s[h]?(e[h]=1,t[h]=s[h],u=!1):n[h]>o[h]?(e[h]=0,t[h]=o[h],u=!1):e[h]=2;if(u)return this.last_t=0,l&&vec3.copy(l,n),!0;for(h=0;h<3;++h)e[h]!=2&&a[h]!=0?r[h]=(t[h]-n[h])/a[h]:r[h]=-1;for(d=0,h=1;h<3;h++)r[d]<r[h]&&(d=h);if(r[d]<0||r[d]>c)return!1;for(this.last_t=r[d],h=0;h<3;++h)if(d!=h){var f=n[h]+r[d]*a[h];if(f<s[h]||f>o[h])return!1;l&&(l[h]=f)}else l&&(l[h]=t[h]);return!0}}(),testRayBBox:function(){var e=mat4.create(),t=vec3.create(),r=vec3.create();return function(n,a,s,o,l,c,u){if(!n||!a||!s)throw"parameters missing";o&&(mat4.invert(e,o),vec3.add(t,n,a),n=vec3.transformMat4(r,n,e),vec3.transformMat4(t,t,e),vec3.sub(t,t,n),a=vec3.normalize(t,t));var h=this.testRayBox(n,a,s.subarray(6,9),s.subarray(9,12),l,c);return!u&&o&&l&&vec3.transformMat4(l,l,o),h}}(),testPointBBox:function(e,t){return!(e[0]<t[6]||e[0]>t[9]||e[1]<t[7]||e[0]>t[10]||e[2]<t[8]||e[0]>t[11])},testBBoxBBox:function(e,t){var r=Math.abs(t[0]-e[0]);if(r>e[3]+t[3])return!1;var n=Math.abs(t[1]-e[1]);if(n>e[4]+t[4])return!1;var a=Math.abs(t[2]-e[2]);if(a>e[5]+t[5])return!1;var s=global.BBox.getMin(t);if(global.geo.testPointBBox(s,e)){var o=global.BBox.getMax(t);if(global.geo.testPointBBox(o,e))return!0}return!0},testSphereBBox:function(e,t,r){for(var n,a=0,s=global.BBox.getMin(r),o=global.BBox.getMax(r),l=0;l<3;++l)e[l]<s[l]?(n=e[l]-s[l],a+=n*n):e[l]>o[l]&&(n=e[l]-o[l],a+=n*n);var c=t*t;return a<=c},closestPointBetweenLines:function(e,t,r,n,a,s){var o=vec3.subtract(vec3.create(),t,e),l=vec3.subtract(vec3.create(),n,r),c=vec3.subtract(vec3.create(),e,r),u=vec3.dot(o,o),h=vec3.dot(o,l),d=vec3.dot(l,l),f=vec3.dot(o,c),p=vec3.dot(l,c),g=u*d-h*h,b,m;g<global.EPSILON?(b=0,m=h>d?f/h:p/d):(b=(h*p-d*f)/g,m=(u*p-h*f)/g),a&&vec3.add(a,e,vec3.scale(vec3.create(),o,b)),s&&vec3.add(s,r,vec3.scale(vec3.create(),l,m));var E=vec3.add(vec3.create(),c,vec3.subtract(vec3.create(),vec3.scale(vec3.create(),o,b),vec3.scale(vec3.create(),l,m)));return vec3.length(E)},extractPlanes:function(e,r){var r=r||new Float32Array(24);return r.set([e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]],0),n(0),r.set([e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]],4),n(4),r.set([e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]],8),n(8),r.set([e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]],12),n(12),r.set([e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]],16),n(16),r.set([e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]],20),n(20),r;function n(a){var s=r.subarray(a,a+3),o=vec3.length(s);o!==0&&(o=1/o,r[a]*=o,r[a+1]*=o,r[a+2]*=o,r[a+3]*=o)}},frustumTestBox:function(e,t){var r=0,n=0;return r=global.planeBoxOverlap(e.subarray(0,4),t),r==global.CLIP_OUTSIDE||(n+=r,r=global.planeBoxOverlap(e.subarray(4,8),t),r==global.CLIP_OUTSIDE)||(n+=r,r=global.planeBoxOverlap(e.subarray(8,12),t),r==global.CLIP_OUTSIDE)||(n+=r,r=global.planeBoxOverlap(e.subarray(12,16),t),r==global.CLIP_OUTSIDE)||(n+=r,r=global.planeBoxOverlap(e.subarray(16,20),t),r==global.CLIP_OUTSIDE)||(n+=r,r=global.planeBoxOverlap(e.subarray(20,24),t),r==global.CLIP_OUTSIDE)?global.CLIP_OUTSIDE:(n+=r,n==0?global.CLIP_INSIDE:global.CLIP_OVERLAP)},frustumTestSphere:function(e,t,r){var n,a=!1;return n=global.distanceToPlane(e.subarray(0,4),t),n<-r||(n>=-r&&n<=r&&(a=!0),n=global.distanceToPlane(e.subarray(4,8),t),n<-r)||(n>=-r&&n<=r&&(a=!0),n=global.distanceToPlane(e.subarray(8,12),t),n<-r)||(n>=-r&&n<=r&&(a=!0),n=global.distanceToPlane(e.subarray(12,16),t),n<-r)||(n>=-r&&n<=r&&(a=!0),n=global.distanceToPlane(e.subarray(16,20),t),n<-r)||(n>=-r&&n<=r&&(a=!0),n=global.distanceToPlane(e.subarray(20,24),t),n<-r)?global.CLIP_OUTSIDE:(n>=-r&&n<=r&&(a=!0),a?global.CLIP_OVERLAP:global.CLIP_INSIDE)},testPoint2DInPolygon:function(e,t){for(var r=!1,n=-1,a=e.length,s=a-1;++n<a;s=n)(e[n][1]<=t[1]&&t[1]<e[s][1]||e[s][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[s][0]-e[n][0])*(t[1]-e[n][1])/(e[s][1]-e[n][1])+e[n][0]&&(r=!r);return r}},global.BBox=GL$1.BBox={center:0,halfsize:3,min:6,max:9,radius:12,data_length:13,corners:[vec3.fromValues(1,1,1),vec3.fromValues(1,1,-1),vec3.fromValues(1,-1,1),vec3.fromValues(1,-1,-1),vec3.fromValues(-1,1,1),vec3.fromValues(-1,1,-1),vec3.fromValues(-1,-1,1),vec3.fromValues(-1,-1,-1)],create:function(){return new Float32Array(13)},clone:function(e){return new Float32Array(e)},copy:function(e,t){return e.set(t),e},fromPoint:function(e){var t=this.create();return t.set(e,0),t.set(e,6),t.set(e,9),t},fromMinMax:function(e,t){var r=this.create();return this.setMinMax(r,e,t),r},fromCenterHalfsize:function(e,t){var r=this.create();return this.setCenterHalfsize(r,e,t),r},fromPoints:function(e){var t=this.create();return this.setFromPoints(t,e),t},setFromPoints:function(e,t){var r=e.subarray(6,9),n=e.subarray(9,12);r[0]=t[0],r[1]=t[1],r[2]=t[2],n.set(r);for(var a=3,s=t.length;a<s;a+=3){var o=t[a],l=t[a+1],c=t[a+2];o<r[0]?r[0]=o:o>n[0]&&(n[0]=o),l<r[1]?r[1]=l:l>n[1]&&(n[1]=l),c<r[2]?r[2]=c:c>n[2]&&(n[2]=c)}return e[0]=(r[0]+n[0])*.5,e[1]=(r[1]+n[1])*.5,e[2]=(r[2]+n[2])*.5,e[3]=n[0]-e[0],e[4]=n[1]-e[1],e[5]=n[2]-e[2],e[12]=Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]),e},setMinMax:function(e,t,r){e[6]=t[0],e[7]=t[1],e[8]=t[2],e[9]=r[0],e[10]=r[1],e[11]=r[2];var n=e.subarray(3,6);return vec3.sub(n,r,t),vec3.scale(n,n,.5),e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[12]=vec3.length(e.subarray(3,6)),e},setCenterHalfsize:function(e,t,r,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=r[0],e[4]=r[1],e[5]=r[2],e[6]=e[0]-e[3],e[7]=e[1]-e[4],e[8]=e[2]-e[5],e[9]=e[0]+e[3],e[10]=e[1]+e[4],e[11]=e[2]+e[5],n?e[12]=n:e[12]=vec3.length(r),e},transformMat4:function(){for(var e=0,t=0,r=0,n=new Float32Array(8*3),a=[],s=0;s<24;s+=3)a.push(n.subarray(s,s+3));return function(o,l,c){var u=l[0],h=l[1],d=l[2];e=l[3],t=l[4],r=l[5];for(var f=this.corners,p=0;p<8;++p){var g=f[p],b=a[p];b[0]=e*g[0]+u,b[1]=t*g[1]+h,b[2]=r*g[2]+d,mat4.multiplyVec3(b,c,b)}return this.setFromPoints(o,n)}}(),getCorners:function(e,t){var r=e,n=e.subarray(3,6),a=null;t?(t.set(this.corners),a=t):a=new Float32Array(this.corners);for(var s=0;s<8;++s){var o=a.subarray(s*3,s*3+3);vec3.multiply(o,n,o),vec3.add(o,o,r)}return a},merge:function(e,t,r){var n=e.subarray(6,9),a=e.subarray(9,12);return vec3.min(n,t.subarray(6,9),r.subarray(6,9)),vec3.max(a,t.subarray(9,12),r.subarray(9,12)),global.BBox.setMinMax(e,n,a)},extendToPoint:function(e,t){t[0]<e[6]?e[6]=t[0]:t[0]>e[9]&&(e[9]=t[0]),t[1]<e[7]?e[7]=t[1]:t[1]>e[10]&&(e[10]=t[1]),t[2]<e[8]?e[8]=t[2]:t[2]>e[11]&&(e[11]=t[2]);var r=e.subarray(6,9),n=e.subarray(9,12),a=vec3.add(e.subarray(0,3),r,n);return vec3.scale(a,a,.5),vec3.subtract(e.subarray(3,6),n,a),e[12]=vec3.length(e.subarray(3,6)),e},clampPoint:function(e,t,r){e[0]=Math.clamp(r[0],t[0]-t[3],t[0]+t[3]),e[1]=Math.clamp(r[1],t[1]-t[4],t[1]+t[4]),e[2]=Math.clamp(r[2],t[2]-t[5],t[2]+t[5])},isPointInside:function(e,t){return!(e[0]-e[3]>t[0]||e[1]-e[4]>t[1]||e[2]-e[5]>t[2]||e[0]+e[3]<t[0]||e[1]+e[4]<t[1]||e[2]+e[5]<t[2])},getCenter:function(e){return e.subarray(0,3)},getHalfsize:function(e){return e.subarray(3,6)},getMin:function(e){return e.subarray(6,9)},getMax:function(e){return e.subarray(9,12)},getRadius:function(e){return e[12]}},global.distanceToPlane=GL$1.distanceToPlane=function(t,r){return vec3.dot(t,r)+t[3]},global.planeBoxOverlap=GL$1.planeBoxOverlap=function(t,r){var n=t,a=t[3],s=r,o=r,l=Math.abs(o[3]*n[0])+Math.abs(o[4]*n[1])+Math.abs(o[5]*n[2]),c=vec3.dot(n,s)+a;return c<=-l?global.CLIP_OUTSIDE:c<=l?global.CLIP_OVERLAP:global.CLIP_INSIDE};class OctreeNode{constructor(t,r){$(this,"min",null);$(this,"max",null);$(this,"size",null);$(this,"faces",null);$(this,"inside",0);$(this,"c",null);this.min=t,this.max=r,this.size=vec3.sub(vec3.create(),r,t)}}class Octree{constructor(t,r,n){this.root=null,this.total_depth=0,this.total_nodes=0,t&&this.buildFromMesh(t,r,n)}}global.Octree=GL$1.Octree=Octree,Octree.MAX_NODE_TRIANGLES_RATIO=.05,Octree.MAX_OCTREE_DEPTH=8,Octree.OCTREE_MARGIN_RATIO=.01,Octree.OCTREE_MIN_MARGIN=.1,Octree.NEAREST=0,Octree.FIRST=1,Octree.ALL=2,Octree.prototype.buildFromMesh=function(e,t,r){this.total_depth=0,this.total_nodes=0,t=t||0;var n=e.getBuffer("vertices").data,a=e.getIndexBuffer("triangles");a&&(a=a.data),r||(r=a?a.length:n.length/3);var s;a?s=this.computeAABBFromIndices(n,a,t,r):s=this.computeAABB(n);var o=new OctreeNode(s.min,s.max);this.root=o,this.total_nodes=1,this.total_triangles=a?a.length/3:n.length/9,this.max_node_triangles=this.total_triangles*Octree.MAX_NODE_TRIANGLES_RATIO;var l=vec3.create();vec3.scale(l,o.size,Octree.OCTREE_MARGIN_RATIO),l[0]<Octree.OCTREE_MIN_MARGIN&&(l[0]=Octree.OCTREE_MIN_MARGIN),l[1]<Octree.OCTREE_MIN_MARGIN&&(l[1]=Octree.OCTREE_MIN_MARGIN),l[2]<Octree.OCTREE_MIN_MARGIN&&(l[2]=Octree.OCTREE_MIN_MARGIN),vec3.sub(o.min,o.min,l),vec3.add(o.max,o.max,l),o.faces=[];var c=t+r;if(a)for(var u=t;u<c;u+=3){var h=new Float32Array([n[a[u]*3],n[a[u]*3+1],n[a[u]*3+2],n[a[u+1]*3],n[a[u+1]*3+1],n[a[u+1]*3+2],n[a[u+2]*3],n[a[u+2]*3+1],n[a[u+2]*3+2],u/3]);Octree.isValidFace(h)&&this.addToNode(h,o,0)}else for(var u=t*3;u<r*3;u+=9){var h=new Float32Array(10);h.set(n.subarray(u,u+9)),h[9]=u/9,Octree.isValidFace(h)&&this.addToNode(h,o,0)}return this.total_nodes=this.trim(),o},Octree.isValidFace=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create();return function(n){var a=n.subarray(0,3),s=n.subarray(3,6),o=n.subarray(6,9);return vec3.sub(e,s,a),vec3.sub(t,o,a),vec3.cross(r,e,t),vec3.length(r)>0}}(),Octree.prototype.addToNode=function(e,t,r){if(t.inside+=1,t.c){for(var n=this.computeAABB(e),a=!1,s=0;s<t.c.length;++s){var o=t.c[s];if(Octree.isInsideAABB(n,o)){this.addToNode(e,o,r+1),a=!0;break}}a||(t.faces==null&&(t.faces=[]),t.faces.push(e))}else if(t.faces==null&&(t.faces=[]),t.faces.push(e),t.faces.length>this.max_node_triangles&&r<Octree.MAX_OCTREE_DEPTH){this.splitNode(t),this.total_depth<r+1&&(this.total_depth=r+1);var l=t.faces;t.faces=null;for(var s=0;s<l.length;++s){for(var e=l[s],n=this.computeAABB(e),a=!1,c=0;c<t.c.length;++c){var o=t.c[c];if(Octree.isInsideAABB(n,o)){this.addToNode(e,o,r+1),a=!0;break}}a||(t.faces==null&&(t.faces=[]),t.faces.push(e))}}},Octree.prototype.octree_pos_ref=[[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]],Octree.prototype.splitNode=function(e){e.c=[];for(var t=[(e.max[0]-e.min[0])*.5,(e.max[1]-e.min[1])*.5,(e.max[2]-e.min[2])*.5],r=0;r<this.octree_pos_ref.length;++r){var n=this.octree_pos_ref[r],a=[e.min[0]+t[0]*n[0],e.min[1]+t[1]*n[1],e.min[2]+t[2]*n[2]],s=[a[0]+t[0],a[1]+t[1],a[2]+t[2]],o=new OctreeNode(a,s);this.total_nodes+=1,o.faces=null,o.inside=0,e.c.push(o)}},Octree.prototype.computeAABB=function(e){for(var t=new Float32Array([e[0],e[1],e[2]]),r=new Float32Array(t),n=3;n<e.length-1;n+=3)for(var a=0;a<3;a++)t[a]>e[n+a]&&(t[a]=e[n+a]),r[a]<e[n+a]&&(r[a]=e[n+a]);return{min:t,max:r}},Octree.prototype.computeAABBFromIndices=function(e,t,r,n){r=r||0,n=n||t.length;for(var a=t[r],s=new Float32Array([e[a*3],e[a*3+1],e[a*3+2]]),o=new Float32Array([e[a*3],e[a*3+1],e[a*3+2]]),l=r+1;l<r+n;++l)for(var a=t[l]*3,c=0;c<3;c++)s[c]>e[a+c]&&(s[c]=e[a+c]),o[c]<e[a+c]&&(o[c]=e[a+c]);return{min:s,max:o}},Octree.prototype.trim=function(e){if(e=e||this.root,!e.c)return 1;for(var t=1,r=[],n=e.c,a=0;a<n.length;++a)n[a].inside&&(r.push(n[a]),t+=this.trim(n[a]));return e.c=r,t},Octree.prototype.testRay=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create();return function(a,s,o,l,c,u){if(u=u||Octree.NEAREST,!this.root)throw"Error: octree not build";e.set(a),t.set(s),r.set(this.root.min),n.set(this.root.max);var h=Octree.hitTestBox(e,t,r,n);if(!h)return null;var h=Octree.testRayInNode(this.root,e,t,c,u);if(h==null)return null;if(u==Octree.ALL)return h;var d=vec3.scale(vec3.create(),s,h.t);return vec3.add(d,d,a),h.pos=d,h}}(),Octree.testRayInNode=function(e,t,r,n,a){var s=null,o=null;if(e.faces)for(var l=0,c=e.faces.length;l<c;++l){var u=e.faces[l];if(s=Octree.hitTestTriangle(t,r,u.subarray(0,3),u.subarray(3,6),u.subarray(6,9),n),s!=null){if(s.index=u[9],a==Octree.FIRST)return s;a==Octree.ALL?(o||(o=[]),o.push(s)):(s.face=u,o?o.mergeWith(s):o=s)}}var h=vec3.create(),d=vec3.create(),f;if(e.c){for(var l=0;l<e.c.length;++l)if(f=e.c[l],h.set(f.min),d.set(f.max),s=Octree.hitTestBox(t,r,h,d),s!=null&&!(a!=Octree.ALL&&o&&s.t>o.t)&&(s=Octree.testRayInNode(f,t,r,n,a),s!=null)){if(a==Octree.FIRST)return s;a==Octree.ALL?(o||(o=[]),o.push(s)):o?o.mergeWith(s):o=s}}return o},Octree.prototype.testSphere=function(e,t){if(e=vec3.clone(e),!this.root)throw"Error: octree not build";var r=t*t;return Octree.testSphereBox(e,r,vec3.clone(this.root.min),vec3.clone(this.root.max))?Octree.testSphereInNode(this.root,e,r):!1},Octree.testSphereInNode=function(e,t,r){if(e.faces)for(var n=0,a=e.faces.length;n<a;++n){var s=e.faces[n];if(Octree.testSphereTriangle(t,r,s.subarray(0,3),s.subarray(3,6),s.subarray(6,9)))return!0}var o=vec3.create(),l=vec3.create(),c;if(e.c){for(var n=0;n<e.c.length;++n)if(c=e.c[n],o.set(c.min),l.set(c.max),!!Octree.testSphereBox(t,r,o,l)&&Octree.testSphereInNode(c,t,r))return!0}return!1},Octree.prototype.findNearestPoint=function(e,t,r,n){if(r=r||1/0,e===t)throw"findNearestPoint input point and output cannot be the same";return Octree.nearestInNode(this.root,e,t,r,n)},Octree.nearestInNode=function(e,t,r,n,a){var s=vec3.create(),o;if(a&&(o=vec3.create()),e.faces)for(var l=0,c=e.faces.length;l<c;++l){var u=e.faces[l],h=u.subarray(0,3),d=u.subarray(3,6),f=u.subarray(6,9);Octree.closestPointOnTriangle(t,h,d,f,s);var p=vec3.dist(s,t);p<n&&(n=p,vec3.copy(r,s),a&&global.geo.computeTriangleNormal(a,h,d,f))}if(!e.c)return n;for(var l=0;l<e.c.length;++l){var g=e.c[l],b=Octree.distanceToBox(t,g.min,g.max);if(!(b>n)){var p=Octree.nearestInNode(g,t,s,n,o);p<n&&(n=p,vec3.copy(r,s),a&&vec3.copy(a,o))}}return n},Octree.closestPointOnTriangle=function(){var e=new Float32Array(4),t=vec3.create(),r=vec3.create(),n=vec3.create(),a=vec3.create();return function(s,o,l,c,u){if(global.geo.planeFromTriangle(e,o,l,c),vec3.length(e)>1e-8&&(global.geo.projectPointOnPlane(s,o,e,t),global.geo.isPointInsideTriangle(t,o,l,c)))return vec3.copy(u,t),u;global.geo.closestPointToSegment(t,o,l,r),global.geo.closestPointToSegment(t,l,c,n),global.geo.closestPointToSegment(t,c,o,a);var h=vec3.sqrDist(t,r),d=vec3.sqrDist(t,n),f=vec3.sqrDist(t,a),p=Math.min(h,d,f);return p===h?vec3.copy(u,r):p===d?vec3.copy(u,n):vec3.copy(u,a),u}}(),Octree.isInsideAABB=function(e,t){return!(e.min[0]<t.min[0]||e.min[1]<t.min[1]||e.min[2]<t.min[2]||e.max[0]>t.max[0]||e.max[1]>t.max[1]||e.max[2]>t.max[2])},Octree.distanceToBox=function(e,t,r){var n=(r[0]+t[0])*.5,a=(r[1]+t[1])*.5,s=(r[2]+t[2])*.5,o=r[0]-n,l=r[1]-a,c=r[2]-s,u=Math.abs(e[0]-n)-o,h=Math.abs(e[1]-a)-l,d=Math.abs(e[2]-s)-c,f=Math.min(Math.max(u,h,d),0);return u=Math.max(u,0),h=Math.max(h,0),d=Math.max(d,0),Math.sqrt(u*u+h*h+d*d)+f},Octree.hitTestBox=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create(),a=vec3.create(),s=vec3.create(),o=1e-6,l=vec3.fromValues(o,o,o);return function(c,u,h,d){if(vec3.subtract(e,h,c),vec3.subtract(t,d,c),vec3.maxValue(e)<0&&vec3.minValue(t)>0)return new HitTest(0,c,u);r[0]=1/u[0],r[1]=1/u[1],r[2]=1/u[2],vec3.multiply(e,e,r),vec3.multiply(t,t,r),vec3.min(n,e,t),vec3.max(a,e,t);var f=vec3.maxValue(n),p=vec3.minValue(a);if(f>0&&f<p){var g=vec3.add(vec3.create(),vec3.scale(s,u,f),c);return vec3.add(h,h,l),vec3.subtract(h,h,l),new HitTest(f,g,vec3.fromValues((g[0]>d[0])-(g[0]<h[0]),(g[1]>d[1])-(g[1]<h[1]),(g[2]>d[2])-(g[2]<h[2])))}return null}}(),Octree.hitTestTriangle=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create();return function(a,s,o,l,c,u){vec3.subtract(e,l,o),vec3.subtract(t,c,o);var h=vec3.cross(vec3.create(),e,t);if(vec3.normalize(h,h),!u&&vec3.dot(h,s)>0)return null;var d=vec3.dot(h,vec3.subtract(n,o,a))/vec3.dot(h,s);if(d>0){var f=vec3.scale(vec3.create(),s,d);vec3.add(f,f,a),vec3.subtract(r,f,o);var p=vec3.dot(t,t),g=vec3.dot(t,e),b=vec3.dot(t,r),m=vec3.dot(e,e),E=vec3.dot(e,r),L=p*m-g*g,T=(m*b-g*E)/L,_=(p*E-g*b)/L;if(T>=0&&_>=0&&T+_<=1)return new HitTest(d,f,h)}return null}}(),Octree.testSphereTriangle=function(){var e=vec3.create(),t=vec3.create(),r=vec3.create(),n=vec3.create(),a=vec3.create(),s=vec3.create(),o=vec3.create(),l=vec3.create();return function(c,u,h,d,f){vec3.sub(e,h,c),vec3.sub(t,d,c),vec3.sub(r,f,c),vec3.sub(n,t,e),vec3.sub(a,r,e),vec3.cross(l,n,a);var p=vec3.dot(e,l),g=vec3.dot(l,l),b=p*p>u*g,m=vec3.dot(e,e),E=vec3.dot(e,t),L=vec3.dot(e,r),T=vec3.dot(t,t),_=vec3.dot(t,r),A=vec3.dot(r,r),M=m>u&E>m&L>m,S=T>u&E>T&_>T,N=A>u&L>A&_>A,I=E-m,P=_-T,R=L-A;vec3.sub(s,r,t),vec3.sub(o,e,r);var C=vec3.dot(n,n),k=vec3.dot(s,s),D=vec3.dot(o,o),U=vec3.scale(vec3.create(),e,C);vec3.sub(U,U,vec3.scale(vec3.create(),n,I));var z=vec3.scale(vec3.create(),t,k);vec3.sub(z,z,vec3.scale(vec3.create(),s,P));var X=vec3.scale(vec3.create(),r,D);vec3.sub(X,X,vec3.scale(vec3.create(),o,R));var W=vec3.scale(vec3.create(),r,C);W=vec3.sub(W,W,U);var Y=vec3.scale(vec3.create(),e,k);Y=vec3.sub(Y,Y,z);var H=vec3.scale(vec3.create(),t,D);H=vec3.sub(H,H,X);var J=vec3.dot(U,U)>u*C*C&vec3.dot(U,W)>0,oe=vec3.dot(z,z)>u*k*k&vec3.dot(z,Y)>0,he=vec3.dot(X,X)>u*D*D&vec3.dot(X,H)>0,ce=b|M|S|N|J|oe|he;return!ce}}(),Octree.testSphereBox=function(e,t,r,n){for(var a,s=0,o=0;o<3;++o)e[o]<r[o]?(a=e[o]-r[o],s+=a*a):e[o]>n[o]&&(a=e[o]-n[o],s+=a*a);return s<=t};class HitTest{constructor(t,r,n,a){this.t=arguments.length?t:Number.MAX_VALUE,this.hit=r,this.normal=n,this.face=null,this.index=a}}global.HitTest=GL$1.HitTest=HitTest,HitTest.prototype.mergeWith=function(e){e.t>0&&e.t<this.t&&(this.t=e.t,this.hit=e.hit,this.normal=e.normal,this.face=e.face,this.index=e.index)},global.Ray=GL$1.Ray=function(t,r){this.origin=vec3.create(),this.direction=vec3.create(),this.collision_point=vec3.create(),this.t=-1,t&&this.origin.set(t),r&&this.direction.set(r)},GL$1.Ray.prototype.testPlane=function(e,t){var r=global.geo.testRayPlane(this.origin,this.direction,e,t,this.collision_point);return this.t=global.geo.last_t,r},GL$1.Ray.prototype.testSphere=function(e,t,r){var n=global.geo.testRaySphere(this.origin,this.direction,e,t,this.collision_point,r);return this.t=global.geo.last_t,n},GL$1.Ray.prototype.testBBox=function(e,t,r,n){var a=global.geo.testRayBBox(this.origin,this.direction,e,r,this.collision_point,t,n);return this.t=global.geo.last_t,a},global.Raytracer=GL$1.Raytracer=function(t,r){this.viewport=vec4.create(),this.ray00=vec3.create(),this.ray10=vec3.create(),this.ray01=vec3.create(),this.ray11=vec3.create(),this.eye=vec3.create(),this.setup(t,r)},GL$1.Raytracer.prototype.setup=function(e,t){t=t||gl.viewport_data,this.viewport.set(t);var r=t[0],n=r+t[2],a=t[1],s=a+t[3];vec3.set(this.ray00,r,a,1),vec3.set(this.ray10,n,a,1),vec3.set(this.ray01,r,s,1),vec3.set(this.ray11,n,s,1),vec3.unproject(this.ray00,this.ray00,e,t),vec3.unproject(this.ray10,this.ray10,e,t),vec3.unproject(this.ray01,this.ray01,e,t),vec3.unproject(this.ray11,this.ray11,e,t);var o=this.eye;vec3.unproject(o,o,e,t),vec3.subtract(this.ray00,this.ray00,o),vec3.subtract(this.ray10,this.ray10,o),vec3.subtract(this.ray01,this.ray01,o),vec3.subtract(this.ray11,this.ray11,o)},GL$1.Raytracer.prototype.getRayForPixel=function(){var e=vec3.create(),t=vec3.create();return function(r,n,a){return a=a||vec3.create(),r=(r-this.viewport[0])/this.viewport[2],n=1-(n-this.viewport[1])/this.viewport[3],vec3.lerp(e,this.ray00,this.ray10,r),vec3.lerp(t,this.ray01,this.ray11,r),vec3.lerp(a,e,t,n),vec3.normalize(a,a)}}();var _hittest_inv=mat4.create();GL$1.Raytracer.hitTestBox=function(e,t,r,n,a){var s=new Float32Array(30);if(a){var o=mat4.invert(_hittest_inv,a);e=mat4.multiplyVec3(s.subarray(3,6),o,e),t=mat4.rotateVec3(s.subarray(6,9),o,t)}var l=vec3.subtract(s.subarray(9,12),r,e);vec3.divide(l,l,t);var c=vec3.subtract(s.subarray(12,15),n,e);vec3.divide(c,c,t);var u=vec3.min(s.subarray(15,18),l,c),h=vec3.max(s.subarray(18,21),l,c),d=vec3.maxValue(u),f=vec3.minValue(h);if(d>0&&d<=f){var p=1e-6,g=vec3.scale(s.subarray(21,24),t,d);return vec3.add(g,e,g),vec3.addValue(s.subarray(24,27),r,p),vec3.subValue(s.subarray(27,30),n,p),new HitTest(d,g,vec3.fromValues((g[0]>n[0])-(g[0]<r[0]),(g[1]>n[1])-(g[1]<r[1]),(g[2]>n[2])-(g[2]<r[2])))}return null},GL$1.Raytracer.hitTestSphere=function(e,t,r,n){var a=vec3.subtract(vec3.create(),e,r),s=vec3.dot(t,t),o=2*vec3.dot(t,a),l=vec3.dot(a,a)-n*n,c=o*o-4*s*l;if(c>0){var u=(-o-Math.sqrt(c))/(2*s),h=vec3.add(vec3.create(),e,vec3.scale(vec3.create(),t,u));return new HitTest(u,h,vec3.scale(vec3.create(),vec3.subtract(vec3.create(),h,r),1/n))}return null},GL$1.Raytracer.hitTestTriangle=function(e,t,r,n,a){var s=vec3.subtract(vec3.create(),n,r),o=vec3.subtract(vec3.create(),a,r),l=vec3.cross(vec3.create(),s,o);vec3.normalize(l,l);var c=vec3.dot(l,vec3.subtract(vec3.create(),r,e))/vec3.dot(l,t);if(c>0){var u=vec3.add(vec3.create(),e,vec3.scale(vec3.create(),t,c)),h=vec3.subtract(vec3.create(),u,r),d=vec3.dot(o,o),f=vec3.dot(o,s),p=vec3.dot(o,h),g=vec3.dot(s,s),b=vec3.dot(s,h),m=d*g-f*f,E=(g*p-f*b)/m,L=(d*b-f*p)/m;if(E>=0&&L>=0&&E+L<=1)return new HitTest(c,u,l)}return null},Mesh.parseOBJ=function(e,t){t=t||{};var r=t.matextension||"",n=[],a=[],s=[],o=[],l=[],c=[],u=[],h={},d=null,f=Te(),p=new Map,g=0,b=1;t.scale&&(b=t.scale);for(var m=1,E=2,L=3,T=4,_=5,A=6,M=7,S=8,N={v:m,vt:E,vn:L,f:T,g:_,o:A,usemtl:M,mtllib:S},I,P,R,C=e.split(`
`),k=C.length,D=0;D<k;++D){var U=C[D];if(U=U.replace(/[ \t]+/g," ").replace(/\s\s*$/,""),U[U.length-1]=="\\"){D+=1;var z=C[D].replace(/[ \t]+/g," ").replace(/\s\s*$/,"");U=(U.substr(0,U.length-1)+z).replace(/[ \t]+/g," ").replace(/\s\s*$/,"")}if(U[0]!="#"&&U!=""){var X=U.split(" "),W=N[X[0]];switch(W<=L&&(I=parseFloat(X[1]),P=parseFloat(X[2]),W!=E&&(R=parseFloat(X[3]))),W){case m:I*=b,P*=b,R*=b,n.push(I,P,R);break;case E:s.push(I,P);break;case L:a.push(I,P,R);break;case T:if(X.length<4)continue;for(var Y=[],H=1;H<X.length;++H)Y.push(ge(X[H]));f.indices.push(Y[0],Y[1],Y[2]);for(var H=2;H<Y.length-1;++H)f.indices.push(Y[0],Y[H],Y[H+1]);break;case _:case A:var J=X[1];d=J,f.name?(h={},f=Te(J)):f.name=J;break;case M:Ie(X[1]);break;case S:X[1];break}}}for(var oe=[],he=0,ce=[],H=0;H<u.length;++H){var f=u[H];f.indices&&(f.start=he,f.length=f.indices.length,oe=oe.concat(f.indices),delete f.indices,he+=f.length,ce.push(f))}u=ce;var ie={};if(!n.length)return console.error("mesh without vertices"),null;if(t.flip_normals&&l.length)for(var a=l,H=0;H<a.length;++H)a[H]*=-1;ie.vertices=new Float32Array(o),l.length&&(ie.normals=new Float32Array(l)),c.length&&(ie.coords=new Float32Array(c)),oe&&oe.length>0&&(ie.triangles=new(he>256*256?Uint32Array:Uint16Array)(oe)),ie.bounding=GL$1.Mesh.computeBoundingBox(ie.vertices);var de={};if(u.length>1&&(de.groups=u),ie.info=de,!ie.bounding)return console.log("empty mesh"),null;if(t.only_data)return ie;var fe=null;return fe=Mesh.load(ie,null,t.mesh),fe;function ge(pe){var ue,me,be,ye,G=!1;if(pe.indexOf("-")==-1){var F=p.get(pe);if(F!==void 0)return F}else G=!0;if(ye||(ye=pe.split("/")),ye.length==1)ue=parseInt(ye[0]),me=ue,be=ue;else if(ye.length==2)ue=parseInt(ye[0]),me=parseInt(ye[1]),be=ue;else if(ye.length==3)ue=parseInt(ye[0]),me=parseInt(ye[1]),be=parseInt(ye[2]);else return console.log("Problem parsing: unknown number of values per face"),-1;if(ue<0&&(ue=n.length/3+ue+1),be<0&&(be=a.length/2+be+1),me<0&&(me=s.length/2+me+1),G){pe=ue+"/"+me+"/"+be;var F=p.get(pe);if(F!==void 0)return F}ue-=1,me-=1,be-=1,o.push(n[ue*3+0],n[ue*3+1],n[ue*3+2]),s.length&&c.push(s[me*2+0],s[me*2+1]),a.length&&l.push(a[be*3+0],a[be*3+1],a[be*3+2]);var F=g;return p.set(pe,F),++g,F}function Te(pe){var ue={name:pe||"",material:"",start:-1,length:-1,indices:[]};return u.push(ue),ue}function Ie(pe){if(!f.material)return f.material=pe+r,h[pe]=f,f;var ue=h[pe];return ue||(ue=Te(d+"_"+pe),ue.material=pe+r,h[pe]=ue),f=ue,ue}},Mesh.parsers.obj=Mesh.parseOBJ,Mesh.encoders.obj=function(e,t){var r=e.getBuffer("vertices");if(!r)return null;var n=[];n.push(`# Generated with liteGL.js by Javi Agenjo
`);for(var a=r.data,s=0;s<a.length;s+=3)n.push("v "+a[s].toFixed(4)+" "+a[s+1].toFixed(4)+" "+a[s+2].toFixed(4));var o=e.getBuffer("normals");if(o){n.push("");for(var l=o.data,s=0;s<l.length;s+=3)n.push("vn "+l[s].toFixed(4)+" "+l[s+1].toFixed(4)+" "+l[s+2].toFixed(4))}var c=e.getBuffer("coords");if(c){n.push("");for(var u=c.data,s=0;s<u.length;s+=2)n.push("vt "+u[s].toFixed(4)+" "+u[s+1].toFixed(4)+"  0.0000")}var h=e.info.groups,d=e.getIndexBuffer("triangles");if(d){var f=d.data;(!h||!h.length)&&(h=[{start:0,length:f.length,name:"mesh"}]);for(var p=0;p<h.length;++p){var g=h[p];n.push("g "+g.name);var b=g.material||"mat_"+p;b.indexOf(".json")!=-1&&(b=b.substr(0,b.indexOf(".json"))),n.push("usemtl "+b);for(var m=g.start,E=m+g.length,s=m;s<E;s+=3)n.push("f "+(f[s]+1)+"/"+(f[s]+1)+"/"+(f[s]+1)+" "+(f[s+1]+1)+"/"+(f[s+1]+1)+"/"+(f[s+1]+1)+" "+(f[s+2]+1)+"/"+(f[s+2]+1)+"/"+(f[s+2]+1))}}else{(!h||!h.length)&&(h=[{start:0,length:a.length/3,name:"mesh"}]);for(var p=0;p<h.length;++p){var g=h[p];n.push("g "+g.name),n.push("usemtl "+(g.material||"mat_"+p));for(var m=g.start,E=m+g.length,s=m;s<E;s+=3)n.push("f "+(s+1)+"/"+(s+1)+"/"+(s+1)+" "+(s+2)+"/"+(s+2)+"/"+(s+2)+" "+(s+3)+"/"+(s+3)+"/"+(s+3))}}return n.join(`
`)},Mesh.parsers.mesh=function(e,t){for(var r={},n=e.split(`
`),a=0;a<n.length;++a){var s=n[a],o=s[0],l=s.substr(1).split(","),c=l[0];if(o=="-"){var u=1,h=Float32Array;(c=="weights"||c=="bone_indices")&&(h=Uint8Array),c=="weights"&&(u=255);for(var d=new h(Number(l[1])),f=0;f<d.length;++f)d[f]=Number(l[f+2])*u;r[c]=d}else if(o=="*"){var h=Uint16Array;Number(l[1])>256*256&&(h=Uint32Array);for(var d=new h(Number(l[1])),f=0;f<d.length;++f)d[f]=Number(l[f+2]);r[c]=d}else if(o=="@"){if(c=="bones"){for(var p=[],g=Number(l[1]),f=0;f<g;++f){var b=l.slice(3+f*17,3+(f+1)*17-1).map(Number);p.push([l[2+f*17],b])}r.bones=p}else if(c=="bind_matrix")r.bind_matrix=l.slice(1,17).map(Number);else if(c=="groups"){r.info={groups:[]};for(var m=Number(l[1]),f=0;f<m;++f){var E={name:l[2+f*4],material:l[2+f*4+1],start:Number(l[2+f*4+2]),length:Number(l[2+f*4+3])};r.info.groups.push(E)}}}else console.warn("type unknown: "+l[0])}if(t.only_data)return r;var L=null;return L=Mesh.load(r,null,t.mesh),L.updateBoundingBox(),L},Mesh.encoders.mesh=function(e,t){var r=[];for(var n in e.vertexBuffers){var a=e.vertexBuffers[n],s=global.typedArrayToArray(a.data);if(a.normalize&&a.data.constructor==Uint8Array)for(var o=0;o<s.length;++o)s[o]/=255;var l=["-"+n,a.data.length,a.data,s];r.push(l.join(","))}for(var n in e.indexBuffers){var a=e.indexBuffers[n],s=global.typedArrayToArray(a.data),l=["*"+n,a.data.length,a.data,s];r.push(l.join(","))}if(e.bounding&&r.push(["@bounding",global.typedArrayToArray(e.bounding.subarray(0,6))].join(",")),e.info&&e.info.groups){for(var c=[],o=0;o<e.info.groups.length;++o){var u=e.info.groups[o];c.push(u.name,u.material,u.start,u.length)}r.push(["@groups",e.info.groups.length].concat(c).join(","))}return e.bones&&r.push(["@bones",e.bones.length,e.bones.flat()].join(",")),e.bind_matrix&&r.push(["@bind_matrix",global.typedArrayToArray(e.bind_matrix)].join(",")),r.join(`
`)},global.WBin&&(global.WBin.classes.Mesh=Mesh),Mesh.binary_file_formats.wbin=!0,Mesh.parsers.wbin=Mesh.fromBinary=function(e,t){t=t||{};var r=null;if(e.constructor==ArrayBuffer){if(!global.WBin)throw"To use binary meshes you need to install WBin.js from https://github.com/jagenjo/litescene.js/blob/master/src/utils/wbin.js ";r=global.WBin.load(e,!0)}else r=e;r.info||console.warn("This WBin doesn't seem to contain a mesh. Classname: ",r["@classname"]),r.format&&GL$1.Mesh.decompress(r);var n={};if(r.vertex_buffers)for(var a in r.vertex_buffers)n[r.vertex_buffers[a]]=r[r.vertex_buffers[a]];else r.vertices&&(n.vertices=r.vertices),r.normals&&(n.normals=r.normals),r.coords&&(n.coords=r.coords),r.weights&&(n.weights=r.weights),r.bone_indices&&(n.bone_indices=r.bone_indices);var s={};if(r.index_buffers)for(var a in r.index_buffers)s[r.index_buffers[a]]=r[r.index_buffers[a]];else r.triangles&&(s.triangles=r.triangles),r.wireframe&&(s.wireframe=r.wireframe);var o={vertex_buffers:n,index_buffers:s,bounding:r.bounding,info:r.info};if(r.bones){o.bones=r.bones;for(var a=0;a<o.bones.length;++a)o.bones[a][1]=mat4.clone(o.bones[a][1]);r.bind_matrix&&(o.bind_matrix=mat4.clone(r.bind_matrix))}if(r.morph_targets&&(o.morph_targets=r.morph_targets),t.only_data)return o;var l=t.mesh||new GL$1.Mesh;return l.configure(o),l},Mesh.encoders.wbin=function(e,t){return e.updateBoundingBox(),e.toBinary(t)},Mesh.prototype.toBinary=function(e){if(!global.WBin)throw"to use Mesh.toBinary you need to have WBin included. Check the repository for wbin.js";this.info||(this.info={});var t={object_class:"Mesh",info:this.info,groups:this.groups};if(this.bones){for(var r=[],n=0;n<this.bones.length;++n)r.push([this.bones[n][0],mat4.toArray(this.bones[n][1])]);t.bones=r,this.bind_matrix&&(t.bind_matrix=this.bind_matrix)}this.bounding||this.updateBoundingBox(),t.bounding=this.bounding;var a=[],s=[];for(var n in this.vertexBuffers){var o=this.vertexBuffers[n];t[o.name]=o.data,a.push(o.name),o.name=="vertices"&&(t.info.num_vertices=o.data.length/3)}for(var n in this.indexBuffers){var o=this.indexBuffers[n];t[n]=o.data,s.push(n)}t.vertex_buffers=a,t.index_buffers=s,GL$1.Mesh.enable_wbin_compression&&GL$1.Mesh.compress(t);var l=global.WBin.create(t,"Mesh");return l},Mesh.compress=function(e,t){t=t||"bounding_compressed",e.format={type:t};var r=Mesh.compressors[t];if(!r)throw"compression format not supported:"+t;return r(e)},Mesh.decompress=function(e){if(e.format){var t=Mesh.decompressors[e.format.type];if(!t)throw"decompression format not supported:"+e.format.type;return t(e)}},Mesh.compressors.bounding_compressed=function(e){if(!e.vertex_buffers)throw"buffers not found";for(var t=global.BBox.getMin(e.bounding),r=global.BBox.getMax(e.bounding),n=vec3.sub(vec3.create(),r,t),a=e.vertices,s=new Uint16Array(a.length),o=0;o<a.length;o+=3)s[o]=(a[o]-t[0])/n[0]*65535,s[o+1]=(a[o+1]-t[1])/n[1]*65535,s[o+2]=(a[o+2]-t[2])/n[2]*65535;if(e.vertices=s,e.normals){for(var l=e.normals,c=new Uint8Array(l.length),u=c.constructor==Uint8Array?255:65535,o=0;o<l.length;o+=3)c[o]=(l[o]*.5+.5)*u,c[o+1]=(l[o+1]*.5+.5)*u,c[o+2]=(l[o+2]*.5+.5)*u;e.normals=c}if(e.coords){for(var h=e.coords,d=[1e4,1e4,-1e4,-1e4],o=0;o<h.length;o+=2){var f=h[o];d[0]>f?d[0]=f:d[2]<f&&(d[2]=f);var p=h[o+1];d[1]>p?d[1]=p:d[3]<p&&(d[3]=p)}e.format.uvs_bounding=d;for(var g=new Uint16Array(h.length),n=[d[2]-d[0],d[3]-d[1]],o=0;o<h.length;o+=2)g[o]=(h[o]-d[0])/n[0]*65535,g[o+1]=(h[o+1]-d[1])/n[1]*65535;e.coords=g}if(e.weights){for(var b=e.weights,m=new Uint16Array(b.length),E=m.constructor==Uint8Array?255:65535,o=0;o<b.length;o+=4)m[o]=b[o]*E,m[o+1]=b[o+1]*E,m[o+2]=b[o+2]*E,m[o+3]=b[o+3]*E;e.weights=m}},Mesh.decompressors.bounding_compressed=function(e){var t=e.bounding;if(!t)throw"error in mesh decompressing data: bounding not found, cannot use the bounding decompression.";for(var r=global.BBox.getMin(t),n=global.BBox.getMax(t),a=vec3.sub(vec3.create(),n,r),s=e.format,o=1/255,l=1/65535,c=e.vertices,u=new Float32Array(c.length),h=0,d=c.length;h<d;h+=3)u[h]=c[h]*l*a[0]+r[0],u[h+1]=c[h+1]*l*a[1]+r[1],u[h+2]=c[h+2]*l*a[2]+r[2];if(e.vertices=u,e.normals&&e.normals.constructor!=Float32Array){for(var f=e.normals,p=new Float32Array(f.length),g=f.constructor==Uint8Array?o:l,h=0,d=f.length;h<d;h+=3){p[h]=f[h]*g*2-1,p[h+1]=f[h+1]*g*2-1,p[h+2]=f[h+2]*g*2-1;var b=p.subarray(h,h+3);vec3.normalize(b,b)}e.normals=p}if(e.coords&&s.uvs_bounding&&e.coords.constructor!=Float32Array){for(var m=e.coords,E=s.uvs_bounding,a=[E[2]-E[0],E[3]-E[1]],L=new Float32Array(m.length),h=0,d=m.length;h<d;h+=2)L[h]=m[h]*l*a[0]+E[0],L[h+1]=m[h+1]*l*a[1]+E[1];e.coords=L}if(e.weights&&e.weights.constructor!=Float32Array){for(var T=e.weights,_=new Float32Array(T.length),A=T.constructor==Uint8Array?o:l,h=0,d=T.length;h<d;h+=4)_[h]=T[h]*A,_[h+1]=T[h+1]*A,_[h+2]=T[h+2]*A,_[h+3]=T[h+3]*A;e.weights=_}};const{hexColorToRGBA}=global;if(typeof GL$1>"u")throw"litegl.js must be included to use enableWebGLCanvas";function enableWebGLCanvas(e,t){var r;if(t=t||{},e.is_webgl)r=e.gl;else{t.canvas=e,t.alpha=!0,t.stencil=!0;try{r=GL$1.create(t)}catch{return console.log("This canvas cannot be used as WebGL, maybe WebGL is not supported or this canvas has already a 2D context associated"),r=e.getContext("2d",t),r}}const n=r.getError();if(n!==r.NO_ERROR&&console.error("WebGL error:",n),e.canvas2DtoWebGL_enabled)return r;var a=50,s=1e4,o=1e3;e.canvas2DtoWebGL_enabled=!0;var l=null,c=e.ctx=r;c.WebGLCanvas={},fromValues$2(1,1,1,1);var u=0,h=new Float32Array(s*3),d=new GL$1.Mesh,f=d.createVertexBuffer("vertices",null,null,h,r.STREAM_DRAW),p=GL$1.Mesh.getScreenQuad(),g=GL$1.Mesh.circle({size:1}),b=create$4(),m=t.anisotropic!==void 0?t.anisotropic:2,E={u_texture:0},L={};t.allow3D&&(L.EXTRA_PROJECTION="");var T=r.WebGLCanvas.textures_atlas={};r.WebGLCanvas.clearAtlas=function(){T=r.WebGLCanvas.textures_atlas={}};var _=null,A=null,M=null,S=null,N=null,I=null,P=null,R=null,C=null,k=null;r.WebGLCanvas.set3DMatrix=function(G){G?b.set(G):identity$1(b),L.EXTRA_PROJECTION==null&&(L.EXTRA_PROJECTION="",D(),E.u_projection=b),E.u_projection_enabled=!!G},D();function D(){_=`
				precision highp float;
				attribute vec3 a_vertex;
				uniform vec2 u_viewport;
				uniform mat3 u_transform;
				#ifdef EXTRA_PROJECTION
					uniform bool u_projection_enabled;
					uniform mat4 u_projection;
				#endif
				varying float v_visible;
				void main() { 
					vec3 pos = a_vertex;
					v_visible = pos.z;
					pos = u_transform * vec3(pos.xy,1.0);
					pos.z = 0.0;
					#ifdef EXTRA_PROJECTION
						if(u_projection_enabled)
						{
							gl_Position = u_projection * vec4(pos.xy,0.0,1.0);
							return;
						}
					#endif
					//normalize
					pos.x = (2.0 * pos.x / u_viewport.x) - 1.0;
					pos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);
					gl_Position = vec4(pos, 1.0); 
				}
				`,A=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute vec2 a_coord;
			varying vec2 v_coord;
			uniform vec2 u_position;
			uniform vec2 u_size;
			uniform vec2 u_viewport;
			uniform mat3 u_transform;
			#ifdef EXTRA_PROJECTION
				uniform bool u_projection_enabled;
				uniform mat4 u_projection;
			#endif
			void main() { 
				vec3 pos = vec3(u_position + vec2(a_coord.x,1.0 - a_coord.y)  * u_size, 1.0);
				v_coord = a_coord; 
				pos = u_transform * pos;
				pos.z = 0.0;
				#ifdef EXTRA_PROJECTION
					if(u_projection_enabled)
					{
						gl_Position = u_projection * vec4(pos.xy,0.0,1.0);
						return;
					}
				#endif
				//normalize
				pos.x = (2.0 * pos.x / u_viewport.x) - 1.0;
				pos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);
				gl_Position = vec4(pos, 1.0); 
			}
		`,M=new GL$1.Shader(A,`
				precision highp float;
				uniform vec4 u_color;
				void main() {
					gl_FragColor = u_color;
				}
			`,L),S=new GL$1.Shader(A,`
				precision highp float;
				varying vec2 v_coord;
				uniform vec4 u_color;
				uniform sampler2D u_texture;
				void main() {
					gl_FragColor = u_color * texture2D( u_texture, v_coord );
				}
			`,L),N=new GL$1.Shader(A,`
				precision highp float;
				varying vec2 v_coord;
				uniform vec4 u_color;
				uniform sampler2D u_texture;
				void main() {
					vec4 color = u_color * texture2D( u_texture, v_coord );
					if(color.a <= 0.0)
						discard;
					gl_FragColor = color;
				}
			`,L),I=new GL$1.Shader(_,`
				precision highp float;
				varying float v_visible;
				uniform vec4 u_color;
				void main() {
					if (v_visible == 0.0)
						discard;
					gl_FragColor = u_color;
				}
			`,L),P=new GL$1.Shader(GL$1.Shader.QUAD_VERTEX_SHADER,`
				precision highp float;
				uniform sampler2D u_texture;
				uniform vec4 u_color;
				uniform vec4 u_texture_transform;
				varying vec2 v_coord;
				void main() {
					vec2 uv = v_coord * u_texture_transform.zw + vec2(u_texture_transform.x,0.0);
					uv.y = uv.y - u_texture_transform.y + (1.0 - u_texture_transform.w);
					uv = clamp(uv,vec2(0.0),vec2(1.0));
					gl_FragColor = u_color * texture2D(u_texture, uv);
				}
			`,L),R=new GL$1.Shader(_,`
				precision highp float;
				varying float v_visible;
				uniform vec4 u_color;
				uniform sampler2D u_texture;
				uniform vec4 u_texture_transform;
				uniform vec2 u_viewport;
				uniform mat3 u_itransform;
				void main() {
					vec2 pos = (u_itransform * vec3( gl_FragCoord.s, u_viewport.y - gl_FragCoord.t,1.0)).xy;
					pos *= vec2( (u_viewport.x * u_texture_transform.z), (u_viewport.y * u_texture_transform.w) );
					vec2 uv = fract(pos / u_viewport) + u_texture_transform.xy;
					uv.y = 1.0 - uv.y;
					gl_FragColor = u_color * texture2D( u_texture, uv);
				}
			`,L),C=new GL$1.Shader(_,`
				precision highp float;
				varying float v_visible;
				uniform vec4 u_color;
				uniform sampler2D u_texture;
				uniform vec4 u_gradient;
				uniform vec2 u_viewport;
				uniform mat3 u_itransform;
				void main() {
					vec2 pos = (u_itransform * vec3( gl_FragCoord.s, u_viewport.y - gl_FragCoord.t,1.0)).xy;
					//vec2 pos = vec2( gl_FragCoord.s, u_viewport.y - gl_FragCoord.t);
					vec2 AP = pos - u_gradient.xy;
					vec2 AB = u_gradient.zw - u_gradient.xy;
					float dotAPAB = dot(AP,AB);
					float dotABAB = dot(AB,AB);
					float x = dotAPAB / dotABAB;
					vec2 uv = vec2( x, 0.0 );
					gl_FragColor = u_color * texture2D( u_texture, uv );
				}
			`,L);var G=`
			precision highp float;
			attribute vec3 a_vertex;
			attribute vec2 a_coord;
			varying vec2 v_coord;
			uniform vec2 u_viewport;
			uniform mat3 u_transform;
			#ifdef EXTRA_PROJECTION
				uniform bool u_projection_enabled;
				uniform mat4 u_projection;
			#endif
			uniform float u_pointSize;
			void main() { 
				vec3 pos = a_vertex;
				pos = u_transform * pos;
				pos.z = 0.0;
				#ifdef EXTRA_PROJECTION
					if(u_projection_enabled)
					{
						gl_Position = u_projection * vec4(pos.xy,0.0,1.0);
						return;
					}
				#endif
				//normalize
				pos.x = (2.0 * pos.x / u_viewport.x) - 1.0;
				pos.y = -((2.0 * pos.y / u_viewport.y) - 1.0);
				gl_Position = vec4(pos, 1.0); 
				gl_PointSize = ceil(u_pointSize);
				v_coord = a_coord;
			}
			`,F=`
			precision highp float;
			uniform sampler2D u_texture;
			uniform float u_iCharSize;
			uniform vec4 u_color;
			uniform float u_pointSize;
			uniform vec2 u_viewport;
			uniform vec2 u_angle_sincos;
			varying vec2 v_coord;
			void main() {
				vec2 uv = vec2(1.0 - gl_PointCoord.s, gl_PointCoord.t);
				uv = vec2( ((uv.y - 0.5) * u_angle_sincos.y - (uv.x - 0.5) * u_angle_sincos.x) + 0.5, ((uv.x - 0.5) * u_angle_sincos.y + (uv.y - 0.5) * u_angle_sincos.x) + 0.5);
				uv = v_coord - uv * u_iCharSize + vec2(u_iCharSize*0.5);
				uv.y = 1.0 - uv.y;
				gl_FragColor = vec4(u_color.xyz, u_color.a * texture2D(u_texture, uv, -1.0  ).a);
      }
			`;k=new GL$1.Shader(G,F,L)}c.createImageShader=function(G){return new GL$1.Shader(GL$1.Shader.QUAD_VERTEX_SHADER,`
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec4 u_color;
			uniform vec4 u_texture_transform;
			uniform vec2 u_viewport;
			varying vec2 v_coord;
			void main() {
				vec2 uv = v_coord * u_texture_transform.zw + vec2(u_texture_transform.x,0.0);
				uv.y = uv.y - u_texture_transform.y + (1.0 - u_texture_transform.w);
				uv = clamp(uv,vec2(0.0),vec2(1.0));
				vec4 color = u_color * texture2D(u_texture, uv);
				`+G+`;
				gl_FragColor = color;
			}
		`,L)},c.WebGLCanvas.vertex_shader=_,c._matrix=create$5();var U=create$5(),z=create(),X=create$2(),W=create$2(),Y=create();c._stack=[],c._stack_size=0;var H=0,J=c.viewport_data.subarray(2,4);c.translate=function(G,F){z[0]=G,z[1]=F,translate$1(this._matrix,this._matrix,z)},c.rotate=function(G){rotate$2(this._matrix,this._matrix,G),H+=G},c.scale=function(G,F){z[0]=G,z[1]=F,scale$5(this._matrix,this._matrix,z)},c.resetTransform=function(){r._stack_size=0,this._matrix.set([1,0,0,0,1,0,0,0,1]),H=0},c.save=function(){if(!(this._stack_size>=32)){var G=null;this._stack_size==this._stack.length?G=this._stack[this._stack_size]={matrix:create$5(),fillColor:create$2(),strokeColor:create$2(),shadowColor:create$2(),globalAlpha:1,font:"",fontFamily:"",fontSize:14,fontMode:"",textAlign:"",clip_level:0}:G=this._stack[this._stack_size],this._stack_size++,G.matrix.set(this._matrix),G.fillColor.set(this._fillcolor),G.strokeColor.set(this._strokecolor),G.shadowColor.set(this._shadowcolor),G.globalAlpha=this._globalAlpha,G.font=this._font,G.fontFamily=this._font_family,G.fontSize=this._font_size,G.fontMode=this._font_mode,G.textAlign=this.textAlign,G.clip_level=this.clip_level}},c.restore=function(){if(this._stack_size==0){identity$2(this._matrix),H=0;return}this._stack_size--;var G=this._stack[this._stack_size];this._matrix.set(G.matrix),this._fillcolor.set(G.fillColor),this._strokecolor.set(G.strokeColor),this._shadowcolor.set(G.shadowColor),this._globalAlpha=G.globalAlpha,this._font=G.font,this._font_family=G.fontFamily,this._font_size=parseInt(G.fontSize),this._font_mode=G.fontMode,this.textAlign=G.textAlign;var F=this.clip_level;this.clip_level=G.clip_level,H=Math.atan2(this._matrix[3],this._matrix[4]),F==this.clip_level||(this.clip_level==0?(r.enable(r.STENCIL_TEST),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.disable(r.STENCIL_TEST)):(r.stencilFunc(r.LEQUAL,this.clip_level,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)))},c.clip=function(){this.clip_level==0,this.clip_level++,r.colorMask(!1,!1,!1,!1),r.depthMask(!1),r.enable(r.STENCIL_TEST),r.stencilFunc(r.EQUAL,this.clip_level-1,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),this.fill(),r.colorMask(!0,!0,!0,!0),r.depthMask(!0),r.stencilFunc(r.EQUAL,this.clip_level,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)},c.clipImage=function(G,F,V,B,q){this.clip_level++,r.colorMask(!1,!1,!1,!1),r.depthMask(!1),r.enable(r.STENCIL_TEST),r.stencilFunc(r.EQUAL,this.clip_level-1,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),this.drawImage(G,F,V,B,q,N),r.colorMask(!0,!0,!0,!0),r.depthMask(!0),r.stencilFunc(r.EQUAL,this.clip_level,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)},c.transform=function(G,F,V,B,q,Q){var K=U;K[0]=G,K[1]=F,K[2]=0,K[3]=V,K[4]=B,K[5]=0,K[6]=q,K[7]=Q,K[8]=1,multiply$5(this._matrix,this._matrix,K),H=Math.atan2(this._matrix[0],this._matrix[1])},c.setTransform=function(G,F,V,B,q,Q){var K=this._matrix;K[0]=G,K[1]=F,K[2]=0,K[3]=V,K[4]=B,K[5]=0,K[6]=q,K[7]=Q,K[8]=1,H=Math.atan2(this._matrix[0],this._matrix[1])};function oe(G){var F=null;if(G.constructor===GL$1.Texture)return G._context_id==r.context_id?G:null;if(G.gl||(G.gl={}),G.src){var V=r.REPEAT;return F=G.gl[r.context_id],F?(G.mustUpdate&&(F.uploadData(G),G.mustUpdate=!1),F):G.gl[r.context_id]=GL$1.Texture.fromImage(G,{magFilter:r.LINEAR,minFilter:r.LINEAR_MIPMAP_LINEAR,wrap:V,ignore_pot:!0,premultipliedAlpha:!0,anisotropic:m})}else return F=G.gl[r.context_id],F?(G.mustUpdate&&(F.uploadData(G),G.mustUpdate=!1),F):G.gl[r.context_id]=GL$1.Texture.fromImage(G,{minFilter:r.LINEAR,magFilter:r.LINEAR,anisotropic:m})}c.drawImage=function(G,F,V,B,q,Q){if(G){var K=G.videoWidth||G.width,ne=G.videoHeight||G.height;if(!(K==0||ne==0)){var j=oe(G);j&&(arguments.length==9?(W.set([F/K,V/ne,B/K,q/ne]),F=arguments[5],V=arguments[6],B=arguments[7],q=arguments[8],Q=P):W.set([0,0,1,1]),z[0]=F,z[1]=V,Y[0]=B===void 0?j.width:B,Y[1]=q===void 0?j.height:q,j.bind(0),j!==G&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,this.imageSmoothingEnabled?r.LINEAR:r.NEAREST),this.tintImages||(X[0]=X[1]=X[2]=1,X[3]=this._globalAlpha),E.u_color=this.tintImages?this._fillcolor:X,E.u_position=z,E.u_size=Y,E.u_transform=this._matrix,E.u_texture_transform=W,E.u_viewport=J,Q=Q||S,Q.uniforms(E).draw(p),b[14]-=.001)}}},c.createPattern=function(G){return oe(G)};function he(G,F,V,B){this.id=c._last_gradient_id++%c._max_gradients,this.points=new Float32Array([G,F,V,B]),this.stops=[],this._must_update=!0}c._last_gradient_id=0,c._max_gradients=16,c._gradients_pool=[],he.prototype.addColorStop=function(G,F){var V=hexColorToRGBA(F),B=new Uint8Array(4);B[0]=Math.clamp(V[0],0,1)*255,B[1]=Math.clamp(V[1],0,1)*255,B[2]=Math.clamp(V[2],0,1)*255,B[3]=Math.clamp(V[3],0,1)*255,this.stops.push([G,B]),this.stops.sort(function(q,Q){return q[0]>Q[0]?1:Q[0]>q[0]?-1:0}),this._must_update=!0},he.prototype.toTexture=function(){if(this._texture||(this.id!=-1&&(this._texture=c._gradients_pool[this.id]),this._texture||(this._texture=new GL$1.Texture(128,1,{format:r.RGBA,magFilter:r.LINEAR,wrap:r.CLAMP_TO_EDGE,minFilter:r.NEAREST}),this.id!=-1&&(c._gradients_pool[this.id]=this._texture))),!this._must_update)return this._texture;if(this._must_update=!1,this.stops.length<1)return this._texture;if(this.stops.length<2)return this._texture.fill(this.stops[0][1]),this._texture;for(var G=0,F=this.stops[G],V=this.stops[G+1],B=new Uint8Array(128*4),q=0;q<128;q+=1){var Q=B.subarray(q*4,q*4+4),K=q/128;if(F[0]>K)if(G==0)Q.set(F[1]);else{if(G+=1,F=this.stops[G],V=this.stops[G+1],!V)break;q-=1}else if(F[0]<=K&&K<V[0]){var ne=(K-F[0])/(V[0]-F[0]);lerp$2(Q,F[1],V[1],ne)}else if(V[0]<=K){if(G+=1,F=this.stops[G],V=this.stops[G+1],!V)break;q-=1}}if(q<128)for(var j=q;j<128;j+=1)B.set(F[1],j*4);return this._texture.uploadData(B),this._texture},c.createLinearGradient=function(G,F,V,B){return new he(G,F,V,B)},c.beginPath=function(){u=0},c.closePath=function(){u<3||(h[u]=h[0],h[u+1]=h[1],h[u+2]=1,u+=3)},c.moveTo=function(G,F){u==0?(h[u]=G,h[u+1]=F,h[u+2]=1,u+=3):(h[u]=h[u-3],h[u+1]=h[u-2],h[u+2]=0,u+=3,h[u]=G,h[u+1]=F,h[u+2]=0,u+=3)},c.lineTo=function(G,F){h[u]=G,h[u+1]=F,h[u+2]=1,u+=3},c.bezierCurveTo=function(G,F,V,B,q,Q){if(!(u<3))for(var K=[h[u-3],h[u-2]],ne=[K,[G,F],[V,B],[q,Q]],j=0;j<=a;j++){var Z=j/a,te,ee,ae,se,le,ve,Ee,Le;ae=3*(ne[1][0]-ne[0][0]),ee=3*(ne[2][0]-ne[1][0])-ae,te=ne[3][0]-ne[0][0]-ae-ee,ve=3*(ne[1][1]-ne[0][1]),le=3*(ne[2][1]-ne[1][1])-ve,se=ne[3][1]-ne[0][1]-ve-le,Ee=Z*Z,Le=Ee*Z;var Ge=te*Le+ee*Ee+ae*Z+ne[0][0],Ae=se*Le+le*Ee+ve*Z+ne[0][1];h[u]=Ge,h[u+1]=Ae,h[u+2]=1,u+=3}},c.quadraticCurveTo=function(G,F,V,B){if(!(u<3))for(var q=h[u-3],Q=h[u-2],K=0;K<=a;K++){var ne=K/a,j=1-ne,Z=q*j+G*ne,te=Q*j+F*ne,ee=G*j+V*ne,ae=F*j+B*ne;h[u]=Z*j+ee*ne,h[u+1]=te*j+ae*ne,h[u+2]=1,u+=3}},c.fill=function(){if(!(u<9)){f.uploadRange(0,u*4),E.u_viewport=J;var G=I;this._shadowcolor[3]>0&&(E.u_color=this._shadowcolor,this.save(),this.translate(this.shadowOffsetX,this.shadowOffsetY),G.uniforms(E).drawRange(d,r.TRIANGLE_FAN,0,u/3),this.restore()),E.u_color=this._fillcolor,E.u_transform=this._matrix;var F=this._fillStyle;if(F.constructor===he){var V=F,B=V.toTexture();E.u_color=[1,1,1,this.globalAlpha],E.u_gradient=V.points,E.u_texture=0,E.u_itransform=invert$2(U,this._matrix),B.bind(0),G=C}else if(F.constructor===GL$1.Texture){var B=F;E.u_color=[1,1,1,this._globalAlpha],E.u_texture=0,X.set([0,0,1/B.width,1/B.height]),E.u_texture_transform=X,E.u_itransform=invert$2(U,this._matrix),B.bind(0),G=R}G.uniforms(E).drawRange(d,r.TRIANGLE_FAN,0,u/3),b[14]-=.001}},c.strokeThin=function(){u<6||(f.uploadRange(0,u*4),r.setLineWidth(this.lineWidth),E.u_color=this._strokecolor,E.u_transform=this._matrix,E.u_viewport=J,I.uniforms(E).drawRange(d,r.LINE_STRIP,0,u/3))};var ce=new Float32Array(s*3),ie=new GL$1.Mesh,de=ie.createVertexBuffer("vertices",null,null,ce,r.STREAM_DRAW);c.stroke=function(){if(!(u<6)){if(z[0]=this._matrix[0],z[1]=this._matrix[1],this.lineWidth*length(z)<=1)return this.strokeThin();var G=ce,F=u,V=this.lineWidth*.5,B=h,q=0,Q=0,K=0,ne=0,j=0,Z=0,te=0,ee=0;if(B[0]==B[u-3]&&B[1]==B[u-2]){q=B[u-3]-B[u-6],Q=B[u-2]-B[u-5];var ae=Math.sqrt(q*q+Q*Q);ae!=0&&(q=q/ae,Q=Q/ae)}var se,le=0;for(se=0;se<F-3;se+=3){K=q,ne=Q,q=B[se+3]-B[se],Q=B[se+4]-B[se+1];var ae=Math.sqrt(q*q+Q*Q);ae!=0&&(q=q/ae,Q=Q/ae),se==0&&(te=q,ee=Q),j=q+K,Z=Q+ne;var ae=Math.sqrt(j*j+Z*Z);ae!=0&&(j=j/ae,Z=Z/ae),G[le+0]=B[se]-Z*V,G[le+1]=B[se+1]+j*V,G[le+2]=1,G[le+3]=B[se]+Z*V,G[le+4]=B[se+1]-j*V,G[le+5]=1,le+=6}if(B[0]==B[u-3]&&B[1]==B[u-2]){j=q+te,Z=Q+ee;var ae=Math.sqrt(j*j+Z*Z);ae!=0&&(j=j/ae,Z=Z/ae),G[le+0]=B[se]-Z*V,G[le+1]=B[se+1]+j*V,G[le+2]=1,G[le+3]=B[se]+Z*V,G[le+4]=B[se+1]-j*V,G[le+5]=1}else{var ae=Math.sqrt(q*q+Q*Q);ae!=0&&(j=q/ae,Z=Q/ae),G[le+0]=B[se]-(Z-j)*V,G[le+1]=B[se+1]+(j+Z)*V,G[le+2]=1,G[le+3]=B[se]+(Z+j)*V,G[le+4]=B[se+1]-(j-Z)*V,G[le+5]=1}le+=6,de.upload(r.STREAM_DRAW),de.uploadRange(0,le*4),E.u_transform=this._matrix,E.u_viewport=J,this._shadowcolor[3]>0&&(E.u_color=this._shadowcolor,this.save(),this.translate(this.shadowOffsetX,this.shadowOffsetY),I.uniforms(E).drawRange(d,r.TRIANGLE_STRIP,0,le/3),this.restore()),E.u_color=this._strokecolor,I.uniforms(E).drawRange(ie,r.TRIANGLE_STRIP,0,le/3),b[14]-=.001}},c.rect=function(G,F,V,B){h[u]=G,h[u+1]=F,h[u+2]=1,h[u+3]=G+V,h[u+4]=F,h[u+5]=1,h[u+6]=G+V,h[u+7]=F+B,h[u+8]=1,h[u+9]=G,h[u+10]=F+B,h[u+11]=1,h[u+12]=G,h[u+13]=F,h[u+14]=1,u+=15},c.roundRect=function(G,F,V,B,q,Q){var K=0,ne=0,j=0,Z=0;if(q===0){this.rect(G,F,V,B);return}if(Q===void 0&&(Q=q),q!=null&&q.constructor===Array)if(q.length==1)K=ne=j=Z=q[0];else if(q.length==2)K=Z=q[0],ne=j=q[1];else if(q.length==4)K=q[0],ne=q[1],j=q[2],Z=q[3];else return;else K=q||0,ne=q||0,j=Q||0,Z=Q||0;var te=h,ee=u;if(K>0)for(var ae=0;ae<10;++ae){var se=ae/10*Math.PI*.5;te[ee]=G+K*(1-Math.cos(se)),te[ee+1]=F+K*(1-Math.sin(se)),te[ee+2]=1,ee+=3}if(te[ee+0]=G+K,te[ee+1]=F,te[ee+2]=1,te[ee+3]=G+V-ne,te[ee+4]=F,te[ee+5]=1,ee+=6,ne>0)for(var ae=0;ae<10;++ae){var se=ae/10*Math.PI*.5;te[ee+0]=G+V-ne*(1-Math.sin(se)),te[ee+1]=F+ne*(1-Math.cos(se)),te[ee+2]=1,ee+=3}if(te[ee+0]=G+V,te[ee+1]=F+ne,te[ee+2]=1,te[ee+3]=G+V,te[ee+4]=F+B-Z,te[ee+5]=1,ee+=6,Z>0)for(var ae=0;ae<10;++ae){var se=ae/10*Math.PI*.5;te[ee+0]=G+V-Z*(1-Math.cos(se)),te[ee+1]=F+B-Z*(1-Math.sin(se)),te[ee+2]=1,ee+=3}if(te[ee+0]=G+V-Z,te[ee+1]=F+B,te[ee+2]=1,te[ee+3]=G+j,te[ee+4]=F+B,te[ee+5]=1,ee+=6,j>0)for(var ae=0;ae<10;++ae){var se=ae/10*Math.PI*.5;te[ee+0]=G+j*(1-Math.sin(se)),te[ee+1]=F+B-j*(1-Math.cos(se)),te[ee+2]=1,ee+=3}te[ee+0]=G,te[ee+1]=F+K,te[ee+2]=1,u=ee+3},c.arc=function(G,F,V,B,q){var Q=Math.max(Math.abs(this._matrix[0]),Math.abs(this._matrix[1]),Math.abs(this._matrix[3]),Math.abs(this._matrix[4])),K=Math.ceil(V*2*Q+1);if(!(K<1)){K=Math.min(K,1024),B=B===void 0?0:B,q=q===void 0?Math.PI*2:q;for(var ne=(q-B)/K,j=0;j<=K;j++){var Z=B+j*ne;this.lineTo(G+Math.cos(Z)*V,F+Math.sin(Z)*V)}}},c.strokeRect=function(G,F,V,B){this.beginPath(),this.rect(G,F,V,B),this.stroke()},c.fillRect=function(G,F,V,B){if(u=0,this._fillStyle.constructor==GL$1.Texture||this._fillStyle.constructor===he){this.beginPath(),this.rect(G,F,V,B),this.fill();return}E.u_color=this._fillcolor,z[0]=G,z[1]=F,Y[0]=V,Y[1]=B,E.u_position=z,E.u_size=Y,E.u_transform=this._matrix,E.u_viewport=J,M.uniforms(E).draw(p),b[14]-=.001},c.clearRect=function(G,F,V,B){(G!=0||F!=0||V!=e.width||B!=e.height)&&(r.enable(r.SCISSOR_TEST),r.scissor(G,F,V,B)),r.clear(r.COLOR_BUFFER_BIT);var q=r.viewport_data;r.scissor(q[0],q[1],q[2],q[3]),r.disable(r.SCISSOR_TEST)},c.fillCircle=function(G,F,V){if(u=0,this._fillStyle.constructor==GL$1.Texture||this._fillStyle.constructor===he){this.beginPath(),this.arc(G,F,V,0,Math.PI*2),this.fill();return}E.u_color=this._fillcolor,z[0]=G,z[1]=F,Y[0]=V,Y[1]=V,E.u_position=z,E.u_size=Y,E.u_transform=this._matrix,E.u_viewport=J,M.uniforms(E).draw(g),b[14]-=.001},c.start2D=function(){l=window.gl,window.gl=this;var G=this;G.disable(G.CULL_FACE),G.disable(G.DEPTH_TEST),G.disable(G.STENCIL_TEST),G.enable(G.BLEND),G.blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),G.blendEquation(G.FUNC_ADD),G.lineWidth=1,u=0,identity$1(b),this.clip_level=0},c.finish2D=function(){u=0,r.lineWidth=1,window.gl=l,r.disable(r.STENCIL_TEST)};var fe=new Float32Array(o*3),ge=new Float32Array(o*2),Te=new GL$1.Mesh,Ie=Te.createVertexBuffer("vertices",null,null,fe,r.STREAM_DRAW),pe=Te.createVertexBuffer("coords",null,null,ge,r.STREAM_DRAW);c.fillText=c.strokeText=function(G,F,V){if(G==null)return;G.constructor!==String&&(G=String(G));let B=0;const{textures:q,info:Q}=ue.call(this,this._font_family,this._font_mode),K=fe,ne=ge;let j=this._font_size*1.1;j<1&&(j=1);let Z=0,te=0;const ee=G.length,ae=Q.spacing,se=Q.kernings;let le=!0,ve=0,Ee=0,Le=-1;function Ge(){if(ve===0||Ee===0||Le===-1)return;Ie.uploadRange(0,ve*4),pe.uploadRange(0,Ee*4),E.u_color=this._fillcolor,E.u_pointSize=j*length(this._matrix),E.u_iCharSize=Q.char_size/B,E.u_transform=this._matrix,E.u_viewport=J,E.u_angle_sincos||(E.u_angle_sincos=create());const re=H;H=0,E.u_angle_sincos[1]=Math.sin(-H),E.u_angle_sincos[0]=-Math.cos(-H),H=re,k.uniforms(E).drawRange(Te,r.POINTS,0,ve/3),ve=0,Ee=0}for(let re=0;re<ee;re++){const xe=G.charCodeAt(re),_e=Q.pages[xe];if(!_e){xe===10?(Z=0,te+=j,le=!0):Z+=j*.5;continue}const[Me,Se,we,Fe]=_e;if(we!==Le)if(Ge.call(this),Le=we,q[we])q[we].bind(0),B=q[we].width;else{console.error(`Page ${we} not found in textures.`);continue}const Ne=se[G[re]];le&&(Z-=j*((Ne==null?void 0:Ne.nwidth)||0)*.25,le=!1),K[ve+0]=F+Z+j*.5,K[ve+1]=V+te-j*.25,K[ve+2]=1,ve+=3,ne[Ee+0]=Me,ne[Ee+1]=Se,Ee+=2;const Re=se[G[re+1]]?se[G[re+1]].nwidth:ae/Q.char_size;Z+=j*Re}Ge.call(this);let Ae=0;if(this.textAlign==="right"?Ae=Z+j*.5:this.textAlign==="center"&&(Ae=(Z+j*.5)*.5),Ae)for(let re=0;re<ve;re+=3)K[re]-=Ae;return{x:Z,y:te}},c.measureText=function(G){const{info:F}=ue.call(this,this._font_family,this._font_mode),V=Math.ceil(this._font_size*(F.line_height||1));let B=0;const q=V*(F.spacing/F.char_size);for(let Q=0;Q<G.length;++Q){const K=F.kernings[G[Q]];K?B+=K.nwidth:B+=q}return B*=V,{width:B,height:V}},c.cacheFontAtlas=function(G="monospace",F="normal",V=!1){const B=`:font_${G}:${F}:${enableWebGLCanvas.useInternationalFont}`;if(!V&&T[B])return T[B];const q=ue.call(this,G,F,V);return T[B]=q,q},c.loadCachedTextures=async function(){const G=await getAllData();if(G&&(G==null?void 0:G.length)>0)for(let F in G){const V=G[F];T[V.name]=V}};function ue(G="monospace",F="normal",V=!1){const B=`:font_${G}:${F}:${enableWebGLCanvas.useInternationalFont}`;if(!V&&T[B])return T[B];const q=enableWebGLCanvas.useInternationalFont;let Q=1024,K=10,ne=200;q&&(ne=55203,K=20,Q=2048);const j=this.imageSmoothingEnabled,Z=Math.floor(Q/K),te=Math.floor(Z*.95);let ee=.5,ae=te*-.15;const se=[],le={font_size:te,char_size:Z,spacing:Z*.6,space:null,kernings:{},pages:[]},ve=re=>re>=32&&re<=47||re>=58&&re<=64||re>=91&&re<=96||re>=123&&re<=126,Ee=re=>re>=65&&re<=90||re>=97&&re<=122||re>=48&&re<=57||re>=32&&re<=47||re>=58&&re<=64||re>=91&&re<=96||re>=123&&re<=126||re>=44032&&re<=55203||re>=127744&&re<=128767,Le=[];for(let re=32;re<=ne;re++)Ee(re)&&Le.push(re);const Ge=Math.ceil(Le.length/(K*K));for(let re=0;re<Ge;re++){const xe=createCanvas(Q,Q),_e=xe.getContext("2d");_e.fillStyle="white",_e.imageSmoothingEnabled=j,_e.clearRect(0,0,xe.width,xe.height),_e.font=`${F} ${te}px ${G}`,_e.textAlign="center";let Me=0,Se=0;const we=re*K*K,Fe=Math.min(Le.length,we+K*K);for(let Re=we;Re<Fe;Re++){const De=Le[Re],Oe=String.fromCharCode(De);let Ce=_e.measureText(Oe).width;ve(De)&&Ce<50&&(Ce*=1.8),le.kernings[Oe]={width:Ce,nwidth:Ce/te},le.pages[De]=[(Me+Z*.5)/xe.width,(Se+Z*.5)/xe.height,re,Oe],_e.save(),_e.beginPath(),_e.rect(Math.floor(Me)+.5,Math.floor(Se)+.5,Z-2,Z-2),_e.clip(),_e.fillText(Oe,Math.floor(Me+Z*ee),Math.floor(Se+Z+ae),Z),_e.restore(),Me+=Z,Me+Z>xe.width&&(Me=0,Se+=Z)}const Ne=GL$1.Texture.fromImage(xe,{format:r.RGBA,magFilter:r.LINEAR,minFilter:r.LINEAR_MIPMAP_LINEAR,premultiply_alpha:!1,anisotropic:1});se.push(Ne)}le.space=le.kernings[" "]?le.kernings[" "].width/te:0;const Ae={textures:se,info:le,name:B};return T[B]=Ae,saveComplexData(Ae,1),T[B]}c.getImageData=function(G,F,V,B){var q=new Uint8Array(V*B*4);return r.readPixels(G,F,V,B,r.RGBA,r.UNSIGNED_BYTE,q),{data:q,width:V,height:B,resolution:1}},c.putImageData=function(G,F,V){var B=new GL$1.Texture(G.width,G.height,{filter:r.NEAREST,pixel_data:G.data});B.renderQuad(F,V,B.width,B.height)},Object.defineProperty(r,"fillStyle",{get:function(){return this._fillStyle},set:function(G){G&&(this._fillStyle=G,hexColorToRGBA(G,this._fillcolor,this._globalAlpha))}}),Object.defineProperty(r,"strokeStyle",{get:function(){return this._strokeStyle},set:function(G){G&&(this._strokeStyle=G,hexColorToRGBA(G,this._strokecolor,this._globalAlpha))}}),Object.defineProperty(r,"fillColor",{get:function(){return this._fillcolor},set:function(G){G&&(G.length<5?this._fillcolor.set(G):console.error("fillColor value has more than 4 components"))}}),Object.defineProperty(r,"strokeColor",{get:function(){return this._strokecolor},set:function(G){G&&(G.length<5?this._strokecolor.set(G):console.error("strokeColor value has more than 4 components"))}}),Object.defineProperty(r,"shadowColor",{get:function(){return this._shadowcolor},set:function(G){G&&hexColorToRGBA(G,this._shadowcolor,this._globalAlpha)}}),Object.defineProperty(r,"globalAlpha",{get:function(){return this._globalAlpha},set:function(G){this._globalAlpha=G,this._strokecolor[3]=this._fillcolor[3]=G}}),Object.defineProperty(r,"globalCompositeOperation",{get:function(){return this._globalCompositeOperation},set:function(G){switch(this._globalCompositeOperation=G,r.blendEquation(r.FUNC_ADD),G){case"source-over":r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case"difference":r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.blendEquation(r.FUNC_REVERSE_SUBTRACT);break}}}),Object.defineProperty(r,"font",{get:function(){return this._font},set:function(G){this._font=G;var F=G.split(" ");F.length>=3?(this._font_mode=F[0],this._font_size=parseFloat(F[1]),Number.isNaN(this._font_size)&&(this._font_size=14),this._font_size<5&&(this._font_size=5),this._font_family=F[2]):F.length==2?(this._font_mode="normal",this._font_size=parseFloat(F[0]),Number.isNaN(this._font_size)&&(this._font_size=14),this._font_size<5&&(this._font_size=5),this._font_family=F[1]):(this._font_mode="normal",this._font_family=F[0])}}),c._fillcolor=fromValues$2(0,0,0,1),c._strokecolor=fromValues$2(0,0,0,1),c._shadowcolor=fromValues$2(0,0,0,0),c._globalAlpha=1,c._font="14px monospace",c._font_family="monospace",c._font_size="14px",c._font_mode="normal",c.clip_level=0,c.strokeStyle="rgba(0,0,0,1)",c.fillStyle="rgba(0,0,0,1)",c.shadowColor="transparent",c.shadowOffsetX=c.shadowOffsetY=0,c.globalAlpha=1,c.globalCompositeOperation="source-over",c.setLineWidth=c.lineWidth,c.lineWidth=4,c.imageSmoothingEnabled=!0,c.tintImages=!1;var me=["arcTo","isPointInPath","createImageData"],be=function(){};for(var ye in me)c[me[ye]]=be;return c}function openDatabase(){return new Promise((e,t)=>{const r=indexedDB.open("WebglContextDB",2);r.onupgradeneeded=function(n){var s;const a=n.target.result;(s=a.objectStoreNames)!=null&&s.contains("fontTexture")||a.createObjectStore("fontTexture",{keyPath:"name"})},r.onsuccess=function(n){e(n.target.result)},r.onerror=function(n){t(n.target.error)}})}async function makeTexture(e){const t=base64ToBlob(e.data),r=await blobToImage(t),n=GL$1.Texture.fromImage(r);return n.wrapS=e.wrapS||n.gl.CLAMP_TO_EDGE,n.wrapT=e.wrapT||n.gl.CLAMP_TO_EDGE,n.minFilter=e.minFilter||n.gl.LINEAR,n.magFilter=e.magFilter||n.gl.LINEAR,n.format=e.format||n.format,n.internalFormat=e.internalFormat||n.internalFormat,n.type=e.type||n.type,n.texture_type=e.texture_type||n.texture_type,n.width=e.width||n.width,n.height=e.height||n.height,e=n,e}function base64ToBlob(e){const t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);const a=new Uint8Array(n);return new Blob([a],{type:r})}function blobToImage(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>t(n),n.onerror=r,n.src=URL.createObjectURL(e)})}function textureToBase64(e){const t=e.gl,r=e.handler,n=e.width,a=e.height,s=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.error("Framebuffer is not complete."),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(s),null;const o=new Uint8Array(n*a*4),l=e.format||t.RGBA,c=e.type||t.UNSIGNED_BYTE;try{t.readPixels(0,0,n,a,l,c,o)}catch(p){return console.error("Error reading pixels from framebuffer:",p),null}const u=document.createElement("canvas");u.width=n,u.height=a;const h=u.getContext("2d"),d=h.createImageData(n,a);for(let p=0;p<a;p++){const g=p*n*4,b=(a-p-1)*n*4;d.data.set(o.subarray(g,g+n*4),b)}h.putImageData(d,0,0);const f=u.toDataURL("image/png");return t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(s),f}async function saveComplexData(e,t=1){var r;try{const s=(await openDatabase()).transaction("fontTexture","readwrite").objectStore("fontTexture"),l=(r=e.textures)==null?void 0:r.map(d=>{const{width:f,height:p,format:g,internalFormat:b,type:m,wrapS:E,wrapT:L,minFilter:T,magFilter:_,has_mipmaps:A,texture_type:M}=d,S=textureToBase64(d);return{width:f,height:p,format:g,internalFormat:b,type:m,wrapS:E,wrapT:L,minFilter:T,magFilter:_,has_mipmaps:A,texture_type:M,data:S}}),c=new Date;c.setDate(c.getDate()+t);const u={info:e.info,textures:l,name:e.name,expiresAt:c.toISOString()},h=s.put(u);h.onsuccess=function(){},h.onerror=function(d){console.error("Error saving data:",d)}}catch(n){console.error("Error in saveComplexData:",n)}}async function getAllData(){const e=await openDatabase();return new Promise((t,r)=>{const a=e.transaction("fontTexture","readwrite").objectStore("fontTexture"),s=a.getAll();s.onsuccess=async function(o){const c=o.target.result.filter(u=>{const h=new Date,d=new Date(u.expiresAt);return h<d?!0:(a.delete(u.name),!1)});if((c==null?void 0:c.length)===0){t([]);return}for(const u of c)u.textures=await Promise.all(u.textures.map(async h=>makeTexture(h)));t(c)},s.onerror=function(o){console.error("Error retrieving data:",o.target.error),r(o.target.error)}})}enableWebGLCanvas.useInternationalFont=!0,enableWebGLCanvas.fontOffsetY=0;const O=class O{constructor(){}static distance(t,r){return Math.sqrt((r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]))}static isInsideRectangle(t,r,n,a,s,o){return n<t&&n+s>t&&a<r&&a+o>r}static closeAllContextMenus(t){t=t||window;let r=t.document.querySelectorAll(".litecontextmenu");if(!r.length)return;let n=[];for(let a=0;a<r.length;a++)n.push(r[a]);for(let a=0;a<n.length;a++)n[a].close?n[a].close():n[a].parentNode&&n[a].parentNode.removeChild(n[a])}static extendClass(t,r){var n,a,s,o;for(const l in r)Object.prototype.hasOwnProperty.call(t,l)||(t[l]=r[l]);if(r.prototype)for(const l in r.prototype){if(!Object.prototype.hasOwnProperty.call(r.prototype,l)||Object.prototype.hasOwnProperty.call(t.prototype,l))continue;const c=(a=(n=r.prototype).__lookupGetter__)==null?void 0:a.call(n,l),u=(o=(s=r.prototype).__lookupSetter__)==null?void 0:o.call(s,l);c?t.prototype.__defineGetter__(l,c):t.prototype[l]=r.prototype[l],u&&t.prototype.__defineSetter__(l,u)}}static getParameterNames(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)}static pointerListenerAdd(t,r,n,a=!1){if(!t||!t.addEventListener||!r||typeof n!="function")return;let s=O.pointerevents_method,o=r;if(s==="pointer"&&!window.PointerEvent){console.warn("PointerEvent not supported. Converting to touch event.");const c={down:"start",move:"move",up:"end",cancel:"cancel"};c[o]?(s="touch",o=c[o]):o==="enter"?console.log("debug: Should I send a move event?"):console.warn(`Event ${o} will not be called`)}if(["down","up","move","over","out","enter","leave","cancel","gotpointercapture","lostpointercapture"].includes(o)&&(s!=="mouse"||["down","up","move","over","out","enter"].includes(o))){t.addEventListener(s+o,n,a);return}t.addEventListener(o,n,a)}static pointerListenerRemove(t,r,n,a=!1){if(!t||!t.removeEventListener||!r||typeof n!="function")return;const s=O.pointerevents_method,o=["down","up","move","over","out","enter"],l=["leave","cancel","gotpointercapture","lostpointercapture"];if(o.includes(r)&&(s==="pointer"||s==="mouse")){t.removeEventListener(s+r,n,a);return}if(l.includes(r)&&s==="pointer"){t.removeEventListener(s+r,n,a);return}t.removeEventListener(r,n,a)}static overlapBounding(t,r){let n=t[0]+t[2],a=t[1]+t[3],s=r[0]+r[2],o=r[1]+r[3];return!(t[0]>s||t[1]>o||n<r[0]||a<r[1])}static registerNodeType(t,r){if(!r.prototype)throw"Cannot register a simple object, it must be a class with a prototype";r.type=t,O.debug&&console.log("Node registered: "+t);const n=r.name,a=t.lastIndexOf("/");r.category=t.substring(0,a),r.title||(r.title=n);for(let o in LGraphNode.prototype)r.prototype[o]||(r.prototype[o]=LGraphNode.prototype[o]);const s=O.registered_node_types[t];if(s&&console.log("replacing node type: "+t),!Object.prototype.hasOwnProperty.call(r.prototype,"shape")&&(Object.defineProperty(r.prototype,"shape",{set:function(o){switch(o){case"default":delete this._shape;break;case"box":this._shape=O.BOX_SHAPE;break;case"round":this._shape=O.ROUND_SHAPE;break;case"circle":this._shape=O.CIRCLE_SHAPE;break;case"card":this._shape=O.CARD_SHAPE;break;default:this._shape=o}},get:function(){return this._shape},enumerable:!0,configurable:!0}),r.supported_extensions))for(let o in r.supported_extensions){const l=r.supported_extensions[o];l&&l.constructor===String&&(this.node_types_by_file_extension[l.toLowerCase()]=r)}O.registered_node_types[t]=r,r.constructor.name&&(this.Nodes[n]=r),O.onNodeTypeRegistered&&O.onNodeTypeRegistered(t,r),s&&O.onNodeTypeReplaced&&O.onNodeTypeReplaced(t,r,s),r.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new r(r.title||"tmpnode")}static unregisterNodeType(t){const r=t.constructor===String?O.registered_node_types[t]:t;if(!r)throw"node type not found: "+t;delete O.registered_node_types[r.type],r.constructor.name&&delete this.Nodes[r.constructor.name]}static registerNodeAndSlotType(t,r,n){n=n||!1;const s=(t.constructor===String&&O.registered_node_types[t]!=="anonymous"?O.registered_node_types[t]:t).constructor.type;let o=[];typeof r=="string"?o=r.split(","):r==this.EVENT||r==this.ACTION?o=["_event_"]:o=["*"];for(let l=0;l<o.length;++l){let c=o[l];c===""&&(c="*");const u=n?"registered_slot_out_types":"registered_slot_in_types";this[u][c]===void 0&&(this[u][c]={nodes:[]}),this[u][c].nodes.includes(s)||this[u][c].nodes.push(s),n?this.slot_types_out.includes(c.toLowerCase())||(this.slot_types_out.push(c.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(c.toLowerCase())||(this.slot_types_in.push(c.toLowerCase()),this.slot_types_in.sort())}}static buildNodeClassFromObject(t,r){let n="";if(r.inputs)for(let s=0;s<r.inputs.length;++s){let o=r.inputs[s][0],l=r.inputs[s][1];l&&l.constructor===String&&(l='"'+l+'"'),n+="this.addInput('"+o+"',"+l+`);
`}if(r.outputs)for(let s=0;s<r.outputs.length;++s){let o=r.outputs[s][0],l=r.outputs[s][1];l&&l.constructor===String&&(l='"'+l+'"'),n+="this.addOutput('"+o+"',"+l+`);
`}if(r.properties)for(let s in r.properties){let o=r.properties[s];o&&o.constructor===String&&(o='"'+o+'"'),n+="this.addProperty('"+s+"',"+o+`);
`}n+="if(this.onCreate)this.onCreate()";let a=Function(n);for(let s in r)s!="inputs"&&s!="outputs"&&s!="properties"&&(a.prototype[s]=r[s]);return a.title=r.title||t.split("/").pop(),a.desc=r.desc||"Generated from object",O.registerNodeType(t,a),a}static wrapFunctionAsNode(t,r,n,a,s){let o=Array(r.length),l="";if(n!==null){let u=O.getParameterNames(r);for(let h=0;h<u.length;++h){let d=0;n&&(n[h]!=null&&n[h].constructor===String?d="'"+n[h]+"'":n[h]!=null&&(d=n[h])),l+="this.addInput('"+u[h]+"',"+d+`);
`}}a!==null&&(l+="this.addOutput('out',"+(a!=null?a.constructor===String?"'"+a+"'":a:0)+`);
`),s&&(l+="this.properties = "+JSON.stringify(s)+`;
`);let c=Function(l);return c.title=t.split("/").pop(),c.desc="Generated from "+r.name,c.prototype.onExecute=function(){for(let d=0;d<o.length;++d)o[d]=this.getInputData(d);let h=r.apply(this,o);this.setOutputData(0,h)},this.registerNodeType(t,c),c}static clearRegisteredTypes(){O.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}static addNodeMethod(t,r){LGraphNode.prototype[t]=r;for(let n in O.registered_node_types){let a=O.registered_node_types[n];a.prototype[t]&&(a.prototype["_"+t]=a.prototype[t]),a.prototype[t]=r}}static createNode(t,r,n){let a=O.registered_node_types[t];if(!a)return O.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;a.prototype,r=r||a.title||t;let s=null;if(O.catch_exceptions)try{s=new a(r)}catch(o){return console.error(o),null}else s=new a(r);if(s.type=t,!s.title&&r&&(s.title=r),s.properties||(s.properties={}),s.properties_info||(s.properties_info=[]),s.flags||(s.flags={}),s.size||(s.size=s.computeSize()),s.pos||(s.pos=O.DEFAULT_POSITION.concat()),s.mode||(s.mode=O.ALWAYS),n)for(let o in n)s[o]=n[o];return s.onNodeCreated&&s.onNodeCreated(),s}static getNodeType(t){return O.registered_node_types[t]}static getNodeTypesInCategory(t,r){let n=[];for(let a in O.registered_node_types){let s=O.registered_node_types[a];s.filter==r&&(t==""?s.category==null&&n.push(s):s.category==t&&n.push(s))}return this.auto_sort_node_types&&n.sort(function(a,s){return a.title.localeCompare(s.title)}),n}static getNodeTypesCategories(t){let r={"":1};for(let a in O.registered_node_types){let s=O.registered_node_types[a];if(s.category&&!s.skip_list){if(s.filter!=t)continue;r[s.category]=1}}let n=[];for(let a in r)n.push(a);return this.auto_sort_node_types?n.sort():n}static reloadNodes(t){let r=document.getElementsByTagName("script"),n=[];for(let s=0;s<r.length;s++)n.push(r[s]);let a=document.getElementsByTagName("head")[0];t=document.location.href+t;for(let s=0;s<n.length;s++){let o=n[s].src;if(!(!o||o.substr(0,t.length)!=t))try{O.debug&&console.log("Reloading: "+o);let l=document.createElement("script");l.type="text/javascript",l.src=o,a.appendChild(l),a.removeChild(n[s])}catch(l){if(O.throw_errors)throw l;O.debug&&console.log("Error while reloading "+o)}}O.debug&&console.log("Nodes reloaded")}static cloneObject(t,r){if(t==null)return null;let n=JSON.parse(JSON.stringify(t));if(!r)return n;for(let a in n)r[a]=n[a];return r}static uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^Math.random()*16>>t/4).toString(16))}static isValidConnection(t,r){if((t==""||t==="*")&&(t=0),(r==""||r==="*")&&(r=0),!t||!r||t==r||t==O.EVENT&&r==O.ACTION)return!0;if(t=String(t),r=String(r),t=t.toLowerCase(),r=r.toLowerCase(),t.indexOf(",")==-1&&r.indexOf(",")==-1)return t==r;let n=t.split(","),a=r.split(",");for(let s=0;s<n.length;++s)for(let o=0;o<a.length;++o)if(this.isValidConnection(n[s],a[o]))return!0;return!1}static registerSearchboxExtra(t,r,n){this.searchbox_extras[r.toLowerCase()]={type:t,desc:r,data:n}}static fetchFile(t,r,n,a){if(!t)return null;if(r=r||"text",t.constructor===String)return t.substr(0,4)=="http"&&O.proxy&&(t=O.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(s){if(!s.ok)throw new Error("File not found");if(r=="arraybuffer")return s.arrayBuffer();if(r=="text"||r=="string")return s.text();if(r=="json")return s.json();if(r=="blob")return s.blob()}).then(function(s){n&&n(s)}).catch(function(s){console.error("error fetching file:",t),a&&a(s)});if(t.constructor===File||t.constructor===Blob){let s=new FileReader;if(s.onload=function(o){let l=o.target.result;r=="json"&&(l=JSON.parse(l)),n&&n(l)},r=="arraybuffer")return s.readAsArrayBuffer(t);if(r=="text"||r=="json")return s.readAsText(t);if(r=="blob")return s.readAsBinaryString(t)}return null}};$(O,"VERSION",.4),$(O,"CANVAS_GRID_SIZE",10),$(O,"NODE_TITLE_HEIGHT",30),$(O,"NODE_TITLE_TEXT_Y",20),$(O,"NODE_SLOT_HEIGHT",20),$(O,"NODE_WIDGET_HEIGHT",20),$(O,"NODE_WIDTH",140),$(O,"NODE_MIN_WIDTH",50),$(O,"NODE_COLLAPSED_RADIUS",10),$(O,"NODE_COLLAPSED_WIDTH",80),$(O,"NODE_TITLE_COLOR","#999"),$(O,"NODE_SELECTED_TITLE_COLOR","#FFF"),$(O,"NODE_TEXT_SIZE",14),$(O,"NODE_TEXT_COLOR","#AAA"),$(O,"NODE_SUBTEXT_SIZE",12),$(O,"NODE_DEFAULT_COLOR","#333"),$(O,"NODE_DEFAULT_BGCOLOR","#353535"),$(O,"NODE_DEFAULT_BOXCOLOR","#666"),$(O,"NODE_DEFAULT_SHAPE","box"),$(O,"NODE_BOX_OUTLINE_COLOR","#FFF"),$(O,"DEFAULT_SHADOW_COLOR","rgba(0,0,0,0.5)"),$(O,"DEFAULT_GROUP_FONT",24),$(O,"WIDGET_BGCOLOR","#222"),$(O,"WIDGET_OUTLINE_COLOR","#666"),$(O,"WIDGET_TEXT_COLOR","#DDD"),$(O,"WIDGET_SECONDARY_TEXT_COLOR","#999"),$(O,"LINK_COLOR","#9A9"),$(O,"EVENT_LINK_COLOR","#A86"),$(O,"CONNECTING_LINK_COLOR","#AFA"),$(O,"MAX_NUMBER_OF_NODES",1e3),$(O,"DEFAULT_POSITION",[100,100]),$(O,"VALID_SHAPES",["default","box","round","card"]),$(O,"BOX_SHAPE",1),$(O,"ROUND_SHAPE",2),$(O,"CIRCLE_SHAPE",3),$(O,"CARD_SHAPE",4),$(O,"ARROW_SHAPE",5),$(O,"GRID_SHAPE",6),$(O,"INPUT",1),$(O,"OUTPUT",2),$(O,"EVENT",-1),$(O,"ACTION",-1),$(O,"NODE_MODES",["Always","On Event","Never","On Trigger"]),$(O,"NODE_MODES_COLORS",["#666","#422","#333","#224","#626"]),$(O,"ALWAYS",0),$(O,"ON_EVENT",1),$(O,"NEVER",2),$(O,"ON_TRIGGER",3),$(O,"UP",1),$(O,"DOWN",2),$(O,"LEFT",3),$(O,"RIGHT",4),$(O,"CENTER",5),$(O,"LINK_RENDER_MODES",["Straight","Linear","Spline"]),$(O,"STRAIGHT_LINK",0),$(O,"LINEAR_LINK",1),$(O,"SPLINE_LINK",2),$(O,"NORMAL_TITLE",0),$(O,"NO_TITLE",1),$(O,"TRANSPARENT_TITLE",2),$(O,"AUTOHIDE_TITLE",3),$(O,"VERTICAL_LAYOUT","vertical"),$(O,"proxy",null),$(O,"node_images_path",""),$(O,"debug",!1),$(O,"catch_exceptions",!0),$(O,"throw_errors",!0),$(O,"allow_scripts",!1),$(O,"use_deferred_actions",!0),$(O,"registered_node_types",{}),$(O,"node_types_by_file_extension",{}),$(O,"Nodes",{}),$(O,"Globals",{}),$(O,"searchbox_extras",{}),$(O,"auto_sort_node_types",!1),$(O,"node_box_coloured_when_on",!1),$(O,"node_box_coloured_by_mode",!1),$(O,"dialog_close_on_mouse_leave",!0),$(O,"dialog_close_on_mouse_leave_delay",500),$(O,"shift_click_do_break_link_from",!1),$(O,"click_do_break_link_to",!1),$(O,"search_hide_on_mouse_leave",!0),$(O,"search_filter_enabled",!1),$(O,"search_show_all_on_open",!0),$(O,"auto_load_slot_types",!1),$(O,"registered_slot_in_types",{}),$(O,"registered_slot_out_types",{}),$(O,"slot_types_in",[]),$(O,"slot_types_out",[]),$(O,"slot_types_default_in",[]),$(O,"slot_types_default_out",[]),$(O,"alt_drag_do_clone_nodes",!1),$(O,"do_add_triggers_slots",!1),$(O,"allow_multi_output_for_events",!0),$(O,"middle_click_slot_add_default_node",!1),$(O,"release_link_on_empty_shows_menu",!1),$(O,"pointerevents_method","mouse"),$(O,"ctrl_shift_v_paste_connect_unselected_outputs",!1),$(O,"use_uuids",!1);let LiteGraph=O;typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){let e=process.hrtime();return e[0]*.001+e[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};class LLink{constructor(t,r,n,a,s,o){this.id=t,this.type=r,this.origin_id=n,this.origin_slot=a,this.target_id=s,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}configure(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}class LGraphNode{constructor(t){this._ctor(t)}_ctor(t){this.title=t||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(r){!r||r.length<2||(this._pos[0]=r[0],this._pos[1]=r[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}configure(t){this.graph&&this.graph._version++;for(const r in t){if(r=="properties"){for(const n in t.properties)this.properties[n]=t.properties[n],this.onPropertyChanged&&this.onPropertyChanged(n,t.properties[n]);continue}t[r]!=null&&(typeof t[r]=="object"?this[r]&&this[r].configure?this[r].configure(t[r]):this[r]=LiteGraph.cloneObject(t[r],this[r]):this[r]=t[r])}if(t.title||(this.title=this.constructor.title),this.inputs)for(let r=0;r<this.inputs.length;++r){const n=this.inputs[r],a=this.graph?this.graph.links[n.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,r,!0,a,n),this.onInputAdded&&this.onInputAdded(n)}if(this.outputs)for(let r=0;r<this.outputs.length;++r){const n=this.outputs[r];if(n.links){for(let a=0;a<n.links.length;++a){const s=this.graph?this.graph.links[n.links[a]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,r,!0,s,n)}this.onOutputAdded&&this.onOutputAdded(n)}}if(this.widgets){for(let r=0;r<this.widgets.length;++r){const n=this.widgets[r];n&&n.options&&n.options.property&&this.properties[n.options.property]!=null&&(n.value=JSON.parse(JSON.stringify(this.properties[n.options.property])))}if(t.widgets_values)for(let r=0;r<t.widgets_values.length;++r)this.widgets[r]&&(this.widgets[r].value=t.widgets_values[r])}this.onConfigure&&this.onConfigure(t)}serialize(){const t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(let r=0;r<this.outputs.length;r++)delete this.outputs[r]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(let r=0;r<this.widgets.length;++r)this.widgets[r]?t.widgets_values[r]=this.widgets[r].value:t.widgets_values[r]=null}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t}clone(){const t=LiteGraph.createNode(this.type);if(!t)return null;const r=LiteGraph.cloneObject(this.serialize());if(r.inputs)for(let n=0;n<r.inputs.length;++n)r.inputs[n].link=null;if(r.outputs)for(let n=0;n<r.outputs.length;++n)r.outputs[n].links&&(r.outputs[n].links.length=0);return delete r.id,LiteGraph.use_uuids&&(r.id=LiteGraph.uuidv4()),t.configure(r),t}toString(){return JSON.stringify(this.serialize())}getTitle(){return this.title||this.constructor.title}setProperty(t,r){if(this.properties||(this.properties={}),r===this.properties[t])return;const n=this.properties[t];if(this.properties[t]=r,this.onPropertyChanged&&this.onPropertyChanged(t,r,n)===!1&&(this.properties[t]=n),this.widgets)for(let a=0;a<this.widgets.length;++a){const s=this.widgets[a];if(s&&s.options.property==t){s.value=r;break}}}setOutputData(t,r){if(!this.outputs||t==-1||t>=this.outputs.length)return;const n=this.outputs[t];if(n&&(n._data=r,this.outputs[t].links))for(let a=0;a<this.outputs[t].links.length;a++){const s=this.outputs[t].links[a],o=this.graph.links[s];o&&(o.data=r)}}setOutputDataType(t,r){if(!this.outputs||t==-1||t>=this.outputs.length)return;const n=this.outputs[t];if(n&&(n.type=r,this.outputs[t].links))for(let a=0;a<this.outputs[t].links.length;a++){const s=this.outputs[t].links[a];this.graph.links[s].type=r}}getInputData(t,r){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return;const n=this.inputs[t].link,a=this.graph.links[n];if(!a)return null;if(!r)return a.data;const s=this.graph.getNodeById(a.origin_id);return s&&(s.updateOutputData?s.updateOutputData(a.origin_slot):s.onExecute&&s.onExecute()),a.data}getInputDataType(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;const r=this.inputs[t].link,n=this.graph.links[r];if(!n)return null;const a=this.graph.getNodeById(n.origin_id);if(!a)return n.type;const s=a.outputs[n.origin_slot];return s?s.type:null}getInputDataByName(t,r){const n=this.findInputSlot(t);return n==-1?null:this.getInputData(n,r)}isInputConnected(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1}getInputInfo(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null}getInputLink(t){if(!this.inputs)return null;if(t<this.inputs.length){const r=this.inputs[t];return this.graph.links[r.link]}return null}getInputNode(t){if(!this.inputs||t>=this.inputs.length)return null;const r=this.inputs[t];if(!r||r.link===null)return null;const n=this.graph.links[r.link];return n?this.graph.getNodeById(n.origin_id):null}getInputOrProperty(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(let r=0,n=this.inputs.length;r<n;++r){const a=this.inputs[r];if(t==a.name&&a.link!=null){const s=this.graph.links[a.link];if(s)return s.data}}return this.properties[t]}getOutputData(t){return!this.outputs||t>=this.outputs.length?null:this.outputs[t]._data}getOutputInfo(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null}isOutputConnected(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1}isAnyOutputConnected(){if(!this.outputs)return!1;for(let t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1}getOutputNodes(t){if(!this.outputs||this.outputs.length==0||t>=this.outputs.length)return null;const r=this.outputs[t];if(!r.links||r.links.length==0)return null;const n=[];for(let a=0;a<r.links.length;a++){const s=r.links[a],o=this.graph.links[s];if(o){const l=this.graph.getNodeById(o.target_id);l&&n.push(l)}}return n}addOnTriggerInput(){const t=this.findInputSlot("onTrigger");if(t==-1){//!trigS ||
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return t}addOnExecutedOutput(){const t=this.findOutputSlot("onExecuted");if(t==-1){//!trigS ||
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return t}onAfterExecuteNode(t,r){const n=this.findOutputSlot("onExecuted");n!=-1&&this.triggerSlot(n,t,null,r)}changeMode(t){switch(t){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0}executePendingActions(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(let t=0;t<this._waiting_actions.length;++t){const r=this._waiting_actions[t];this.onAction(r[0],r[1],r[2],r[3],r[4])}this._waiting_actions.length=0}}doExecute(t,r){r=r||{},this.onExecute&&(r.action_call||(r.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(t,r),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,r&&r.action_call&&(this.action_call=r.action_call,this.graph.nodes_executedAction[this.id]=r.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,r)}actionDo(t,r,n,a){n=n||{},this.onAction&&(n.action_call||(n.action_call=this.id+"_"+(t||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,r,n,a),this.graph.nodes_actioning[this.id]=!1,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(r,n)}trigger(t,r,n){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(let a=0;a<this.outputs.length;++a){const s=this.outputs[a];!s||s.type!==LiteGraph.EVENT||t&&s.name!=t||this.triggerSlot(a,r,null,n)}}}triggerSlot(t,r,n,a){if(a=a||{},!this.outputs)return;if(t==null){console.error("slot must be a number");return}t.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");const s=this.outputs[t];if(!s)return;const o=s.links;if(!(!o||!o.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(let l=0;l<o.length;++l){const c=o[l];if(n!=null&&n!=c)continue;const u=this.graph.links[o[l]];if(!u)continue;u._last_time=LiteGraph.getTime();const h=this.graph.getNodeById(u.target_id);if(h){if(h.inputs[u.target_slot],h.mode===LiteGraph.ON_TRIGGER)a.action_call||(a.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),h.onExecute&&h.doExecute(r,a);else if(h.onAction){a.action_call||(a.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));const d=h.inputs[u.target_slot];LiteGraph.use_deferred_actions&&h.onExecute?(h._waiting_actions||(h._waiting_actions=[]),h._waiting_actions.push([d.name,r,a,u.target_slot])):h.actionDo(d.name,r,a,u.target_slot)}}}}}clearTriggeredSlot(t,r){if(!this.outputs)return;const n=this.outputs[t];if(!n)return;const a=n.links;if(!(!a||!a.length))for(let s=0;s<a.length;++s){const o=a[s];if(r!=null&&r!=o)continue;const l=this.graph.links[a[s]];l&&(l._last_time=0)}}setSize(t){this.size=t,this.onResize&&this.onResize(this.size)}addProperty(t,r,n,a){const s={name:t,type:n,default_value:r};if(a)for(const o in a)s[o]=a[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(s),this.properties||(this.properties={}),this.properties[t]=r,s}addOutput(t,r,n){const a={name:t,type:r,links:null};if(n)for(const s in n)a[s]=n[s];return this.outputs||(this.outputs=[]),this.outputs.push(a),this.onOutputAdded&&this.onOutputAdded(a),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,r,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),a}addOutputs(t){for(let r=0;r<t.length;++r){const n=t[r],a={name:n[0],type:n[1],link:null};if(t[2])for(const s in n[2])a[s]=n[2][s];this.outputs||(this.outputs=[]),this.outputs.push(a),this.onOutputAdded&&this.onOutputAdded(a),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)}removeOutput(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(let r=t;r<this.outputs.length;++r){if(!this.outputs[r]||!this.outputs[r].links)continue;const n=this.outputs[r].links;for(let a=0;a<n.length;++a){const s=this.graph.links[n[a]];s&&(s.origin_slot-=1)}}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)}addInput(t,r,n){r=r||0;const a={name:t,type:r,link:null};if(n)for(const s in n)a[s]=n[s];return this.inputs||(this.inputs=[]),this.inputs.push(a),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(a),LiteGraph.registerNodeAndSlotType(this,r),this.setDirtyCanvas(!0,!0),a}addInputs(t){for(let r=0;r<t.length;++r){const n=t[r],a={name:n[0],type:n[1],link:null};if(t[2])for(const s in n[2])a[s]=n[2][s];this.inputs||(this.inputs=[]),this.inputs.push(a),this.onInputAdded&&this.onInputAdded(a),LiteGraph.registerNodeAndSlotType(this,n[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)}removeInput(t){this.disconnectInput(t);const r=this.inputs.splice(t,1);for(let n=t;n<this.inputs.length;++n){if(!this.inputs[n])continue;const a=this.graph.links[this.inputs[n].link];a&&(a.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(t,r[0]),this.setDirtyCanvas(!0,!0)}addConnection(t,r,n,a){const s={name:t,type:r,pos:n,direction:a,links:null};return this.connections.push(s),s}computeSize(t){if(this.constructor.size)return this.constructor.size.concat();let r=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1);const n=t||new Float32Array([0,0]);r=Math.max(r,1);const a=LiteGraph.NODE_TEXT_SIZE,s=u(this.title);let o=0,l=0;if(this.inputs)for(let h=0,d=this.inputs.length;h<d;++h){const f=this.inputs[h],p=f.label||f.name||"",g=u(p);o<g&&(o=g)}if(this.outputs)for(let h=0,d=this.outputs.length;h<d;++h){const f=this.outputs[h],p=f.label||f.name||"",g=u(p);l<g&&(l=g)}n[0]=Math.max(o+l+10,s),n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH*1.5)),n[1]=(this.constructor.slot_start_y||0)+r*LiteGraph.NODE_SLOT_HEIGHT;let c=0;if(this.widgets&&this.widgets.length){for(let h=0,d=this.widgets.length;h<d;++h)this.widgets[h].computeSize?c+=this.widgets[h].computeSize(n[0])[1]+4:c+=LiteGraph.NODE_WIDGET_HEIGHT+4;c+=8}this.widgets_up?n[1]=Math.max(n[1],c):this.widgets_start_y!=null?n[1]=Math.max(n[1],c+this.widgets_start_y):n[1]+=c;function u(h){return h?a*h.length*.6:0}return this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n}getPropertyInfo(t){let r=null;if(this.properties_info){for(let n=0;n<this.properties_info.length;++n)if(this.properties_info[n].name==t){r=this.properties_info[n];break}}return this.constructor["@"+t]&&(r=this.constructor["@"+t]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(r=this.constructor.widgets_info[t]),!r&&this.onGetPropertyInfo&&(r=this.onGetPropertyInfo(t)),r||(r={}),r.type||(r.type=typeof this.properties[t]),r.widget=="combo"&&(r.type="enum"),r}addWidget(t,r,n,a,s){this.widgets||(this.widgets=[]),!s&&a&&a.constructor===Object&&(s=a,a=null),s&&s.constructor===String&&(s={property:s}),a&&a.constructor===String&&(s||(s={}),s.property=a,a=null),a&&a.constructor!==Function&&(console.warn("addWidget: callback must be a function"),a=null);const o={type:t.toLowerCase(),name:r,value:n,callback:a,options:s||{}};if(o.options.y!==void 0&&(o.y=o.options.y),!a&&!o.options.callback&&!o.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),t=="combo"&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),this.setSize(this.computeSize()),o}addCustomWidget(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t}getBounding(t,r){t=t||new Float32Array(4);const n=this.pos,a=this.flags.collapsed,s=this.size;let o=0,l=1,c=0,u=0;return r&&(o=4,l=6+o,c=4,u=5+c),t[0]=n[0]-o,t[1]=n[1]-LiteGraph.NODE_TITLE_HEIGHT-c,t[2]=a?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+l:s[0]+l,t[3]=a?LiteGraph.NODE_TITLE_HEIGHT+u:s[1]+LiteGraph.NODE_TITLE_HEIGHT+u,this.onBounding&&this.onBounding(t),t}isPointInside(t,r,n,a){n=n||0;let s=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(a&&(s=0),this.flags&&this.flags.collapsed){if(LiteGraph.isInsideRectangle(t,r,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-s-n<r&&this.pos[1]+this.size[1]+n>r)return!0;return!1}getSlotInPosition(t,r){const n=new Float32Array(2);if(this.inputs)for(let a=0,s=this.inputs.length;a<s;++a){const o=this.inputs[a];if(this.getConnectionPos(!0,a,n),LiteGraph.isInsideRectangle(t,r,n[0]-10,n[1]-5,20,10))return{input:o,slot:a,link_pos:n}}if(this.outputs)for(let a=0,s=this.outputs.length;a<s;++a){const o=this.outputs[a];if(this.getConnectionPos(!1,a,n),LiteGraph.isInsideRectangle(t,r,n[0]-10,n[1]-5,20,10))return{output:o,slot:a,link_pos:n}}return null}findInputSlot(t,r){if(!this.inputs)return-1;for(let n=0,a=this.inputs.length;n<a;++n)if(t==this.inputs[n].name)return r?this.inputs[n]:n;return-1}findOutputSlot(t,r){if(r=r||!1,!this.outputs)return-1;for(let n=0,a=this.outputs.length;n<a;++n)if(t==this.outputs[n].name)return r?this.outputs[n]:n;return-1}findInputSlotFree(t){const a=Object.assign({returnObj:!1,typesNotAccepted:[]},t||{});if(!this.inputs)return-1;for(let s=0,o=this.inputs.length;s<o;++s)if(!(this.inputs[s].link&&this.inputs[s].link!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.inputs[s].type)))return a.returnObj?this.inputs[s]:s;return-1}findOutputSlotFree(t){const a=Object.assign({returnObj:!1,typesNotAccepted:[]},t||{});if(!this.outputs)return-1;for(let s=0,o=this.outputs.length;s<o;++s)if(!(this.outputs[s].links&&this.outputs[s].links!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.outputs[s].type)))return a.returnObj?this.outputs[s]:s;return-1}findInputSlotByType(t,r,n,a){return this.findSlotByType(!0,t,r,n,a)}findOutputSlotByType(t,r,n,a){return this.findSlotByType(!1,t,r,n,a)}findSlotByType(t,r,n,a,s){t=t||!1,n=n||!1,a=a||!1,s=s||!1;const o=t?this.inputs:this.outputs;if(!o)return-1;(r==""||r=="*")&&(r=0);for(let l=0,c=o.length;l<c;++l){const u=(r+"").toLowerCase().split(",");let h=o[l].type=="0"||o[l].type=="*"?"0":o[l].type;h=(h+"").toLowerCase().split(",");for(let d=0;d<u.length;d++)for(let f=0;f<h.length;f++)if(u[d]=="_event_"&&(u[d]=LiteGraph.EVENT),h[d]=="_event_"&&(h[d]=LiteGraph.EVENT),u[d]=="*"&&(u[d]=0),h[d]=="*"&&(h[d]=0),u[d]==h[f]){if(a&&o[l].links&&o[l].links!==null)continue;return n?o[l]:l}}if(a&&!s)for(let l=0,c=o.length;l<c;++l){const u=(r+"").toLowerCase().split(",");let h=o[l].type=="0"||o[l].type=="*"?"0":o[l].type;h=(h+"").toLowerCase().split(",");for(let d=0;d<u.length;d++)for(let f=0;f<h.length;f++)if(u[d]=="*"&&(u[d]=0),h[d]=="*"&&(h[d]=0),u[d]==h[f])return n?o[l]:l}return-1}connectByType(t,r,n,a){const l=Object.assign({createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},a||{});r&&r.constructor===Number&&(r=this.graph.getNodeById(r));const c=r.findInputSlotByType(n,!1,!0);if(c>=0&&c!==null)return this.connect(t,r,c);if(l.createEventInCase&&n==LiteGraph.EVENT)return this.connect(t,r,-1);if(l.generalTypeInCase){const u=r.findInputSlotByType(0,!1,!0,!0);if(u>=0)return this.connect(t,r,u)}if(l.firstFreeIfOutputGeneralInCase&&(n==0||n=="*"||n=="")){const u=r.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return this.connect(t,r,u)}return console.debug("no way to connect type: ",n," to targetNODE ",r),null}connectByTypeOutput(t,r,n,a){const l=Object.assign({createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},a||{});r&&r.constructor===Number&&(r=this.graph.getNodeById(r));const c=r.findOutputSlotByType(n,!1,!0);if(c>=0&&c!==null)return r.connect(c,this,t);if(l.generalTypeInCase){const u=r.findOutputSlotByType(0,!1,!0,!0);if(u>=0)return r.connect(u,this,t)}if(l.createEventInCase&&n==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){const u=r.addOnExecutedOutput();return r.connect(u,this,t)}if(l.firstFreeIfInputGeneralInCase&&(n==0||n=="*"||n=="")){const u=r.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return r.connect(u,this,t)}return console.debug("no way to connect byOUT type: ",n," to sourceNODE ",r),null}connect(t,r,n){if(n=n||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(r&&r.constructor===Number&&(r=this.graph.getNodeById(r)),!r)throw"target node is null";if(r==this)return null;if(n.constructor===String){if(n=r.findInputSlot(n),n==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+n),null}else if(n===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)r.changeMode(LiteGraph.ON_TRIGGER),n=r.findInputSlot("onTrigger");else return null;else if(!r.inputs||n>=r.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;let a=!1;const s=r.inputs[n];let o=null;const l=this.outputs[t];if(!this.outputs[t])return null;if(r.onBeforeConnectInput&&(n=r.onBeforeConnectInput(n)),n===!1||n===null||!LiteGraph.isValidConnection(l.type,s.type))return this.setDirtyCanvas(!1,!0),a&&this.graph.connectionChange(this,o),null;if(r.onConnectInput&&r.onConnectInput(n,l.type,l,this,t)===!1||this.onConnectOutput&&this.onConnectOutput(t,s.type,s,r,n)===!1)return null;if(r.inputs[n]&&r.inputs[n].link!=null&&(this.graph.beforeChange(),r.disconnectInput(n,{doProcessChange:!1}),a=!0),l.links!==null&&l.links.length)switch(l.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),a=!0);break}let c;return LiteGraph.use_uuids?c=LiteGraph.uuidv4():c=++this.graph.last_link_id,o=new LLink(c,s.type||l.type,this.id,t,r.id,n),this.graph.links[o.id]=o,l.links==null&&(l.links=[]),l.links.push(o.id),r.inputs[n].link=o.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!0,o,l),r.onConnectionsChange&&r.onConnectionsChange(LiteGraph.INPUT,n,!0,o,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,r,n,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,r,n)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,o),o}disconnectOutput(t,r){if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;const n=this.outputs[t];if(!n||!n.links||n.links.length==0)return!1;if(r){if(r.constructor===Number&&(r=this.graph.getNodeById(r)),!r)throw"Target Node not found";for(let a=0,s=n.links.length;a<s;a++){const o=n.links[a],l=this.graph.links[o];if(l.target_id==r.id){n.links.splice(a,1);const c=r.inputs[l.target_slot];c.link=null,delete this.graph.links[o],this.graph&&this.graph._version++,r.onConnectionsChange&&r.onConnectionsChange(LiteGraph.INPUT,l.target_slot,!1,l,c),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,l,n),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,r,l.target_slot));break}}}else{for(let a=0,s=n.links.length;a<s;a++){const o=n.links[a],l=this.graph.links[o];if(!l)continue;const c=this.graph.getNodeById(l.target_id);let u=null;this.graph&&this.graph._version++,c&&(u=c.inputs[l.target_slot],u.link=null,c.onConnectionsChange&&c.onConnectionsChange(LiteGraph.INPUT,l.target_slot,!1,l,u),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,c,l.target_slot)),delete this.graph.links[o],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,l,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,c,l.target_slot))}n.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0}disconnectInput(t){if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;const r=this.inputs[t];if(!r)return!1;const n=this.inputs[t].link;if(n!=null){this.inputs[t].link=null;const a=this.graph.links[n];if(a){const s=this.graph.getNodeById(a.origin_id);if(!s)return!1;const o=s.outputs[a.origin_slot];if(!o||!o.links||o.links.length==0)return!1;let l=null;for(let c=0,u=o.links.length;c<u;c++)if(l=c,o.links[c]==n){o.links.splice(c,1);break}delete this.graph.links[n],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,a,r),s.onConnectionsChange&&s.onConnectionsChange(LiteGraph.OUTPUT,l,!1,a,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,s,l),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}getConnectionPos(t,r,n){n=n||new Float32Array(2);let a=0;t&&this.inputs&&(a=this.inputs.length),!t&&this.outputs&&(a=this.outputs.length);const s=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){const o=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+o*.5,t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]):(t?n[0]=this.pos[0]:n[0]=this.pos[0]+o,n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),n}return t&&r==-1?(n[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,n[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,n):t&&a>r&&this.inputs[r].pos?(n[0]=this.pos[0]+this.inputs[r].pos[0],n[1]=this.pos[1]+this.inputs[r].pos[1],n):!t&&a>r&&this.outputs[r].pos?(n[0]=this.pos[0]+this.outputs[r].pos[0],n[1]=this.pos[1]+this.outputs[r].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(r+.5)*(this.size[0]/a),t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]+this.size[1],n):(t?n[0]=this.pos[0]+s:n[0]=this.pos[0]+this.size[0]+1-s,n[1]=this.pos[1]+(r+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)}alignToGrid(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)}trace(t){this.console||(this.console=[]),this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)}setDirtyCanvas(t,r){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,r])}loadImage(t){const r=new Image;r.src=LiteGraph.node_images_path+t,r.ready=!1;const n=this;return r.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},r}captureInput(t){if(!this.graph||!this.graph.list_of_graphcanvas)return;const r=this.graph.list_of_graphcanvas;for(let n=0;n<r.length;++n){const a=r[n];!t&&a.node_capturing_input!=this||(a.node_capturing_input=t?this:null)}}collapse(t){this.graph._version++,!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))}pin(t){this.graph._version++,t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t}localToScreen(t,r,n){return[(t+this.pos[0])*n.scale+n.offset[0],(r+this.pos[1])*n.scale+n.offset[1]]}}class LGraphGroup{constructor(t){this._ctor(t)}_ctor(t){this.title=t||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,this.id=LiteGraph.uuidv4(),this.group_id=null,Object.defineProperty(this,"pos",{set:function(r){!r||r.length<2||(this._pos[0]=Math.round(r[0]),this._pos[1]=Math.round(r[1]))},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(r){!r||r.length<2||(this._size[0]=Math.max(140,Math.round(r[0])),this._size[1]=Math.max(80,r[1]))},get:function(){return this._size},enumerable:!0})}configure(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font_size=t.font_size,this.id=t.id,this.group_id=t.group_id,this.status=t.status}serialize(){let t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font_size:this.font_size,id:this.id,status:this.status,group_id:this.group_id}}move(t,r,n){if(this._pos[0]+=t,this._pos[1]+=r,!n)for(let a=0;a<this._nodes.length;++a){let s=this._nodes[a];s.pos[0]+=t,s.pos[1]+=r}}recomputeInsideNodes(){this._nodes.length=0;let t=this.graph._nodes,r=new Float32Array(4);for(let n=0;n<t.length;++n){let a=t[n];a.getBounding(r),LiteGraph.overlapBounding(this._bounding,r)&&this._nodes.push(a)}}isPointInside(t,r,n,a){n=n||0;let s=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(a&&(s=0),this.flags&&this.flags.collapsed){if(LiteGraph.isInsideRectangle(t,r,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-s-n<r&&this.pos[1]+this.size[1]+n>r)return!0;return!1}setDirtyCanvas(t,r){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,r])}}class DragAndScale{constructor(t,r){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,r||this.bindEvents(t))}bindEvents(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"up",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)}computeVisibleArea(t){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}let r=this.element.width,n=this.element.height,a=-this.offset[0],s=-this.offset[1];t&&(a+=t[0]/this.scale,s+=t[1]/this.scale,r=t[2],n=t[3]);const o=a+r/this.scale,l=s+n/this.scale;this.visible_area[0]=a,this.visible_area[1]=s,this.visible_area[2]=o-a,this.visible_area[3]=l-s}onMouse(t){if(!this.enabled)return;const r=this.element,n=r.getBoundingClientRect(),a=t.clientX-n.left,s=t.clientY-n.top;t.canvasx=a,t.canvasy=s,t.dragging=this.dragging;const o=!this.viewport||this.viewport&&a>=this.viewport[0]&&a<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];let l=!1;if(this.onmouse&&(l=this.onmouse(t)),t.type==LiteGraph.pointerevents_method+"down"&&o)this.dragging=!0,LiteGraph.pointerListenerRemove(r,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(t.type==LiteGraph.pointerevents_method+"move"){if(!l){const c=a-this.last_mouse[0],u=s-this.last_mouse[1];this.dragging&&this.mouseDrag(c,u)}}else t.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(r,"move",this._binded_mouse_callback)):o&&(t.type=="mousewheel"||t.type=="wheel"||t.type=="DOMMouseScroll")&&(t.eventType="mousewheel",t.type=="wheel"?t.wheel=-t.deltaY:t.wheel=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+t.delta*.05));if(this.last_mouse[0]=a,this.last_mouse[1]=s,o)return t.preventDefault(),t.stopPropagation(),!1}toCanvasContext(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]}convertCanvasToOffset(t,r){return r=r||[0,0],r[0]=t[0]/this.scale-this.offset[0],r[1]=t[1]/this.scale-this.offset[1],r}mouseDrag(t,r){this.offset[0]+=t/this.scale,this.offset[1]+=r/this.scale,this.onredraw&&this.onredraw(this)}changeScale(t,r){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t==this.scale||!this.element)return;const n=this.element.getBoundingClientRect();if(!n)return;r=r||[n.width*.5,n.height*.5];const a=this.convertCanvasToOffset(r);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);const s=this.convertCanvasToOffset(r),o=[s[0]-a[0],s[1]-a[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}changeDeltaScale(t,r){this.changeScale(this.scale*t,r)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}const _LGraphCanvas=class _LGraphCanvas{constructor(e,t,r){$(this,"saveUndoStack",async function(){var r,n;const e=this.graph.serialize(),t=this.tempDeepClone(e);(((r=this.undoStack)==null?void 0:r.length)===0||((n=this.undoStack)==null?void 0:n.length)>0&&!this.checkObjectEqual(t,this.undoStack[this.undoStack.length-1]))&&this.undoStack.push(t),this.undoStack.length>this.maxStackSize&&this.undoStack.shift(),this.redoStack.length=0});this.options=r=r||{},this.ALWAYS_FLOW=!1,this.isKeyPressed=!1,this._menus=[],this.maxStackSize=r.maxStackSize||1e3,this.undoStack=[],this.redoStack=[],this.saveUndoStackEvt=this.debounceTime(this.saveUndoStack.bind(this),50),this.background_image=_LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,e&&e.constructor===String&&(e=document.querySelector(e)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=r.viewport||null,t&&t.attachCanvas(this),this.setCanvas(e,r.skip_events),this.clear(),r.skip_render||this.startRendering(),this.autoresize=r.autoresize}clear(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()}setGraph(e,t){if(this.graph!=e){if(t||this.clear(),!e&&this.graph){this.graph.detachCanvas(this);return}e.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}openSubgraph(e){if(!e)throw"graph cannot be null";if(this.graph==e)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),e.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}closeSubgraph(){if(!this._graph_stack||this._graph_stack.length==0)return;const e=this.graph._subgraph_node,t=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},t.attachCanvas(this),this.setDirty(!0,!0),e&&(this.centerOnNode(e),this.selectNodes([e])),this.ds.offset=[0,0],this.ds.scale=1}getCurrentGraph(){return this.graph}async setCanvas(e,t){if(e&&e.constructor===String&&(e=document.getElementById(e),!e))throw"Error creating LiteGraph canvas: Canvas not found";if(e===this.canvas)return;!e&&this.canvas&&(t||this.unbindEvents());const r=e.parentElement,{width:n,height:a}=r.getBoundingClientRect();if(e.width=n,e.height=a,this.canvas=e,this.ds.element=e,!!e){if(e.className+=" lgraphcanvas",e.data=this,e.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),e.getContext==null)throw e.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+e.localName:"This browser doesn't support Canvas";this.options.useWebgl?await this.enableWebGL():(this.ctx=e.getContext("2d"))==null&&(e.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),await this.enableWebGL()),t||this.bindEvents(),this.draw(!0,!0)}}_doNothing(e){return e.preventDefault(),!1}_doReturnTrue(e){return e.preventDefault(),!0}bindEvents(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}const e=this.canvas,r=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(e,"down",this._mousedown_callback,!0),e.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(e,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(e,"move",this._mousemove_callback),e.addEventListener("contextmenu",this._doNothing),e.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),e.setAttribute("tabindex",1),e.addEventListener("keydown",this._key_callback,!0),r.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),e.addEventListener("dragover",this._doNothing,!1),e.addEventListener("dragend",this._doNothing,!1),e.addEventListener("drop",this._ondrop_callback,!1),e.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}unbindEvents(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}const t=this.getCanvasWindow().document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),t.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}static getFileExtension(e){const t=e.indexOf("?");t!=-1&&(e=e.substr(0,t));const r=e.lastIndexOf(".");return r==-1?"":e.substr(r+1).toLowerCase()}async enableWebGL(){var t;if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";const e=enableWebGLCanvas(this.canvas);e instanceof WebGLRenderingContext&&(await e.loadCachedTextures(),e.cacheFontAtlas("Arial","normal"),e.cacheFontAtlas("Arial","Bold")),this.gl=e,this.ctx=e,this.bgctx=e,(t=this.gl)==null||t.viewport(0,0,this.canvas.width,this.canvas.height),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.canvas.webgl_enabled=!0}setDirty(e,t){e&&(this.dirty_canvas=!0),t&&(this.dirty_bgcanvas=!0)}getCanvasWindow(){if(!this.canvas)return window;const e=this.canvas.ownerDocument;return e.defaultView||e.parentWindow}startRendering(){if(this.is_rendering)return;this.is_rendering=!0,e.call(this);function e(){this.pause_rendering||this.draw();const t=this.getCanvasWindow();this.is_rendering&&t.requestAnimationFrame(e.bind(this))}}stopRendering(){this.is_rendering=!1}blockClick(){this.block_click=!0,this.last_mouseclick=0}processMouseDown(e){let t=!1;if(this.block_drag_grp=!1,this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!this.graph)return;this.adjustMouseEvent(e);const r=this.getCanvasWindow();r.document,_LGraphCanvas.active_canvas=this;const n=e.clientX,a=e.clientY;this.ds.viewport=this.viewport;const s=!this.viewport||this.viewport&&n>=this.viewport[0]&&n<this.viewport[0]+this.viewport[2]&&a>=this.viewport[1]&&a<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(r.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(r.document,"up",this._mouseup_callback,!0)),!s)return;let o=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes,5),l=!1;const c=LiteGraph.getTime(),u=e.isPrimary===void 0||!e.isPrimary,h=c-this.last_mouseclick<300&&u;if(this.mouse[0]=e.clientX,this.mouse[1]=e.clientY,this.graph_mouse[0]=e.canvasX,this.graph_mouse[1]=e.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&u?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(r),!(this.onMouse&&this.onMouse(e)==!0)){if(o||this.closePanels(),e.which==1&&!this.pointer_is_double){if(this.saveUndoStack(),e.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=e.canvasX,this.dragging_rectangle[1]=e.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,l=!0),LiteGraph.alt_drag_do_clone_nodes&&e.altKey&&o&&this.allow_interaction&&!l&&!this.read_only){let f=o.clone();(f=o.clone())&&(f.pos[0]+=5,f.pos[1]+=5,this.graph.add(f,!1,{doCalcSize:!1}),o=f,l=!0,t||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=o),this.selected_nodes[o.id]||this.processNodeSelected(o,e)))}let d=!1;if(o&&(this.allow_interaction||o.flags.allow_interaction)&&!l&&!this.read_only){if(!this.live_mode&&!o.flags.pinned&&this.bringToFront(o),this.allow_interaction&&!this.connecting_node&&!o.flags.collapsed&&!this.live_mode)if(!l&&o.resizable!==!1&&LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,o.pos[0]+o.size[0]-5,o.pos[1]+o.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=o,this.canvas.style.cursor="se-resize",l=!0;else{if(o.outputs)for(let f=0,p=o.outputs.length;f<p;++f){const g=o.outputs[f],b=o.getConnectionPos(!1,f);if(LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,b[0]-15,b[1]-10,30,20)){this.connecting_node=o,this.connecting_output=g,this.connecting_output.slot_index=f,this.connecting_pos=o.getConnectionPos(!1,f),this.connecting_slot=f,LiteGraph.shift_click_do_break_link_from&&e.shiftKey&&o.disconnectOutput(f),h?o.onOutputDblClick&&o.onOutputDblClick(f,e):o.onOutputClick&&o.onOutputClick(f,e),l=!0;break}}if(o.inputs)for(let f=0,p=o.inputs.length;f<p;++f){const g=o.inputs[f],b=o.getConnectionPos(!0,f);if(LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,b[0]-15,b[1]-10,30,20)){if(h?o.onInputDblClick&&o.onInputDblClick(f,e):o.onInputClick&&o.onInputClick(f,e),g.link!==null){const m=this.graph.links[g.link];LiteGraph.click_do_break_link_to&&(o.disconnectInput(f),this.dirty_bgcanvas=!0,l=!0),(this.allow_reconnect_links||e.shiftKey)&&(LiteGraph.click_do_break_link_to||o.disconnectInput(f),this.connecting_node=this.graph._nodes_by_id[m.origin_id],this.connecting_slot=m.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,l=!0)}l||(this.connecting_node=o,this.connecting_input=g,this.connecting_input.slot_index=f,this.connecting_pos=o.getConnectionPos(!0,f),this.connecting_slot=f,this.dirty_bgcanvas=!0,l=!0)}}}if(!l){const f=[e.canvasX-o.pos[0],e.canvasY-o.pos[1]],p=this.processNodeWidgets(o,this.graph_mouse,e);if(p&&(t=!0,this.node_widget=[o,p]),this.allow_interaction&&h&&this.selected_nodes[o.id]&&(o.onDblClick&&o.onDblClick(e,f,this),this.processNodeDblClicked(o),t=!0),o.onMouseDown&&o.onMouseDown(e,f,this))t=!0;else{if(o.subgraph&&!o.skip_subgraph_button&&!o.flags.collapsed&&f[0]>o.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&f[1]<0){const g=this;setTimeout(function(){g.openSubgraph(o.subgraph)},10)}this.live_mode&&(d=!0,t=!0)}t?o.is_selected||this.processNodeSelected(o,e):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=o),this.processNodeSelected(o,e)),this.dirty_canvas=!0}}else if(!l){if(!this.read_only)for(let f=0;f<this.visible_links.length;++f){const p=this.visible_links[f],g=p._pos;if(!(!g||e.canvasX<g[0]-4||e.canvasX>g[0]+4||e.canvasY<g[1]-4||e.canvasY>g[1]+4)){this.showLinkMenu(p,e),this.over_link_center=null;break}}this.selected_group=this.graph.getGroupOnPos(e.canvasX,e.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only&&h&&(e.preventDefault(),e.stopPropagation(),this.showGrpPanel(this.selected_group),this.block_drag_grp=!0),this.selected_group&&!this.read_only&&!h&&(this.block_drag_grp=!1,e.ctrlKey&&(this.dragging_rectangle=null),LiteGraph.distance([e.canvasX,e.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()),d=!0}!l&&d&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(e.which==2)if(this.saveUndoStack(),LiteGraph.middle_click_slot_add_default_node){if(o&&this.allow_interaction&&!l&&!this.read_only&&!this.connecting_node&&!o.flags.collapsed&&!this.live_mode){let d=!1,f=!1,p=!1;if(o.outputs)for(let g=0,b=o.outputs.length;g<b;++g){const m=o.outputs[g],E=o.getConnectionPos(!1,g);if(LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,E[0]-15,E[1]-10,30,20)){d=m,f=g,p=!0;break}}if(o.inputs)for(let g=0,b=o.inputs.length;g<b;++g){const m=o.inputs[g],E=o.getConnectionPos(!0,g);if(LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,E[0]-15,E[1]-10,30,20)){d=m,f=g,p=!1;break}}if(d&&f!==!1){const g=.5-(f+1)/(p?o.outputs.length:o.inputs.length),b=o.getBounding(),m=[p?b[0]+b[2]:b[0],e.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:p?o:null,slotFrom:p?f:null,nodeTo:p?null:o,slotTo:p?null:f,position:m,nodeType:"AUTO",posAdd:[p?30:-30,-g*130],posSizeFix:[p?0:-1,0]})}}}else!l&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(e.which==3||this.pointer_is_double)&&(this.saveUndoStack(),this.allow_interaction&&!l&&!this.read_only&&(o&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[o.id]||e.shiftKey||e.ctrlKey||e.metaKey)?this.selected_nodes[o.id]||this.selectNodes([o],!0):this.selectNodes([o])),this.processContextMenu(o,e)));return this.last_mouse[0]=e.clientX,this.last_mouse[1]=e.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!r.document.activeElement||r.document.activeElement.nodeName.toLowerCase()!="input"&&r.document.activeElement.nodeName.toLowerCase()!="textarea")&&e.preventDefault(),e.stopPropagation(),this.onMouseDown&&this.onMouseDown(e),!1}}getGroupMenuOptions(e){return[{content:"제목",callback:this.onShowPropertyEditor},{content:"그룹 위치",property:"그룹 위치",type:"Number",callback:this.onGrpPositionEditor},{content:"그룹 사이즈",property:"그룹 사이즈",type:"Number",callback:this.onGrpSizeEditor},{content:"그룹 색",has_submenu:!0,callback:_LGraphCanvas.onMenuNodeColors},{content:"폰트 사이즈",property:"font_size",type:"Number",callback:this.onShowPropertyEditor},{content:"앞으로",property:"font_size",type:"Number",callback:this.bringGroupToFront.bind(this,e)},{content:"뒤로",property:"font_size",type:"Number",callback:this.sendGroupToBack.bind(this,e)},null,{content:"그룹 삭제",callback:_LGraphCanvas.onMenuNodeRemove}]}processMouseMove(e){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!this.graph)return;_LGraphCanvas.active_canvas=this,this.adjustMouseEvent(e);const t=[e.clientX,e.clientY];this.mouse[0]=t[0],this.mouse[1]=t[1];const r=[t[0]-this.last_mouse[0],t[1]-this.last_mouse[1]];if(this.last_mouse=t,this.graph_mouse[0]=e.canvasX,this.graph_mouse[1]=e.canvasY,this.block_click)return e.preventDefault(),!1;e.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e,this.node_widget[1]),this.dirty_canvas=!0);const n=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=e.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=e.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[e.canvasX-this.selected_group.pos[0],e.canvasY-this.selected_group.pos[1]];else{const a=r[0]/this.ds.scale,s=r[1]/this.ds.scale;this.selected_group.move(a,s,e.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||n&&n.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let a=0,s=this.graph._nodes.length;a<s;++a)this.graph._nodes[a].mouseOver&&n!=this.graph._nodes[a]&&(this.graph._nodes[a].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(e),this.node_over=null,this.dirty_canvas=!0);if(n){if(n.redraw_on_mouse&&(this.dirty_canvas=!0),n.mouseOver||(n.mouseOver=!0,this.node_over=n,this.dirty_canvas=!0,n.onMouseEnter&&n.onMouseEnter(e)),n.onMouseMove&&n.onMouseMove(e,[e.canvasX-n.pos[0],e.canvasY-n.pos[1]],this),this.connecting_node){if(this.connecting_output){const a=this._highlight_input||[0,0];if(!this.isOverNodeBox(n,e.canvasX,e.canvasY)){const s=this.isOverNodeInput(n,e.canvasX,e.canvasY,a);if(s!=-1&&n.inputs[s]){const o=n.inputs[s].type;LiteGraph.isValidConnection(this.connecting_output.type,o)&&(this._highlight_input=a,this._highlight_input_slot=n.inputs[s])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){const a=this._highlight_output||[0,0];if(!this.isOverNodeBox(n,e.canvasX,e.canvasY)){const s=this.isOverNodeOutput(n,e.canvasX,e.canvasY,a);if(s!=-1&&n.outputs[s]){const o=n.outputs[s].type;LiteGraph.isValidConnection(this.connecting_input.type,o)&&(this._highlight_output=a)}else this._highlight_output=null}}}this.canvas&&(LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,n.pos[0]+n.size[0]-5,n.pos[1]+n.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{let a=null;for(let s=0;s<this.visible_links.length;++s){const o=this.visible_links[s],l=o._pos;if(!(!l||e.canvasX<l[0]-4||e.canvasX>l[0]+4||e.canvasY<l[1]-4||e.canvasY>l[1]+4)){a=o;break}}a!=this.over_link_center&&(this.over_link_center=a,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=n&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(const a in this.selected_nodes){const s=this.selected_nodes[a];s.pos[0]+=r[0]/this.ds.scale,s.pos[1]+=r[1]/this.ds.scale,s.is_selected||this.processNodeSelected(s,e)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){const a=[e.canvasX-this.resizing_node.pos[0],e.canvasY-this.resizing_node.pos[1]],s=this.resizing_node.computeSize();a[0]=Math.max(s[0],a[0]),a[1]=Math.max(s[1],a[1]),this.resizing_node.setSize(a),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return e.preventDefault(),!1}processMouseUp(e){const t=e.isPrimary===void 0||e.isPrimary;if(!t)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!this.graph)return;const n=this.getCanvasWindow().document;_LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(n,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(n,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(e);const a=LiteGraph.getTime();if(e.click_time=a-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),e.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e),this.node_widget=null,this.selected_group){const o=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),l=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(o,l,e.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;const s=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){const o=this.graph._nodes,l=new Float32Array(4),c=Math.abs(this.dragging_rectangle[2]),u=Math.abs(this.dragging_rectangle[3]),h=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-c:this.dragging_rectangle[0],d=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-u:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=h,this.dragging_rectangle[1]=d,this.dragging_rectangle[2]=c,this.dragging_rectangle[3]=u,!s||c>10&&u>10){const f=[];for(let p=0;p<o.length;++p){const g=o[p];g.getBounding(l),LiteGraph.overlapBounding(this.dragging_rectangle,l)&&f.push(g)}f.length&&this.selectNodes(f,e.shiftKey)}else this.selectNodes([s],e.shiftKey||e.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;const l=(this.connecting_output||this.connecting_input).type;if(s){if(this.connecting_output){const c=this.isOverNodeInput(s,e.canvasX,e.canvasY);c!=-1?this.connecting_node.connect(this.connecting_slot,s,c):this.connecting_node.connectByType(this.connecting_slot,s,l)}else if(this.connecting_input){const c=this.isOverNodeOutput(s,e.canvasX,e.canvasY);c!=-1?s.connect(c,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,s,l)}}else LiteGraph.release_link_on_empty_shows_menu&&(e.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(e,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(e,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){const o=this.node_dragged;o&&e.click_time<300&&LiteGraph.isInsideRectangle(e.canvasX,e.canvasY,o.pos[0],o.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&o.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else!this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes)&&e.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(e,[e.canvasX-this.node_over.pos[0],e.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]])}else e.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):e.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return t&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),e.stopPropagation(),e.preventDefault(),!1}processMouseWheel(e){if(!this.graph||!this.allow_dragcanvas)return;const t=e.wheelDeltaY!=null?e.wheelDeltaY:e.detail*-60;this.adjustMouseEvent(e);const r=e.clientX,n=e.clientY;if(!(!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3]))return;let s=this.ds.scale;return t>0?s*=1.1:t<0&&(s*=1/1.1),this.ds.changeScale(s,[e.clientX,e.clientY]),this.graph.change(),e.preventDefault(),!1}isOverNodeBox(e,t,r){const n=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(t,r,e.pos[0]+2,e.pos[1]+2-n,n-4,n-4)}isOverNodeInput(e,t,r,n){if(e.inputs)for(let a=0,s=e.inputs.length;a<s;++a){e.inputs[a];const o=e.getConnectionPos(!0,a);let l=!1;if(e.horizontal?l=LiteGraph.isInsideRectangle(t,r,o[0]-5,o[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,r,o[0]-10,o[1]-5,40,10),l)return n&&(n[0]=o[0],n[1]=o[1]),a}return-1}isOverNodeOutput(e,t,r,n){if(e.outputs)for(let a=0,s=e.outputs.length;a<s;++a){e.outputs[a];const o=e.getConnectionPos(!1,a);let l=!1;if(e.horizontal?l=LiteGraph.isInsideRectangle(t,r,o[0]-5,o[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,r,o[0]-10,o[1]-5,40,10),l)return n&&(n[0]=o[0],n[1]=o[1]),a}return-1}processKey(e){if(!this.graph)return;let t=!1;if(e.target.localName!="input"){if(e.type=="keydown"){this.isKeyPressed=!0,e.keyCode==32&&(this.saveUndoStack(),this.dragging_canvas=!0,t=!0),e.keyCode==27&&(this.saveUndoStack(),this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),t=!0),e.keyCode==65&&e.ctrlKey&&(this.saveUndoStack(),this.selectNodes(),t=!0),e.keyCode===67&&(e.metaKey||e.ctrlKey)&&!e.shiftKey&&this.selected_nodes&&(this.saveUndoStack(),this.copyToClipboard(),t=!0),e.keyCode===86&&(e.metaKey||e.ctrlKey)&&(this.saveUndoStack(),this.pasteFromClipboard(e.shiftKey));const r=n=>{if(this.selected_nodes&&n.key==="ArrowUp"){this.saveUndoStackEvt();for(let a in this.selected_nodes)this.selected_nodes[a].pos[1]-=1}if(this.selected_nodes&&n.key==="ArrowDown"){this.saveUndoStackEvt();for(let a in this.selected_nodes)this.selected_nodes[a].pos[1]+=1}if(this.selected_nodes&&n.key==="ArrowLeft"){this.saveUndoStackEvt();for(let a in this.selected_nodes)this.selected_nodes[a].pos[0]-=1}if(this.selected_nodes&&n.key==="ArrowRight"){this.saveUndoStackEvt();for(let a in this.selected_nodes)this.selected_nodes[a].pos[0]+=1}};if(this.isKeyPressed?r(e):this.isKeyPressed=!1,(e.keyCode==46||e.keyCode==8)&&e.target.localName!="input"&&e.target.localName!="textarea"&&(this.saveUndoStack(),this.deleteSelectedNodes(),t=!0),this.selected_nodes)for(const n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(e)}else if(e.type=="keyup"){if(e.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes)for(const r in this.selected_nodes)this.selected_nodes[r].onKeyUp&&this.selected_nodes[r].onKeyUp(e);e.ctrlKey&&e.key==="z"&&!this.read_only&&this.undo(),e.ctrlKey&&e.key==="y"&&!this.read_only&&this.redo()}if(this.graph.change(),t)return e.preventDefault(),e.stopImmediatePropagation(),!1}}checkObjectEqual(e,t){const r=JSON.stringify(e),n=JSON.stringify(t);return r===n}undo(){if(this.undoStack.length===0)return;const e=this.graph.serialize();this.redoStack.push(this.tempDeepClone(e));const t=this.undoStack.pop();this.graph.configure(this.tempDeepClone(t)),this.draw(!0,!0)}redo(){if(this.redoStack.length===0)return;const e=this.graph.serialize();this.undoStack.push(this.tempDeepClone(e));const t=this.redoStack.pop();this.graph.configure(this.tempDeepClone(t)),this.draw(!0,!0)}debounceTime(e,t){let r=null;return function(...n){const a=this;clearTimeout(r),r=setTimeout(()=>e.apply(a,n),t)}}tempDeepClone(e){return JSON.parse(JSON.stringify(e))}copyToClipboard(){const e={nodes:[],links:[]};let t=0;const r=[];for(const n in this.selected_nodes){const a=this.selected_nodes[n];a.clonable!==!1&&(a._relative_id=t,r.push(a),t+=1)}for(let n=0;n<r.length;++n){const a=r[n];if(a.clonable===!1)continue;const s=a.clone();if(!s){console.warn("node type not found: "+a.type);continue}if(e.nodes.push(s.serialize()),a.inputs&&a.inputs.length)for(let o=0;o<a.inputs.length;++o){const l=a.inputs[o];if(!l||l.link==null)continue;const c=this.graph.links[l.link];if(!c)continue;const u=this.graph.getNodeById(c.origin_id);u&&e.links.push([u._relative_id,c.origin_slot,a._relative_id,c.target_slot,u.id])}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(e))}pasteFromClipboard(e=!1){if(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&e)return;const t=localStorage.getItem("litegrapheditor_clipboard");if(!t)return;this.graph.beforeChange();const r=JSON.parse(t);let n=!1,a=!1;for(let o=0;o<r.nodes.length;++o)n?(n[0]>r.nodes[o].pos[0]&&(n[0]=r.nodes[o].pos[0],a[0]=o),n[1]>r.nodes[o].pos[1]&&(n[1]=r.nodes[o].pos[1],a[1]=o)):(n=[r.nodes[o].pos[0],r.nodes[o].pos[1]],a=[o,o]);const s=[];for(let o=0;o<r.nodes.length;++o){const l=r.nodes[o],c=LiteGraph.createNode(l.type);c&&(c.configure(l),c.pos[0]+=this.graph_mouse[0]-n[0],c.pos[1]+=this.graph_mouse[1]-n[1],this.graph.add(c,{doProcessChange:!1}),s.push(c))}for(let o=0;o<r.links.length;++o){const l=r.links[o];let c;const u=l[0];if(u!=null)c=s[u];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&e){const d=l[4];d&&(c=this.graph.getNodeById(d))}const h=s[l[2]];c&&h?c.connect(l[1],h,l[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(s),this.graph.afterChange()}processDrop(e){e.preventDefault(),this.adjustMouseEvent(e);const t=e.clientX,r=e.clientY;if(!(!this.viewport||this.viewport&&t>=this.viewport[0]&&t<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3]))return;const a=[e.canvasX,e.canvasY],s=this.graph?this.graph.getNodeOnPos(a[0],a[1]):null;if(!s){let o=null;this.onDropItem&&(o=this.onDropItem(event)),o||this.checkDropItem(e);return}if(s.onDropFile||s.onDropData){const o=e.dataTransfer.files;if(o&&o.length)for(let l=0;l<o.length;l++){const c=e.dataTransfer.files[0],u=c.name;if(_LGraphCanvas.getFileExtension(u),s.onDropFile&&s.onDropFile(c),s.onDropData){const h=new FileReader;h.onload=function(f){const p=f.target.result;s.onDropData(p,u,c)};const d=c.type.split("/")[0];d=="text"||d==""?h.readAsText(c):d=="image"?h.readAsDataURL(c):h.readAsArrayBuffer(c)}}}return s.onDropItem&&s.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}checkDropItem(e){if(e.dataTransfer.files.length){const t=e.dataTransfer.files[0],r=_LGraphCanvas.getFileExtension(t.name).toLowerCase(),n=LiteGraph.node_types_by_file_extension[r];if(n){this.graph.beforeChange();const a=LiteGraph.createNode(n.type);a.pos=[e.canvasX,e.canvasY],this.graph.add(a),a.onDropFile&&a.onDropFile(t),this.graph.afterChange()}}}processNodeDblClicked(e){this.onShowNodePanel?this.onShowNodePanel(e):this.showShowNodePanel(e),this.onNodeDblClicked&&this.onNodeDblClicked(e),this.setDirty(!0)}processNodeSelected(e,t){this.selectNode(e,t&&(t.shiftKey||t.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(e)}selectNode(e,t){e==null?this.deselectAllNodes():this.selectNodes([e],t)}selectNodes(e,t){t||this.deselectAllNodes(),e=e||this.graph._nodes,typeof e=="string"&&(e=[e]);for(const r in e){const n=e[r];if(n.is_selected){this.deselectNode(n);continue}if(!n.is_selected&&n.onSelected&&n.onSelected(),n.is_selected=!0,this.selected_nodes[n.id]=n,n.inputs)for(let a=0;a<n.inputs.length;++a)this.highlighted_links[n.inputs[a].link]=!0;if(n.outputs)for(let a=0;a<n.outputs.length;++a){const s=n.outputs[a];if(s.links)for(let o=0;o<s.links.length;++o)this.highlighted_links[s.links[o]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}deselectNode(e){if(e.is_selected){if(e.onDeselected&&e.onDeselected(),e.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(e),e.inputs)for(let t=0;t<e.inputs.length;++t)delete this.highlighted_links[e.inputs[t].link];if(e.outputs)for(let t=0;t<e.outputs.length;++t){const r=e.outputs[t];if(r.links)for(let n=0;n<r.links.length;++n)delete this.highlighted_links[r.links[n]]}}}deselectAllNodes(){if(!this.graph)return;const e=this.graph._nodes;for(let t=0,r=e.length;t<r;++t){const n=e[t];n.is_selected&&(n.onDeselected&&n.onDeselected(),n.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(n))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}deleteSelectedNodes(){this.graph.beforeChange();for(const e in this.selected_nodes){const t=this.selected_nodes[e];if(!t.block_delete){if(t.inputs&&t.inputs.length&&t.outputs&&t.outputs.length&&LiteGraph.isValidConnection(t.inputs[0].type,t.outputs[0].type)&&t.inputs[0].link&&t.outputs[0].links&&t.outputs[0].links.length){const r=t.graph.links[t.inputs[0].link],n=t.graph.links[t.outputs[0].links[0]],a=t.getInputNode(0),s=t.getOutputNodes(0)[0];a&&s&&a.connect(r.origin_slot,s,n.target_slot)}this.graph.remove(t),this.onNodeDeselected&&this.onNodeDeselected(t)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}centerOnNode(e){this.ds.offset[0]=-e.pos[0]-e.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-e.pos[1]-e.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}adjustMouseEvent(e){let t=0,r=0;if(this.canvas){const n=this.canvas.getBoundingClientRect();t=e.clientX-n.left,r=e.clientY-n.top}else t=e.clientX,r=e.clientY;this.last_mouse_position[0]=t,this.last_mouse_position[1]=r,e.canvasX=t/this.ds.scale-this.ds.offset[0],e.canvasY=r/this.ds.scale-this.ds.offset[1]}setZoom(e,t){this.ds.changeScale(e,t),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}convertOffsetToCanvas(e,t){return this.ds.convertOffsetToCanvas(e,t)}convertCanvasToOffset(e,t){return this.ds.convertCanvasToOffset(e,t)}convertEventToCanvasOffset(e){const t=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([e.clientX-t.left,e.clientY-t.top])}bringToFront(e){const t=this.graph._nodes.indexOf(e);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.push(e))}sendToBack(e){const t=this.graph._nodes.indexOf(e);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.unshift(e))}computeVisibleNodes(e,t){const r=new Float32Array(4),n=t||[];n.length=0,e=e||this.graph._nodes;for(let a=0,s=e.length;a<s;++a){const o=e[a];this.live_mode&&!o.onDrawBackground&&!o.onDrawForeground||o.getBounding&&LiteGraph.overlapBounding(this.visible_area,o.getBounding(r,!0))&&n.push(o)}return n}draw(e,t){if(!this.canvas||this.canvas.width==0||this.canvas.height==0)return;const r=LiteGraph.getTime();this.render_time=(r-this.last_draw_time)*.001,this.last_draw_time=r,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||t||this.always_render_background||this.graph&&this.graph._last_trigger_time&&r-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||e)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}drawFrontCanvas(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));const e=this.ctx;if(!e)return;const t=this.canvas;e.start2D&&!this.viewport&&(e.start2D(),e.restore(),e.setTransform(1,0,0,1,0,0));const r=this.viewport||this.dirty_area;if(r&&(e.save(),e.beginPath(),e.rect(r[0],r[1],r[2],r[3]),e.clip()),this.clear_background&&(r?e.clearRect(r[0],r[1],r[2],r[3]):e.clearRect(0,0,t.width,t.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():e.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(t,e),this.show_info&&this.renderInfo(e,r?r[0]:0,r?r[1]:0),this.graph){e.save(),this.ds.toCanvasContext(e);const n=this.computeVisibleNodes(null,this.visible_nodes);for(let a=0;a<n.length;++a){const s=n[a];e.save(),e.translate(s.pos[0],s.pos[1]),this.drawNode(s,e),e.restore()}if(this.addNodeGuideLines(e),this.render_execution_order&&this.drawExecutionOrder(e),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(e)),this.connecting_pos!=null){e.lineWidth=this.connections_width;let a=null;const s=this.connecting_output||this.connecting_input,o=s.type;let l=s.dir;l==null&&(this.connecting_output?l=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:l=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);const c=s.shape;switch(o){case LiteGraph.EVENT:a=LiteGraph.EVENT_LINK_COLOR;break;default:a=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(e,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,a,l,LiteGraph.CENTER),e.beginPath(),o===LiteGraph.EVENT||c===LiteGraph.BOX_SHAPE?(e.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),e.fill(),e.beginPath(),e.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):c===LiteGraph.ARROW_SHAPE?(e.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),e.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),e.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),e.closePath()):(e.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),e.fill(),e.fillStyle="#ffcc00",this._highlight_input&&(e.beginPath(),this._highlight_input_slot.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),e.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),e.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),e.closePath()):e.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),e.fill()),this._highlight_output){let u=this._highlight_output.shape;e.beginPath(),u===LiteGraph.ARROW_SHAPE?(e.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),e.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),e.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),e.closePath()):e.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),e.fill()}}this.dragging_rectangle&&(e.strokeStyle="#FFF",e.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(e,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(e,null),this.onDrawForeground&&this.onDrawForeground(e,this.visible_rect),e.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(e),this.onDrawOverlay&&this.onDrawOverlay(e),this.showPopover&&this.drawPopoverLine(e),r&&e.restore(),e.finish2D&&e.finish2D()}drawSubgraphPanel(e){const t=this.graph,r=t._subgraph_node;if(!r){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(t,r,e),this.drawSubgraphPanelRight(t,r,e)}drawSubgraphPanelLeft(e,t,r){const n=t.inputs?t.inputs.length:0,a=200,s=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(r.fillStyle="#111",r.globalAlpha=.8,r.beginPath(),r.roundRect(10,10,a,(n+1)*s+50,[8]),r.fill(),r.globalAlpha=1,r.fillStyle="#888",r.font="14px Arial",r.textAlign="left",r.fillText("Graph Inputs",20,34),this.drawButton(a-20,20,20,20,"X","#151515")){this.closeSubgraph();return}let o=50;if(r.font="14px Arial",t.inputs)for(let l=0;l<t.inputs.length;++l){const c=t.inputs[l];if(!c.not_subgraph_input){if(this.drawButton(20,o+2,a-20,s-2)){const u=t.constructor.input_node_type||"graph/input";this.graph.beforeChange();const h=LiteGraph.createNode(u);h?(e.add(h),this.block_click=!1,this.last_click_position=null,this.selectNodes([h]),this.node_dragged=h,this.dragging_canvas=!1,h.setProperty("name",c.name),h.setProperty("type",c.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",u)}r.fillStyle="#9C9",r.beginPath(),r.arc(a-16,o+s*.5,5,0,2*Math.PI),r.fill(),r.fillStyle="#AAA",r.fillText(c.name,30,o+s*.75),r.fillStyle="#777",r.fillText(c.type,130,o+s*.75),o+=s}}this.drawButton(20,o+2,a-20,s-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(t)}drawSubgraphPanelRight(e,t,r){const n=t.outputs?t.outputs.length:0,a=this.bgcanvas.width,s=200,o=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);r.fillStyle="#111",r.globalAlpha=.8,r.beginPath(),r.roundRect(a-s-10,10,s,(n+1)*o+50,[8]),r.fill(),r.globalAlpha=1,r.fillStyle="#888",r.font="14px Arial",r.textAlign="left";const l="Graph Outputs",c=r.measureText(l).width;if(r.fillText(l,a-c-20,34),this.drawButton(a-s,20,20,20,"X","#151515")){this.closeSubgraph();return}let u=50;if(r.font="14px Arial",t.outputs)for(let h=0;h<t.outputs.length;++h){const d=t.outputs[h];if(!d.not_subgraph_input){if(this.drawButton(a-s,u+2,s-20,o-2)){const f=t.constructor.output_node_type||"graph/output";this.graph.beforeChange();const p=LiteGraph.createNode(f);p?(e.add(p),this.block_click=!1,this.last_click_position=null,this.selectNodes([p]),this.node_dragged=p,this.dragging_canvas=!1,p.setProperty("name",d.name),p.setProperty("type",d.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",f)}r.fillStyle="#9C9",r.beginPath(),r.arc(a-s+16,u+o*.5,5,0,2*Math.PI),r.fill(),r.fillStyle="#AAA",r.fillText(d.name,a-s+30,u+o*.75),r.fillStyle="#777",r.fillText(d.type,a-s+130,u+o*.75),u+=o}}this.drawButton(a-s,u+2,s-20,o-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(t)}drawButton(e,t,r,n,a,s,o,l){const c=this.ctx;s=s||LiteGraph.NODE_DEFAULT_COLOR,o=o||"#555",l=l||LiteGraph.NODE_TEXT_COLOR;let u=this.ds.convertOffsetToCanvas(this.graph_mouse);const h=LiteGraph.isInsideRectangle(u[0],u[1],e,t,r,n);if(u=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,u){const p=this.canvas.getBoundingClientRect();u[0]-=p.left,u[1]-=p.top}const d=u&&LiteGraph.isInsideRectangle(u[0],u[1],e,t,r,n);c.fillStyle=h?o:s,d&&(c.fillStyle="#AAA"),c.beginPath(),c.roundRect(e,t,r,n,[4]),c.fill(),a!=null&&a.constructor==String&&(c.fillStyle=l,c.textAlign="center",c.font=(n*.65|0)+"px Arial",c.fillText(a,e+r*.5,t+n*.75),c.textAlign="left");const f=d&&!this.block_click;return d&&this.blockClick(),f}isAreaClicked(e,t,r,n,a){let s=this.mouse;LiteGraph.isInsideRectangle(s[0],s[1],e,t,r,n),s=this.last_click_position;const o=s&&LiteGraph.isInsideRectangle(s[0],s[1],e,t,r,n),l=o&&!this.block_click;return o&&a&&this.blockClick(),l}renderInfo(e,t,r){t=t||10,r=r||this.canvas.height-80,e.save(),e.translate(t,r),e.font="10px Arial",e.fillStyle="#888",e.textAlign="left",this.graph?(e.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13*1),e.fillText("I: "+this.graph.iteration,5,13*2),e.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,13*3),e.fillText("V: "+this.graph._version,5,13*4),e.fillText("FPS:"+this.fps.toFixed(2),5,13*5)):e.fillText("No graph selected",5,13*1),e.restore()}drawBackCanvas(){const e=this.bgcanvas;(e.width!=this.canvas.width||e.height!=this.canvas.height)&&(e.width=this.canvas.width,e.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));const t=this.bgctx;t.start&&t.start();const r=this.viewport||[0,0,t.canvas.width,t.canvas.height];if(this.clear_background&&t.clearRect(r[0],r[1],r[2],r[3]),this._graph_stack&&this._graph_stack.length){t.save(),this._graph_stack[this._graph_stack.length-1];const a=this.graph._subgraph_node;t.strokeStyle=a.bgcolor,t.lineWidth=10,t.strokeRect(1,1,e.width-2,e.height-2),t.lineWidth=1,t.font="40px Arial",t.textAlign="center",t.fillStyle=a.bgcolor||"#AAA";let s="";for(let o=1;o<this._graph_stack.length;++o)s+=this._graph_stack[o]._subgraph_node.getTitle()+" >> ";t.fillText(s+a.getTitle(),e.width*.5,40),t.restore()}let n=!1;if(this.onRenderBackground&&(n=this.onRenderBackground(e,t)),this.viewport||(t.restore(),t.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(t.save(),this.ds.toCanvasContext(t),this.ds.scale<1.5&&!n&&this.clear_background_color&&(t.fillStyle=this.clear_background_color,t.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!n){if(this.zoom_modify_alpha?t.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:t.globalAlpha=this.editor_alpha,t.imageSmoothingEnabled=t.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;const s=this;this._bg_img.onload=function(){s.draw(!0,!0)}}let a=null;this._pattern==null&&this._bg_img.width>0?(a=t.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=a):a=this._pattern,a&&(t.fillStyle=a,t.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),t.fillStyle="transparent"),t.globalAlpha=1,t.imageSmoothingEnabled=t.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(e,t),this.onDrawBackground&&this.onDrawBackground(t,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(t.strokeStyle="#235",t.strokeRect(0,0,e.width,e.height)),this.render_connections_shadows?(t.shadowColor="#000",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=6):t.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(t),t.shadowColor="rgba(0,0,0,0)",t.restore()}t.finish&&t.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}drawNode(e,t){var b;const r=new Float32Array(2);this.current_node=e;const n=e.color||e.constructor.color||LiteGraph.NODE_DEFAULT_COLOR;let a=e.bgcolor||e.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;e.mouseOver;const s=this.ds.scale<.6;if(this.live_mode){e.flags.collapsed||(t.shadowColor="transparent",e.onDrawForeground&&e.onDrawForeground(t,this,this.canvas));return}const o=this.editor_alpha;if(t.globalAlpha=o,this.render_shadows&&!s?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.shadowOffsetX=2*this.ds.scale,t.shadowOffsetY=2*this.ds.scale,t.shadowBlur=3*this.ds.scale):t.shadowColor="transparent",e.flags.collapsed&&e.onDrawCollapsed&&e.onDrawCollapsed(t,this)==!0)return;const l=e._shape||LiteGraph.BOX_SHAPE,c=r;r.set(e.size);const u=e.horizontal;if(e.flags.collapsed){t.font=this.inner_text_font;const m=e.getTitle?e.getTitle():e.title;m!=null&&(e._collapsed_width=Math.min(e.size[0],t.measureText(m).width+LiteGraph.NODE_TITLE_HEIGHT*2),c[0]=e._collapsed_width,c[1]=0)}e.clip_area&&(t.save(),t.beginPath(),l==LiteGraph.BOX_SHAPE?t.rect(0,0,c[0],c[1]):l==LiteGraph.ROUND_SHAPE?t.roundRect(0,0,c[0],c[1],[10]):l==LiteGraph.CIRCLE_SHAPE&&t.arc(c[0]*.5,c[1]*.5,c[0]*.5,0,Math.PI*2),t.clip()),e.has_errors&&(a="red"),this.drawNodeShape(e,t,c,n,a,e.is_selected,e.mouseOver),t.shadowColor="transparent",e.onDrawForeground&&e.onDrawForeground(t,this,this.canvas),t.textAlign=u?"center":"left",t.font=this.inner_text_font;const h=!s,d=this.connecting_output,f=this.connecting_input;t.lineWidth=1;let p=0;const g=new Float32Array(2);if(e.flags.collapsed){if(this.render_collapsed_slots){let m=null,E=null;if(e.inputs)for(let L=0;L<e.inputs.length;L++){const T=e.inputs[L];if(T.link!=null){m=T;break}}if(e.outputs)for(let L=0;L<e.outputs.length;L++){const T=e.outputs[L];T.links&&T.links.length&&(E=T)}if(m){let L=0,T=LiteGraph.NODE_TITLE_HEIGHT*-.5;u&&(L=e._collapsed_width*.5,T=-LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#686",t.beginPath(),m.type===LiteGraph.EVENT||m.shape===LiteGraph.BOX_SHAPE?t.rect(L-7+.5,T-4,14,8):m.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(L+8,T),t.lineTo(L-4,T-4),t.lineTo(L-4,T+4),t.closePath()):t.arc(L,T,4,0,Math.PI*2),t.fill()}if(E){let L=e._collapsed_width,T=LiteGraph.NODE_TITLE_HEIGHT*-.5;u&&(L=e._collapsed_width*.5,T=0),t.fillStyle="#686",t.strokeStyle="black",t.beginPath(),E.type===LiteGraph.EVENT||E.shape===LiteGraph.BOX_SHAPE?t.rect(L-7+.5,T-4,14,8):E.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(L+6,T),t.lineTo(L-6,T-4),t.lineTo(L-6,T+4),t.closePath()):t.arc(L,T,4,0,Math.PI*2),t.fill()}}}else{if(e.inputs)for(let m=0;m<e.inputs.length;m++){const E=e.inputs[m],L=E.type;let T=E.shape;t.globalAlpha=o,this.connecting_output&&!LiteGraph.isValidConnection(E.type,d.type)&&(t.globalAlpha=.4*o),t.fillStyle=E.link!=null?E.color_on||this.default_connection_color_byType[L]||this.default_connection_color.input_on:E.color_off||this.default_connection_color_byTypeOff[L]||this.default_connection_color_byType[L]||this.default_connection_color.input_off;const _=e.getConnectionPos(!0,m,g);if(_[0]-=e.pos[0],_[1]-=e.pos[1],p<_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(p=_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.beginPath(),L=="array"&&(T=LiteGraph.GRID_SHAPE),E.type===LiteGraph.EVENT||E.shape===LiteGraph.BOX_SHAPE?u?t.rect(_[0]-5+.5,_[1]-8+.5,10,14):t.rect(_[0]-6+.5,_[1]-5+.5,14,10):T===LiteGraph.ARROW_SHAPE?(t.moveTo(_[0]+8,_[1]+.5),t.lineTo(_[0]-4,_[1]+6+.5),t.lineTo(_[0]-4,_[1]-6+.5),t.closePath()):T===LiteGraph.GRID_SHAPE?(t.rect(_[0]-4,_[1]-4,2,2),t.rect(_[0]-1,_[1]-4,2,2),t.rect(_[0]+2,_[1]-4,2,2),t.rect(_[0]-4,_[1]-1,2,2),t.rect(_[0]-1,_[1]-1,2,2),t.rect(_[0]+2,_[1]-1,2,2),t.rect(_[0]-4,_[1]+2,2,2),t.rect(_[0]-1,_[1]+2,2,2),t.rect(_[0]+2,_[1]+2,2,2)):s?t.rect(_[0]-4,_[1]-4,8,8):t.arc(_[0],_[1],4,0,Math.PI*2),t.fill(),h){const A=E.label!=null?E.label:E.name;A&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,u||E.dir==LiteGraph.UP?t.fillText(A,_[0],_[1]-10):this.options.useWebgl?t.fillText(A,_[0]+10,_[1]+2):t.fillText(A,_[0]+10,_[1]+5))}}if(t.textAlign=u?"center":"right",t.strokeStyle="black",e.outputs)for(let m=0;m<e.outputs.length;m++){const E=e.outputs[m],L=E.type;let T=E.shape;this.connecting_input&&!LiteGraph.isValidConnection(L,f.type)&&(t.globalAlpha=.4*o);const _=e.getConnectionPos(!1,m,g);_[0]-=e.pos[0],_[1]-=e.pos[1],p<_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(p=_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fillStyle=E.links&&E.links.length?E.color_on||this.default_connection_color_byType[L]||this.default_connection_color.output_on:E.color_off||this.default_connection_color_byTypeOff[L]||this.default_connection_color_byType[L]||this.default_connection_color.output_off,t.beginPath(),L=="array"&&(T=LiteGraph.GRID_SHAPE);let A=!0;if(L===LiteGraph.EVENT||T===LiteGraph.BOX_SHAPE?u?t.rect(_[0]-5+.5,_[1]-8+.5,10,14):t.rect(_[0]-6+.5,_[1]-5+.5,14,10):T===LiteGraph.ARROW_SHAPE?(t.moveTo(_[0]+8,_[1]+.5),t.lineTo(_[0]-4,_[1]+6+.5),t.lineTo(_[0]-4,_[1]-6+.5),t.closePath()):T===LiteGraph.GRID_SHAPE?(t.rect(_[0]-4,_[1]-4,2,2),t.rect(_[0]-1,_[1]-4,2,2),t.rect(_[0]+2,_[1]-4,2,2),t.rect(_[0]-4,_[1]-1,2,2),t.rect(_[0]-1,_[1]-1,2,2),t.rect(_[0]+2,_[1]-1,2,2),t.rect(_[0]-4,_[1]+2,2,2),t.rect(_[0]-1,_[1]+2,2,2),t.rect(_[0]+2,_[1]+2,2,2),A=!1):s?t.rect(_[0]-4,_[1]-4,8,8):t.arc(_[0],_[1],4,0,Math.PI*2),t.fill(),!s&&A&&t.stroke(),h){const M=E.label!=null?E.label:E.name;if(M)if(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,u||E.dir==LiteGraph.DOWN)t.fillText(M,_[0],_[1]-8);else if(this.options.useWebgl){t.textBaseline="middle";const S=((b=t.measureText(M))==null?void 0:b.width)||0;t.fillText(M,_[0]-S-10,_[1]+2)}else t.fillText(M,_[0]-10,_[1]+5)}}if(t.textAlign="left",t.globalAlpha=1,e.widgets){let m=p;(u||e.widgets_up)&&(m=2),e.widgets_start_y!=null&&(m=e.widgets_start_y),this.drawNodeWidgets(e,m,t,this.node_widget&&this.node_widget[0]==e?this.node_widget[1]:null)}}e.clip_area&&t.restore(),t.globalAlpha=1}drawLinkTooltip(e,t){const r=t._pos;if(e.fillStyle="black",e.beginPath(),e.arc(r[0],r[1],3,0,Math.PI*2),e.fill(),t.data==null||this.onDrawLinkTooltip&&this.onDrawLinkTooltip(e,t,this)==!0)return;const n=t.data;let a=null;if(n.constructor===Number?a=n.toFixed(2):n.constructor===String?a='"'+n+'"':n.constructor===Boolean?a=String(n):n.toToolTip?a=n.toToolTip():a="["+n.constructor.name+"]",a==null)return;a=a.substr(0,30),e.font="14px Courier New";const o=e.measureText(a).width+20,l=24;e.shadowColor="black",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=3,e.fillStyle="#454",e.beginPath(),e.roundRect(r[0]-o*.5,r[1]-15-l,o,l,[3]),e.moveTo(r[0]-10,r[1]-15),e.lineTo(r[0]+10,r[1]-15),e.lineTo(r[0],r[1]-5),e.fill(),e.shadowColor="transparent",e.textAlign="center",e.fillStyle="#CEC",e.fillText(a,r[0],r[1]-15-l*.3)}drawNodeShape(e,t,r,n,a,s,o){const l=new Float32Array(4);t.strokeStyle=n,t.fillStyle=a;const c=LiteGraph.NODE_TITLE_HEIGHT,u=this.ds.scale<.5,h=e._shape||e.constructor.shape||LiteGraph.ROUND_SHAPE,d=e.constructor.title_mode;let f=!0;d==LiteGraph.TRANSPARENT_TITLE||d==LiteGraph.NO_TITLE?f=!1:d==LiteGraph.AUTOHIDE_TITLE&&o&&(f=!0);const p=l;p[0]=0,p[1]=f?-c:0,p[2]=r[0]+1,p[3]=f?r[1]+c:r[1];const g=t.globalAlpha;if(t.beginPath(),h==LiteGraph.BOX_SHAPE||u?t.fillRect(p[0],p[1],p[2],p[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE?t.roundRect(p[0],p[1],p[2],p[3],h==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):h==LiteGraph.CIRCLE_SHAPE&&t.arc(r[0]*.5,r[1]*.5,r[0]*.5,0,Math.PI*2),t.fill(),!e.flags.collapsed&&f&&(t.shadowColor="transparent",t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,-1,p[2],2)),t.shadowColor="transparent",e.onDrawBackground&&e.onDrawBackground(t,this,this.canvas,this.graph_mouse),f||d==LiteGraph.TRANSPARENT_TITLE){if(e.onDrawTitleBar)e.onDrawTitleBar(t,c,r,this.ds.scale,n);else if(d!=LiteGraph.TRANSPARENT_TITLE&&(e.constructor.title_color||this.render_title_colored)){const E=e.constructor.title_color||n;if(e.flags.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){let L=_LGraphCanvas.gradients[E];L||(L=_LGraphCanvas.gradients[E]=t.createLinearGradient(0,0,400,0),L.addColorStop(0,E),L.addColorStop(1,"#000")),t.fillStyle=L}else t.fillStyle=E;t.beginPath(),h==LiteGraph.BOX_SHAPE||u?t.rect(0,-c,r[0]+1,c):(h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE)&&t.roundRect(0,-c,r[0]+1,c,e.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),t.fill(),t.shadowColor="transparent"}let b=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[e.mode]&&(b=LiteGraph.NODE_MODES_COLORS[e.mode]),LiteGraph.node_box_coloured_when_on&&(b=e.action_triggered?"#FFF":e.execute_triggered?"#AAA":b);const m=10;if(e.onDrawTitleBox?e.onDrawTitleBox(t,c,r,this.ds.scale):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CIRCLE_SHAPE||h==LiteGraph.CARD_SHAPE?(u&&(t.fillStyle="black",t.beginPath(),t.arc(c*.5,c*-.5,m*.5+1,0,Math.PI*2),t.fill()),t.fillStyle=e.boxcolor||b||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?t.fillRect(c*.5-m*.5,c*-.5-m*.5,m,m):(t.beginPath(),t.arc(c*.5,c*-.5,m*.5,0,Math.PI*2),t.fill())):(u&&(t.fillStyle="black",t.fillRect((c-m)*.5-1,(c+m)*-.5-1,m+2,m+2)),t.fillStyle=e.boxcolor||b||LiteGraph.NODE_DEFAULT_BOXCOLOR,t.fillRect((c-m)*.5,(c+m)*-.5,m,m)),t.globalAlpha=g,e.onDrawTitleText&&e.onDrawTitleText(t,c,r,this.ds.scale,this.title_text_font,s),!u){t.font=this.title_text_font;const E=String(e.getTitle());E&&(s?t.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:t.fillStyle=e.constructor.title_text_color||this.node_title_color,e.flags.collapsed?(t.textAlign="left",t.measureText(E),t.fillText(E.substr(0,20),c,LiteGraph.NODE_TITLE_TEXT_Y-c),t.textAlign="left"):(t.textAlign="left",t.fillText(E,c,LiteGraph.NODE_TITLE_TEXT_Y-c)))}if(!e.flags.collapsed&&e.subgraph&&!e.skip_subgraph_button){const E=LiteGraph.NODE_TITLE_HEIGHT,L=e.size[0]-E,T=LiteGraph.isInsideRectangle(this.graph_mouse[0]-e.pos[0],this.graph_mouse[1]-e.pos[1],L+2,-E+2,E-4,E-4);t.fillStyle=T?"#888":"#555",h==LiteGraph.BOX_SHAPE||u?t.fillRect(L+2,-E+2,E-4,E-4):(t.beginPath(),t.roundRect(L+2,-E+2,E-4,E-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(L+E*.2,-E*.6),t.lineTo(L+E*.8,-E*.6),t.lineTo(L+E*.5,-E*.3),t.fill()}e.onDrawTitle&&e.onDrawTitle(t)}s&&(e.onBounding&&e.onBounding(p),d==LiteGraph.TRANSPARENT_TITLE&&(p[1]-=c,p[3]+=c),t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),h==LiteGraph.BOX_SHAPE?t.rect(-6+p[0],-6+p[1],12+p[2],12+p[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE&&e.flags.collapsed?t.roundRect(-6+p[0],-6+p[1],12+p[2],12+p[3],[this.round_radius*2]):h==LiteGraph.CARD_SHAPE?t.roundRect(-6+p[0],-6+p[1],12+p[2],12+p[3],[this.round_radius*2,2,this.round_radius*2,2]):h==LiteGraph.CIRCLE_SHAPE&&t.arc(r[0]*.5,r[1]*.5,r[0]*.5+6,0,Math.PI*2),t.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.stroke(),t.strokeStyle=n,t.globalAlpha=1),e.execute_triggered>0&&e.execute_triggered--,e.action_triggered>0&&e.action_triggered--}drawConnections(e){const t=new Float32Array(4),r=new Float32Array(4),n=new Float32Array(2),a=new Float32Array(2),s=LiteGraph.getTime(),o=this.visible_area;t[0]=o[0]-20,t[1]=o[1]-20,t[2]=o[2]+40,t[3]=o[3]+40,e.lineWidth=this.connections_width,e.fillStyle="#AAA",e.strokeStyle="#AAA",e.globalAlpha=this.editor_alpha;const l=this.graph._nodes;for(let c=0,u=l.length;c<u;++c){const h=l[c];if(!(!h.inputs||!h.inputs.length))for(let d=0;d<h.inputs.length;++d){const f=h.inputs[d];if(!f||f.link==null)continue;const p=f.link,g=this.graph.links[p];if(!g)continue;const b=this.graph.getNodeById(g.origin_id);if(b==null)continue;let m=g.origin_slot,E=null;m==-1?E=[b.pos[0]+10,b.pos[1]+10]:E=b.getConnectionPos(!1,m,n);const L=h.getConnectionPos(!0,d,a);if(r[0]=E[0],r[1]=E[1],r[2]=L[0]-E[0],r[3]=L[1]-E[1],r[2]<0&&(r[0]+=r[2],r[2]=Math.abs(r[2])),r[3]<0&&(r[1]+=r[3],r[3]=Math.abs(r[3])),!LiteGraph.overlapBounding(r,t))continue;const T=b.outputs[m],_=h.inputs[d];if(!T||!_)continue;const A=T.dir||(b.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),M=_.dir||(h.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.ALWAYS_FLOW)this.renderLink(e,E,L,g,!0,1,"white",A,M);else if(this.renderLink(e,E,L,g,!1,0,null,A,M),g&&g._last_time&&s-g._last_time<1e3){const S=2-(s-g._last_time)*.002,N=e.globalAlpha;e.globalAlpha=N*S,this.renderLink(e,E,L,g,!0,S,"white",A,M),e.globalAlpha=N}}}e.globalAlpha=1}showGrpPanel(e){this.closePanels();const t=this.getCanvasWindow(),r=this,n=this.createPanel(e.title||"",{closable:!0,window:t,onOpen:function(){r.NODEPANEL_IS_OPEN=!0},onClose:function(){r.NODEPANEL_IS_OPEN=!1,r.node_panel=null}});r.node_panel=n,n.id="node-panel",n.node=e,n.classList.add("settings");function a(){n.content.innerHTML="",n.addHTML("<h4>속성</h4>","panel-section");const s=(o,l)=>{switch(r.graph.beforeChange(e),r.saveUndoStack(),o){case"Title":e.title=l;break;case"Color":_LGraphCanvas.node_colors[l]?e.color=_LGraphCanvas.node_colors[l].groupcolor:console.warn("unexpected color: "+l);break;case"X":e.move(parseInt(l)-e.pos[0],0);break;case"Y":e.move(0,parseInt(l)-e.pos[1]);break;case"넓이":e.size[0]=parseInt(l);break;case"높이":e.size[1]=parseInt(l);break}r.graph.afterChange(),r.dirty_canvas=!0};n.addWidget("string","Title",e.title,{},s),e.id&&n.addWidget("string","그룹 아이디",e.id,{},s),e.status&&n.addWidget("string","상태",e.status,{disabled:!0},s),n.addWidget("number","X",e.pos[0],{min:0},s),n.addWidget("number","Y",e.pos[1],{min:0},s),n.addWidget("number","넓이",e.size[0],{min:0},s),n.addWidget("number","높이",e.size[1],{min:0},s),n.addSeparator()}a(),this.canvas.parentNode.appendChild(n)}drawGuideLines(e,{roundX:t,roundY:r,roundWidth:n,roundHeight:a,otherRoundX:s,otherRoundY:o,otherRoundWidth:l,otherRoundHeight:c}){l===n&&(e.beginPath(),e.moveTo(t,r-10),e.lineTo(t,r+a+10),e.stroke(),e.beginPath(),e.moveTo(t+ +n,r-10),e.lineTo(t+n,r+a+10),e.stroke(),e.beginPath(),e.moveTo(s,o-10),e.lineTo(s,o+c+10),e.stroke(),e.beginPath(),e.moveTo(s+l,o-10),e.lineTo(s+l,o+c+10),e.stroke()),c===a&&(e.beginPath(),e.moveTo(t-10,r),e.lineTo(t+n+10,r),e.stroke(),e.beginPath(),e.moveTo(t-10,r+a),e.lineTo(t+n+10,r+a),e.stroke(),e.beginPath(),e.moveTo(s-10,o),e.lineTo(s+l+10,o),e.stroke(),e.beginPath(),e.moveTo(s-10,o+c),e.lineTo(s+l+10,o+c),e.stroke()),s===t&&(r<o?(e.beginPath(),e.moveTo(t,r),e.lineTo(s,o+c),e.stroke()):(e.beginPath(),e.moveTo(s,o),e.lineTo(t,r+a),e.stroke())),s+l===t+n&&(r<o?(e.beginPath(),e.moveTo(t+n,r),e.lineTo(s+l,o+c),e.stroke()):(e.beginPath(),e.moveTo(s+l,o),e.lineTo(t+n,r+a),e.stroke())),o===r&&(t<s?(e.beginPath(),e.moveTo(t,r),e.lineTo(s+l,o),e.stroke()):(e.beginPath(),e.moveTo(s,o),e.lineTo(t+n,r),e.stroke())),o+c===r+a&&(t<s?(e.beginPath(),e.moveTo(t,r+a),e.lineTo(s+l,o+c),e.stroke()):(e.beginPath(),e.moveTo(s,o+c),e.lineTo(t+n,r+a),e.stroke()))}drawGroups(e,t){var n,a,s,o,l;if(!this.graph)return;const r=this.graph._groups;t.save(),t.globalAlpha=.5*this.editor_alpha;for(let c=0;c<r.length;++c){const u=r[c];if(!LiteGraph.overlapBounding(this.visible_area,u._bounding))continue;const h=u._pos,d=u._size,f=u.color||_LGraphCanvas.node_colors.black.groupcolor;t.fillStyle=f,t.globalAlpha=.75,t.beginPath();const p=10;t.fillStyle=f,t.beginPath(),t.moveTo(h[0]+p,h[1]),t.lineTo(h[0]+d[0]-p,h[1]),t.quadraticCurveTo(h[0]+d[0],h[1],h[0]+d[0],h[1]+p),t.lineTo(h[0]+d[0],h[1]+d[1]-p),t.quadraticCurveTo(h[0]+d[0],h[1]+d[1],h[0]+d[0]-p,h[1]+d[1]),t.lineTo(h[0]+p,h[1]+d[1]),t.quadraticCurveTo(h[0],h[1]+d[1],h[0],h[1]+d[1]-p),t.lineTo(h[0],h[1]+p),t.quadraticCurveTo(h[0],h[1],h[0]+p,h[1]),t.closePath(),t.fill(),this.read_only||(t.fillStyle="#0085FF",t.beginPath(),t.moveTo(h[0]+d[0]-7,h[1]+d[1]),t.lineTo(h[0]+d[0],h[1]+d[1]),t.lineTo(h[0]+d[0],h[1]+d[1]-7),t.closePath(),t.fill());const g=LiteGraph.DEFAULT_GROUP_FONT_SIZE||20,b=u.font_size||g;if(t.fillStyle="#ffffff",t.font="Bold "+b+"px Arial",t.textAlign="left",t.fillText(u.title,h[0]+12,h[1]+b+8),!this.read_only){const m=u.font_size*.6;t.font=`${m}px Arial`,t.fillStyle="#c6c6c6";const E=`x/y/넓이/높이: ${parseInt(u.pos[0])}/${parseInt(u.pos[1])}/${parseInt(u.size[0])}/${parseInt(u.size[1])}`;let L="";for(let T=0;T<E.length;T++){const _=L+E[T]+"";if(t.measureText(_).width>u.size[0]-30&&T>0){L=L.slice(0,L.length-2),L+=" ..";break}else L=_}t.fillText(L,h[0]+10,h[1]+u.size[1]-12)}if(this.selected_group&&(u==null?void 0:u.id)!==((n=this.selected_group)==null?void 0:n.id)&&!this.read_only){t.strokeStyle="#c4c4c4",t.lineWidth=1;const m=(a=this.selected_group)==null?void 0:a.size[0],E=(s=this.selected_group)==null?void 0:s.size[1],L=(o=this.selected_group)==null?void 0:o.pos[0],T=(l=this.selected_group)==null?void 0:l.pos[1],_=u.size[0],A=u.size[1],M=u.pos[0],S=u.pos[1],N=Math.round(L),I=Math.round(T),P=Math.round(m),R=Math.round(E),C=Math.round(M),k=Math.round(S),D=Math.round(_),U=Math.round(A);this.drawGuideLines(t,{roundX:N,roundY:I,roundWidth:P,roundHeight:R,otherRoundX:C,otherRoundY:k,otherRoundWidth:D,otherRoundHeight:U})}}t.restore()}scaleFit(){this.canvas&&(this.ds.scale=1,this.ds.max_scale=1,this.ds.min_scale=1,window.innerWidth>=3840&&(this.ds.scale=2,this.ds.max_scale=2,this.ds.min_scale=2))}renderLink(e,t,r,n,a,s,o,l,c,u){if(o="#3b3b3b",n){const f=this.graph.getNodeById(n.origin_id),p=this.graph.getNodeById(n.target_id),g=f.properties.status,b=p.properties.status,m=f.properties.resultIndex;typeof m=="number"&&n.origin_slot===m&&(g===1&&b===1?o="#34c38f":g===-1||b===-1?o="#f46a6a":(g===0||b===0)&&(o="#3b3b3b"))}n&&this.visible_links.push(n),!o&&n&&(o=n.color||_LGraphCanvas.link_type_colors[n.type]),o||(o=this.default_link_color),n!=null&&this.highlighted_links[n.id]&&(o="#FFF"),l=l||LiteGraph.RIGHT,c=c||LiteGraph.LEFT;const h=LiteGraph.distance(t,r);this.render_connections_border&&this.ds.scale>.6&&(e.lineWidth=this.connections_width+4),e.lineJoin="round",u=u||1,u>1&&(e.lineWidth=.5),e.beginPath();for(let f=0;f<u;f+=1){const p=(f-(u-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){e.moveTo(t[0],t[1]+p);let g=0,b=0,m=0,E=0;switch(l){case LiteGraph.LEFT:g=h*-.25;break;case LiteGraph.RIGHT:g=h*.25;break;case LiteGraph.UP:b=h*-.25;break;case LiteGraph.DOWN:b=h*.25;break}switch(c){case LiteGraph.LEFT:m=h*-.25;break;case LiteGraph.RIGHT:m=h*.25;break;case LiteGraph.UP:E=h*-.25;break;case LiteGraph.DOWN:E=h*.25;break}e.bezierCurveTo(t[0]+g,t[1]+b+p,r[0]+m,r[1]+E+p,r[0],r[1]+p)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){e.moveTo(t[0],t[1]+p);let g=0,b=0,m=0,E=0;switch(l){case LiteGraph.LEFT:g=-1;break;case LiteGraph.RIGHT:g=1;break;case LiteGraph.UP:b=-1;break;case LiteGraph.DOWN:b=1;break}switch(c){case LiteGraph.LEFT:m=-1;break;case LiteGraph.RIGHT:m=1;break;case LiteGraph.UP:E=-1;break;case LiteGraph.DOWN:E=1;break}const L=15;e.lineTo(t[0]+g*L,t[1]+b*L+p),e.lineTo(r[0]+m*L,r[1]+E*L+p),e.lineTo(r[0],r[1]+p)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){e.moveTo(t[0],t[1]);let g=t[0],b=t[1],m=r[0],E=r[1];l==LiteGraph.RIGHT?g+=10:b+=10,c==LiteGraph.LEFT?m-=10:E-=10,e.lineTo(g,b),e.lineTo((g+m)*.5,b),e.lineTo((g+m)*.5,E),e.lineTo(m,E),e.lineTo(r[0],r[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!a&&(e.strokeStyle="rgba(0,0,0,0.5)",e.stroke()),e.lineWidth=this.connections_width,e.fillStyle=e.strokeStyle=o,e.stroke();let d=this.computeConnectionPoint(t,r,.5,l,c);if(n&&n._pos&&(n._pos[0]=d[0],n._pos[1]=d[1]),this.ds.scale>=.6&&this.highquality_render&&c!=LiteGraph.CENTER&&!this.read_only){if(this.render_connection_arrows){const f=this.computeConnectionPoint(t,r,.25,l,c),p=this.computeConnectionPoint(t,r,.26,l,c),g=this.computeConnectionPoint(t,r,.75,l,c),b=this.computeConnectionPoint(t,r,.76,l,c);let m=0,E=0;this.render_curved_connections?(m=-Math.atan2(p[0]-f[0],p[1]-f[1]),E=-Math.atan2(b[0]-g[0],b[1]-g[1])):E=m=r[1]>t[1]?0:Math.PI,e.save(),e.translate(f[0],f[1]),e.rotate(m),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore(),e.save(),e.translate(g[0],g[1]),e.rotate(E),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore()}e.beginPath(),e.arc(d[0],d[1],5,0,Math.PI*2),e.fill()}if(s){e.fillStyle=o;for(let f=0;f<3;++f){let p=(LiteGraph.getTime()*2e-4+f*.2)%1;if(this.links_render_mode===LiteGraph.STRAIGHT_LINK){let g=t[0],b=t[1],m=r[0],E=r[1];l==LiteGraph.RIGHT?g+=10:l==LiteGraph.LEFT?g-=10:l==LiteGraph.DOWN?b+=10:l==LiteGraph.UP&&(b-=10),c==LiteGraph.LEFT?m-=10:c==LiteGraph.RIGHT?m+=10:c==LiteGraph.UP?E-=10:c==LiteGraph.DOWN&&(E+=10);const L=(g+m)*.5,T=Math.abs(L-g),_=Math.abs(E-b),A=Math.abs(m-L),M=T+_+A,S=p*M;let N=[g,b];if(S<=T)N=[g+S*(g<L?1:-1),b];else if(S<=T+_){const I=S-T;b<E?N=[L,b+I]:N=[L,b-I]}else if(S<=M){const I=S-(T+_);N=[L+I*(L<m?1:-1),E]}e.beginPath(),e.arc(N[0],N[1],5,0,2*Math.PI),e.fill()}else d=this.computeConnectionPoint(t,r,p,l,c);e.beginPath(),e.arc(d[0],d[1],5,0,2*Math.PI),e.fill()}}}computeConnectionPoint(e,t,r,n,a){n=n||LiteGraph.RIGHT,a=a||LiteGraph.LEFT;const s=LiteGraph.distance(e,t),o=e,l=[e[0],e[1]],c=[t[0],t[1]],u=t;switch(n){case LiteGraph.LEFT:l[0]+=s*-.25;break;case LiteGraph.RIGHT:l[0]+=s*.25;break;case LiteGraph.UP:l[1]+=s*-.25;break;case LiteGraph.DOWN:l[1]+=s*.25;break}switch(a){case LiteGraph.LEFT:c[0]+=s*-.25;break;case LiteGraph.RIGHT:c[0]+=s*.25;break;case LiteGraph.UP:c[1]+=s*-.25;break;case LiteGraph.DOWN:c[1]+=s*.25;break}const h=(1-r)*(1-r)*(1-r),d=3*((1-r)*(1-r))*r,f=3*(1-r)*(r*r),p=r*r*r,g=h*o[0]+d*l[0]+f*c[0]+p*u[0],b=h*o[1]+d*l[1]+f*c[1]+p*u[1];return[g,b]}drawExecutionOrder(e){e.shadowColor="transparent",e.globalAlpha=.25,e.textAlign="center",e.strokeStyle="white",e.globalAlpha=.75;const t=this.visible_nodes;for(let r=0;r<t.length;++r){const n=t[r];e.fillStyle="black",e.fillRect(n.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,n.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),n.order==0&&e.strokeRect(n.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,n.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#FFF",e.fillText(n.order,n.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,n.pos[1]-6)}e.globalAlpha=1}drawNodeWidgets(e,t,r,n){if(!e.widgets||!e.widgets.length)return 0;const a=e.size[0],s=e.widgets;t+=2;const o=LiteGraph.NODE_WIDGET_HEIGHT,l=this.ds.scale>.5;r.save(),r.globalAlpha=this.editor_alpha;const c=LiteGraph.WIDGET_OUTLINE_COLOR,u=LiteGraph.WIDGET_BGCOLOR,h=LiteGraph.WIDGET_TEXT_COLOR,d=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,f=15;for(let p=0;p<s.length;++p){let g=s[p],b=t;g.y&&(b=g.y),g.last_y=b,r.strokeStyle=c,r.fillStyle="#222",r.textAlign="left",g.disabled&&(r.globalAlpha*=.5);const m=g.width||a;let E=g.options.max-g.options.min,L=(g.value-g.options.min)/E;switch(g.type){case"button":g.clicked&&(r.fillStyle="#AAA",g.clicked=!1,this.dirty_canvas=!0),r.fillRect(f,b,m-f*2,o),l&&!g.disabled&&r.strokeRect(f,b,m-f*2,o),l&&(r.textAlign="center",r.fillStyle=h,r.fillText(g.label||g.name,m*.5,b+o*.7));break;case"toggle":if(r.textAlign="left",r.strokeStyle=c,r.fillStyle=u,r.beginPath(),l?r.roundRect(f,b,m-f*2,o,[o*.5]):r.rect(f,b,m-f*2,o),r.fill(),l&&!g.disabled&&r.stroke(),r.fillStyle=g.value?"#89A":"#333",r.beginPath(),r.arc(m-f*2,b+o*.5,o*.36,0,Math.PI*2),r.fill(),l){r.fillStyle=d;const T=g.label||g.name;T!=null&&r.fillText(T,f*2,b+o*.7),r.fillStyle=g.value?h:d,r.textAlign="right",r.fillText(g.value?g.options.on||"true":g.options.off||"false",m-40,b+o*.7)}break;case"slider":if(r.fillStyle=u,r.fillRect(f,b,m-f*2,o),L<0&&(L=0),L>1&&(L=1),r.fillStyle=Object.prototype.hasOwnProperty.call(g.options,"slider_color")?g.options.slider_color:n==g?"#89A":"#678",r.fillRect(f,b,L*(m-f*2),o),l&&!g.disabled&&r.strokeRect(f,b,m-f*2,o),g.marker){let T=(g.marker-g.options.min)/E;T<0&&(T=0),T>1&&(T=1),r.fillStyle=Object.prototype.hasOwnProperty.call(g.options,"marker_color")?g.options.marker_color:"#AA9",r.fillRect(f+T*(m-f*2),b,2,o)}l&&(r.textAlign="center",r.fillStyle=h,r.fillText(g.label||g.name+"  "+Number(g.value).toFixed(g.options.precision!=null?g.options.precision:3),m*.5,b+o*.7));break;case"number":case"combo":if(r.textAlign="left",r.strokeStyle=c,r.fillStyle=u,r.beginPath(),l?r.roundRect(f,b,m-f*2,o,[o*.5]):r.rect(f,b,m-f*2,o),r.fill(),l)if(g.disabled||r.stroke(),r.fillStyle=h,g.disabled||(r.beginPath(),r.moveTo(f+16,b+5),r.lineTo(f+6,b+o*.5),r.lineTo(f+16,b+o-5),r.fill(),r.beginPath(),r.moveTo(m-f-16,b+5),r.lineTo(m-f-6,b+o*.5),r.lineTo(m-f-16,b+o-5),r.fill()),r.fillStyle=d,r.fillText(g.label||g.name,f*2+5,b+o*.7),r.fillStyle=h,r.textAlign="right",g.type=="number")r.fillText(Number(g.value).toFixed(g.options.precision!==void 0?g.options.precision:3),m-f*2-20,b+o*.7);else{let T=g.value;if(g.options.values){let _=g.options.values;_.constructor===Function&&(_=_()),_&&_.constructor!==Array&&(T=_[g.value])}r.fillText(T,m-f*2-20,b+o*.7)}break;case"string":case"text":if(r.textAlign="left",r.strokeStyle=c,r.fillStyle=u,r.beginPath(),l?r.roundRect(f,b,m-f*2,o,[o*.5]):r.rect(f,b,m-f*2,o),r.fill(),l){g.disabled||r.stroke(),r.save(),r.beginPath(),r.rect(f,b,m-f*2,o),r.clip(),r.fillStyle=d;const T=g.label||g.name;T!=null&&r.fillText(T,f*2,b+o*.7),r.fillStyle=h,r.textAlign="right",r.fillText(String(g.value).substr(0,30),m-f*2,b+o*.7),r.restore()}break;default:g.draw&&g.draw(r,e,m,b,o);break}t+=(g.computeSize?g.computeSize(m)[1]:o)+4,r.globalAlpha=this.editor_alpha}r.restore(),r.textAlign="left"}processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;const x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){const w=node.widgets[i];if(!w||w.disabled)continue;const widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))continue;const old_value=w.value;let _old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,_old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){let e=w.options.values;e&&e.constructor===Function&&(e=w.options.values(w,node));let t=null;w.type!="number"&&(t=e.constructor===Array?e:Object.keys(e));const r=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=r*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(r){let n=-1;this.last_mouseclick=0,e.constructor===Object?n=t.indexOf(String(w.value))+r:n=t.indexOf(w.value)+r,n>=t.length&&(n=t.length-1),n<0&&(n=0),e.constructor===Array?w.value=e[n]:w.value=n}else{let a=function(s,o,l){return e!=t&&(s=n.indexOf(s)),this.value=s,inner_value_change(this,s),that.dirty_canvas=!0,!1};const n=e!=t?Object.values(e):e;new ContextMenu(n,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:a.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){const delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(e){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(e){inner_value_change(this,e)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}function inner_value_change(e,t){e.type=="number"&&(t=Number(t)),e.value=t,e.options&&e.options.property&&node.properties[e.options.property]!==void 0&&node.setProperty(e.options.property,t),e.callback&&e.callback(e.value,that,node,pos,event)}return null}adjustNodesSize(){const e=this.graph._nodes;for(let t=0;t<e.length;++t)e[t].size=e[t].computeSize();this.setDirty(!0,!0)}resize(e,t){if(!e&&!t){const r=this.canvas.parentNode;e=r.offsetWidth,t=r.offsetHeight}this.canvas.width==e&&this.canvas.height==t||(this.canvas.width=e,this.canvas.height=t,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}switchLiveMode(e){if(!e){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}const t=this,r=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);const n=setInterval(function(){t.editor_alpha*=r,t.dirty_canvas=!0,t.dirty_bgcanvas=!0,r<1&&t.editor_alpha<.01&&(clearInterval(n),r<1&&(t.live_mode=!0)),r>1&&t.editor_alpha>.99&&(clearInterval(n),t.editor_alpha=1)},1)}onNodeSelectionChange(e){}static onGroupAdd(e,t,r){const n=_LGraphCanvas.active_canvas;n.getCanvasWindow();const a=new LGraphGroup;a.pos=n.convertEventToCanvasOffset(r),n.graph.add(a)}static getBoundaryNodes(e){let t=null,r=null,n=null,a=null;for(const s in e){const o=e[s],[l,c]=o.pos,[u,h]=o.size;(t===null||c<t.pos[1])&&(t=o),(r===null||l+u>r.pos[0]+r.size[0])&&(r=o),(n===null||c+h>n.pos[1]+n.size[1])&&(n=o),(a===null||l<a.pos[0])&&(a=o)}return{top:t,right:r,bottom:n,left:a}}boundaryNodesForSelection(){return _LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}static alignNodes(e,t,r){if(!e)return;const n=_LGraphCanvas.active_canvas;let a=[];r===void 0?a=_LGraphCanvas.getBoundaryNodes(e):a={top:r,right:r,bottom:r,left:r};for(const[s,o]of Object.entries(n.selected_nodes))switch(t){case"right":o.pos[0]=a.right.pos[0]+a.right.size[0]-o.size[0];break;case"left":o.pos[0]=a.left.pos[0];break;case"top":o.pos[1]=a.top.pos[1];break;case"bottom":o.pos[1]=a.bottom.pos[1]+a.bottom.size[1]-o.size[1];break}n.dirty_canvas=!0,n.dirty_bgcanvas=!0}static onNodeAlign(e,t,r,n,a){new ContextMenu(["Top","Bottom","Left","Right"],{event:r,callback:s,parentMenu:n});function s(o){_LGraphCanvas.alignNodes(_LGraphCanvas.active_canvas.selected_nodes,o.toLowerCase(),a)}}static onGroupAlign(e,t,r,n){new ContextMenu(["Top","Bottom","Left","Right"],{event:r,callback:a,parentMenu:n});function a(s){_LGraphCanvas.alignNodes(_LGraphCanvas.active_canvas.selected_nodes,s.toLowerCase())}}static onMenuAdd(e,t,r,n,a){const s=_LGraphCanvas.active_canvas,o=s.getCanvasWindow(),l=s.graph;if(!l)return;function c(u,h){const d=LiteGraph.getNodeTypesCategories(s.filter||l.filter).filter(function(g){return g.startsWith(u)}),f=[];d.map(function(g){if(!g)return;const b=new RegExp("^("+u+")"),m=g.replace(b,"").split("/")[0],E=u===""?m+"/":u+m+"/";let L=m;L.indexOf("::")!=-1&&(L=L.split("::")[1]),f.findIndex(function(_){return _.value===E})===-1&&f.push({value:E,content:L,has_submenu:!0,callback:function(_,A,M,S){c(_.value,S)}})}),LiteGraph.getNodeTypesInCategory(u.slice(0,-1),s.filter||l.filter).map(function(g){if(g.skip_list)return;const b={value:g.type,content:g.title,has_submenu:!1,callback:function(m,E,L,T){const _=T.getFirstEvent();s.graph.beforeChange();const A=LiteGraph.createNode(m.value);A&&(A.pos=s.convertEventToCanvasOffset(_),s.graph.add(A)),a&&a(A),s.graph.afterChange()}};f.push(b)}),new ContextMenu(f,{event:r,parentMenu:h},o)}return c("",n),!1}static onMenuCollapseAll(){}static onMenuNodeEdit(){}static showMenuNodeOptionalInputs(e,t,r,n,a){if(!a)return;const s=this,l=_LGraphCanvas.active_canvas.getCanvasWindow();let c=a.optional_inputs;a.onGetInputs&&(c=a.onGetInputs());let u=[];if(c)for(let d=0;d<c.length;d++){const f=c[d];if(!f){u.push(null);continue}let p=f[0];f[2]||(f[2]={}),f[2].label&&(p=f[2].label),f[2].removable=!0;const g={content:p,value:f};f[1]==LiteGraph.ACTION&&(g.className="event"),u.push(g)}if(a.onMenuNodeInputs){const d=a.onMenuNodeInputs(u);d&&(u=d)}if(!u.length){console.log("no input entries");return}new ContextMenu(u,{event:r,callback:h,parentMenu:n,node:a},l);function h(d,f,p){a&&(d.callback&&d.callback.call(s,a,d,f,p),d.value&&(a.graph.beforeChange(),a.addInput(d.value[0],d.value[1],d.value[2]),a.onNodeInputAdd&&a.onNodeInputAdd(d.value),a.setDirtyCanvas(!0,!0),a.graph.afterChange()))}return!1}static showMenuNodeOptionalOutputs(e,t,r,n,a){if(!a)return;const s=this,l=_LGraphCanvas.active_canvas.getCanvasWindow();let c=a.optional_outputs;a.onGetOutputs&&(c=a.onGetOutputs());let u=[];if(c)for(let d=0;d<c.length;d++){const f=c[d];if(!f){u.push(null);continue}if(a.flags&&a.flags.skip_repeated_outputs&&a.findOutputSlot(f[0])!=-1)continue;let p=f[0];f[2]||(f[2]={}),f[2].label&&(p=f[2].label),f[2].removable=!0;const g={content:p,value:f};f[1]==LiteGraph.EVENT&&(g.className="event"),u.push(g)}if(this.onMenuNodeOutputs&&(u=this.onMenuNodeOutputs(u)),LiteGraph.do_add_triggers_slots&&a.findOutputSlot("onExecuted")==-1&&u.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),a.onMenuNodeOutputs){const d=a.onMenuNodeOutputs(u);d&&(u=d)}if(!u.length)return;new ContextMenu(u,{event:r,callback:h,parentMenu:n,node:a},l);function h(d,f,p){if(!a||(d.callback&&d.callback.call(s,a,d,f,p),!d.value))return;const g=d.value[1];if(g&&(g.constructor===Object||g.constructor===Array)){const b=[];for(const m in g)b.push({content:m,value:g[m]});return new ContextMenu(b,{event:f,callback:h,parentMenu:n,node:a}),!1}else a.graph.beforeChange(),a.addOutput(d.value[0],d.value[1],d.value[2]),a.onNodeOutputAdd&&a.onNodeOutputAdd(d.value),a.setDirtyCanvas(!0,!0),a.graph.afterChange()}return!1}static onShowMenuNodeProperties(e,t,r,n,a){if(!a||!a.properties)return;const s=_LGraphCanvas.active_canvas,o=s.getCanvasWindow(),l=[];for(const u in a.properties){let h=a.properties[u]!==void 0?a.properties[u]:" ";typeof h=="object"&&(h=JSON.stringify(h));const d=a.getPropertyInfo(u);(d.type=="enum"||d.type=="combo")&&(h=_LGraphCanvas.getPropertyPrintableValue(h,d.values)),h=_LGraphCanvas.decodeHTML(h),l.push({content:"<span class='property_name'>"+(d.label?d.label:u)+"</span><span class='property_value'>"+h+"</span>",value:u})}if(!l.length)return;new ContextMenu(l,{event:r,callback:c,parentMenu:n,allow_html:!0,node:a},o);function c(u,h,d,f){if(!a)return;const p=this.getBoundingClientRect();s.showEditPropertyValue(a,u.value,{position:[p.left,p.top]})}return!1}static decodeHTML(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}static onMenuResizeNode(e,t,r,n,a){if(!a)return;const s=function(l){l.size=l.computeSize(),l.onResize&&l.onResize(l.size)},o=_LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)s(a);else for(const l in o.selected_nodes)s(o.selected_nodes[l]);a.setDirtyCanvas(!0,!0)}static showLinkMenu(e,t){const r=this,n=r.graph.getNodeById(e.origin_id),a=r.graph.getNodeById(e.target_id);let s=!1;n&&n.outputs&&n.outputs[e.origin_slot]&&(s=n.outputs[e.origin_slot].type);let o=!1;a&&a.outputs&&a.outputs[e.target_slot]&&(o=a.inputs[e.target_slot].type);const l=["Add Node",null,"Delete",null],c=new ContextMenu(l,{event:t,title:e.data!=null?e.data.constructor.name:null,callback:u});function u(h,d,f){switch(h){case"Add Node":_LGraphCanvas.onMenuAdd(null,null,f,c,function(p){!p.inputs||!p.inputs.length||!p.outputs||!p.outputs.length||n.connectByType(e.origin_slot,p,s)&&(p.connectByType(e.target_slot,a,o),p.pos[0]-=p.size[0]*.5)});break;case"Delete":r.graph.removeLink(e.id);break}}return!1}createDefaultNodeForSlot(e){const r=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},e||{}),n=this,a=r.nodeFrom&&r.slotFrom!==null,s=!a&&r.nodeTo&&r.slotTo!==null;if(!a&&!s)return console.warn("No data passed to createDefaultNodeForSlot "+r.nodeFrom+" "+r.slotFrom+" "+r.nodeTo+" "+r.slotTo),!1;if(!r.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;const o=a?r.nodeFrom:r.nodeTo;let l=a?r.slotFrom:r.slotTo,c=!1;switch(typeof l){case"string":c=a?o.findOutputSlot(l,!1):o.findInputSlot(l,!1),l=a?o.outputs[l]:o.inputs[l];break;case"object":c=a?o.findOutputSlot(l.name):o.findInputSlot(l.name);break;case"number":c=l,l=a?o.outputs[l]:o.inputs[l];break;case"undefined":default:return console.warn("Cant get slot information "+l),!1}(l===!1||c===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+l+" "+c);const u=l.type==LiteGraph.EVENT?"_event_":l.type,h=a?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(h&&h[u]){l.link;let d=!1;if(typeof h[u]=="object"||Array.isArray(h[u])){for(const f in h[u])if(r.nodeType==h[u][f]||r.nodeType=="AUTO"){d=h[u][f];break}}else(r.nodeType==h[u]||r.nodeType=="AUTO")&&(d=h[u]);if(d){let f=!1;typeof d=="object"&&d.node&&(f=d,d=d.node);const p=LiteGraph.createNode(d);if(p){if(f){if(f.properties)for(const g in f.properties)p.addProperty(g,f.properties[g]);if(f.inputs){p.inputs=[];for(const g in f.inputs)p.addOutput(f.inputs[g][0],f.inputs[g][1])}if(f.outputs){p.outputs=[];for(const g in f.outputs)p.addOutput(f.outputs[g][0],f.outputs[g][1])}f.title&&(p.title=f.title),f.json&&p.configure(f.json)}return n.graph.add(p),p.pos=[r.position[0]+r.posAdd[0]+(r.posSizeFix[0]?r.posSizeFix[0]*p.size[0]:0),r.position[1]+r.posAdd[1]+(r.posSizeFix[1]?r.posSizeFix[1]*p.size[1]:0)],a?r.nodeFrom.connectByType(c,p,u):r.nodeTo.connectByTypeOutput(c,p,u),!0}else console.log("failed creating "+d)}}return!1}showConnectionMenu(e){const r=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},e||{}),n=this,a=r.nodeFrom&&r.slotFrom,s=!a&&r.nodeTo&&r.slotTo;if(!a&&!s)return console.warn("No data passed to showConnectionMenu"),!1;const o=a?r.nodeFrom:r.nodeTo;let l=a?r.slotFrom:r.slotTo,c=!1;switch(typeof l){case"string":c=a?o.findOutputSlot(l,!1):o.findInputSlot(l,!1),l=a?o.outputs[l]:o.inputs[l];break;case"object":c=a?o.findOutputSlot(l.name):o.findInputSlot(l.name);break;case"number":c=l,l=a?o.outputs[l]:o.inputs[l];break;default:return console.warn("Cant get slot information "+l),!1}const u=["Add Node",null];n.allow_searchbox&&(u.push("Search"),u.push(null));const h=l.type==LiteGraph.EVENT?"_event_":l.type,d=a?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(d&&d[h])if(typeof d[h]=="object"||Array.isArray(d[h]))for(const g in d[h])u.push(d[h][g]);else u.push(d[h]);const f=new ContextMenu(u,{event:r.e,title:(l&&l.name!=""?l.name+(h?" | ":""):"")+(l&&h?h:""),callback:p});function p(g,b,m){switch(n.createDefaultNodeForSlot(Object.assign(r,{position:[r.e.canvasX,r.e.canvasY],nodeType:g})),g){case"Add Node":_LGraphCanvas.onMenuAdd(null,null,m,f,function(E){a?r.nodeFrom.connectByType(c,E,h):r.nodeTo.connectByTypeOutput(c,E,h)});break;case"Search":a?n.showSearchBox(m,{node_from:r.nodeFrom,slot_from:l,type_filter_in:h}):n.showSearchBox(m,{node_to:r.nodeTo,slot_from:l,type_filter_out:h});break}}return!1}static onShowPropertyEditor(e,t,r,n,a){const s=e.property||"title",o=a[s],l=document.createElement("div");l.is_modified=!1,l.className="graphdialog",l.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",l.close=function(){l.parentNode&&l.parentNode.removeChild(l)};const c=l.querySelector(".name");c.innerText=s;let u=l.querySelector(".value");u&&(u.value=o,u.addEventListener("blur",function(T){this.focus()}),u.addEventListener("keydown",function(T){if(l.is_modified=!0,T.keyCode==27)l.close();else if(T.keyCode==13)E();else if(T.keyCode!=13&&T.target.localName!="textarea")return;T.preventDefault(),T.stopPropagation()}));const d=_LGraphCanvas.active_canvas.canvas,f=d.getBoundingClientRect();let p=-20,g=-20;f&&(p-=f.left,g-=f.top),event?(l.style.left=event.clientX+p+"px",l.style.top=event.clientY+g+"px"):(l.style.left=d.width*.5+p+"px",l.style.top=d.height*.5+g+"px"),l.querySelector("button").addEventListener("click",E),d.parentNode.appendChild(l),u&&u.focus();let m=null;l.addEventListener("mouseleave",function(T){LiteGraph.dialog_close_on_mouse_leave&&!l.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(m=setTimeout(l.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),l.addEventListener("mouseenter",function(T){LiteGraph.dialog_close_on_mouse_leave&&m&&clearTimeout(m)});function E(){u&&L(u.value)}function L(T){e.type=="Number"?T=Number(T):e.type=="Boolean"&&(T=!!T),a[s]=T,l.parentNode&&l.parentNode.removeChild(l),a.setDirtyCanvas(!0,!0)}}prompt(e,t,r,n,a){const s=this;e=e||"";const o=document.createElement("div");o.is_modified=!1,o.className="graphdialog rounded",a?o.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":o.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",o.close=function(){s.prompt_box=null,o.parentNode&&o.parentNode.removeChild(o)};const c=_LGraphCanvas.active_canvas.canvas;c.parentNode.appendChild(o),this.ds.scale>1&&(o.style.transform="scale("+this.ds.scale+")");let u=null,h=!1;LiteGraph.pointerListenerAdd(o,"leave",function(T){h||LiteGraph.dialog_close_on_mouse_leave&&!o.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(o.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(o,"enter",function(T){LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)});const d=o.querySelectorAll("select");d&&d.forEach(function(T){T.addEventListener("click",function(_){h++}),T.addEventListener("blur",function(_){h=0}),T.addEventListener("change",function(_){h=-1})}),s.prompt_box&&s.prompt_box.close(),s.prompt_box=o;const f=o.querySelector(".name");f.innerText=e;const p=o.querySelector(".value");p.value=t;const g=p;g.addEventListener("keydown",function(T){if(o.is_modified=!0,T.keyCode==27)o.close();else if(T.keyCode==13&&T.target.localName!="textarea")r&&r(this.value),o.close();else return;T.preventDefault(),T.stopPropagation()}),o.querySelector("button").addEventListener("click",function(T){r&&r(g.value),s.setDirty(!0),o.close()});const m=c.getBoundingClientRect();let E=-20,L=-20;return m&&(E-=m.left,L-=m.top),n?(o.style.left=n.clientX+E+"px",o.style.top=n.clientY+L+"px"):(o.style.left=c.width*.5+E+"px",o.style.top=c.height*.5+L+"px"),setTimeout(function(){g.focus()},10),o}showSearchBox(e,t){const r={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};t=Object.assign(r,t||{});const n=this,a=_LGraphCanvas.active_canvas,s=a.canvas,o=s.ownerDocument||document,l=document.createElement("div");l.className="litegraph litesearchbox graphdialog rounded",l.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",t.do_type_filter&&(l.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",l.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),l.innerHTML+="<div class='helper'></div>",o.fullscreenElement?o.fullscreenElement.appendChild(l):(o.body.appendChild(l),o.body.style.overflow="hidden");let c,u;if(t.do_type_filter&&(c=l.querySelector(".slot_in_type_filter"),u=l.querySelector(".slot_out_type_filter")),l.close=function(){n.search_box=null,this.blur(),s.focus(),o.body.style.overflow="",setTimeout(function(){n.canvas.focus()},20),l.parentNode&&l.parentNode.removeChild(l)},this.ds.scale>1&&(l.style.transform="scale("+this.ds.scale+")"),t.hide_on_mouse_leave){let A=!1,M=null;LiteGraph.pointerListenerAdd(l,"enter",function(S){M&&(clearTimeout(M),M=null)}),LiteGraph.pointerListenerAdd(l,"leave",function(S){A||(M=setTimeout(function(){l.close()},500))}),t.do_type_filter&&(c.addEventListener("click",function(S){A++}),c.addEventListener("blur",function(S){A=0}),c.addEventListener("change",function(S){A=-1}),u.addEventListener("click",function(S){A++}),u.addEventListener("blur",function(S){A=0}),u.addEventListener("change",function(S){A=-1}))}n.search_box&&n.search_box.close(),n.search_box=l;const h=l.querySelector(".helper");let d=null,f=null,p=null,g=l.querySelector("input");if(g&&(g.addEventListener("blur",function(A){n.search_box&&this.focus()}),g.addEventListener("keydown",function(A){if(A.keyCode==38)T(!1);else if(A.keyCode==40)T(!0);else if(A.keyCode==27)l.close();else if(A.keyCode==13)_(),p?L(p.innerHTML):d?L(d):l.close();else{f&&clearInterval(f),f=setTimeout(_,250);return}return A.preventDefault(),A.stopPropagation(),A.stopImmediatePropagation(),!0})),t.do_type_filter){if(c){const A=LiteGraph.slot_types_in,M=A.length;(t.type_filter_in==LiteGraph.EVENT||t.type_filter_in==LiteGraph.ACTION)&&(t.type_filter_in="_event_");for(let S=0;S<M;S++){const N=document.createElement("option");N.value=A[S],N.innerHTML=A[S],c.appendChild(N),t.type_filter_in!==!1&&(t.type_filter_in+"").toLowerCase()==(A[S]+"").toLowerCase()&&(N.selected=!0)}c.addEventListener("change",function(){_()})}if(u){const A=LiteGraph.slot_types_out,M=A.length;(t.type_filter_out==LiteGraph.EVENT||t.type_filter_out==LiteGraph.ACTION)&&(t.type_filter_out="_event_");for(let S=0;S<M;S++){const N=document.createElement("option");N.value=A[S],N.innerHTML=A[S],u.appendChild(N),t.type_filter_out!==!1&&(t.type_filter_out+"").toLowerCase()==(A[S]+"").toLowerCase()&&(N.selected=!0)}u.addEventListener("change",function(){_()})}}const b=s.getBoundingClientRect(),m=(e?e.clientX:b.left+b.width*.5)-80,E=(e?e.clientY:b.top+b.height*.5)-20;l.style.left=m+"px",l.style.top=E+"px",e.layerY>b.height-200&&(h.style.maxHeight=b.height-e.layerY-20+"px"),g.focus(),t.show_all_on_open&&_();function L(A){if(A)if(n.onSearchBoxSelection)n.onSearchBoxSelection(A,e,a);else{const M=LiteGraph.searchbox_extras[A.toLowerCase()];M&&(A=M.type),a.graph.beforeChange();const S=LiteGraph.createNode(A);if(S&&(S.pos=a.convertEventToCanvasOffset(e),a.graph.add(S,!1)),M&&M.data){if(M.data.properties)for(const N in M.data.properties)S.addProperty(N,M.data.properties[N]);if(M.data.inputs){S.inputs=[];for(const N in M.data.inputs)S.addOutput(M.data.inputs[N][0],M.data.inputs[N][1])}if(M.data.outputs){S.outputs=[];for(const N in M.data.outputs)S.addOutput(M.data.outputs[N][0],M.data.outputs[N][1])}M.data.title&&(S.title=M.data.title),M.data.json&&S.configure(M.data.json)}if(t.node_from){let N=!1;switch(typeof t.slot_from){case"string":N=t.node_from.findOutputSlot(t.slot_from);break;case"object":t.slot_from.name?N=t.node_from.findOutputSlot(t.slot_from.name):N=-1,N==-1&&typeof t.slot_from.slot_index<"u"&&(N=t.slot_from.slot_index);break;case"number":N=t.slot_from;break;default:N=0}typeof t.node_from.outputs[N]<"u"&&N!==!1&&N>-1&&t.node_from.connectByType(N,S,t.node_from.outputs[N].type)}if(t.node_to){let N=!1;switch(typeof t.slot_from){case"string":N=t.node_to.findInputSlot(t.slot_from);break;case"object":t.slot_from.name?N=t.node_to.findInputSlot(t.slot_from.name):N=-1,N==-1&&typeof t.slot_from.slot_index<"u"&&(N=t.slot_from.slot_index);break;case"number":N=t.slot_from;break;default:N=0}typeof t.node_to.inputs[N]<"u"&&N!==!1&&N>-1&&t.node_to.connectByTypeOutput(N,S,t.node_to.inputs[N].type)}a.graph.afterChange()}l.close()}function T(A){const M=p;p&&p.classList.remove("selected"),p?(p=A?p.nextSibling:p.previousSibling,p||(p=M)):p=A?h.childNodes[0]:h.childNodes[h.childNodes.length],p&&(p.classList.add("selected"),p.scrollIntoView({block:"end",behavior:"smooth"}))}function _(){f=null;let A=g.value;if(d=null,h.innerHTML="",!A&&!t.show_all_if_empty)return;if(n.onSearchBox){const S=n.onSearchBox(h,A,a);if(S)for(let N=0;N<S.length;++N)M(S[N])}else{let R=function(C,k){const z=Object.assign({skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},k||{}),X=LiteGraph.registered_node_types[C];if(S&&X.filter!=S||(!t.show_all_if_empty||A)&&C.toLowerCase().indexOf(A)===-1)return!1;if(t.do_type_filter&&!z.skipFilter){const W=C;let Y=N.value;if(z.inTypeOverride!==!1&&(Y=z.inTypeOverride),N&&Y&&LiteGraph.registered_slot_in_types[Y]&&LiteGraph.registered_slot_in_types[Y].nodes&&LiteGraph.registered_slot_in_types[Y].nodes.includes(W)===!1)return!1;let H=I.value;if(z.outTypeOverride!==!1&&(H=z.outTypeOverride),I&&H&&LiteGraph.registered_slot_out_types[H]&&LiteGraph.registered_slot_out_types[H].nodes&&LiteGraph.registered_slot_out_types[H].nodes.includes(W)===!1)return!1}return!0};A=A.toLowerCase();const S=a.filter||a.graph.filter;let N=null,I=null;t.do_type_filter&&n.search_box?(N=n.search_box.querySelector(".slot_in_type_filter"),I=n.search_box.querySelector(".slot_out_type_filter")):(N=!1,I=!1);for(const C in LiteGraph.searchbox_extras){const k=LiteGraph.searchbox_extras[C];if((!t.show_all_if_empty||A)&&k.desc.toLowerCase().indexOf(A)===-1)continue;const D=LiteGraph.registered_node_types[k.type];D&&D.filter!=S||R(k.type)&&M(k.desc,"searchbox_extra")}let P=null;if(Array.prototype.filter)P=Object.keys(LiteGraph.registered_node_types).filter(R);else{P=[];for(const C in LiteGraph.registered_node_types)R(C)&&P.push(C)}for(let C=0;C<P.length;C++)M(P[C]);if(t.show_general_after_typefiltered&&(N.value||I.value)){const C=[];for(const k in LiteGraph.registered_node_types)R(k,{inTypeOverride:N&&N.value?"*":!1,outTypeOverride:I&&I.value?"*":!1})&&C.push(k);for(let k=0;k<C.length;k++)M(C[k],"generic_type")}if((N.value||I.value)&&h.childNodes.length==0&&t.show_general_if_none_on_typefilter){const C=[];for(const k in LiteGraph.registered_node_types)R(k,{skipFilter:!0})&&C.push(k);for(let k=0;k<C.length;k++)M(C[k],"not_in_filter")}}function M(S,N){const I=document.createElement("div");d||(d=S),I.innerText=S,I.dataset.type=escape(S),I.className="litegraph lite-search-item",N&&(I.className+=" "+N),I.addEventListener("click",function(P){L(unescape(this.dataset.type))}),h.appendChild(I)}}return l}showEditPropertyValue(e,t,r){if(!e||e.properties[t]===void 0)return;r=r||{};const n=e.getPropertyInfo(t),a=n.type;let s="";if(a=="string"||a=="number"||a=="array"||a=="object")s="<input autofocus type='text' class='value'/>";else if((a=="enum"||a=="combo")&&n.values){s="<select autofocus type='text' class='value'>";for(const d in n.values){let f=d;n.values.constructor===Array&&(f=n.values[d]),s+="<option value='"+f+"' "+(f==e.properties[t]?"selected":"")+">"+n.values[d]+"</option>"}s+="</select>"}else if(a=="boolean"||a=="toggle")s="<input autofocus type='checkbox' class='value' "+(e.properties[t]?"checked":"")+"/>";else{console.warn("unknown type: "+a);return}const o=this.createDialog("<span class='name'>"+(n.label?n.label:t)+"</span>"+s+"<button>OK</button>",r);let l=!1;if((a=="enum"||a=="combo")&&n.values)l=o.querySelector("select"),l.addEventListener("change",function(d){o.modified(),h(d.target.value)});else if(a=="boolean"||a=="toggle")l=o.querySelector("input"),l&&l.addEventListener("click",function(d){o.modified(),h(!!l.checked)});else if(l=o.querySelector("input"),l){l.addEventListener("blur",function(f){this.focus()});let d=e.properties[t]!==void 0?e.properties[t]:"";a!=="string"&&(d=JSON.stringify(d)),l.value=d,l.addEventListener("keydown",function(f){if(f.keyCode==27)o.close();else if(f.keyCode==13)u();else if(f.keyCode!=13){o.modified();return}f.preventDefault(),f.stopPropagation()})}l&&l.focus(),o.querySelector("button").addEventListener("click",u);function u(){h(l.value)}function h(d){n&&n.values&&n.values.constructor===Object&&n.values[d]!=null&&(d=n.values[d]),typeof e.properties[t]=="number"&&(d=Number(d)),(a=="array"||a=="object")&&(d=JSON.parse(d)),e.properties[t]=d,e.graph&&e.graph._version++,e.onPropertyChanged&&e.onPropertyChanged(t,d),r.onclose&&r.onclose(),o.close(),e.setDirtyCanvas(!0,!0)}return o}createDialog(e,t){t=Object.assign({checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0},t||{});const n=document.createElement("div");n.className="graphdialog",n.innerHTML=e,n.is_modified=!1;const a=this.canvas.getBoundingClientRect();let s=-20,o=-20;if(a&&(s-=a.left,o-=a.top),t.position?(s+=t.position[0],o+=t.position[1]):t.event?(s+=t.event.clientX,o+=t.event.clientY):(s+=this.canvas.width*.5,o+=this.canvas.height*.5),n.style.left=s+"px",n.style.top=o+"px",this.canvas.parentNode.appendChild(n),t.checkForInput){let h=[];(h=n.querySelectorAll("input"))&&h.forEach(function(d){d.addEventListener("keydown",function(f){if(n.modified(),f.keyCode==27)n.close();else if(f.keyCode!=13)return;f.preventDefault(),f.stopPropagation()}),d.focus()})}n.modified=function(){n.is_modified=!0},n.close=function(){n.parentNode&&n.parentNode.removeChild(n)};let l=null,c=!1;n.addEventListener("mouseleave",function(h){c||(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!n.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(l=setTimeout(n.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),n.addEventListener("mouseenter",function(h){(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&l&&clearTimeout(l)});const u=n.querySelectorAll("select");return u&&u.forEach(function(h){h.addEventListener("click",function(d){c++}),h.addEventListener("blur",function(d){c=0}),h.addEventListener("change",function(d){c=-1})}),n}createPanel(e,t){t=t||{};const r=t.window||window,n=document.createElement("div");if(n.className="litegraph dialog",n.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",n.header=n.querySelector(".dialog-header"),t.width&&(n.style.width=t.width+(t.width.constructor===Number?"px":"")),t.height&&(n.style.height=t.height+(t.height.constructor===Number?"px":"")),t.closable){const a=document.createElement("span");a.innerHTML="&#10005;",a.classList.add("close"),a.addEventListener("click",function(){n.close()}),n.header.appendChild(a)}return n.title_element=n.querySelector(".dialog-title"),n.title_element.innerText=e,n.content=n.querySelector(".dialog-content"),n.alt_content=n.querySelector(".dialog-alt-content"),n.footer=n.querySelector(".dialog-footer"),n.close=()=>{n.onClose&&typeof n.onClose=="function"&&n.onClose(),n.parentNode&&n.parentNode.removeChild(n),n.parentNode&&n.parentNode.removeChild(this)},n.toggleAltContent=a=>{let s,o;typeof a<"u"?(s=a?"block":"none",o=a?"none":"block"):(s=n.alt_content.style.display!="block"?"block":"none",o=n.alt_content.style.display!="block"?"none":"block"),n.alt_content.style.display=s,n.content.style.display=o},n.toggleFooterVisibility=a=>{let s;typeof a<"u"?s=a?"block":"none":s=n.footer.style.display!="block"?"block":"none",n.footer.style.display=s},n.clear=()=>{this.content.innerHTML=""},n.addHTML=(a,s,o)=>{const l=document.createElement("div");return s&&(l.className=s),l.innerHTML=a,o?n.footer.appendChild(l):n.content.appendChild(l),l},n.addButton=(a,s,o)=>{const l=document.createElement("button");return l.innerText=a,l.options=o,l.classList.add("btn"),l.addEventListener("click",s),n.footer.appendChild(l),l},n.addSeparator=()=>{const a=document.createElement("div");a.className="separator",n.content.appendChild(a)},n.addWidget=(a,s,o,l,c)=>{l=l||{};let u=String(o);a=a.toLowerCase(),a=="number"&&(u=parseFloat(o).toFixed(3));const h=document.createElement("div");h.className="property",h.innerHTML="<span class='property_name'></span><span class='property_value'></span>",h.querySelector(".property_name").innerText=l.label||s;const d=h.querySelector(".property_value");d.innerText=u,h.dataset.property=s,h.dataset.type=l.type||a,h.options=l,h.value=o;const f=l.disabled||!1;if(f&&d.classList.add("disabled"),a=="code")h.addEventListener("click",function(g){g.preventDefault(),!f&&n.inner_showCodePad(this.dataset.property)});else if(a=="boolean")h.classList.add("boolean"),o&&h.classList.add("bool-on"),h.addEventListener("click",function(g){if(g.preventDefault(),f)return;const b=this.dataset.property||s;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",p(b,this.value)});else if(a=="string"||a=="number"){const g=document.createElement("input"),b=a==="string"?"string":"number";l.id&&g.setAttribute("id",l.id),g.setAttribute("type",b),l.min&&g.setAttribute("min",l.min),l.max&&g.setAttribute("max",l.max),g.classList.add("property_value_input"),f&&(g.setAttribute("disabled",f),g.classList.add("disabled")),d.innerText="",g.value=a==="string"?u:Number(u),d.appendChild(g),g.addEventListener("input",function(E){if(E.preventDefault(),f)return;const L=n.parentNode.dataset.property||s,T=n.parentNode.dataset.type;let _=E.target.value;T=="number"&&(_=Number(_)),p(L,_)})}else if(a=="enum"||a=="combo"){const g=_LGraphCanvas.getPropertyPrintableValue(o,l.values);d.innerText=g,d.addEventListener("click",b=>{if(b.preventDefault(),f)return;this.closeAllContextmenu();const m=l.values||[],E=n.parentNode.dataset.property||s,L=d,T=new ContextMenu(m,{event:b,className:"dark",callback:_},r);this._menus.push(T);function _(A,M,S){return L.innerText=A,p(E,A),!1}})}else if(a==="button"){h.innerHTML=`
                  <span class='property_name'></span>
                  <span class='property_value_img'>
                    <span class="property_img_src"></span>
                    
                  </span>`,h.querySelector(".property_name").innerText=l.label||s;const g=h.querySelector(".property_value_img");g.setAttribute("contenteditable",!0),g.innerText=u,h.dataset.property=s,h.dataset.type=l.type||a,h.options=l,h.value=o;const b=l.disabled,m=document.createElement("btn");m.classList.add("btn","btn-save-image"),m.textContent="이미지 추가",m.addEventListener("click",function(E){if(E.preventDefault(),b)return;const L=document.createElement("input");L.type="file",L.setAttribute("accept",".png,.jpg,.jpeg,.gif,.webp,"),L.click()}),g.appendChild(m)}n.content.appendChild(h);function p(g,b){l.callback&&l.callback(g,b,l),c&&c(g,b,l)}return h},n.onOpen&&typeof n.onOpen=="function"&&n.onOpen(),n}static getPropertyPrintableValue(e,t){if(!t||t.constructor===Array)return String(e);if(t.constructor===Object){let r="";for(const n in t)if(t[n]==e){r=n;break}return String(e)+" ("+r+")"}}closePanels(){const e=document.querySelector("#node-panel");e&&e.close();const t=document.querySelector("#option-panel");t&&t.close()}showShowGraphOptionsPanel(e,t,r,n){let a=document.querySelector("#node-panel"),s;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!t||!t.event||!t.event.target||!t.event.target.lgraphcanvas){console.warn("Canvas not found");return}s=t.event.target.lgraphcanvas}else s=this;s.closePanels();const o=s.getCanvasWindow();a=s.createPanel("Options",{closable:!0,window:o,onOpen:function(){s.OPTIONPANEL_IS_OPEN=!0},onClose:function(){s.OPTIONPANEL_IS_OPEN=!1,s.options_panel=null}}),s.options_panel=a,a.id="option-panel",a.classList.add("settings");function l(){a.content.innerHTML="";const c=function(h,d,f){f&&f.key&&(h=f.key),f.values&&(d=Object.values(f.values).indexOf(d)),s[h]=d},u=LiteGraph.availableCanvasOptions;u.sort();for(const h in u){const d=u[h];a.addWidget("boolean",d,s[d],{key:d,on:"True",off:"False"},c)}s.links_render_mode,a.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[s.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},c),a.addSeparator(),a.footer.innerHTML=""}l(),s.canvas.parentNode.appendChild(a)}showShowNodePanel(e){this.SELECTED_NODE=e,this.closePanels();const t=this.getCanvasWindow(),r=this,n=this.createPanel(e.title||"",{closable:!0,window:t,onOpen:function(){r.NODEPANEL_IS_OPEN=!0},onClose:function(){r.NODEPANEL_IS_OPEN=!1,r.node_panel=null}});r.node_panel=n,n.id="node-panel",n.node=e,n.classList.add("settings");function a(){var c;n.content.innerHTML="",n.addHTML("<span class='node_type'>"+e.type+"</span><span class='node_desc'>"+(e.constructor.desc||"")+"</span><span class='separator'></span>"),n.addHTML("<h4>Properties</h4>");const s=(u,h)=>{r.graph.beforeChange(e);const d=Object.values(LiteGraph.NODE_MODES).indexOf(h);if(u.includes("inputName")){const f=e.properties[`editable-${u}`];e.setInputName(f.index,h),e.properties[`editable-${u}`].value=h}else if(u.includes("outputName")){const f=e.properties[`editable-${u}`];e.setOutputName(f.index,h),e.properties[`editable-${u}`].value=h}else switch(u){case"Title":e.title=h;break;case"Mode":d>=0&&LiteGraph.NODE_MODES[d]?e.changeMode(d):console.warn("unexpected mode: "+h);break;case"Color":_LGraphCanvas.node_colors[h]?(e.color=_LGraphCanvas.node_colors[h].color,e.bgcolor=_LGraphCanvas.node_colors[h].bgcolor):console.warn("unexpected color: "+h);break;case"x":e.pos=[parseInt(h),e.pos[1]];break;case"y":e.pos=[e.pos[0],parseInt(h)];break;case"Width":e.size=[parseInt(h),e.size[1]];break;case"Height":e.size=[e.size[0],parseInt(h)];break;default:e.setProperty(u,h);break}r.graph.afterChange(),r.dirty_canvas=!0};n.addWidget("string","Title",e.title,{disabled:!1},s);const o=["font_size","status","message"];for(let u in e.properties){if(o.includes(u)||u.includes("editable-"))continue;const h=e.properties[u],d=e.getPropertyInfo(u);d.type,!(e.onAddPropertyToPanel&&e.onAddPropertyToPanel(u,n))&&n.addWidget(d.widget||d.type,u,h,d,s)}if(n.addSeparator(),e.onShowCustomPanelInfo&&e.onShowCustomPanelInfo(n),(c=Object.keys(e.properties))==null?void 0:c.some(u=>u.includes("editable-"))){n.addHTML("<h4>Editable-Properties</h4>");for(let u in e.properties)if(u.includes("editable-")){const h=e.properties[u].value,d=e.getPropertyInfo(u);d.type;const f=u.split("-")[1];if(e.onAddPropertyToPanel&&e.onAddPropertyToPanel(u,n))continue;n.addWidget(d.widget||d.type,f,h,d,s)}}n.footer.innerHTML="",n.addButton("Delete",function(){e.block_delete||(e.graph.remove(e),n.close())}).classList.add("delete")}n.inner_showCodePad=s=>{n.classList.remove("settings"),n.classList.add("centered"),n.alt_content.innerHTML="<textarea class='code'></textarea>";const o=n.alt_content.querySelector("textarea"),l=()=>{n.toggleAltContent(!1),n.toggleFooterVisibility(!0),o.parentNode.removeChild(o),n.classList.add("settings"),n.classList.remove("centered"),a()};o.value=e.properties[s],o.addEventListener("keydown",function(h){h.code=="Enter"&&h.ctrlKey&&(e.setProperty(s,o.value),l())}),n.toggleAltContent(!0),n.toggleFooterVisibility(!1),o.style.height="calc(100% - 40px)";const c=n.addButton("Assign",function(){e.setProperty(s,o.value),l()});n.alt_content.appendChild(c);const u=n.addButton("Close",l);u.style.float="right",n.alt_content.appendChild(u)},a(),this.canvas.parentNode.appendChild(n)}showSubgraphPropertiesDialog(e){console.log("showing subgraph properties dialog");const t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();const r=this.createPanel("Subgraph Inputs",{closable:!0,width:500});r.node=e,r.classList.add("subgraph_dialog");function n(){if(r.clear(),e.inputs)for(let o=0;o<e.inputs.length;++o){const l=e.inputs[o];if(l.not_subgraph_input)continue;const u=r.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");u.dataset.name=l.name,u.dataset.slot=o,u.querySelector(".name").innerText=l.name,u.querySelector(".type").innerText=l.type,u.querySelector("button").addEventListener("click",function(h){e.removeInput(Number(this.parentNode.dataset.slot)),n()})}}return r.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",function(o){const l=this.parentNode,c=l.querySelector(".name").value,u=l.querySelector(".type").value;!c||e.findInputSlot(c)!=-1||(e.addInput(c,u),l.querySelector(".name").value="",l.querySelector(".type").value="",n())}),n(),this.canvas.parentNode.appendChild(r),r}showSubgraphPropertiesDialogRight(e){const t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();const r=this.createPanel("Subgraph Outputs",{closable:!0,width:500});r.node=e,r.classList.add("subgraph_dialog");function n(){if(r.clear(),e.outputs)for(let l=0;l<e.outputs.length;++l){const c=e.outputs[l];if(c.not_subgraph_output)continue;const h=r.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");h.dataset.name=c.name,h.dataset.slot=l,h.querySelector(".name").innerText=c.name,h.querySelector(".type").innerText=c.type,h.querySelector("button").addEventListener("click",function(d){e.removeOutput(Number(this.parentNode.dataset.slot)),n()})}}const s=r.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0);s.querySelector(".name").addEventListener("keydown",function(l){l.keyCode==13&&o.apply(this)}),s.querySelector("button").addEventListener("click",function(l){o.apply(this)});function o(){const l=this.parentNode,c=l.querySelector(".name").value,u=l.querySelector(".type").value;!c||e.findOutputSlot(c)!=-1||(e.addOutput(c,u),l.querySelector(".name").value="",l.querySelector(".type").value="",n())}return n(),this.canvas.parentNode.appendChild(r),r}checkPanels(){if(!this.canvas)return;const e=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let t=0;t<e.length;++t){const r=e[t];r.node&&(!r.node.graph||r.graph!=this.graph)&&r.close()}}static onMenuNodeCollapse(e,t,r,n,a){a.graph.beforeChange();const s=function(l){l.collapse()},o=_LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)s(a);else for(const l in o.selected_nodes)s(o.selected_nodes[l]);a.graph.afterChange()}static onMenuNodePin(e,t,r,n,a){a.pin()}static onMenuNodeMode(e,t,r,n,a){new ContextMenu(LiteGraph.NODE_MODES,{event:r,callback:s,parentMenu:n,node:a});function s(o){if(!a)return;const l=Object.values(LiteGraph.NODE_MODES).indexOf(o),c=function(h){l>=0&&LiteGraph.NODE_MODES[l]?h.changeMode(l):(console.warn("unexpected mode: "+o),h.changeMode(LiteGraph.ALWAYS))},u=_LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)c(a);else for(const h in u.selected_nodes)c(u.selected_nodes[h])}return!1}static onMenuNodeColors(e,t,r,n,a){if(!a)throw"no node for color";const s=[];s.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(const l in _LGraphCanvas.node_colors){const c=_LGraphCanvas.node_colors[l],u={value:l,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+c.color+"; background-color:"+c.bgcolor+"'>"+l+"</span>"};s.push(u)}new ContextMenu(s,{event:r,callback:o,parentMenu:n,node:a});function o(l){if(!a)return;const c=l.value?_LGraphCanvas.node_colors[l.value]:null,u=function(d){c?d.constructor===LiteGraph.LGraphGroup?d.color=c.groupcolor:(d.color=c.color,d.bgcolor=c.bgcolor):(delete d.color,delete d.bgcolor)},h=_LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)u(a);else for(const d in h.selected_nodes)u(h.selected_nodes[d]);a.setDirtyCanvas(!0,!0)}return!1}static onMenuNodeShapes(e,t,r,n,a){if(!a)throw"no node passed";new ContextMenu(LiteGraph.VALID_SHAPES,{event:r,callback:s,parentMenu:n,node:a});function s(o){if(!a)return;a.graph.beforeChange();const l=function(u){u.shape=o},c=_LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)l(a);else for(const u in c.selected_nodes)l(c.selected_nodes[u]);a.graph.afterChange(),a.setDirtyCanvas(!0)}return!1}static onMenuNodeRemove(e,t,r,n,a){if(!a)throw"no node passed";const s=a.graph;s.beforeChange();const o=function(c){c.removable!==!1&&s.remove(c)},l=_LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)o(a);else for(const c in l.selected_nodes)o(l.selected_nodes[c]);s.afterChange(),a.setDirtyCanvas(!0,!0)}static onMenuNodeToSubgraph(e,t,r,n,a){const s=a.graph,o=_LGraphCanvas.active_canvas;if(!o)return;let l=Object.values(o.selected_nodes||{});l.length||(l=[a]);const c=LiteGraph.createNode("graph/subgraph");c.pos=a.pos.concat(),s.add(c),c.buildFromNodes(l),o.deselectAllNodes(),a.setDirtyCanvas(!0,!0)}static onMenuNodeClone(e,t,r,n,a){a.graph.beforeChange();const s={},o=function(c){if(c.clonable===!1)return;const u=c.clone();u&&(u.pos=[c.pos[0]+5,c.pos[1]+5],c.graph.add(u),s[u.id]=u)},l=_LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)o(a);else for(const c in l.selected_nodes)o(l.selected_nodes[c]);Object.keys(s).length&&l.selectNodes(s),a.graph.afterChange(),a.setDirtyCanvas(!0,!0)}getNodeMenuOptions(e){let t=null;if(e.getMenuOptions?t=e.getMenuOptions(this):(t=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:_LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:_LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:_LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:_LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:_LGraphCanvas.onMenuNodeMode}],e.resizable!==!1&&t.push({content:"Resize",callback:_LGraphCanvas.onMenuResizeNode}),t.push({content:"Collapse",callback:_LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:_LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:_LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:_LGraphCanvas.onMenuNodeShapes},null)),e.onGetInputs){const r=e.onGetInputs();r&&r.length&&(t[0].disabled=!1)}if(e.onGetOutputs){const r=e.onGetOutputs();r&&r.length&&(t[1].disabled=!1)}if(e.getExtraMenuOptions){const r=e.getExtraMenuOptions(this,t);r&&(r.push(null),t=r.concat(t))}return e.clonable!==!1&&t.push({content:"Clone",callback:_LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&t.push({content:"Align Selected To",has_submenu:!0,callback:_LGraphCanvas.onNodeAlign}),t.push(null,{content:"Remove",disabled:!(e.removable!==!1&&!e.block_delete),callback:_LGraphCanvas.onMenuNodeRemove}),e.graph&&e.graph.onGetNodeMenuOptions&&e.graph.onGetNodeMenuOptions(t,e),t}bringGroupToFront(e){const t=this.graph._groups,r=this.findGroupIndexById(e.id);Number(r)!==-1&&(t.splice(Number(r),1),t.push(e),this.setDirty(!0,!0))}onGrpSizeEditor(e,t,r,n,a){e.property;const s=document.createElement("div");s.is_modified=!1,s.className="graphdialog",s.innerHTML=`
                <div class="d-flex flex-column align-items-start p-2" id="grpSizeDialog">
                  <div> <div><span class='main-tit p-1'>그룹 사이즈 변경</span> </div>
                  <div class="p-1"><span class='sub-prop'>넓이</span><input  type='number' class='value' id="widthValue" /></div>
                  <div class="p-1"><span class='sub-prop'>높이</span><input type='number' class='value' id="heightValue"  /></div>
                  <div class="d-flex align-items-center justify-content-end p-1"><button class="okBtn">OK</button></div>
                </div>
               
                
                `,s.close=function(){s.parentNode&&s.parentNode.removeChild(s)};const l=_LGraphCanvas.active_canvas.canvas,c=l.getBoundingClientRect();let u=-20,h=-20;c&&(u-=c.left,h-=c.top),event?(s.style.left=event.clientX+u+"px",s.style.top=event.clientY+h+"px"):(s.style.left=l.width*.5+u+"px",s.style.top=l.height*.5+h+"px"),s.querySelector(".okBtn").addEventListener("click",b),l.parentNode.appendChild(s);const f=document.querySelector("#widthValue"),p=document.querySelector("#heightValue");f&&(f.value=Number(a.size[0]),f.addEventListener("keydown",function(E){if(s.is_modified=!0,E.keyCode==27)s.close();else if(E.keyCode==13)b();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()})),p&&(p.value=Number(a.size[1]),p.addEventListener("keydown",function(E){if(s.is_modified=!0,E.keyCode==27)s.close();else if(E.keyCode==13)b();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));let g=null;s.addEventListener("mouseleave",function(E){LiteGraph.dialog_close_on_mouse_leave&&!s.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(g=setTimeout(s.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),s.addEventListener("mouseenter",function(E){LiteGraph.dialog_close_on_mouse_leave&&g&&clearTimeout(g)});function b(){m(f==null?void 0:f.value,p==null?void 0:p.value)}function m(E,L){const T=E||a.size[0],_=L||a.size[1];a.size=[T,_],s.parentNode&&s.parentNode.removeChild(s),a.setDirtyCanvas(!0,!0)}}onShowPropertyEditor(e,t,r,n,a){const s=e.property||"title",o=a[s],l=document.createElement("div");l.is_modified=!1,l.className="graphdialog",l.innerHTML="<span class='name'></span><input type='text' class='value '/><button>OK</button>",l.close=function(){l.parentNode&&l.parentNode.removeChild(l)};const c=l.querySelector(".name");c.innerText=s;let u=l.querySelector(".value");u&&(u.value=o,u.addEventListener("keydown",function(T){if(l.is_modified=!0,T.keyCode==27)l.close();else if(T.keyCode==13)E();else if(T.keyCode!=13&&T.target.localName!="textarea")return;T.preventDefault(),T.stopPropagation()}));const d=_LGraphCanvas.active_canvas.canvas,f=d.getBoundingClientRect();let p=-20,g=-20;f&&(p-=f.left,g-=f.top),event?(l.style.left=event.clientX+p+"px",l.style.top=event.clientY+g+"px"):(l.style.left=d.width*.5+p+"px",l.style.top=d.height*.5+g+"px"),l.querySelector("button").addEventListener("click",E),d.parentNode.appendChild(l);let m=null;l.addEventListener("mouseleave",function(T){LiteGraph.dialog_close_on_mouse_leave&&!l.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(m=setTimeout(l.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),l.addEventListener("mouseenter",function(T){LiteGraph.dialog_close_on_mouse_leave&&m&&clearTimeout(m)});function E(){u&&L(u.value)}function L(T){e.type=="Number"?T=Number(T):e.type=="Boolean"&&(T=!!T),a[s]=T,l.parentNode&&l.parentNode.removeChild(l),a.setDirtyCanvas(!0,!0)}}onGrpPositionEditor(e,t,r,n,a){const s=document.createElement("div");s.is_modified=!1,s.className="graphdialog",s.innerHTML=`
                <div class="d-flex flex-column align-items-start p-2" id="grpSizeDialog">
                  <div> <div><span class='main-tit p-1'>그룹 위치 변경</span> </div>
                  <div class="p-1"><span class='sub-prop'>X</span><input  type='number' class='value' id="xValue" /></div>
                  <div class="p-1"><span class='sub-prop'>Y</span><input type='number' class='value' id="yValue" /></div>
                  <div class="d-flex align-items-center justify-content-end p-1"><button class="okBtn">OK</button></div>
                </div>
                `,s.close=function(){s.parentNode&&s.parentNode.removeChild(s)};const l=_LGraphCanvas.active_canvas.canvas,c=l.getBoundingClientRect();let u=-20,h=-20;c&&(u-=c.left,h-=c.top),event?(s.style.left=event.clientX+u+"px",s.style.top=event.clientY+h+"px"):(s.style.left=l.width*.5+u+"px",s.style.top=l.height*.5+h+"px"),s.querySelector(".okBtn").addEventListener("click",b),l.parentNode.appendChild(s);const f=document.querySelector("#xValue"),p=document.querySelector("#yValue");f&&(f.value=Number(a.pos[0]),f.addEventListener("keydown",function(E){if(s.is_modified=!0,E.keyCode==27)s.close();else if(E.keyCode==13)b();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()})),p&&(p.value=Number(a.pos[1]),p.addEventListener("keydown",function(E){if(s.is_modified=!0,E.keyCode==27)s.close();else if(E.keyCode==13)b();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));let g=null;s.addEventListener("mouseleave",function(E){LiteGraph.dialog_close_on_mouse_leave&&!s.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(g=setTimeout(s.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),s.addEventListener("mouseenter",function(E){LiteGraph.dialog_close_on_mouse_leave&&g&&clearTimeout(g)});function b(){m(f==null?void 0:f.value,p==null?void 0:p.value)}function m(E,L){const T=E||a.pos[0],_=L||a.pos[1];a.recomputeInsideNodes();const A=[T-a.pos[0],_-a.pos[1]];a.move(A[0],A[1]),s.parentNode&&s.parentNode.removeChild(s),a.setDirtyCanvas(!0,!0)}}sendGroupToBack(e){const t=this.graph._groups,r=this.findGroupIndexById(e.id);Number(r)!==-1&&(t.splice(Number(r),1),t.unshift(e),this.setDirty(!0,!0))}findGroupIndexById(e){const t=this.graph._groups;for(let r in t)if(t[r].id===e)return r;return-1}addNodeGuideLines(e){var r;const t=this.selected_nodes?Object.keys(this.selected_nodes):[];if((t==null?void 0:t.length)===1&&!this.read_only&&((r=this.graph._nodes)==null?void 0:r.length)>=2){const n=this.selected_nodes[t[0]],s=n.constructor.title_mode?0:LiteGraph.NODE_TITLE_HEIGHT,o=this.graph._nodes.map(d=>({x:d.pos[0],y:d.pos[1]-s,width:d.size[0],height:d.size[1],id:d.id})).filter(d=>(d==null?void 0:d.id)!==(n==null?void 0:n.id)),l=n.size[0],c=n.size[1],u=n.pos[0],h=n.pos[1]-s;e.strokeStyle="#c4c4c4",e.lineWidth=1;for(let d in o){e.strokeStyle=16711680;const f=o[d],p=f.width,g=f.height,b=f.x,m=f.y,E=Math.round(u),L=Math.round(h),T=Math.round(l),_=Math.round(c),A=Math.round(b),M=Math.round(m),S=Math.round(p),N=Math.round(g);A===E&&(L<M?(e.beginPath(),e.moveTo(E,L),e.lineTo(A,M+N+s),e.stroke()):(e.beginPath(),e.moveTo(A,M),e.lineTo(E,L+_+s),e.stroke())),A+S===E+T&&(L<M?(e.beginPath(),e.moveTo(E+T,L),e.lineTo(A+S,M+N+s),e.stroke()):(e.beginPath(),e.moveTo(A+S,M),e.lineTo(E+T,L+_+s),e.stroke())),M===L&&(E<A?(e.beginPath(),e.moveTo(E,L),e.lineTo(A+S,M),e.stroke()):(e.beginPath(),e.moveTo(A,M),e.lineTo(E+T,L),e.stroke())),M+N===L+_&&(E<A?(e.beginPath(),e.moveTo(E,L+_+s),e.lineTo(A+S,M+N+s),e.stroke()):(e.beginPath(),e.moveTo(A,M+N+s),e.lineTo(E+T,L+_+s),e.stroke()))}}}getCanvasMenuOptions(){let e=null;if(this.getMenuOptions?e=this.getMenuOptions():(e=[{content:"노드 추가",has_submenu:!0,callback:_LGraphCanvas.onMenuAdd.bind(this)},{content:"그룹 추가",callback:_LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&e.push({content:"정렬",has_submenu:!0,callback:_LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&e.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){const t=this.getExtraMenuOptions(this,e);t&&(e=e.concat(t))}return e}processContextMenu(e,t){const r=this,a=_LGraphCanvas.active_canvas.getCanvasWindow();if(!a)return;let s=null;const o={event:t,callback:c,extra:e};e&&(o.title=e.type);let l=null;if(e&&(l=e.getSlotInPosition(t.canvasX,t.canvasY),_LGraphCanvas.active_node=e),l){if(s=[],e.getSlotMenuOptions)s=e.getSlotMenuOptions(l);else{l&&l.output&&l.output.links&&l.output.links.length&&s.push({content:"Disconnect Links",slot:l});const u=l.input||l.output;u.removable&&s.push(u.locked?"Cannot remove":{content:"Remove Slot",slot:l}),u.nameLocked||s.push({content:"Rename Slot",slot:l})}o.title=(l.input?l.input.type:l.output.type)||"*",l.input&&l.input.type==LiteGraph.ACTION&&(o.title="Action"),l.output&&l.output.type==LiteGraph.EVENT&&(o.title="Event")}else if(e)s=this.getNodeMenuOptions(e);else{s=this.getCanvasMenuOptions();const u=this.graph.getGroupOnPos(t.canvasX,t.canvasY);u&&s.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:u,options:this.getGroupMenuOptions(u)}})}if(!s)return;new ContextMenu(s,o,a);function c(u,h,d){if(u){if(u.content=="Remove Slot"){const f=u.slot;e.graph.beforeChange(),f.input?e.removeInput(f.slot):f.output&&e.removeOutput(f.slot),e.graph.afterChange();return}else if(u.content=="Disconnect Links"){const f=u.slot;e.graph.beforeChange(),f.output?e.disconnectOutput(f.slot):f.input&&e.disconnectInput(f.slot),e.graph.afterChange();return}else if(u.content=="Rename Slot"){const f=u.slot,p=f.input?e.getInputInfo(f.slot):e.getOutputInfo(f.slot),g=r.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",h),b=g.querySelector("input");b&&p&&(b.value=p.label||"");const m=function(){e.graph.beforeChange(),b.value&&(p&&(p.label=b.value),r.setDirty(!0)),g.close(),e.graph.afterChange()};g.querySelector("button").addEventListener("click",m),b.addEventListener("keydown",function(E){if(g.is_modified=!0,E.keyCode==27)g.close();else if(E.keyCode==13)m();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}),b.focus()}}}}};$(_LGraphCanvas,"DEFAULT_BACKGROUND_IMAGE","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII="),$(_LGraphCanvas,"link_type_colors",{"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"}),$(_LGraphCanvas,"gradients",{}),$(_LGraphCanvas,"search_limit",-1),$(_LGraphCanvas,"node_colors",{red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}});let LGraphCanvas=_LGraphCanvas;class ContextMenu{constructor(t,r){r=r||{},this.options=r;const n=this;r.parentMenu&&(r.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),r.parentMenu=null):(this.parentMenu=r.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));let a=null;r.event&&(a=r.event.constructor.name),a!=="MouseEvent"&&a!=="CustomEvent"&&a!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+a+")"),r.event=null);const s=document.createElement("div");s.className="litegraph litecontextmenu litemenubar-panel",r.className&&(s.className+=" "+r.className),s.style.minWidth=100,s.style.minHeight=100,s.style.pointerEvents="none",setTimeout(function(){s.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(s,"up",function(f){return f.preventDefault(),!0},!0),s.addEventListener("contextmenu",function(f){return f.button!=2||f.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(s,"down",function(f){if(f.button==2)return n.close(),f.preventDefault(),!0},!0);function o(f){const p=parseInt(s.style.top);return s.style.top=(p+f.deltaY*r.scroll_speed).toFixed()+"px",f.preventDefault(),!0}if(r.scroll_speed||(r.scroll_speed=.1),s.addEventListener("wheel",o,!0),s.addEventListener("mousewheel",o,!0),this.root=s,r.title){const f=document.createElement("div");f.className="litemenu-title",f.innerHTML=r.title,s.appendChild(f)}for(let f=0;f<t.length;f++){let p=t.constructor==Array?t[f]:f;p!=null&&p.constructor!==String&&(p=p.content===void 0?String(p):p.content);const g=t[f];this.addItem(p,g,r)}LiteGraph.pointerListenerAdd(s,"enter",function(f){s.closing_timer&&clearTimeout(s.closing_timer)});let l=document;r.event&&(l=r.event.target.ownerDocument),l||(l=document),l.fullscreenElement?l.fullscreenElement.appendChild(s):l.body.appendChild(s);let c=r.left||0,u=r.top||0;if(r.event){if(c=r.event.clientX-10,u=r.event.clientY-10,r.title&&(u-=20),r.parentMenu){const g=r.parentMenu.root.getBoundingClientRect();c=g.left+g.width}const f=document.body.getBoundingClientRect(),p=s.getBoundingClientRect();f.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),f.width&&c>f.width-p.width-10&&(c=f.width-p.width-10),f.height&&u>f.height-p.height-10&&(u=f.height-p.height-10)}s.style.left=c+"px",s.style.top=u+"px",r.scale&&(s.style.transform="scale("+r.scale+")");const d=LGraphCanvas.active_canvas.canvas;this.parent=d.parentElement||document}addItem(t,r,n){const a=this;n=n||{};const s=document.createElement("div");s.className="litemenu-entry submenu";let o=!1;r===null?s.classList.add("separator"):(s.innerHTML=r&&r.title?r.title:t,s.value=r,r&&(r.disabled&&(o=!0,s.classList.add("disabled")),(r.submenu||r.has_submenu)&&s.classList.add("has_submenu")),typeof r=="function"?(s.dataset.value=t,s.onclick_callback=r):s.dataset.value=r,r.className&&(s.className+=" "+r.className)),this.root.appendChild(s),o||s.addEventListener("click",c),!o&&n.autoopen&&LiteGraph.pointerListenerAdd(s,"enter",l);function l(u){const h=this.value;!h||!h.has_submenu||c.call(this,u)}function c(u){const h=this.value;let d=!0;if(a.current_submenu&&a.current_submenu.close(u),n.callback&&n.callback.call(this,h,n,u,a,n.node)===!0&&(d=!1),h&&(h.callback&&!n.ignore_item_callbacks&&h.disabled!==!0&&h.callback.call(this,h,n,u,a,n.extra)===!0&&(d=!1),h.submenu)){if(!h.submenu.options)throw"ContextMenu submenu needs options";new a.constructor(h.submenu.options,{callback:h.submenu.callback,event:u,parentMenu:a,ignore_item_callbacks:h.submenu.ignore_item_callbacks,title:h.submenu.title,extra:h.submenu.extra,autoopen:n.autoopen}),d=!1}d&&!a.lock&&a.close()}return s}close(t,r){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!r&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)}static trigger(t,r,n,a){const s=document.createEvent("CustomEvent");return s.initCustomEvent(r,!0,!0,n),s.srcElement=a,t.dispatchEvent?t.dispatchEvent(s):t.__events&&t.__events.dispatchEvent(s),s}getTopMenu(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this}getFirstEvent(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event}static isCursorOverElement(t,r){const n=t.clientX,a=t.clientY,s=r.getBoundingClientRect();return s?a>s.top&&a<s.top+s.height&&n>s.left&&n<s.left+s.width:!1}}function clamp(e,t,r){return t>e?t:r<e?r:e}typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}),typeof exports<"u"&&(exports.LiteGraph=(void 0).LiteGraph,exports.LGraph=(void 0).LGraph,exports.LLink=(void 0).LLink,exports.LGraphNode=(void 0).LGraphNode,exports.LGraphGroup=(void 0).LGraphGroup,exports.DragAndScale=(void 0).DragAndScale,exports.LGraphCanvas=(void 0).LGraphCanvas,exports.ContextMenu=(void 0).ContextMenu);class RootNode extends LGraphNode{constructor(){super(),this.mode=0,this.addProperty("status",0,"number"),this.addProperty("message","","string")}}class ManualTrigger extends RootNode{constructor(){super(),this.title="수동 시작"}onExecute(){}}LiteGraph.registerNodeType("trigger/manualTrigger",ManualTrigger);class Selector extends LGraphNode{constructor(){super(),this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0,this.title="Selector",this.desc="selects an output"}onDrawBackground(t){if(!this.flags.collapsed){t.fillStyle="#AFB";var r=(this.selected+1)*LiteGraph.NODE_SLOT_HEIGHT+6;t.beginPath(),t.moveTo(50,r),t.lineTo(50,r+LiteGraph.NODE_SLOT_HEIGHT),t.lineTo(34,r+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fill()}}onExecute(){var t=this.getInputData(0);(t==null||t.constructor!==Number)&&(t=0),this.selected=t=Math.round(t)%(this.inputs.length-1);var r=this.getInputData(t+1);r!==void 0&&this.setOutputData(0,r)}onGetInputs(){return[["E",0],["F",0],["G",0],["H",0]]}}class Sequence extends LGraphNode{constructor(){super(),this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(","),this.title="Sequence",this.desc="select one element from a sequence from a string"}onPropertyChanged(t,r){t=="sequence"&&(this.values=r.split(","))}onExecute(){var t=this.getInputData(1);t&&t!=this.current_sequence&&(this.values=t.split(","),this.current_sequence=t);var r=this.getInputData(0);r==null&&(r=0),this.index=r=Math.round(r)%this.values.length,this.setOutputData(0,this.values[r])}}class LogicAnd extends LGraphNode{constructor(){super(),this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean"),this.title="AND",this.desc="Return true if all inputs are true"}onExecute(){var t=!0;for(var r in this.inputs)if(!this.getInputData(r)){var t=!1;break}this.setOutputData(0,t)}onGetInputs(){return[["and","boolean"]]}}class LogicOr extends LGraphNode{constructor(){super(),this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean"),this.title="OR",this.desc="Return true if at least one input is true"}onExecute(){var t=!1;for(var r in this.inputs)if(this.getInputData(r)){t=!0;break}this.setOutputData(0,t)}onGetInputs(){return[["or","boolean"]]}}class LogicNot extends LGraphNode{constructor(){super(),this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean"),this.title="NOT",this.desc="Return the logical negation"}onExecute(){var t=!this.getInputData(0);this.setOutputData(0,t)}}class LogicCompare extends LGraphNode{constructor(){super(),this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean"),this.title="bool == bool",this.desc="Compare for logical equality"}onExecute(){var t=null,r=!0;for(var n in this.inputs)if(t===null)t=this.getInputData(n);else if(t!=this.getInputData(n)){r=!1;break}this.setOutputData(0,r)}onGetInputs(){return[["bool","boolean"]]}}class LogicBranch extends LGraphNode{constructor(){super(),this.properties={},this.addInput("onTrigger",LiteGraph.ACTION),this.addInput("condition","boolean"),this.addOutput("true",LiteGraph.EVENT),this.addOutput("false",LiteGraph.EVENT),this.mode=LiteGraph.ON_TRIGGER,this.title="Branch",this.desc="Branch execution on condition"}onExecute(t,r){var n=this.getInputData(1);n?this.triggerSlot(0):this.triggerSlot(1)}}LiteGraph.registerNodeType("logic/CompareBool",LogicCompare),LiteGraph.registerNodeType("logic/NOT",LogicNot),LiteGraph.registerNodeType("logic/OR",LogicOr),LiteGraph.registerNodeType("logic/AND",LogicAnd),LiteGraph.registerNodeType("logic/sequence",Sequence),LiteGraph.registerNodeType("logic/selector",Selector),LiteGraph.registerNodeType("logic/IF",LogicBranch)})();
